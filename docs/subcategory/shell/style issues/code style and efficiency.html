
<!DOCTYPE html>
<html lang="en">

<head>
    <link href='../../../theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="../../../theme/stylesheet/normalize.min.css">
    <script src="../../../theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="../../../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../../../theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="../../../theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">      <meta name="author" content="Pinpoint Team"/>
    <meta name="description" content="Manual and documents for Sourcebrella Pinpoint"/> <meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Pinpoint Document"/>
<meta property="og:description" content="Manual and documents for Sourcebrella Pinpoint"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../.."/>
 
    <title>Pinpoint Document &ndash; Category</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href="../../..">
                <img src="../../../theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href="../../..">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="../../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="Input to search">
            </form>
        </div>


        <ul class="global_lang">
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="../../../standard/language-independent.html">Language Independent documents</a>
                        (3)
                    </li>
                    <li>
                        <a href="../../../standard/c.html">c/c++ documents</a>
                        (317)
                    </li>
                    <li>
                        <a href="../../../standard/csharp.html">csharp documents</a>
                        (39)
                    </li>
                    <li>
                        <a href="../../../standard/golang.html">golang documents</a>
                        (34)
                    </li>
                    <li>
                        <a href="../../../standard/java.html">java documents</a>
                        (555)
                    </li>
                    <li>
                        <a href="../../../standard/javascript.html">javascript documents</a>
                        (295)
                    </li>
                    <li>
                        <a href="../../../standard/objective-c.html">objective-c documents</a>
                        (124)
                    </li>
                    <li>
                        <a href="../../../standard/python.html">python documents</a>
                        (618)
                    </li>
                    <li>
                        <a href="../../../standard/shell.html">shell documents</a>
                        (334)
                    </li>
                    <li>
                        <a href="../../../standard/swift.html">swift documents</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
          <article>
            <h1>
            Code style and efficiency (334)
            </h1>
        </article>
        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2162">Improper use of read command</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#read-without-r-will-mangle-backslashes">read without -r will mangle backslashes</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="read-without-r-will-mangle-backslashes">read without -r will mangle backslashes</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Enter name:"</span>
<span class="nb">read</span> name
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Enter name:"</span>
<span class="nb">read</span> -r name
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>By default, <code>read</code> will interpret backslashes before spaces and line feeds, and otherwise strip them. This is rarely expected or desired.</p>
<p>Normally you just want to read data, which is what <code>read -r</code> does. You should always use <code>-r</code> unless you have a good reason not to.</p>
<p>Note that <a href="https://www.tldp.org/LDP/abs/html/internal.html#READR"><code>read -r</code></a> will still strip leading and trailing spaces. <code>IFS="" read -r</code> prevents this.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you want backslashes to affect field splitting and line terminators instead of being read, you can disable this message with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1086">Using '$' on the iterator name in for loops.</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-use-on-the-iterator-name-in-for-loops">Don't use $ on the iterator name in for loops.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="dont-use-on-the-iterator-name-in-for-loops">Don't use $ on the iterator name in for loops.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nv">$var</span> in *
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> var in *
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The variable is named <code>var</code>, and can be expanded to its value with <code>$var</code>.</p>
<p>The <code>for</code> loop expects the variable's name, not its value (and the name can not be specified indirectly).</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1049">Missing 'then' for 'if'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#did-you-forget-the-then-for-this-if">Did you forget the 'then' for this 'if'?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="did-you-forget-the-then-for-this-if">Did you forget the 'then' for this 'if'?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
  <span class="nb">echo</span> <span class="s2">"foo"</span>
<span class="k">elif</span> <span class="nb">true</span>
  <span class="nb">echo</span> <span class="s2">"bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"foo"</span>
<span class="k">elif</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a parsing error in the script, and determined that it's most likely due to a missing <code>then</code> keyword for the <code>if</code> or <code>elif</code> indicated.</p>
<p>Make sure the <code>then</code> is there. </p>
<p>Note that the <code>then</code> needs a <code>;</code> or linefeed before it. <code>if true then</code> is invalid, while <code>if true; then</code> is correct.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2112">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#function-keyword-is-non-standard-delete-it">'function' keyword is non-standard. Delete it.</a></li>
</ul>
</div>

            <div>
                
<h1 id="function-keyword-is-non-standard-delete-it">'function' keyword is non-standard. Delete it.</h1>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2157">Improper use of '-n'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#argument-to-implicit-n-is-always-true-due-to-literal-strings">Argument to implicit -n is always true due to literal strings.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="argument-to-implicit-n-is-always-true-due-to-literal-strings">Argument to implicit -n is always true due to literal strings.</h2>
<p>(Or: Argument to -z is always false due to literal strings. )</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2"> "</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"this is always true because of the trailing space"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"correctly checks value"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Since <code>[ str ]</code> and <code>[ -n str ]</code> check that the string is non-empty, any literal characters in the string -- including a space character like in the example -- will cause the test to always be true.</p>
<p>Equivalently, since <code>[ -z str ]</code> checks that the string is empty, any literal character in the string will cause the test to always be false.</p>
<p>Double check the string: you may have added trailing characters, or bad quotes or syntax. Some examples include:</p>
<ul>
<li><code>[ "$foo " ]</code> like in the example, where the space becomes part of the string</li>
<li><code>[ "{$foo}" ]</code> instead of <code>[ "${foo}" ]</code>, where the <code>{</code> becomes part of the string</li>
<li><code>[ "$foo -gt 0" ]</code> instead of <code>[ "$foo" -gt "0" ]</code>, where the <code>-gt</code> becomes part of the string</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2106">Ineffective exit</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sc2106-this-only-exits-the-subshell-caused-by-the-pipeline">SC2106: This only exits the subshell caused by the pipeline.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sc2106-this-only-exits-the-subshell-caused-by-the-pipeline">SC2106: This only exits the subshell caused by the pipeline.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> hi <span class="p">|</span> grep -q bye <span class="p">|</span> <span class="nb">break</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> hi <span class="p">|</span> grep -q bye <span class="o">||</span> <span class="nb">break</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The most common cause of this issue is probably using a single <code>|</code> when <code>||</code> was intended.  The reason this message appears, though, is that a construction like this, intended to surface a failure inside of a loop:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span> <span class="nb">false</span> <span class="p">|</span> break<span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span>
</pre></div>
</td></tr></table>
<p>may appear to work:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span> <span class="nb">false</span> <span class="p">|</span> break<span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span>
<span class="m">1</span> <span class="m">0</span>
</pre></div>
</td></tr></table>
<p>What's actually happening, though, becomes clear if we add some <code>echo</code>s; the entire loop completes, and the <code>break</code> has no effect.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="nb">false</span> <span class="p">|</span> break<span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span>
a
b
c
<span class="m">1</span> <span class="m">0</span>
$ <span class="k">for</span> i in a b c<span class="p">;</span> <span class="k">do</span> <span class="nb">false</span> <span class="p">|</span> break<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span>
a
b
c
<span class="m">0</span>
</pre></div>
</td></tr></table>
<p>Because bash processes pipelines by creating subshells, control statements like <code>break</code> only take effect in the subshell.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Contrast with the related, but different, problem in <a href="https://unix.stackexchange.com/questions/166546/bash-cannot-break-out-of-piped-while-read-loop-process-substitution-works">this link</a>.</li>
<li><a href="https://www.gnu.org/software/bash/manual/bash.html#Pipelines">Bash Reference Manual: Pipelines</a>, esp.:
     &gt; Each command in a pipeline is executed in its own subshell.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2165">Improper loop</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-nested-loop-overrides-the-index-variable-of-its-parent">This nested loop overrides the index variable of its parent.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-nested-loop-overrides-the-index-variable-of-its-parent">This nested loop overrides the index variable of its parent.</h2>
<p>And companion warning "This parent loop has its index variable overridden."</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> i&lt;<span class="m">10</span><span class="p">;</span> i++<span class="o">))</span>
<span class="k">do</span>
  <span class="k">for</span> i in *
  <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
  <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> i&lt;<span class="m">10</span><span class="p">;</span> i++<span class="o">))</span>
<span class="k">do</span>
  <span class="k">for</span> j in *
  <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$j</span><span class="s2">"</span>
  <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When nesting loops, especially arithmetic for loops, using the same loop variable can cause unexpected results.</p>
<p>In the problematic code, <code>i</code> will contain the last filename from the inner loop, which will be interpreted as a value in the next iteration out the outer loop. This results in either an infinite loop or a syntax error, depending on whether the last filename is a valid shell variable name.</p>
<p>In nested for-in loops, variable merely shadow each other and won't cause infinite loops or syntax errors, but reusing the variable name is rarely intentional.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2126">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#consider-using-grep-c-instead-of-grepwc">Consider using grep -c instead of grep|wc.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="consider-using-grep-c-instead-of-grepwc">Consider using grep -c instead of grep|wc.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep foo <span class="p">|</span> wc -l
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep -c foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is purely a stylistic issue. <code>grep</code> can count lines without piping to <code>wc</code>.</p>
<p>Note that in many cases, this number is only used to see whether there are matches (i.e. <code>== 0</code>). In these cases, it's better and more efficient to use <code>grep -q</code> and check its exit status:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> grep -q pattern file
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"The file contains the pattern"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>Also note that in <code>foo | grep bar | wc -l</code>, wc will mask the exit code of grep by default (i.e. without <code>set -o pipefail</code>), and always return success. If replacing with <code>foo | grep -c bar</code>, grep will exit non-zero when the count is 0. This is convenient for conditional statements but may require handling when used with <code>set -e</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you e.g. want to count characters instead of lines, and you actually care about the number and not just whether it's greater than 0, you can [[ignore]] this error.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2139">Improper variable expension</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-expands-when-defined-not-when-used-consider-escaping">This expands when defined, not when used. Consider escaping.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-expands-when-defined-not-when-used-consider-escaping">This expands when defined, not when used. Consider escaping.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">alias</span> <span class="nv">whereami</span><span class="o">=</span><span class="s2">"echo </span><span class="nv">$PWD</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">alias</span> <span class="nv">whereami</span><span class="o">=</span><span class="s1">'echo $PWD'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>With double quotes, this particular alias will be defined as <code>echo /home/me</code>, so it will always print the same path. This is rarely intended.</p>
<p>By using single quotes or escaping any expansions, we define the alias as <code>echo $PWD</code>, which will be expanded when we use the alias. This is the far more common use case.</p>
<p>Note that even if you expect that the variable will never change, it may still be better to quote it. This prevents a second round of evaluation later:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>default="Can't handle failure, aborting"
trap "echo $default; exit 1" err
false
</pre></div>
</td></tr></table>
<p>The trap now has a syntax error, because instead of running <code>echo $default</code>, it runs <code>echo Can't handle ..</code> which has an unmatched single quote. Avoid early expansion unless you're equally comfortable putting <code>eval</code> in there.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you don't mind that your alias definition is expanded at define time (and its result expanded again at evaluation time), you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2251">Using '!' outside conditions</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-not-on-a-condition-and-skips-errexit-use-exit-1-instead-or-make-sure-is-checked">This ! is not on a condition and skips errexit. Use &amp;&amp; exit 1 instead, or make sure $? is checked.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-not-on-a-condition-and-skips-errexit-use-exit-1-instead-or-make-sure-is-checked">This ! is not on a condition and skips errexit. Use <code>&amp;&amp; exit 1</code> instead, or make sure $? is checked.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> -e
! <span class="nb">false</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> -e
! <span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a command inverted with <code>!</code> that may have no effect. In particular, it does not appear as a condition in an <code>if</code> statement or <code>while</code> loop, or as the final command in a script or function.</p>
<p>The most common reason for this is thinking that it'll trigger <code>set -e</code> aka <code>errexit</code> if a command succeeds, as in the example. This is not the case: <code>!</code> will inhibit errexit both on success and failure of the inverted command.</p>
<p>Using <code>&amp;&amp; exit</code> will instead exit when failure when the command succeeds.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck will not detect cases where <code>$?</code> is implicitly or explicitly used to check the value afterwards:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>set -e;
check_success() { [ $? -eq 0 ] || exit 1; }
! false; check_success
! true; check_success
</pre></div>
</td></tr></table>
<p>In this case, you can [[ignore]] the warning.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>StackOverflow: <a href="https://stackoverflow.com/questions/39581150/why-do-i-need-parenthesis-in-bash-set-e-and-negated-return-code/39582012">Why do I need parenthesis In bash <code>set -e</code> and negated return code</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2102">Suspicious string matching</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#ranges-can-only-match-single-chars-mentioned-due-to-duplicates">Ranges can only match single chars (mentioned due to duplicates).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="ranges-can-only-match-single-chars-mentioned-due-to-duplicates">Ranges can only match single chars (mentioned due to duplicates).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="o">[</span><span class="m">100</span>-999<span class="o">]</span>.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="o">[</span><span class="m">1</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">]</span>.txt
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a glob range expression (such as <code>[a-z]</code>) that contains multiple of the same character.</p>
<p>Range expressions can only be used to match a single character in a given set, so <code>[ab]</code> and <code>[abba]</code> will both match the same thing: either one <code>a</code> or one <code>b</code>. </p>
<p>Having multiple of the same character often means you're trying to match more than one character, such as in the problematic example where someone tried to match any number from 100 to 999. Instead, it matches a single digit just like <code>[0-9].txt</code>, and specifies 0, 1 and 9 multiple times.</p>
<p>In Bash, most uses can be rewritten using <a href="https://mywiki.wooledge.org/glob#extglob">extglob</a> and/or <a href="https://mywiki.wooledge.org/BraceExpansion">brace expansion</a>. For example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat *.<span class="o">[</span>dev,prod,test<span class="o">]</span>.conf   <span class="c1"># Doesn't work</span>
cat *.<span class="o">{</span>dev,prod,test<span class="o">}</span>.conf   <span class="c1"># Works in bash</span>
cat *.@<span class="o">(</span>dev<span class="p">|</span>prod<span class="p">|</span><span class="nb">test</span><span class="o">)</span>.conf  <span class="c1"># Works in bash with `shopt -s extglob`</span>
</pre></div>
</td></tr></table>
<p>In POSIX sh, you may have to write multiple globs, one after the other:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat *.dev.conf *.prod.conf *.test.conf
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>There is currently a bug in which a range expression whose contents is a variable gets parsed verbatim, e.g. <code>[$foo]</code>. In this case, either ignore the warning or make the square brackets part of the variable contents instead.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2064">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-single-quotes-otherwise-this-expands-now-rather-than-when-signalled">Use single quotes, otherwise this expands now rather than when signalled.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-single-quotes-otherwise-this-expands-now-rather-than-when-signalled">Use single quotes, otherwise this expands now rather than when signalled.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> <span class="s2">"echo \"Finished on </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">\""</span> EXIT
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> <span class="s1">'echo "Finished on $(date)"'</span> EXIT
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>With double quotes, all parameter and command expansions will expand when the trap is defined rather than when it's executed.</p>
<p>In the example, the message will contain the date on which the trap was declared, and not the date on which the script exits.</p>
<p>Using single quotes will prevent expansion at declaration time, and save it for execution time.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you don't care that the trap code is expanded early because the commands/variables won't change during execution of the script, or because you want to use the current and not the future values, then you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2011">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-find-print0-or-find-exec-to-better-handle-non-alphanumeric-filenames">Use find -print0 or find -exec to better handle non-alphanumeric filenames.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-find-print0-or-find-exec-to-better-handle-non-alphanumeric-filenames">Use <code>find -print0</code> or <code>find -exec</code> to better handle non-alphanumeric filenames.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls <span class="p">|</span> xargs -n1 wc -w
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -maxdepth <span class="m">1</span> -print0 <span class="p">|</span> xargs -0 -n1 wc -w
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -maxdepth <span class="m">1</span> -exec wc -w <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Using <code>-print0</code> separates each output with a NUL character, rather than a newline, which is safer to pipe into <code>xargs</code>. Alternatively using <code>-exec</code> avoids the problem of piping and parsing filenames in the first place.</p>
<p>See [[SC2012]] for more details on this issue.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2166">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#prefer-p-q-as-p-a-q-is-not-well-defined">Prefer [ p ] &amp;&amp; [ q ] as [ p -a q ] is not well defined.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="prefer-p-q-as-p-a-q-is-not-well-defined">Prefer [ p ] &amp;&amp; [ q ] as [ p -a q ] is not well defined.</h2>
<p>And likewise, prefer <code>[ p ] || [ q ]</code> over <code>[ p -o q ]</code>.</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span> -a -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>-a</code> and <code>-o</code> to mean AND and OR in a <code>[ .. ]</code> test expression is not well defined, and can cause incorrect results when arguments start with dashes or contain <code>!</code>. <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html">From POSIX</a>:</p>
<blockquote>
<p>The XSI extensions specifying the -a and -o binary primaries and the '(' and ')' operators have been marked obsolescent. (Many expressions using them are ambiguously defined by the grammar depending on the specific expressions being evaluated.) Scripts using these expressions should be converted to the forms given below. Even though many implementations will continue to support these obsolescent forms, scripts should be extremely careful when dealing with user-supplied input that could be confused with these and other primaries and operators. Unless the application developer knows all the cases that produce input to the script, invocations like:</p>
<p><code>test "$1" -a "$2"</code></p>
<p>should be written as:</p>
<p><code>test "$1" &amp;&amp; test "$2"</code></p>
</blockquote>
<p>Using multiple <code>[ .. ]</code> expressions with shell AND/OR operators <code>&amp;&amp;</code> and <code>||</code> is well defined and therefore preferred (but note that they have equal precedence, while <code>-a</code>/<code>-o</code> is unspecified but usually implemented as <code>-a</code> having higher precedence).</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the shell variant being used is ksh derived (such as the bash shell) it will have the shell builtin command <code>[[ ... ]]</code>. This has the operators <code>&amp;&amp;</code>, <code>||</code>, <code>(</code>, <code>)</code>, <code>!</code> which safely avoid the ambiguity by noting which arguments were quoted and requiring the operators to be unquoted (except by the <code>[[ ... ]]</code> construct itself).</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2241">Improper return value</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-exit-status-can-only-be-one-integer-0-255-use-stdout-for-other-data">The exit status can only be one integer 0-255. Use stdout for other data.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-exit-status-can-only-be-one-integer-0-255-use-stdout-for-other-data">The exit status can only be one integer 0-255. Use stdout for other data.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">exit</span> foo bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> foo
<span class="nb">echo</span> bar
<span class="nb">exit</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In bash, <code>exit</code> can only be used to signal success or failure (0 = success, 1-255 = failure).</p>
<p>To exit with textual or multiple values from a function, write them to stdout and capture them with command substitution instead.</p>
<p>See [[SC2242]] for more information.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2223">Potencial danger by using wildcard</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-default-assignment-may-cause-dos-due-to-globbing-quote-it">This default assignment may cause DoS due to globbing. Quote it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-default-assignment-may-cause-dos-due-to-globbing-quote-it">This default assignment may cause DoS due to globbing. Quote it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="si">${</span><span class="nv">COLUMNS</span><span class="p">:=80</span><span class="si">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="s2">"</span><span class="si">${</span><span class="nv">COLUMNS</span><span class="p">:=80</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This statement is an idiomatic way of assigning a default value to an environment variable. However, even though it's passed to <code>:</code> which ignores arguments, it's better to quote it.</p>
<p>If <code>COLUMNS='/*/*/*/*/*/*'</code>, the unquoted, problematic code may spend 30+ minutes trashing the disk as it unnecessarily tries to glob expand the value. </p>
<p>The correct code uses double quotes to avoid glob expansion, and therefore does not have this problem.</p>
<p>When quoting, make sure to update any inner quotes:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="cp">${</span><span class="n">var</span><span class="p">:</span><span class="o">=</span><span class="s1">'foo'</span><span class="cp">}</span>    # Assigns foo without quotes
: "<span class="cp">${</span><span class="n">var</span><span class="p">:</span><span class="o">=</span><span class="s1">'foo'</span><span class="cp">}</span>"  # Assigns 'foo' with quotes
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None, though this issue is largely theoretical.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1052">Improper Semicolons directly after 'then'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#semicolons-directly-after-then-are-not-allowed-just-remove-it">Semicolons directly after 'then' are not allowed. Just remove it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="semicolons-directly-after-then-are-not-allowed-just-remove-it">Semicolons directly after 'then' are not allowed. Just remove it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> true<span class="p">;</span> <span class="k">then</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Hi"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> true<span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"Hi"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>then</code> keywords should not be followed by semicolons. It's not valid shell syntax.</p>
<p>You can follow them directly with a line break or another command.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2040">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#binsh-was-specified-so-____-is-not-supported-even-when-sh-is-actually-bash">#!/bin/sh was specified, so ____ is not supported, even when sh is actually bash.</a></li>
</ul>
</div>

            <div>
                
<h2 id="binsh-was-specified-so-____-is-not-supported-even-when-sh-is-actually-bash">#!/bin/sh was specified, so ____ is not supported, even when sh is actually bash.</h2>
<p>The shebang indicates that the script works with <code>/bin/sh</code>, but you are using non-standard features that may not work with <code>/bin/sh</code>, <strong>even if /bin/sh is actually bash</strong>. Bash behaves differently when invoked as <code>sh</code>, and disabling support for the highlighted feature is one part of that.</p>
<p>Specify <code>#!/usr/bin/env bash</code> to ensure that bash (or your shell of choice) will be used, or rewrite the script to be more portable.</p>
<p>The Ubuntu wiki has <a href="https://wiki.ubuntu.com/DashAsBinSh">a list of portability issues</a> and suggestions on how to rewrite them.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2067">Missing ';' or + terminating -exec</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#missing-or-terminating-exec-you-cant-use-and-has-to-be-a-separate-quoted-argument">Missing ';' or + terminating -exec. You can't use |/||/&amp;&amp;, and ';' has to be a separate, quoted argument.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="missing-or-terminating-exec-you-cant-use-and-has-to-be-a-separate-quoted-argument">Missing ';' or + terminating -exec. You can't use |/||/&amp;&amp;, and ';' has to be a separate, quoted argument.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -exec shellcheck <span class="o">{}</span> <span class="p">|</span> wc -l <span class="se">\;</span>
find . -exec <span class="nb">echo</span> <span class="o">{}</span> <span class="p">;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -exec sh -c <span class="s1">'shellcheck "$1" | wc -l'</span> -- <span class="o">{}</span> <span class="se">\;</span>
find . -exec <span class="nb">echo</span> <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>find -exec</code> is still subject to all normal shell rules, so all shell features like <code>|</code>, <code>||</code>, <code>&amp;</code> and <code>&amp;&amp;</code> will apply to the <code>find</code> command itself, and not to the command you are trying to construct with <code>-exec</code>.</p>
<p><code>find . -exec foo {} &amp;&amp; bar {} \;</code> means run the command <code>find . -exec foo {}</code>, and if find is successful, run the command <code>bar "{}" ";"</code>.</p>
<p>To instead go through each file and run <code>foo file &amp;&amp; bar file</code> on it, invoke a shell that can interpret <code>&amp;&amp;</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -exec sh <span class="s1">'foo "$1" &amp;&amp; bar "$1"'</span> -- <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<p>You can also use find <code>-a</code> instead of shell <code>&amp;&amp;</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -exec foo <span class="o">{}</span> <span class="se">\;</span> -a -exec bar <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<p>This will have the same effect (<code>-a</code> is also the default when two commands are specified, and can therefore be omitted).</p>
<h3 id="exceptions">Exceptions</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1108">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-and-after-the">You need a space before and after the = .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-and-after-the">You need a space before and after the = .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span><span class="o">=</span> <span class="m">2</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">=</span> <span class="m">2</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be missing the space on the left side of the operator. Shell in general, and <code>[</code> in particular, is space sensitive. Operators and operands must be separate tokens. </p>
<p>Please ensure that the operator, like the <code>=</code> in the example, has a space both before and after it.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you're comparing values in C style reverse order like <code>[ -eq == $1 ]</code>, use quotes: <code>[ "-eq" == "$1" ]</code>. Also, it's pointless since <code>[ a = b ]</code> doesn't assign.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1010">Missing semicolon or linefeed before 'done'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-semicolon-or-linefeed-before-done-or-quote-to-make-it-literal">Use semicolon or linefeed before 'done' (or quote to make it literal).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-semicolon-or-linefeed-before-done-or-quote-to-make-it-literal">Use semicolon or linefeed before 'done' (or quote to make it literal).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>for f in *; do echo "$f" done
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo $f is done
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>for f in *; do echo "$f"; done
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo "$f is done"
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>done</code> only works as a keyword when it's the first token of the command. If added after a command, it will just be the literal word "done". </p>
<p>This is also true for other keywords like <code>then</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're intentionally using <code>done</code> as a literal, you can quote it to make this clear to shellcheck (and also human readers), e.g. instead of <code>echo Task is done</code>, use <code>echo "Task is done"</code>. This makes no difference to the shell, but it will silence this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1038">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shells-are-space-sensitive-use-cmd-not-cmd">Shells are space sensitive. Use '&lt; &lt;(cmd)', not '&lt;&lt;(cmd)'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="shells-are-space-sensitive-use-cmd-not-cmd">Shells are space sensitive. Use '&lt; &lt;(cmd)', not '&lt;&lt;(cmd)'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line
<span class="k">do</span>
  <span class="nb">printf</span> <span class="s2">"%q\n"</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span> &lt;&lt;<span class="o">(</span>curl -s http://example.com<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line
<span class="k">do</span>
  <span class="nb">printf</span> <span class="s2">"%q\n"</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span> &lt;  &lt;<span class="o">(</span>curl -s http://example.com<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using <code>&lt;&lt;(</code> which is an invalid construct.</p>
<p>You probably meant to redirect <code>&lt;</code> from process substitution <code>&lt;(..)</code> instead. To do this, a space is needed between the <code>&lt;</code> and <code>&lt;(..)</code>, i.e. <code>&lt; &lt;(cmd)</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1084">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-not-for-the-shebang">Use #!, not !#, for the shebang.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-not-for-the-shebang">Use #!, not !#, for the shebang.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>!#/bin/sh
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The shebang has been accidentally swapped. The <code>#</code> should come first: <code>#!</code>, not <code>!#</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1016">Unicode single quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-single-quote-delete-and-retype-it">This is a Unicode single quote. Delete and retype it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#status">Status:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-single-quote-delete-and-retype-it">This is a Unicode single quote. Delete and retype it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> ‘hello world’
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'hello world'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Some software, like OS X, Word and WordPress, may automatically replace your regular quotes with slanted Unicode quotes. Try deleting and retyping them, and/or disable “smart quotes” in your editor or OS.</p>
<h3 id="status">Status:</h3>
<p>This error was retired after 0.4.5. In this version and earlier, ShellCheck parsed slanted quotes as a valid double quote. This meant that the warning could not simply be ignored. It has since been replaced by [[SC1110]] (outside quotes) and [[SC1112]] (inside single quotes).</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to use typographic single quotes, you can put them in double quotes (or typographic double quotes in single quotes) to make shellcheck ignore them, e.g.,</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Warning: ‘wakeonlan’ is not installed.\n"</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1077">Improper quote for command expension</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#for-command-expansion-the-tick-should-slant-left-vs">For command expansion, the tick should slant left (` vs ´).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="for-command-expansion-the-tick-should-slant-left-vs">For command expansion, the tick should slant left (` vs ´).</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Your username is ´whoami´"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Your username is </span><span class="k">$(</span>whoami<span class="k">)</span><span class="s2">"</span> <span class="c1"># Preferred</span>
<span class="nb">echo</span> <span class="s2">"Your username is `whoami`"</span>  <span class="c1"># Deprecated, will give [SC2006]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In some fonts it's hard to tell ticks apart, but Bash strongly distinguishes between backticks (grave accent <code>`</code>), forward ticks (acute accent <code>´</code>) and regular ticks (apostrophe <code>'</code>).</p>
<p>Backticks start command expansions, while forward ticks are literal. To help spot bugs, ShellCheck parses backticks and forward ticks interchangeably.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to write out literal forward ticks, such as fancyful ascii quotation marks:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"``Proprietary software is an injustice.´´  - Richard Stallman"</span>
</pre></div>
</td></tr></table>
<p>use single quotes instead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'``Proprietary software is an injustice.´´  - Richard Stallman'</span>
</pre></div>
</td></tr></table>
<p>To nest forward ticks in command expansion, use <code>$(..)</code> instead of <code>`..`</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2238">Improper file redirection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#redirecting-tofrom-command-name-instead-of-file-did-you-want-pipesxargs-or-quote-to-ignore">Redirecting to/from command name instead of file. Did you want pipes/xargs (or quote to ignore)?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="redirecting-tofrom-command-name-instead-of-file-did-you-want-pipesxargs-or-quote-to-ignore">Redirecting to/from command name instead of file. Did you want pipes/xargs (or quote to ignore)?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat file &gt; tr -d <span class="s1">'\r'</span>
cat file &gt; rm
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat file <span class="p">|</span> tr -d <span class="s1">'\r'</span>         <span class="c1"># tr reads stdin</span>
cat file <span class="p">|</span> xargs -d <span class="s1">'\n'</span> rm   <span class="c1"># rm reads arguments</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using file redirection, but the filename is an unquoted command name. Instead of running the command and feeding data to it, this just writes to a file with the same name. </p>
<p>To run the command and feed data to it, determine how it gets its data:</p>
<ul>
<li>If the command reads from STDIN, simply use a pipe as in the first example.</li>
<li>If the command reads multiple arguments, use a pipe to <code>xargs</code> as in the second example</li>
</ul>
<p>Note that <code>xargs</code> has many pitfalls when it comes to spaces and quotes. <code>cat file | xargs rm</code>  will appear to work during testing, but fails for filenames like <code>My File.txt</code> or <code>Can't_Fight_This_Feeling.mp3</code>. The example uses the GNU extension <code>-d '\n'</code> to more safely handle these names. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you actually did want to write a file named after a command, simply quote the filename to let ShellCheck know you meant it literally and not as a command name. This does not change anything about how the script works:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Write to a file literally named 'rm', does not try to delete anything</span>
<span class="nb">echo</span> <span class="s2">"A potentially dangerous command"</span> &gt; <span class="s2">"rm"</span> 
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2070">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#-n-doesnt-work-with-unquoted-arguments-quote-or-use">-n doesn't work with unquoted arguments. Quote or use [[ ]].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="-n-doesnt-work-with-unquoted-arguments-quote-or-use"><code>-n</code> doesn't work with unquoted arguments. Quote or use <code>[[ ]]</code>.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -n <span class="nv">$var</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"var has a value"</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">"var is empty"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>In POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"var has a value"</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">"var is empty"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>In bash/ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$var</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"var has a value"</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">"var is empty"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When <code>$var</code> is unquoted, a blank value will cause it to wordsplit and disappear. If <code>$var</code> is empty, these two statements are identical:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -n <span class="nv">$var</span> <span class="o">]</span>
<span class="o">[</span> -n <span class="o">]</span>
</pre></div>
</td></tr></table>
<p><code>[ string ]</code> is shorthand for testing if a string is empty. This is still true if <code>string</code> happens to be <code>-n</code>. <code>[ -n ]</code> is therefore true, and by extension so is <code>[ -n $var ]</code>.</p>
<p>To fix this, either quote the variable, or (if your shell supports it) use <code>[[ -n $var ]]</code> which generally has fewer caveats than <code>[</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1126">Improper ShellCheck directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#place-shellcheck-directives-before-commands-not-after">Place shellcheck directives before commands, not after.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="place-shellcheck-directives-before-commands-not-after">Place shellcheck directives before commands, not after.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="m">1</span> <span class="c1"># shellcheck disable=SC2034</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC2034</span>
<span class="nv">var</span><span class="o">=</span><span class="m">1</span> 
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck expects directives to come before the relevant command. They are not allowed after.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If this is not a directive and just a comment mentioning ShellCheck, please rewrite or capitalize:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>var=1 # ShellCheck encourages lowercase variable names
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1009">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-mentioned-parser-error-was-in">The mentioned parser error was in ...</a></li>
</ul>
</div>

            <div>
                
<h1 id="the-mentioned-parser-error-was-in">The mentioned parser error was in ...</h1>
<p>This info warning points to the start of what ShellCheck was parsing when it failed. See [[Parser error]] for example and information.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2247">Improper use of Quotes/backslashes</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#flip-leading-and-if-this-should-be-a-quoted-substitution">Flip leading $ and " if this should be a quoted substitution.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="flip-leading-and-if-this-should-be-a-quoted-substitution">Flip leading $ and " if this should be a quoted substitution.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">$"(whoami)"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>whoami<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a <code>$"(</code> or <code>$"{</code> . This is most likely due to flipping the dollar-sign and double quote:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo $"(cmd)"  # Supposed to be "$(cmd)"
echo $"{var}"  # Supposed to be "<span class="cp">${</span><span class="n">var</span><span class="cp">}</span>"
</pre></div>
</td></tr></table>
<p>Instead of quoted substitutions, these will be interpreted as localized string resources (<code>$".."</code>) containing literal parentheses or curly braces. If this was not intentional, you should flip the <code>"</code> and <code>$</code> like in the example.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you intentionally wanted a localized string literal <code>$".."</code> that starts with <code>(</code> or <code>{</code>, either [[ignore]] this error or start it with a different character.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2163">Misuse of '$/${}'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-does-not-export-foo-remove-for-that-or-use-var-to-quiet">This does not export 'FOO'. Remove $/${} for that, or use ${var?} to quiet.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-does-not-export-foo-remove-for-that-or-use-var-to-quiet">This does not export 'FOO'. Remove $/${} for that, or use ${var?} to quiet.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">MYVAR</span><span class="o">=</span>foo
<span class="nb">export</span> <span class="nv">$MYVAR</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">MYVAR</span><span class="o">=</span>foo
<span class="nb">export</span> MYVAR
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>export</code> takes a variable name, but shellcheck has noticed that you give it an expanded variable instead. The problematic code does not export <code>MYVAR</code> but a variable called <code>foo</code> if any.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If this is intentional and you do want to export <code>foo</code> instead of <code>MYVAR</code>, you can either use a directive:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC2163</span>
<span class="nb">export</span> <span class="s2">"</span><span class="nv">$MYVAR</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>Or after (but not including) version 0.4.7, take advantage of the fact that ShellCheck only warns when no parameter expansion modifiers are applied:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="s2">"</span><span class="si">${</span><span class="nv">MYVAR</span><span class="si">}</span><span class="s2">"</span>    <span class="c1"># ShellCheck warns</span>
<span class="nb">export</span> <span class="s2">"</span><span class="si">${</span><span class="nv">MYVAR</span><span class="p">?</span><span class="si">}</span><span class="s2">"</span>   <span class="c1"># No warning</span>
</pre></div>
</td></tr></table>
<p><code>${MYVAR?}</code> fails when <code>MYVAR</code> is unset, which is fine since <code>export</code> would have failed too. The main side effect is an improved runtime error message in that case.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2003">Expired expression style</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expr-is-antiquated-consider-rewriting-this-using-or-9191-9393">expr is antiquated. Consider rewriting this using $((..)), ${} or [[ ]].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="expr-is-antiquated-consider-rewriting-this-using-or-9191-9393">expr is antiquated. Consider rewriting this using $((..)), ${} or [[ ]].</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="k">$(</span>expr <span class="m">1</span> + <span class="m">2</span><span class="k">)</span>
<span class="nv">l</span><span class="o">=</span><span class="k">$(</span>expr length <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span><span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="k">))</span>
<span class="nv">l</span><span class="o">=</span><span class="si">${#</span><span class="nv">var</span><span class="si">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><a href="http://pubs.opengroup.org/onlinepubs/009695399/utilities/expr.html">To quote POSIX:</a></p>
<blockquote>
<p>The expr utility has a rather difficult syntax [...] In many cases, the arithmetic and string features provided as part of the shell command language are easier to use than their equivalents in expr. Newly written scripts should avoid expr in favor of the new features within the shell.</p>
</blockquote>
<h3 id="exceptions">Exceptions</h3>
<p><code>sh</code> doesn't have a great replacement for the <code>:</code> operator (regex match). ShellCheck tries not to warn when using expr with <code>:</code>, but e.g. <code>op=:; expr string "$op" regex</code> will still trigger it.</p>
<p>Other than that, all uses of <code>expr</code> can be rewritten to use modern shell features instead.</p>
<p>Bash has <code>[[ string =~ regex ]]</code>, so not even <code>expr .. : ..</code> is necessary.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2062">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-the-grep-pattern-so-the-shell-wont-interpret-it">Quote the grep pattern so the shell won't interpret it.</a><ul>
<li><a href="#problematic-code">Problematic code</a></li>
<li><a href="#correct-code">Correct code</a></li>
<li><a href="#rationale">Rationale</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="quote-the-grep-pattern-so-the-shell-wont-interpret-it">Quote the grep pattern so the shell won't interpret it.</h1>
<h3 id="problematic-code">Problematic code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep foo* file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep "foo*" file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale</h3>
<p>The regex passed to grep frequently contains characters that collide with globs. The code above is supposed to match "f followed by 1 or more o's", but if the directory contains a file called "foo.txt", an unquoted pattern will cause it to become <code>grep foo.txt file</code>.</p>
<p>To prevent this, always quote the regex passed to grep, especially when it contains one or more glob character.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1069">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-the">You need a space before the [.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-the">You need a space before the [.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span><span class="o">[</span> -e file <span class="o">]</span>
<span class="k">then</span> <span class="nb">echo</span> <span class="s2">"exists"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e file <span class="o">]</span>
<span class="k">then</span> <span class="nb">echo</span> <span class="s2">"exists"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a keyword immediately followed by a <code>[</code>. There needs to be a space between them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2009">bad 'grep'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sc2009-consider-using-pgrep-instead-of-grepping-ps-output">SC2009 Consider using pgrep instead of grepping ps output.</a><ul>
<li><a href="#problematic-code">Problematic Code:</a></li>
<li><a href="#correct-code">Correct Code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sc2009-consider-using-pgrep-instead-of-grepping-ps-output">SC2009 Consider using pgrep instead of grepping ps output.</h2>
<h3 id="problematic-code">Problematic Code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ps ax <span class="p">|</span> grep -v grep <span class="p">|</span> grep <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> &gt; /dev/null
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct Code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>pgrep -f <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> &gt; /dev/null
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>If you are just after a pid from a running program, then pgrep is a much safer alternative. Especially if you are also looking for a pid belonging to a certain user or group. All of the parameters are in one command and it can eliminate multiple greps, cuts, seds, awks, etc.</p>
<p>If you want a field that's not the pid, consider doing this through <code>ps</code> + <code>pgrep</code> instead of <code>ps</code> + <code>grep</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>for pid in $(pgrep '^python$')
do
  user=$(ps -o user= -p "$pid")
  echo "The process $pid is run by $user"
done
</pre></div>
</td></tr></table>
<p>This is more robust than <code>ps .. | grep python | cut ..</code> because it does not try to match against unrelated fields, such as if the user's name was <code>pythonguru</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>You can [[ignore]] this error if you are trying to match against something that <code>pgrep</code> doesn't support:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># pgrep does not support filtering by 'nice' value
# shellcheck disable=SC2009
ps -axo nice=,pid= | grep -v '^  0'
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1003">Invalid escape for quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#want-to-escape-a-single-quote-echo-this-is-how-it92s-done">Want to escape a single quote? echo 'This is how it'\''s done'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="want-to-escape-a-single-quote-echo-this-is-how-it92s-done">Want to escape a single quote? echo 'This is how it'\''s done'.</h2>
<p>(Note: in v0.4.6, the error message was accidentally missing the backslash)</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'This is not how it\'</span>s <span class="k">done</span><span class="err">'</span>.
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'This is how it'</span><span class="se">\'</span><span class="s1">'s done'</span>.
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale</h3>
<p>In POSIX shell, the shell cares about nothing but another single quote to terminate the quoted segment. Not even backslashes are interpreted.</p>
<p><a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_02_02">POSIX.1 Shell Command Language § 2.2.2 Single Quotes</a>:</p>
<blockquote>
<p>Enclosing characters in single-quotes ( <code>''</code> ) shall preserve the literal value of each character within the single-quotes. A single-quote cannot occur within single-quotes.</p>
</blockquote>
<h3 id="exceptions">Exceptions</h3>
<p>If you want your single quoted string to end in a backslash, you can rewrite as <code>'string'\\</code> or [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2188">Improper output redirection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-redirection-doesnt-have-a-command-move-to-its-command-or-use-true-as-no-op">This redirection doesn't have a command. Move to its command (or use 'true' as no-op).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-redirection-doesnt-have-a-command-move-to-its-command-or-use-true-as-no-op">This redirection doesn't have a command. Move to its command (or use 'true' as no-op).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">{</span> 
  <span class="nb">echo</span> <span class="s2">"Report for </span><span class="k">$(</span>date +%F<span class="k">)</span><span class="s2">"</span>
  uptime
  df -h
<span class="o">}</span>
  &gt; report.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">{</span> 
  <span class="nb">echo</span> <span class="s2">"Report for </span><span class="k">$(</span>date +%F<span class="k">)</span><span class="s2">"</span>
  uptime
  df -h
<span class="o">}</span> &gt; report.txt
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a redirection that doesn't actually redirect from/to anything.</p>
<p>This could indicate a bug, such as in the problematic code where an additional linefeed causes <code>report.txt</code> to be truncated instead of containing report output, or in <code>foo &amp; &gt; bar</code>, where either <code>foo &amp;&gt; bar</code> or <code>foo &gt; bar &amp;</code> was intended. </p>
<p>However, it could also be intentionally used to truncate a file or check that it's readable. You can make this more explicit for both ShellCheck and human readers by using <code>true</code> or <code>:</code> as a dummy command, e.g. <code>true &gt; file</code> or <code>: &gt; file</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>There are no semantic problems with using <code>&gt; foo</code> over <code>true &gt; foo</code>, so if you don't see this as a potential source of bugs or confusion, you can [[ignore]] it.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2198">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#arrays-dont-work-as-operands-in-use-a-loop-or-concatenate-with-instead-of">Arrays don't work as operands in [ ]. Use a loop (or concatenate with * instead of @).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="arrays-dont-work-as-operands-in-use-a-loop-or-concatenate-with-instead-of">Arrays don't work as operands in [ ]. Use a loop (or concatenate with * instead of @).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">ext</span><span class="o">=</span>png
<span class="nv">allowedExt</span><span class="o">=(</span>jpg bmp png<span class="o">)</span>
<span class="o">[</span> <span class="s2">"</span><span class="nv">$ext</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">allowedExt</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Extension is valid"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">ext</span><span class="o">=</span>png
<span class="nv">allowedExt</span><span class="o">=(</span>jpg bmp png<span class="o">)</span>
<span class="k">for</span> value in <span class="s2">"</span><span class="si">${</span><span class="nv">allowedExt</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">do</span>
  <span class="o">[</span> <span class="s2">"</span><span class="nv">$ext</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Extension is valid"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Array expansions become a series of words in <code>[ .. ]</code>. Operators expect single words only.</p>
<p>The problematic code is equivalent to <code>[ "$ext" = jpg bmp png ]</code>, which is invalid syntax. A typical error message is <code>bash: [: too many arguments</code> or <code>dash: somefile: unexpected operator</code>. </p>
<p>Instead, use a <code>for</code> loop to iterate over values, and apply your condition to each.</p>
<p>Alternatively, if you want to concatenate all the values in the array into a single string for your test, use <code>"$*"</code> or <code>"${array[*]}"</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you are dynamically building an a test expression, make your array the only thing in the test expression. ShellCheck will not emit a warning for: <code>set -- 1 -lt 2; [ "$@" ]</code></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1015">Unicode double quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-double-quote-delete-and-retype-it">This is a unicode double quote. Delete and retype it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#status">Status:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-double-quote-delete-and-retype-it">This is a unicode double quote. Delete and retype it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> “hello world”
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"hello world"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Blog software and word processors frequently replaces ASCII quotes <code>""</code> with fancy Unicode quotes, <code>“”</code>. To bash, Unicode quotes are considered regular literals and not quotes at all.</p>
<p>Simply delete them and retype them in your editor.</p>
<h3 id="status">Status:</h3>
<p>This error was retired after 0.4.5. In this version and earlier, ShellCheck parsed slanted quotes as a valid double quote. This meant that the warning could not simply be ignored. It has since been replaced by [[SC1110]] (outside quotes) and [[SC1111]] (inside double quotes).</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you really want literal Unicode double quotes, you can put them in single quotes (or Unicode single quotes in double quotes) to make shellcheck ignore them, e.g.,</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'Warning: “wakeonlan” is not installed.\n'</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2031">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#var-was-modified-in-a-subshell-that-change-might-be-lost">var was modified in a subshell. That change might be lost.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="var-was-modified-in-a-subshell-that-change-might-be-lost">var was modified in a subshell. That change might be lost.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<p>There are many ways of accidentally creating subshells, but a common one is piping to a loop:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">0</span>
<span class="nb">printf</span> <span class="s2">"%s\n"</span> <span class="o">{</span><span class="m">1</span>..10<span class="o">}</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> i<span class="p">;</span> <span class="k">do</span> <span class="o">((</span> <span class="nv">n</span><span class="o">+=</span>i <span class="o">))</span><span class="p">;</span> <span class="k">done</span>
<span class="nb">echo</span> <span class="nv">$n</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Bash specific: process substitution. Also try shopts like lastpipe.</span>
<span class="nv">n</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span> <span class="nb">read</span> i<span class="p">;</span> <span class="k">do</span> <span class="o">((</span> <span class="nv">n</span><span class="o">+=</span>i <span class="o">))</span><span class="p">;</span> <span class="k">done</span> &lt; &lt;<span class="o">(</span><span class="nb">printf</span> <span class="s2">"%s\n"</span> <span class="o">{</span><span class="m">1</span>..10<span class="o">})</span>
<span class="nb">echo</span> <span class="nv">$n</span>
</pre></div>
</td></tr></table>
<p>In <code>sh</code>, a temp file (better if fifo or fd) can be used instead of process substitution. And if it's acceptable to do it with waiting, try Here Documents.</p>
<h3 id="rationale">Rationale:</h3>
<p>Variables set in subshells are not available outside the subshell. This is a wide topic, and better described on the <a href="http://mywiki.wooledge.org/BashFAQ/024">Wooledge Bash Wiki</a>.</p>
<p>Here are some constructs that cause subshells (shellcheck may not warn about all of them). In each case, you can replace <code>subshell1</code> by a command or function that sets a variable, e.g. simply <code>var=foo</code>, and the variable will appear to be unset after the command is run. Similarly, you can replace <code>regular</code> with <code>var=foo</code>, and it will be set afterwards:</p>
<p>Pipelines:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>subshell1 <span class="p">|</span> subshell2 <span class="p">|</span> subshell3    <span class="c1"># Bash, Dash, Ash</span>
subshell1 <span class="p">|</span> subshell2 <span class="p">|</span> regular      <span class="c1"># Ksh, Zsh</span>
</pre></div>
</td></tr></table>
<p>Command substitution:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>regular <span class="s2">"</span><span class="k">$(</span>subshell1<span class="k">)</span><span class="s2">"</span> <span class="s2">"`subshell2`"</span>
</pre></div>
</td></tr></table>
<p>Process substitution:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>regular &lt;<span class="o">(</span>subshell1<span class="o">)</span> &gt;<span class="o">(</span>subshell2<span class="o">)</span>
</pre></div>
</td></tr></table>
<p>Some forms of grouping:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">(</span> subshell <span class="o">)</span>
<span class="o">{</span> regular<span class="p">;</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Backgrounding:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>subshell1 <span class="p">&amp;</span>
subshell2 <span class="p">&amp;</span>
</pre></div>
</td></tr></table>
<p>Anything executed by external processes:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -exec subshell1 <span class="o">{}</span> <span class="se">\;</span>
find . -print0 <span class="p">|</span> xargs -0 subshell2
sudo subshell3
su -c subshell4
</pre></div>
</td></tr></table>
<p>This applies not only to setting variables, but also setting shell options and changing directories.</p>
<h3 id="exceptions">Exceptions</h3>
<p>You can ignore this error if you don't care that the changes aren't reflected, because work on the value branches and shouldn't be recombined.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/024">BashFaq: I set variables in a loop that's in a pipeline. Why do they disappear after the loop terminates?</a></li>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf8">Bash Pitfalls: grep foo bar | while read -r; do ((count++)); done</a></li>
<li><a href="https://stackoverflow.com/questions/16854280/a-variable-modified-inside-a-while-loop-is-not-remembered">StackOverflow: A variable modified inside a while loop is not remembered</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2234">Redundant braces</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-superfluous-around-test-command">Remove superfluous (..) around test command.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-superfluous-around-test-command">Remove superfluous <code>(..)</code> around test command.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">([</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> -gt <span class="m">0</span> <span class="o">])</span> <span class="o">&amp;&amp;</span> foo
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> -gt <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are wrapping a single test command in <code>(..)</code>, creating an unnecessary subshell. This serves no purpose, but is dramatically slower:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">while</span> <span class="o">(</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> -lt <span class="m">10000</span> <span class="o">]</span> <span class="o">)</span><span class="p">;</span> <span class="k">do</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">;</span> <span class="k">done</span>
real    0m6.998s
user    0m3.453s
sys     0m3.464s

$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">while</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> -lt <span class="m">10000</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">;</span> <span class="k">done</span>
real    0m0.055s
user    0m0.054s
sys     0m0.001s
</pre></div>
</td></tr></table>
<p>Just delete the surrounding <code>(..)</code> since they serve no purpose and only slows the script down.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2249">Missing default case branch</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#consider-adding-a-default-case-even-if-it-just-exits-with-error">Consider adding a default *) case, even if it just exits with error.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="consider-adding-a-default-case-even-if-it-just-exits-with-error">Consider adding a default *) case, even if it just exits with error.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  start<span class="o">)</span> start_service <span class="p">;;</span>
  stop<span class="o">)</span>  stop_service <span class="p">;;</span>
  restart<span class="p">|</span>reload<span class="p">|</span>force-reload<span class="o">)</span>
    stop_service<span class="p">;</span>
    start_service<span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  start<span class="o">)</span> start_service <span class="p">;;</span>
  stop<span class="o">)</span>  stop_service <span class="p">;;</span>
  restart<span class="p">|</span>reload<span class="p">|</span>force-reload<span class="o">)</span>
    stop_service<span class="p">;</span>
    start_service<span class="p">;;</span>
  *<span class="o">)</span>
    <span class="nb">echo</span> &gt;<span class="p">&amp;</span><span class="m">2</span> <span class="s2">"Invalid choice: </span><span class="nv">$1</span><span class="s2">"</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a <code>case</code> statement that may not be considering all possible cases. This may mean that only the <a href="https://en.wikipedia.org/wiki/Happy_path">happy paths</a> are accounted for.</p>
<p>Consider adding a default case to handle other values. If you don't know what to do or don't believe it'll ever happen, exiting with an error is good, fail-fast practice.</p>
<p>The example is adapted from a real world Debian init script, which due to a missing default case reports success on any misspelled command (here with underscore instead of dash):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ /etc/init.d/screen-cleanup force_reload <span class="o">&amp;&amp;</span> <span class="nb">echo</span> success
success
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>This suggestion only triggers in verbose mode (<code>-S verbose</code>). </p>
<p>If you don't have a default case because the default should be to take no action, consider adding a comment to other humans:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>case "$(uname)" in
  CYGWIN*) cygwin=1;;
  MINGW*) mingw=1;;
  *) # No special workarounds identified
esac
</pre></div>
</td></tr></table>
<p>If you believe that it's impossible for the expression to have any other value, it's considered good practice to add the equivalent of an <code>assert(0)</code> to fail fast if this assumption should turn out to be incorrect in the current or future versions:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>case "$result" in
  true)  proceed;;
  false) cancel;;
  *) echo &gt;&amp;2 "Submit bug report: '$result' should be true or false."
     exit 127
esac
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1111">Using unicode quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-quote-delete-and-retype-it-or-ignoresinglequote-for-literal">This is a unicode quote. Delete and retype it (or ignore/singlequote for literal).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-quote-delete-and-retype-it-or-ignoresinglequote-for-literal">This is a unicode quote. Delete and retype it (or ignore/singlequote for literal).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"hello world”</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"hello world"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Some software, like OS X, Word and WordPress, may automatically replace your regular quotes with slanted Unicode quotes. The shell does not recognize these quotes and will not respect them.</p>
<p>In this case, you have slanted double quotes in a double quoted string. Try deleting and retyping them, and/or disable “smart quotes” in your editor or OS.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to use literal slanted double quotes for typographic reasons, you can put them in single quotes to make ShellCheck ignore them:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'Warning: “wakeonlan” is not installed.\n'</span>
</pre></div>
</td></tr></table>
<p>You can also just [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2114">Deleting system folder</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#warning-deletes-a-system-directory">Warning: deletes a system directory.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="warning-deletes-a-system-directory">Warning: deletes a system directory.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -rf /usr /lib/nvidia-current/xorg/xorg
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -rf /usr/lib/nvidia-current/xorg/xorg
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The example line of code was an actual bug in the <a href="https://github.com/MrMEEE/bumblebee-Old-and-abbandoned/commit/a047be85247755cdbe0acce6f1dafc8beb84f2ac">Bumblebee NVIDIA driver</a>.</p>
<p>Due to an accidental space, it deleted <code>/usr</code> instead of just the particular directory.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do intend to delete a system directory, such as when working in a chroot or initramfs, you can disable this message with a directive: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC2114</span>
rm -rf /usr 
</pre></div>
</td></tr></table>
<p>Previous versions of shellcheck, up to and including 0.4.6, would ignore <code>rm</code> statements containing a <code>--</code> (an arbitrary convention). This is no longer the case.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1098">Missing escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quoteescape-special-characters-when-using-eval-eg-eval-ab">Quote/escape special characters when using eval, e.g. eval "a=(b)".</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quoteescape-special-characters-when-using-eval-eg-eval-ab">Quote/escape special characters when using eval, e.g. eval "a=(b)".</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="nv">$var</span><span class="o">=(</span>a b<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">=(a b)"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shells differ widely in how they handle unescaped parentheses in <code>eval</code> expressions.</p>
<ul>
<li><code>eval foo=bar</code> is allowed by dash, bash and ksh.</li>
<li><code>eval foo=(bar)</code> is allowed by bash and ksh, but not dash.</li>
<li><code>eval $var=(bar)</code> is allowed by ksh, but not bash or dash.</li>
<li><code>eval foo() ( echo bar; )</code> is not allowed by any shell.</li>
</ul>
<p>Since the expression is evaluated as shell script code anyways, it should be passed in as a literal string without relying on special case parsing rules in the target shell. Quote/escape the characters accordingly.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2110">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-91-use-instead-of-o">In [[..]], use || instead of -o.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="in-91-use-instead-of-o">In [[..]], use || instead of -o.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> -o <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-help"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">||</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-help"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>-o</code> for logical OR is not supported in a <code>[[ .. ]]</code> expression. Use <code>||</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2253">Bad permission operation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-r-to-recurse-or-explicitly-a-r-to-remove-read-permissions">Use -R to recurse, or explicitly a-r to remove read permissions.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-r-to-recurse-or-explicitly-a-r-to-remove-read-permissions">Use -R to recurse, or explicitly a-r to remove read permissions.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>chmod -r <span class="m">0700</span> dir
chmod -r file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>chmod -R <span class="m">0700</span> dir
chmod a-r file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Many tools use <code>-r</code> for recursive operation, but in <code>chmod</code> this removes read permissions.</p>
<p>If you wanted to change permissions recursively, change the flag to <code>-R</code>. If you wanted to remove read permissions, consider using <code>a-r</code> explicitly to make this more obvious.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you're using it correctly and don't mind the potential for confusion, you can save a single character by ignoring this warning.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1132">Improper '&'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-terminates-the-command-escape-it-or-add-space-after-to-silence">This &amp; terminates the command. Escape it or add space after &amp; to silence.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-terminates-the-command-escape-it-or-add-space-after-to-silence">This <code>&amp;</code> terminates the command. Escape it or add space after <code>&amp;</code> to silence.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>curl https://www.google.com/search?q<span class="o">=</span>cats<span class="p">&amp;</span><span class="nv">tbm</span><span class="o">=</span>isch
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>curl <span class="s2">"https://www.google.com/search?q=cats&amp;tbm=isch"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>An unescaped and unquoted <code>&amp;</code> terminates the command, but here it's used in the middle of what would otherwise be a shell word. This most commonly happens when copying a URL with query string parameters without escaping the <code>&amp;</code>. </p>
<p>Either quote or escape the <code>&amp;</code> if you wanted it as a literal ampersand, or add a space after it to make it easier to see where the previous command stopped.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want to background one command and run another, e.g. <code>sleep 10&amp;wait</code>, just add a space or linefeed after the <code>&amp;</code> to make this more obvious: <code>sleep 10&amp; wait</code></p>
<p>This does not change the meaning of the script, it just makes it clear to ShellCheck (and other humans) that the <code>&amp;</code> isn't supposed to be a part of the shell world.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1119">Missing line feed</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#add-a-linefeed-between-end-token-and-terminating">Add a linefeed between end token and terminating ')'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="add-a-linefeed-between-end-token-and-terminating">Add a linefeed between end token and terminating ')'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="k">$(</span>fmt -s <span class="s2">"</span><span class="nv">$COLUMNS</span><span class="s2">"</span> &lt;&lt; <span class="s2">"eof"</span>
This is a bunch of text
eof<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="k">$(</span>fmt -s <span class="s2">"</span><span class="nv">$COLUMNS</span><span class="s2">"</span> &lt;&lt; <span class="s2">"eof"</span>
This is a bunch of text
eof
<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When embedding a here document in <code>$(..)</code> or <code>(..)</code>, there needs to be a linefeed (newline) between the here doc token and the closing <code>)</code>. Please insert one.</p>
<p>Failing to do so may cause warnings like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">bash</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">here</span><span class="o">-</span><span class="n">document</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">15</span> <span class="n">delimited</span> <span class="n">by</span> <span class="n">end</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">file</span> <span class="o">(</span><span class="n">wanted</span> <span class="err">`</span><span class="n">eof</span><span class="err">'</span><span class="o">)</span><span class="err">`</span>
<span class="n">dash</span><span class="o">:</span> <span class="mi">5</span><span class="o">:</span> <span class="n">Syntax</span> <span class="n">error</span><span class="o">:</span> <span class="n">end</span> <span class="n">of</span> <span class="n">file</span> <span class="n">unexpected</span> <span class="o">(</span><span class="n">expecting</span> <span class="s2">")"</span><span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>This error may be incorrectly emitted for <code>ksh</code>, where this is allowed. In this case, please either write it in a standard way or ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1075">Improper using of 'else if'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-elif-instead-of-else-if">Use 'elif' instead of 'else if'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-elif-instead-of-else-if">Use 'elif' instead of 'else if'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$#</span><span class="s2">"</span> -eq <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Usage: ..."</span>
<span class="k">else</span> <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$#</span><span class="s2">"</span> -lt <span class="m">2</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Missing operand"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$#</span><span class="s2">"</span> -eq <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Usage: ..."</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$#</span><span class="s2">"</span> -lt <span class="m">2</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Missing operand"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Many languages allow alternate branches with <code>else if</code>, but <code>sh</code> is not one of them. Use <code>elif</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p><code>else if</code> is a valid (though confusing) way of nesting an <code>if</code> statement in a parent's <code>else</code>. If this is your intention, consider using canonical formatting by putting a linefeed between <code>else</code> and <code>if</code>.</p>
<p>This does not change the behavior of the script, but merely makes it more obvious to ShellCheck (and other humans) that you didn't expect the <code>else if</code> to behave the way it does in C. Alternatively, you can [[ignore]] it with no ill effects.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> x
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"x"</span>
<span class="k">else</span>     <span class="c1"># line break here</span>
  <span class="k">if</span> y
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"y"</span>
   <span class="k">fi</span> 
<span class="k">fi</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1094">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#parsing-of-sourced-file-failed-ignoring-it">Parsing of sourced file failed. Ignoring it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="parsing-of-sourced-file-failed-ignoring-it">Parsing of sourced file failed. Ignoring it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">source</span> mylib
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC1094</span>
<span class="nb">source</span> mylib
</pre></div>
</td></tr></table>
<p>(or fix <code>mylib</code>)</p>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck encountered a parsing error in a sourced file, <code>mylib</code> in the example.</p>
<p>Fix parsing error, or just disable it with a directive.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the file is fine and this is due to a known <code>shellcheck</code> bug, you can ignore it with a [[directive]] as in the example.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2094">Read and write a same file in a same pipeline</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sc2094-make-sure-not-to-read-and-write-the-same-file-in-the-same-pipeline">SC2094 Make sure not to read and write the same file in the same pipeline.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="sc2094-make-sure-not-to-read-and-write-the-same-file-in-the-same-pipeline">SC2094 Make sure not to read and write the same file in the same pipeline.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep foo file.txt <span class="p">|</span> sed -e <span class="s1">'s/foo/bar/g'</span> &gt; file.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep foo file.txt  <span class="p">|</span> sed -e <span class="s1">'s/foo/bar/g'</span> &gt; tmpfile <span class="o">&amp;&amp;</span> mv tmpfile file.txt
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Each step in a pipeline runs in parallel.</p>
<p>In this case, <code>grep foo file.txt</code> will immediately try to read <code>file.txt</code> while <code>sed .. &gt; file.txt</code> will immediately try to truncate it.</p>
<p>This is a race condition, and results in the file being partially or (far more likely) entirely truncated.</p>
<h3 id="exceptions">Exceptions</h3>
<p>You can ignore this error if:</p>
<ul>
<li>The file is a device or named pipe. These files don't truncate in the same way.</li>
<li>The command mentions the filename but doesn't read/write it, such as <code>echo log.txt &gt; log.txt</code>.</li>
</ul>
<h3 id="additional-resources">Additional Resources</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/6696842/bash-redirect-input-from-file-back-into-same-file">StackOverflow: bash redirect input from file back into same file</a></li>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf13">BashPitfalls: <code>cat file | sed s/foo/bar/ &gt; file</code></a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2169">Features not supported by dash</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-dash-something-is-not-supported">In dash, something is not supported.</a></li>
</ul>
</div>

            <div>
                
<h2 id="in-dash-something-is-not-supported">In dash, <em>something</em> is not supported.</h2>
<p>You are writing a script for <code>dash</code>, but you're using a feature that <code>dash</code> doesn't support. See [[SC2039]], the equivalent warning for POSIX sh, for possible workarounds.</p>
<p>See also Ubuntu's <a href="https://wiki.ubuntu.com/DashAsBinSh">DashAsBinSh</a> migration guide for how to make bash-specific scripts dash-compatible.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1087">Use braces when expanding arrays</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-braces-when-expanding-arrays-eg-arrayidx-or-var-to-quiet">"Use braces when expanding arrays, e.g. ${array[idx]} (or ${var}[.. to quiet)."</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-braces-when-expanding-arrays-eg-arrayidx-or-var-to-quiet">"Use braces when expanding arrays, e.g. ${array[idx]} (or ${var}[.. to quiet)."</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$array</span><span class="s2">[@]"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Some languages use the syntax <code>$array[index]</code> to access an index of an arrays, but a shell will interpret this as <code>$array</code> followed by the unrelated literal string (or glob) <code>[index]</code>.</p>
<p>Curly braces are needed to tell the shell that the square brackets are part of the expansion.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want the square brackets to be treated literally or as a glob, use <code>${var}[idx]</code> to prevent this warning.</p>
<p>This does not change how the script works, but clarifies your intent to ShellCheck as well as other programmers.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2167">Improper loop</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-parent-loop-has-its-index-variable-overridden">This parent loop has its index variable overridden.</a></li>
</ul>
</div>

            <div>
                
<h2 id="this-parent-loop-has-its-index-variable-overridden">This parent loop has its index variable overridden.</h2>
<p>See companion warning [[SC2165]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2176">Improper timing</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#time-is-undefined-for-pipelines-time-single-stage-or-bash-c-instead">'time' is undefined for pipelines. time single stage or bash -c instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="time-is-undefined-for-pipelines-time-single-stage-or-bash-c-instead">'time' is undefined for pipelines. time single stage or bash -c instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">time</span> foo <span class="p">|</span> bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>To time the most relevant stage:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="p">|</span> <span class="o">{</span> <span class="nb">time</span> bar<span class="p">;</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<p>To time everything in a pipeline:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">time</span> bash -c <span class="s1">'foo | bar'</span>
</pre></div>
</td></tr></table>
<p>Note that you can not use <code>time sh -c</code> to time an entire pipeline, because POSIX does not guarantee that anything other than the last stage is waited upon by the shell. </p>
<h3 id="rationale">Rationale:</h3>
<p>This behavior is explicitly left undefined <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/time.html">in POSIX</a>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. This warning is not emitted in <code>ksh</code> or <code>bash</code> where <code>time</code> is defined for pipelines.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2256">Improper quoted substitution</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-translated-string-is-the-name-of-a-variable-flip-leading-and-if-this-should-be-a-quoted-substitution">This translated string is the name of a variable. Flip leading $ and " if this should be a quoted substitution.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-translated-string-is-the-name-of-a-variable-flip-leading-and-if-this-should-be-a-quoted-substitution">This translated string is the name of a variable. Flip leading $ and " if this should be a quoted substitution.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"foo"</span>
<span class="nb">echo</span> <span class="s2">$"var"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"foo"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>$".."</code> is a localized string, for example, <code>echo $"Hello $USER"</code> along with the proper translation files can be used to have the script say "Bonjour, youruser" in French locales.</p>
<p>In this case, ShellCheck found a localized string whose contents is also the name of a variable. This could have happened because the user wanted a far more common quoted substitution, e.g. <code>"$var"</code>, but accidentally switched the leading <code>$</code> and <code>"</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want a localized string whose contents is also an active variable, you can [[ignore]] this warning or rename the variable.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2018">Missing '[:lower:]' for non-english charactors</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-lower-to-support-accents-and-foreign-alphabets">Use '[:lower:]' to support accents and foreign alphabets.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-lower-to-support-accents-and-foreign-alphabets">Use '[:lower:]' to support accents and foreign alphabets.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PLATFORM</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>uname -s <span class="p">|</span> tr <span class="s1">'A-Z'</span> <span class="s1">'a-z'</span><span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PLATFORM</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>uname -s <span class="p">|</span> tr <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>A-Z</code> and <code>a-z</code> are commonly intended to mean "all uppercase" and "all lowercase letters" respectively. This ignores accented characters in English, and foreign characters in other languages:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ tr <span class="s1">'a-z'</span> <span class="s1">'A-Z'</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"My fiancée ordered a piña colada."</span>
MY FIANCéE ORDERED A PIñA COLADA.
</pre></div>
</td></tr></table>
<p>Instead, you can use <code>[:lower:]</code> and <code>[:upper:]</code> to explicitly specify case:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ tr <span class="s1">'[:lower:]'</span> <span class="s1">'[:upper:]'</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"My fiancée ordered a piña colada."</span>
MY FIANCÉE ORDERED A PIÑA COLADA.
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>If you don't want <code>a-z</code> to match <code>é</code> or <code>A-Z</code> to match <code>Ñ</code>, you can ignore this message.</p>
<p>As of 2019-09-08, BusyBox <code>tr</code> does not support character classes, so you would have to ignore this message.</p>
<p>Note that the examples used here are multibyte characters in UTF-8. Many implementations (including GNU) fails to deal with them. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2029">Improper escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#note-that-unescaped-this-expands-on-the-client-side">Note that, unescaped, this expands on the client side.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="note-that-unescaped-this-expands-on-the-client-side">Note that, unescaped, this expands on the client side.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host <span class="s2">"echo </span><span class="nv">$HOSTNAME</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host <span class="s2">"echo \$HOSTNAME"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host <span class="s1">'echo $HOSTNAME'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash expands all arguments that are not escaped/singlequoted. This means that the problematic code is identical to</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host <span class="s2">"echo clienthostname"</span>
</pre></div>
</td></tr></table>
<p>and will print out the client's hostname, not the server's hostname.</p>
<p>By escaping the <code>$</code> in <code>$HOSTNAME</code>, it will be transmitted literally and evaluated on the server instead.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you do want your string expanded on the client side, you can safely ignore this message.</p>
<p>Keep in mind that the expanded string will be evaluated again on the server side, so for arbitrary variables and command output, you may need to add a layer of escaping with e.g. <code>printf %q</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2048">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-with-quotes-to-prevent-whitespace-problems">Use "$@" (with quotes) to prevent whitespace problems.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-with-quotes-to-prevent-whitespace-problems">Use "$@" (with quotes) to prevent whitespace problems.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="nv">$*</span> ~/dir
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> ~/dir
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>$*</code>, unquoted, is subject to word splitting and globbing.</p>
<p>Let's say you have three arguments: <code>baz</code>, <code>foo bar</code> and <code>*</code></p>
<p><code>"$@"</code> will expand into exactly that: <code>baz</code>, <code>foo bar</code> and <code>*</code></p>
<p><code>$*</code> will expand into multiple other arguments: <code>baz</code>, <code>foo</code>, <code>bar</code>, <code>file.txt</code> and <code>otherfile.jpg</code></p>
<p>Since the latter is rarely expected or desired, ShellCheck warns about it.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2153">Possible Misspelling</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#possible-misspelling-myvariable-may-not-be-assigned-but-my_variable-is">Possible Misspelling: MYVARIABLE may not be assigned, but MY_VARIABLE is.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="possible-misspelling-myvariable-may-not-be-assigned-but-my_variable-is">Possible Misspelling: MYVARIABLE may not be assigned, but MY_VARIABLE is.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">MY_VARIABLE</span><span class="o">=</span><span class="s2">"hello world"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$MYVARIABLE</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">MY_VARIABLE</span><span class="o">=</span><span class="s2">"hello world"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$MY_VARIABLE</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you reference a variable that is not assigned in the script, which has a name remarkably similar to one that is explicitly assigned. You should verify that the variable name is spelled correctly.</p>
<p>Note: This error only triggers for environment variables (all uppercase variables), and only when they have names similar to something assigned in the script. If the variable is script-local, it should by convention have a lowercase name, and will in that case be caught by [SC2154] whether or not it resembles another name.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you've double checked and ensured that you did not intend to reference the specified variable, you can disable this message with a [[directive]]. The message will also not appear for guarded references like <code>${ENVVAR:-default}</code> or <code>${ENVVAR:?Unset error message here}</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2177">Improper timing</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#time-is-undefined-for-compound-commands-time-sh-c-instead">'time' is undefined for compound commands, time sh -c instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="time-is-undefined-for-compound-commands-time-sh-c-instead">'time' is undefined for compound commands, time sh -c instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">time</span> <span class="k">for</span> i in *.bmp<span class="p">;</span> <span class="k">do</span> convert <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">.png"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">time</span> sh -c <span class="s1">'for i in *.bmp; do convert "$i" "$i.png"; done'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>time</code> is only defined for Simple Commands <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/time.html">by POSIX</a>. Timing loops, command groups and similar is not.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you use a shell that supports this (e.g. bash, ksh), specify this shell in the shebang.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2076">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-quote-rhs-of-itll-match-literally-rather-than-as-a-regex">Don't quote rhs of =~, it'll match literally rather than as a regex.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#compatibility">Compatibility:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="dont-quote-rhs-of-itll-match-literally-rather-than-as-a-regex">Don't quote rhs of =~, it'll match literally rather than as a regex.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$foo</span> <span class="o">=</span>~ <span class="s2">"^fo+ bar</span>$<span class="s2">"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$foo</span> <span class="o">=</span>~ ^fo+<span class="se">\ </span>bar$ <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Quotes on the right hand side of <code>=~</code> can be used to match literally, so that <code>[[ $1 =~ ^"$2".* ]]</code> works even if <code>$2</code> contains regex metacharacters. This mirrors the behavior of globs, <code>[[ $1 = "$2"* ]]</code>.</p>
<p>This also means that the problematic code tries to match literal carets and plus signs instead of interpreting them as regular expression matchers.  To match as a regex, the regex metacharacters it must be unquoted. Literal parts of the expression can be quoted with double or single quotes, or escaped.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want to match literally just to do a plain substring search, e.g. <code>[[ $foo =~ "bar" ]]</code>, you could ignore this message, but consider using a more canonical glob match instead: <code>[[ $foo = *"bar"* ]]</code>.</p>
<h3 id="compatibility">Compatibility:</h3>
<ul>
<li>In Bash 3.2 and newer with shopt <code>compat31</code> <em>disabled (the default)</em>, quoted patterns are literal whereas unquoted patterns are parsed for regex metacharacters.</li>
<li>In Bash 3.2 and newer with shopt <code>compat31</code> <em>enabled</em>, quoted and unquoted patterns match identically.</li>
<li>In Bash 3.1 quoted and unquoted patterns match identically.</li>
</ul>
<p>See http://stackoverflow.com/questions/218156/bash-regex-with-quotes</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1019">Improper unary condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-this-to-be-an-argument-to-the-unary-condition">Expected this to be an argument to the unary condition.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="expected-this-to-be-an-argument-to-the-unary-condition">Expected this to be an argument to the unary condition.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -x <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -x <span class="s2">"myfile"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a unary test operator that does not appear to be followed by a valid shell word. </p>
<p>This could be because of a misplaced <code>]</code>, <code>)</code>, or a missing space before the <code>]</code>.</p>
<p>Check the syntax, make sure the test operator has an operand, and try again.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2210">Improper file redirection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-file-redirection-was-it-supposed-to-be-a-comparison-or-fd-operation">This is a file redirection. Was it supposed to be a comparison or fd operation?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-file-redirection-was-it-supposed-to-be-a-comparison-or-fd-operation">This is a file redirection. Was it supposed to be a comparison or fd operation?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> x &gt; <span class="m">5</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"true"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo &gt; /dev/null <span class="m">2</span>&gt;1
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">((</span> x &gt; <span class="m">5</span> <span class="o">))</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"true"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are redirecting to or from a filename that is an integer. For example, <code>ls &gt; file</code> where <code>file</code> happens to be <code>3</code>.</p>
<p>This is not likely to be intentional. The most common causes are:</p>
<ol>
<li>Trying to compare two numbers, as in <code>x &gt; 5</code>. This should instead be <code>[ "$x" -gt 5 ]</code> or <code>(( x &gt; 5 ))</code>.</li>
<li>Trying similarly to compare command output, as in <code>grep -c foo file &gt; 100</code> instead of <code>[ "$(grep -c foo file)" -gt 100 ]</code></li>
<li>Malformed FD operations, such as writing <code>1&gt;2</code> instead of <code>1&gt;&amp;2</code>.</li>
</ol>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you do want to create a file named <code>4</code>, you can quote it to silence shellcheck and make it more clear to humans that it's not supposed to be taken numerically.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1012">Invalid printing of \t</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#t-is-just-literal-t-here-for-tab-use-printf-t-instead">\t is just literal t here. For tab, use "$(printf '\t')" instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="t-is-just-literal-t-here-for-tab-use-printf-t-instead"><code>\t</code> is just literal <code>t</code> here. For tab, use <code>"$(printf '\t')"</code> instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Want tab</span>
<span class="nv">var</span><span class="o">=</span>foo<span class="se">\t</span>bar
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Want linefeed</span>
<span class="nv">var</span><span class="o">=</span>foo<span class="se">\n</span>bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"foo</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'\t'</span><span class="k">)</span><span class="s2">bar"</span>  <span class="c1"># As suggested in warning</span>
<span class="nv">var</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'foo\tbar'</span><span class="k">)</span><span class="s2">"</span>  <span class="c1"># Equivalent alternative</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Literal, quoted linefeed</span>
<span class="nv">line</span><span class="o">=</span><span class="s2">"foo</span>
<span class="s2">bar"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a <code>\t</code>, <code>\n</code> or <code>\r</code> in a context where they just become regular letter <code>t</code>, <code>n</code> or <code>r</code>. Most likely, it was intended as a tab, linefeed or carriage return.</p>
<p>To generate such characters (plus other less common ones including <code>\a</code>, <code>\f</code> and octal escapes) , use <code>printf</code> as in the example. The exception is for linefeeds that would be stripped by command substitution; in these cases, use a literal quoted linefeed instead.</p>
<p>Other characters like <code>\z</code> generate a [[SC1001]] info message, as the intent is less certain.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2025">Improper escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#make-sure-all-escape-sequences-are-enclosed-in-to-prevent-line-wrapping-issues">Make sure all escape sequences are enclosed in \[..\] to prevent line wrapping issues</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="make-sure-all-escape-sequences-are-enclosed-in-to-prevent-line-wrapping-issues">Make sure all escape sequences are enclosed in <code>\[..\]</code> to prevent line wrapping issues</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'\e[36m\$ \e(B\e[m'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'\[\e[36m\]\$ \[\e(B\e[m\]'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash is unable to determine exactly which parts of your prompt are text and which are terminal codes. You have to help it by wrapping invisible control codes in <code>\[..\]</code> (and ensuring that visible characters are not wrapped in <code>\[..\]</code>).</p>
<p>Note: ShellCheck offers this as a helpful hint and not a robust check. Don't rely on ShellCheck to verify that your prompt is correct.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/053">BashFaq: I have a fancy prompt with colors, and now bash doesn't seem to know how wide my terminal is. Lines wrap around incorrectly.</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2051">Using variables in brace range expansions</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#bash-doesnt-support-variables-in-brace-range-expansions">Bash doesn't support variables in brace range expansions.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related Resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="bash-doesnt-support-variables-in-brace-range-expansions">Bash doesn't support variables in brace range expansions.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in <span class="o">{</span><span class="m">1</span>..<span class="nv">$n</span><span class="o">}</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> i&lt;n<span class="p">;</span> i++<span class="o">))</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In Bash, brace expansion happens before variable expansion. This means that brace expansion will not account for variables.</p>
<p>For integers, use an arithmetic for loop instead. For zero-padded numbers or letters, use of eval may be warranted:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">from</span><span class="o">=</span><span class="s2">"a"</span> <span class="nv">to</span><span class="o">=</span><span class="s2">"m"</span>
<span class="k">for</span> c in <span class="k">$(</span><span class="nb">eval</span> <span class="s2">"echo {</span><span class="nv">$from</span><span class="s2">..</span><span class="nv">$to</span><span class="s2">}"</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$c</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>or more carefully (if <code>from</code>/<code>to</code> could be user input, or if the brace expansion could have spaces):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">from</span><span class="o">=</span><span class="s2">"a"</span> <span class="nv">to</span><span class="o">=</span><span class="s2">"m"</span>
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -d <span class="s1">''</span> -r c
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Read </span><span class="nv">$c</span><span class="s2">"</span>
<span class="k">done</span> &lt;  &lt;<span class="o">(</span><span class="nb">eval</span> <span class="s2">"printf '%s\0' </span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">"{%q..%q}.jpg"</span> <span class="s2">"</span><span class="nv">$from</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$to</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span><span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>None (if you're writing for e.g. zsh, you can use a directive to disable this check)</p>
<h3 id="related-resources">Related Resources:</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/169511/how-do-i-iterate-over-a-range-of-numbers-defined-by-variables-in-bash">StackOverflow: Variables in bash seq replacement ({1..10})</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2183">Unmatched arguments for printf</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-format-string-has-2-variables-but-is-passed-1-arguments">This format string has 2 variables, but is passed 1 arguments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-format-string-has-2-variables-but-is-passed-1-arguments">This format string has 2 variables, but is passed 1 arguments.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Hello %s, welcome to %s.\n"</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Hello %s, welcome to %s.\n"</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$HOSTNAME</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you're using a <code>printf</code> format string with more <code>%s</code> variables than arguments to fill them.</p>
<p>In the problematic example case, the last <code>%s</code> will just become an empty string every time.</p>
<p>Either remove the unused variables from the format string, or add enough arguments to fill them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>When using the Ksh/Bash <code>%T</code> timestamp extension, such as <code>printf 'The time is %(%H:%M)T\n'</code>, an argument of <code>-1</code> and no argument are both taken to mean the current time. In these cases, consider specifying <code>-1</code> explicitly.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2182">Unmatched arguments for printf</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-printf-format-string-has-no-variables-other-arguments-are-ignored">This printf format string has no variables. Other arguments are ignored.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-printf-format-string-has-no-variables-other-arguments-are-ignored">This printf format string has no variables. Other arguments are ignored.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">place</span><span class="o">=</span><span class="s2">"world"</span>
<span class="nb">printf</span> hello <span class="nv">$place</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">place</span><span class="o">=</span><span class="s2">"world"</span>
<span class="nb">printf</span> <span class="s2">"hello %s\n"</span> <span class="s2">"</span><span class="nv">$place</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you're using a <code>printf</code> with multiple arguments, but where the first argument has no <code>%s</code> or equivalent variable placeholders.</p>
<p><code>echo</code> accepts zero or more strings to write, e.g. <code>echo hello world</code>.</p>
<p><code>printf</code> instead accepts one pattern/template with zero or more <code>%s</code>-style placeholders, and one argument for each placeholder.</p>
<p>Rewrite your command using the right semantics, otherwise all arguments after the first one will be ignored:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nb">printf</span> hello world<span class="se">\\</span>n
hello

$ <span class="nb">printf</span> <span class="s2">"hello world\n"</span>
hello world

$ <span class="nb">printf</span> <span class="s2">"hello %s\n"</span> <span class="s2">"world"</span>
hello world
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2066">Looping only once</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#since-you-double-quoted-this-it-will-not-word-split-and-the-loop-will-only-run-once">Since you double quoted this, it will not word split, and the loop will only run once.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a><ul>
<li><a href="#loop-over-each-line-without-globbing-hello-world-my-png">Loop over each line without globbing (hello world, My *.png)</a></li>
<li><a href="#loop-over-each-word-with-globbing-hello-world-my-filepng-my-catpng">Loop over each word with globbing (hello, world, My, file.png, My cat.png):</a></li>
<li><a href="#loop-over-each-line-with-globbing-hello-world-my-catpng">Loop over each line with globbing (hello world, My cat.png)</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="since-you-double-quoted-this-it-will-not-word-split-and-the-loop-will-only-run-once">Since you double quoted this, it will not word split, and the loop will only run once.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> s in <span class="s2">"</span><span class="k">$(</span>mycommand<span class="k">)</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$s</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>The correct code depends on your intention. Let's say you're in a directory with the files <code>file.png</code> and <code>My cat.png</code>, and you want to loop over a command that outputs (or variable that contains):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>hello world
My *.png
</pre></div>
</td></tr></table>
<h4 id="loop-over-each-line-without-globbing-hello-world-my-png">Loop over each line without globbing (<code>hello world</code>, <code>My *.png</code>)</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mycommand <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r s<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$s</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h4 id="loop-over-each-word-with-globbing-hello-world-my-filepng-my-catpng">Loop over each word with globbing (<code>hello</code>, <code>world</code>, <code>My</code>, <code>file.png</code>, <code>My cat.png</code>):</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># relies on the fact that IFS by default contains space-tab-linefeed</span>
<span class="k">for</span> s in <span class="k">$(</span>mycommand<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$s</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h4 id="loop-over-each-line-with-globbing-hello-world-my-catpng">Loop over each line with globbing (<code>hello world</code>, <code>My cat.png</code>)</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># explicitly set IFS to contain only a line feed</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">'</span>
<span class="s1">'</span>
<span class="k">for</span> s in <span class="k">$(</span>mycommand<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$s</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You get this warning because you have a loop that will only ever run exactly one iteration. Since you have a loop, you clearly expect it to run more than once. You just have to decide how it should be split up.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2071">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-for-string-comparisons-use-gt-instead">&gt; is for string comparisons. Use -gt instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-for-string-comparisons-use-gt-instead">&gt; is for string comparisons. Use -gt instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> &gt; <span class="m">10</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Incorrectly triggers when var=5"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> -gt <span class="m">10</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Correct numerical comparison"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>&lt;</code> and <code>&gt;</code>, in both <code>[[</code> and <code>[</code> (when escaped) will do a lexicographical comparison, not a numerical comparison. </p>
<p>This means that <code>[[ 5 &gt; 10 ]]</code> is true because 5 comes after 10 alphabetically. Meanwhile <code>[[ 5 -gt 10 ]]</code> is false because 5 does not come after 10 numerically.</p>
<p>If you want to compare numbers by value, use the numerical comparison operators <code>-gt</code>, <code>-ge</code>, <code>-lt</code> and <code>-le</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the strings happen to be version numbers and you're using &lt;, or &gt; to compare them as strings, and you consider this an acceptable thing to do, then you can ignore this warning.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf7">Bash Pitfalls: <code>[[ $foo &gt; 7 ]]</code></a></li>
<li><a href="https://stackoverflow.com/questions/18668556/comparing-numbers-in-bash">StackOverflow: Comparing numbers in Bash</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1068">Redundant space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-put-spaces-around-the-in-assignments">Don't put spaces around the = in assignments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="dont-put-spaces-around-the-in-assignments">Don't put spaces around the = in assignments.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span> <span class="o">=</span> <span class="m">42</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="m">42</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shells are space sensitive. <code>foo=42</code> means to assign <code>42</code> to the variable <code>foo</code>. <code>foo = 42</code> means to run a command named <code>foo</code>, and pass <code>=</code> as <code>$1</code> and <code>42</code> as <code>$2</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you actually wanted to run a command named foo and provide <code>=</code> as the first argument, simply quote it to make ShellCheck be quiet: <code>foo "=" 42</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1113">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-not-just-for-the-shebang">Use #!, not just #, for the shebang.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-not-just-for-the-shebang">Use #!, not just #, for the shebang.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># /bin/bash</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be specifying a shebang, but missing the bang (i.e. <code>!</code>). The shebang should always be on the form <code>#!/path/shell</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2069">Improper output redirection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-redirect-stdoutstderr-21-must-be-last-or-use-cmd-file-21-to-clarify">To redirect stdout+stderr, 2&gt;&amp;1 must be last (or use '{ cmd &gt; file; } 2&gt;&amp;1' to clarify).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="to-redirect-stdoutstderr-21-must-be-last-or-use-cmd-file-21-to-clarify">To redirect stdout+stderr, 2&gt;&amp;1 must be last (or use '{ cmd &gt; file; } 2&gt;&amp;1' to clarify).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>firefox <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> &gt; /dev/null
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>firefox &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When it comes to redirection, order matters.</p>
<p>The problematic code means "Point stderr to where stdout is currently pointing (the terminal). Then point stdout to /dev/null".</p>
<p>The correct code means "Point stdout to /dev/null. Then point stderr to where stdout is currently pointing (/dev/null)".</p>
<p>In other words, the problematic code hides stdout and shows stderr. The correct code hides both stderr and stdout, which is usually the intention.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you actually do want to redirect stdout to a file, and then turn stderr into the new stdout, you can make this more explicit with braces:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{ firefox &gt; /dev/null; } 2&gt;&amp;1
</pre></div>
</td></tr></table>
<p>Also note that this warning does not trigger when output is piped or captured.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf43">Bash Pitfalls: somecmd 2&gt;&amp;1 &gt;&gt;logfile</a></li>
<li><a href="https://mywiki.wooledge.org/BashFAQ/055">BashFaq: Tell me all about 2&gt;&amp;1 -- what's the difference between 2&gt;&amp;1 &gt;foo and &gt;foo 2&gt;&amp;1, and when do I use which?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2145">Ambiguous expression</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#argument-mixes-string-and-array-use-or-separate-argument">Argument mixes string and array. Use * or separate argument.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#problematic-code-2">Problematic code 2:</a></li>
<li><a href="#correct-code-2">Correct code 2:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="argument-mixes-string-and-array-use-or-separate-argument">Argument mixes string and array. Use * or separate argument.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Error: %s\n"</span> <span class="s2">"Bad parameters: </span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Error: %s\n"</span> <span class="s2">"Bad parameters: </span><span class="nv">$*</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="problematic-code-2">Problematic code 2:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Error: %s\n"</span> <span class="s2">"Bad parameters: </span><span class="si">${</span><span class="nv">ARRAY_VAR</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code-2">Correct code 2:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Error: %s\n"</span> <span class="s2">"Bad parameters: "</span> <span class="s2">"</span><span class="si">${</span><span class="nv">ARRAY_VAR</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The behavior when concatenating a string and array is rarely intended. The preceeding string is prefixed to the first array element, while the succeeding string is appended to the last one. The middle array elements are unaffected.</p>
<p>E.g., with the parameters <code>foo</code>,<code>bar</code>,<code>baz</code>, <code>"--flag=$@"</code> is equivalent to the three arguments <code>"--flag=foo" "bar" "baz"</code>.</p>
<p>If the intention is to concatenate all the array elements into one argument, use <code>$*</code>. This concatenates based on <code>IFS</code>.</p>
<p>If the intention is to provide each array element as a separate argument, put the array expansion in its own argument.</p>
<h3 id="exceptions">Exceptions</h3>
<p>The POSIX specified behavior of <code>$@</code> (and by extension arrays) as part of other strings is often unexpected:</p>
<blockquote>
<p>if the parameter being expanded was embedded within a word, the first field shall be joined with the beginning part of the original word and the last field shall be joined with the end part of the original word. In all other contexts the results of the expansion are unspecified. If there are no positional parameters, the expansion of '@' shall generate zero fields, even when '@' is within double-quotes; however, if the expansion is embedded within a word which contains one or more other parts that expand to a quoted null string, these null string(s) shall still produce an empty field, except that if the other parts are all within the same double-quotes as the '@', it is unspecified whether the result is zero fields or one empty field.</p>
</blockquote>
<p>If you're aware of this and intend to take advantage of it, you can ignore this warning. However, you can also usually also rewrite it into a less surprising form. For example, here's a wrapper script that uses this behavior to substitute certain commands by defining a function for them:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
fixed_fgrep<span class="o">()</span> <span class="o">{</span> grep -F <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
fixed_echo<span class="o">()</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
fixed_seq<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"seq is not portable"</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="k">return</span> <span class="m">1</span><span class="p">;</span> <span class="o">}</span>

<span class="k">if</span> <span class="nb">command</span> -v <span class="s2">"fixed_</span><span class="nv">$1</span><span class="s2">"</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">then</span>
  <span class="c1"># shellcheck disable=SC2145   # I know how fixed_"$@" behaves and it's correct!</span>
  fixed_<span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">else</span>
  <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>Here's the same script without relying on this behavior:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
fixed_fgrep<span class="o">()</span> <span class="o">{</span> grep -F <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
fixed_echo<span class="o">()</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
fixed_seq<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"seq is not portable"</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="k">return</span> <span class="m">1</span><span class="p">;</span> <span class="o">}</span>

<span class="nv">cmd</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nb">shift</span>

<span class="k">if</span> <span class="nb">command</span> -v <span class="s2">"fixed_</span><span class="nv">$cmd</span><span class="s2">"</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">then</span>
 <span class="c1"># Perhaps more straight forward with fewer surprises:</span>
  <span class="s2">"fixed_</span><span class="nv">$cmd</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">else</span>
  <span class="s2">"</span><span class="nv">$cmd</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2034">Unused variable</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#foo-appears-unused-verify-it-or-export-it">foo appears unused. Verify it or export it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a><ul>
<li><a href="#indirection">Indirection</a></li>
<li><a href="#intentionally-unused-variables">Intentionally unused variables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="foo-appears-unused-verify-it-or-export-it">foo appears unused. Verify it or export it.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FOO</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Variables not used for anything are often associated with bugs, so ShellCheck warns about them.</p>
<p>Also note that something like <code>local let foo=42</code> does not make a <code>let</code> statement local -- it instead declares an additional local variable named <code>let</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>This warning may be falsely emitted when a variable is only referenced indirectly, and for variables that are intentionally unused.</p>
<h4 id="indirection">Indirection</h4>
<p>It's ShellCheck's intended behavior to emit this warning for any variable that is only referenced though indirection:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span># foo generates a warning, even though it has five indirect references
foo=42     
name=foo
echo "<span class="cp">${</span><span class="err">!</span><span class="n">name</span><span class="cp">}</span> $((name))"
export "<span class="nv">$name</span>"; eval "echo <span class="nv">$name</span>"
declare -n name; echo "<span class="nv">$name</span>"
</pre></div>
</td></tr></table>
<p>This is an intentional design decision and not a bug. If you have variables that will not have direct references, consider using an associative array in bash, or just [[Ignore]] the warning. </p>
<p>Tracking indirect references is a common problem for compilers and static analysis tool, and it is known to be unsolvable in the most general case. There are two ways to handle unresolved indirections (which in a realistic program will essentially be all of them):</p>
<ul>
<li>Avoid false positives by assuming all variables may potentially be used (disable all unused variable warnings)</li>
<li>Keep true positives by allowing some false positives (emit unused variable warnings that may be incorrect)</li>
</ul>
<p>Compilers are forced to do the former, but static analysis tools generally do the latter. This includes <code>pylint</code>, <code>jshint</code> and <code>shellcheck</code> itself. This is a design decision meant to make the tools more helpful at the expense of some noise. For consistency and to avoid giving the impression that it should work more generally, ShellCheck does not attempt to resolve even trivial indirections.</p>
<h4 id="intentionally-unused-variables">Intentionally unused variables</h4>
<p>For throwaway variables, consider using <code>_</code> as a dummy:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> _ last _ zip _ _ <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$str</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$last</span><span class="s2">, </span><span class="nv">$zip</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or if you prefer to keep the names, use a directive to disable the warning:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC2034  # Unused variables left for readability</span>
<span class="nb">read</span> first last email zip lat lng <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$str</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$last</span><span class="s2">, </span><span class="nv">$zip</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2209">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-varcommand-to-assign-output-or-quote-to-assign-string">Use var=$(command) to assign output (or quote to assign string).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-varcommand-to-assign-output-or-quote-to-assign-string">Use var=$(command) to assign output (or quote to assign string).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">user</span><span class="o">=</span>whoami         <span class="c1"># Want to run whoami and assign output</span>

<span class="nv">PAGER</span><span class="o">=</span>cat git log   <span class="c1"># Want to assign the string "cat"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">user</span><span class="o">=</span><span class="k">$(</span>whoami<span class="k">)</span>

<span class="nv">PAGER</span><span class="o">=</span><span class="s2">"cat"</span> git log
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Putting <code>var=</code> in front of a command will not assign its output. Use <code>var=$(my command here)</code> to execute the command and capture its output.</p>
<p>If you do want to assign a literal string, use quotes to make this clear to shellcheck and humans alike. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
<p>Quoting a single command (as in <code>PAGER="cat"</code> above) doesn't change how the script works. It's purely to show shellcheck (and humans) that a literal assignment of a command name is intentional. </p>
<p>This warning triggers generally when a variable is assigned an unquoted command name (from a list of hard coded names). See related warning [[SC2037]] which detects the same kind of error through the patterns <code>var=value -flag</code> and <code>var=value *glob*</code>.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/002">BashFaq: How can I store the return value and/or output of a command in a variable?</a></li>
<li><a href="https://stackoverflow.com/questions/4651437/how-to-set-a-variable-to-the-output-from-a-command-in-bash">StackOverflow: How to set a variable to the output from a command in Bash</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2186">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#tempfile-is-deprecated-use-mktemp-instead">tempfile is deprecated. Use mktemp instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="tempfile-is-deprecated-use-mktemp-instead">tempfile is deprecated. Use mktemp instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">tmp</span><span class="o">=</span><span class="k">$(</span>tempfile<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">tmp</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>tempfile</code> is a Debian specific utility for creating temporary files. Its man page notes:</p>
<blockquote>
<p>tempfile is deprecated; you should use mktemp(1) instead.</p>
</blockquote>
<p>Neither <code>tempfile</code> nor <code>mktemp</code> are POSIX, but <code>tempfile</code> is Debian specific while <code>mktemp</code> works on GNU, OSX, BusyBox, *BSD and Solaris.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck will not recognize when a function overrides this name.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2207">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#prefer-mapfile-or-read-a-to-split-command-output-or-quote-to-avoid-splitting">Prefer mapfile or read -a to split command output (or quote to avoid splitting).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="prefer-mapfile-or-read-a-to-split-command-output-or-quote-to-avoid-splitting">Prefer mapfile or read -a to split command output (or quote to avoid splitting).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="k">$(</span>mycommand<span class="k">)</span> <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>If it outputs multiple lines, each of which should be an element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For bash 4.x</span>
mapfile -t array &lt; &lt;<span class="o">(</span>mycommand<span class="o">)</span>

<span class="c1"># For bash 3.x+</span>
<span class="nv">array</span><span class="o">=()</span>
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span><span class="s1">''</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span> <span class="nv">array</span><span class="o">+=(</span><span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span> &lt; &lt;<span class="o">(</span>mycommand<span class="o">)</span>

<span class="c1"># For ksh</span>
<span class="nv">array</span><span class="o">=()</span>
mycommand <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span><span class="s2">""</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span> <span class="nv">array</span><span class="o">+=(</span><span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>If it outputs a line with multiple words (separated by spaces), other delimiters can be chosen with IFS, each of which should be an element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For bash</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">" "</span> <span class="nb">read</span> -r -a array <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="k">$(</span>mycommand<span class="k">)</span><span class="s2">"</span>

<span class="c1"># For ksh</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">" "</span> <span class="nb">read</span> -r -A array <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="k">$(</span>mycommand<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>If the output should be a single element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="s2">"</span><span class="k">$(</span>mycommand<span class="k">)</span><span class="s2">"</span> <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are doing unquoted command expansion in an array. This will invoke the shell's sloppy word splitting and glob expansion.</p>
<p>Instead, prefer explicitly splitting (or not splitting):</p>
<ul>
<li>If you want to split the output into lines or words, use <code>mapfile</code>, <code>read -ra</code> and/or <code>while</code> loops as appropriate.</li>
<li>If the command output should become a single array element, quote it.</li>
</ul>
<p>This prevents the shell from doing unwanted splitting and glob expansion, and therefore avoiding problems with output containing spaces or special characters.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you have already taken care (through setting IFS and <code>set -f</code>) to have word splitting work the way you intend, you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2124">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#assigning-an-array-to-a-string-assign-as-array-or-use-instead-of-to-concatenate">Assigning an array to a string! Assign as array, or use * instead of @ to concatenate.</a><ul>
<li><a href="#danger">Danger!</a></li>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#adding-an-element-to-an-array-may-trigger-this-warning-when-you-forget-the-parenthesis">Adding an element to an array may trigger this warning when you forget the parenthesis.</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="assigning-an-array-to-a-string-assign-as-array-or-use-instead-of-to-concatenate">Assigning an array to a string! Assign as array, or use * instead of @ to concatenate.</h2>
<h3 id="danger">Danger!</h3>
<blockquote>
<p>Changing this parameter can be dangerous. Its behavior is influenced by the value of <code>IFS</code>. In certain situations (like feeding strings into commands) this can result in unexpected results from a seemingly aesthetic-only change.
<a href="https://wiki.bash-hackers.org/syntax/shellvars#special_parameters_and_shell_variables">[More info]</a></p>
</blockquote>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="nv">$@</span>
<span class="k">for</span> i in <span class="nv">$var</span><span class="p">;</span> <span class="k">do</span> ..<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> -- Hello World
<span class="nv">msg</span><span class="o">=</span><span class="nv">$@</span>
<span class="nb">echo</span> <span class="s2">"You said </span><span class="nv">$msg</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=(</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="o">)</span>
<span class="k">for</span> i in <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span> ..<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> -- Hello World
<span class="nv">msg</span><span class="o">=</span><span class="nv">$*</span>
<span class="nb">echo</span> <span class="s2">"You said </span><span class="nv">$msg</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Arrays and <code>$@</code> can contain multiple elements. Simple variables contain only one. When assigning multiple elements to one element, the default behavior depends on the shell (bash concatenates with spaces, zsh concatenates with first char of <code>IFS</code>).</p>
<p>Since doing this usually indicates a bug, ShellCheck warns and asks you to be explicit about what you want.</p>
<p>If you want to assign N elements as N elements, use an array, e.g. <code>myArray=( "$@" )</code>.</p>
<p>If you want to assign N elements as 1 element by concatenating them, use <code>*</code> instead of <code>@</code>, e.g. <code>myVar=${myArray[*]}</code> (this separates elements with the first character of <code>IFS</code>, usually space).</p>
<p>The same is true for <code>${@: -1}</code>, which results in 0 or 1 elements: <code>var=${*: -1}</code> assigns the last element or an empty string.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
<h3 id="adding-an-element-to-an-array-may-trigger-this-warning-when-you-forget-the-parenthesis">Adding an element to an array may trigger this warning when you forget the parenthesis.</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>filelist="<span class="cp">${</span><span class="n">filelist</span><span class="p">[</span><span class="err">@</span><span class="p">]</span><span class="cp">}</span>" "<span class="nv">$filename</span>"
</pre></div>
</td></tr></table>
<p>What was meant is:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>filelist=("<span class="cp">${</span><span class="n">filelist</span><span class="p">[</span><span class="err">@</span><span class="p">]</span><span class="cp">}</span>" "<span class="nv">$filename</span>")
</pre></div>
</td></tr></table>
<p>Note: this syntax is compatible with older shells, in later shells (bash 3.1+ and zsh 4.2+) you can do: <code>filelist+=("$filename")</code></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2154">Use of uninitialized variable</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#var-is-referenced-but-not-assigned">var is referenced but not assigned.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="var-is-referenced-but-not-assigned">var is referenced but not assigned.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span>name
<span class="nv">n</span><span class="o">=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var_$n</span><span class="s2">.jpg"</span>   <span class="c1"># overextended</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">target</span><span class="o">=</span><span class="s2">"world"</span>
<span class="nb">echo</span> <span class="s2">"hello </span><span class="nv">$tagret</span><span class="s2">"</span>  <span class="c1"># misspelled</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Result: </span><span class="si">${</span><span class="nv">mycmd</span><span class="p"> -a myfile</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># trying to execute commands</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span>name
<span class="nv">n</span><span class="o">=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="si">}</span><span class="s2">_</span><span class="nv">$n</span><span class="s2">.jpg"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">target</span><span class="o">=</span><span class="s2">"world"</span>
<span class="nb">echo</span> <span class="s2">"hello </span><span class="nv">$target</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Result: </span><span class="k">$(</span>mycmd -a myfile<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you reference a variable that is not assigned. Double check that the variable is indeed assigned, and that the name is not misspelled.</p>
<p>Note: This message only triggers for variables with lowercase characters in their name (<code>foo</code> and <code>kFOO</code> but not <code>FOO</code>) due to the standard convention of using lowercase variable names for unexported, local variables.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck intentionally does not attempt to figure out runtime or dynamic assignments like with <code>source "$(date +%F).sh"</code> or <code>eval var=value</code>. See [[SC2034]] for an extended discussion of why this is the case.</p>
<p>If you know for a fact that the variable is set, you can use <code>${var:?}</code> to fail if the variable is unset (or empty), initialize it to a default value if uninitialized with <code>: "${var:=}"</code>, or explicitly initialize/declare it with <code>var=""</code> or <code>declare var</code>. You can also disable the message with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2158">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#false-is-true-remove-the-brackets">[ false ] is true. Remove the brackets</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="false-is-true-remove-the-brackets">[ false ] is true. Remove the brackets</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="nb">false</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"triggers anyways"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">false</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"never triggers"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ str ]</code> checks whether <code>str</code> is non-empty. It doesn't matter if <code>str</code> is <code>false</code>, it will still be evaluated for non-emptyness.</p>
<p>Instead, use the command <code>false</code> which -- as the manual puts it -- does nothing, unsuccessfully.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1120">Comments after here-doc token</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#no-comments-allowed-after-here-doc-token-comment-the-next-line-instead">No comments allowed after here-doc token. Comment the next line instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="no-comments-allowed-after-here-doc-token-comment-the-next-line-instead">No comments allowed after here-doc token. Comment the next line instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; eof  # --- Start greeting --</span>
<span class="s">Hello</span>
<span class="s">eof</span>         <span class="c1"># --- End greeting ---</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; eof  # --- Start greeting --</span>
<span class="s">Hello</span>
<span class="s">eof</span>
            <span class="c1"># --- End greeting ---</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The terminator token for a here document must be on an entirely separate line. No comments are allowed on this line.</p>
<p>Place the comment somewhere else, such as on the following line.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2013">Improper line reading</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-read-lines-rather-than-words-piperedirect-to-a-while-read-loop">To read lines rather than words, pipe/redirect to a 'while read' loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="to-read-lines-rather-than-words-piperedirect-to-a-while-read-loop">To read lines rather than words, pipe/redirect to a 'while read' loop.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> line in <span class="k">$(</span>cat file <span class="p">|</span> grep -v <span class="s1">'^ *#'</span><span class="k">)</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Line: </span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep -v <span class="s1">'^ *#'</span> &lt; file <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Line: </span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<p>or without a subshell (bash, zsh, ksh):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Line: </span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>grep -v <span class="s1">'^ *#'</span> &lt; file<span class="o">)</span>
</pre></div>
</td></tr></table>
<p>or without a subshell, with a pipe (more portable, but write a file on the filesystem):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mkfifo mypipe
grep -v <span class="s1">'^ *#'</span> &lt; file &gt; mypipe <span class="p">&amp;</span>
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Line: </span><span class="nv">$line</span><span class="s2">"</span>
<span class="k">done</span> &lt; mypipe
rm mypipe
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>For loops by default (subject to <code>$IFS</code>) read word by word. Additionally, glob expansion will occur.</p>
<p>Given this text file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo *
bar
</pre></div>
</td></tr></table>
<p>The for loop will print:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Line: foo
Line: aardwark.jpg
Line: bullfrog.jpg
...
</pre></div>
</td></tr></table>
<p>The while loop will print:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Line: foo *
Line: bar
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>If you do want to read word by word, you can set <code>$IFS</code> appropriately and disable globbing with <code>set -f</code>, and then [[ignore]] this warning. Alternatively, you can pipe through <code>tr ' ' '\n'</code> to turn words into lines, and then use <code>while read</code>. In Bash/Ksh, you can also use a <code>while read -a</code> loop to get an array of words per line.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2087">Improper here-doc</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-eof-to-make-here-document-expansions-happen-on-the-server-side-rather-than-on-the-client">Quote 'EOF' to make here document expansions happen on the server side rather than on the client.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-eof-to-make-here-document-expansions-happen-on-the-server-side-rather-than-on-the-client">Quote 'EOF' to make here document expansions happen on the server side rather than on the client.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host.example.com <span class="s">&lt;&lt; EOF</span>
<span class="s">  echo "Logged in on $HOSTNAME"</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host.example.com &lt;&lt; <span class="s2">"EOF"</span>
  <span class="nb">echo</span> <span class="s2">"Logged in on </span><span class="nv">$HOSTNAME</span><span class="s2">"</span>
EOF
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When the end token of a here document is unquoted, parameter expansion and command substitution will happen on in contents of the here doc.</p>
<p>This means that before sending the commands to the server, the client replaces <code>$HOSTNAME</code> with localhost, thereby sending <code>echo "Logged in on localhost"</code> to the server. This has the effect of printing the client's hostname instead of the server's.</p>
<p>Scripts with any kind of variable use are especially problematic because all references will be expanded before the script run. For example,</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host <span class="s">&lt;&lt; EOF</span>
<span class="s">  x="$(uname -a)"</span>
<span class="s">  echo "$x"</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>
<p>will never print anything, neither client nor server details, since before evaluation, it will be expanded to:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="nv">x</span><span class="o">=</span><span class="s2">"Linux localhost ... x86_64 GNU/Linux"</span>
  <span class="nb">echo</span> <span class="s2">""</span>
</pre></div>
</td></tr></table>
<p>By quoting the here token, local expansion will not take place, so the server sees <code>echo "Logged in on $HOSTNAME"</code> which is expanded and printed with the server's hostname, which is usually the intention.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the client should expand some or all variables, this message can and should be ignored.</p>
<p>To expand a mix of local and remote variables, the here doc end token should be unquoted, and the remote variables should be escaped, e.g.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ssh host.example.com <span class="s">&lt;&lt; EOF</span>
<span class="s">  echo "Logged in on \$HOSTNAME from $HOSTNAME"</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1065">Using observable function parameters</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#trying-to-declare-parameters-dont-use-and-refer-to-params-as-1-2">Trying to declare parameters? Don't. Use () and refer to params as $1, $2..</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="trying-to-declare-parameters-dont-use-and-refer-to-params-as-1-2">Trying to declare parameters? Don't. Use () and refer to params as $1, $2..</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">(</span>input<span class="o">)</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$input</span><span class="s2">"</span>
<span class="o">}</span>
foo<span class="o">(</span><span class="s2">"hello world"</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
foo <span class="s2">"hello world"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shell script functions behave just like scripts and other commands:</p>
<ul>
<li>They always take a 0 to N parameters, referred to with <code>$1</code>, <code>$2</code> etc. They can not declare parameters by name.</li>
<li>They are executed using <code>name arg1 arg2</code>, and not with parentheses as C-like languages.</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2006">Expired expression style</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-notation-instead-of-legacy-backticked">Use $(...) notation instead of legacy backticked `...`.</a><ul>
<li><a href="#problematic-code">Problematic code</a></li>
<li><a href="#correct-code">Correct code</a></li>
<li><a href="#rationale">Rationale</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="use-notation-instead-of-legacy-backticked">Use <code>$(...)</code> notation instead of legacy backticked <code>`...`</code>.</h1>
<h3 id="problematic-code">Problematic code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"You are running on `uname`"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"You are running on </span><span class="k">$(</span>uname<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale</h3>
<p>Backtick command substitution <code>`...`</code> is legacy syntax with several issues.</p>
<ol>
<li>It has a series of undefined behaviors related to quoting in POSIX.</li>
<li>It imposes a custom escaping mode with surprising results.</li>
<li>It's exceptionally hard to nest.</li>
</ol>
<p><code>$(...)</code> command substitution has none of these problems, and is therefore strongly encouraged.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="http://mywiki.wooledge.org/BashFAQ/082">BashFaq: Why is <code>$(...)</code> preferred over <code>`...`</code> (backticks)?</a></li>
<li><a href="https://stackoverflow.com/questions/4708549/shell-programming-whats-the-difference-between-command-and-command">StackOverflow: What is the difference between $(command) and <code>`command`</code> in shell programming?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1114">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-leading-spaces-before-the-shebang">Remove leading spaces before the shebang.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-leading-spaces-before-the-shebang">Remove leading spaces before the shebang.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="c1">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello world"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script has leading spaces before the shebang (<code>#!</code>). This is not allowed. </p>
<p>The <code>#!</code> should be the first two bytes in the file, as they're used as a file signature by the OS to determine whether a file is a script.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2206">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-to-prevent-word-splittingglobbing-or-split-robustly-with-mapfile-or-read-a">Quote to prevent word splitting/globbing, or split robustly with mapfile or read -a.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-to-prevent-word-splittingglobbing-or-split-robustly-with-mapfile-or-read-a">Quote to prevent word splitting/globbing, or split robustly with mapfile or read -a.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="nv">$var</span> <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>If the variable should be a single element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">)</span>
</pre></div>
</td></tr></table>
<p>If it's multiple lines, each of which should be an element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For bash</span>
mapfile -t array <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>

<span class="c1"># For ksh</span>
<span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span><span class="s2">""</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span> <span class="nv">array</span><span class="o">+=(</span><span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>If it's a line with multiple words (separated by spaces, other delimiters can be chosen with IFS), each of which should be an element:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For bash</span>
<span class="nb">read</span> -r -a array <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>

<span class="c1"># For ksh</span>
<span class="nb">read</span> -r -A array <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<ol>
<li>https://stackoverflow.com/questions/1469849</li>
</ol>
<h3 id="rationale">Rationale:</h3>
<p>You are expanding a variable unquoted in an array. This will invoke the shell's sloppy word splitting and glob expansion.</p>
<p>Instead, prefer explicitly splitting (or not splitting):</p>
<ul>
<li>If the variable should become a single array element, quote it.</li>
<li>If you want to split into lines or words, use <code>mapfile</code>, <code>read -ra</code> and/or <code>while</code> loops as appropriate.</li>
</ul>
<p>This prevents the shell from doing unwanted splitting and glob expansion, and therefore avoiding problems with data containing spaces or special characters.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you have already taken care (through setting IFS and <code>set -f</code>) to have word splitting work the way you intend, you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2101">Missing '[]' for named class</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#named-class-needs-outer-eg-digit93">Named class needs outer [], e.g. [[:digit:]].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="named-class-needs-outer-eg-digit93">Named class needs outer [], e.g. [[:digit:]].</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>gzip file<span class="o">[</span>:digit:<span class="o">]</span>*.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>gzip file<span class="o">[[</span>:digit:<span class="o">]]</span>*.txt
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Predefined character groups are supposed to be used inside character ranges. <code>[:digit:]</code> matches one of "digt:" just like <code>[abc]</code> matches one of "abc". <code>[[:digit:]]</code> matches a digit.</p>
<h3 id="exceptions">Exceptions</h3>
<p>When passing an argument to <code>tr</code> which parses these by itself without relying on globbing, you should quote it instead, e.g. <code>tr -d '[:digit:]'</code></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2216">Bad piping</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#piping-to-rm-a-command-that-doesnt-read-stdin-wrong-command-or-missing-xargs">Piping to 'rm', a command that doesn't read stdin. Wrong command or missing xargs?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="piping-to-rm-a-command-that-doesnt-read-stdin-wrong-command-or-missing-xargs">Piping to 'rm', a command that doesn't read stdin. Wrong command or missing xargs?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls <span class="p">|</span> <span class="nb">echo</span>                      <span class="c1"># Want to print result</span>
cat files <span class="p">|</span> rm                 <span class="c1"># Want to delete items from a file</span>
find . -type f <span class="p">|</span> cp dir        <span class="c1"># Want to process 'find' output</span>
rm file <span class="p">|</span> <span class="nb">true</span>                 <span class="c1"># Want to ignore errors</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls
cat files <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r file<span class="p">;</span> <span class="k">do</span> rm -- <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
find . -type f -exec cp <span class="o">{}</span> dir <span class="se">\;</span>
rm file <span class="o">||</span> <span class="nb">true</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are piping to one of several commands that don't read from stdin.</p>
<p>This may happen when:</p>
<ul>
<li>Confusing one command for another, e.g. using <code>echo</code> where <code>cat</code> was intended.</li>
<li>Incorrectly refactoring, leaving a <code>|</code> on the previous line.</li>
<li>Missing <code>xargs</code>, because stdin should be passed as positional parameters instead (use <code>xargs -0</code> if at all possible).</li>
<li>Intending to use <code>||</code> instead of <code>|</code></li>
</ul>
<p>Check your logic, and rewrite the command so data is passed correctly.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you've overridden a command to return output, you can either rename it to make this obvious, or [[ignore]] this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2035">Ambiguous wildcard character</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-42glob-or-42glob-so-names-with-dashes-wont-become-options">Use ./*glob or -- *glob so names with dashes won't become options.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="use-42glob-or-42glob-so-names-with-dashes-wont-become-options">Use ./*glob<em> or -- *glob</em> so names with dashes won't become options.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm *
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm ./*
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -- *
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale</h3>
<p>Since files and arguments are strings passed the same way, programs can't properly determine which is which, and rely on dashes to determine what's what.</p>
<p>A file named <code>-f</code> (<code>touch -- -f</code>) will not be deleted by the problematic code. It will instead be interpreted as a command line option, and <code>rm</code> will even report success.</p>
<p>Using <code>./*</code> will instead cause the glob to be expanded into <code>./-f</code>, which no program will treat as an option.</p>
<p>Similarly, <code>--</code> by convention indicates the end of options, and nothing after it will be treated like flags (except for some programs possibly still special casing <code>-</code> as e.g. stdin).</p>
<p>Note that changing <code>*</code> to <code>./*</code> in GNU Tar parameters will add <code>./</code> prefix to path names in the created archive. This may cause subtle problems (eg. to search for a specific file in archive, the <code>./</code> prefix must be specified as well). So using <code>-- *</code> is a safer fix for GNU Tar commands.</p>
<p>For more information, see "<a href="http://www.dwheeler.com/essays/filenames-in-shell.html">Filenames and Pathnames in Shell: How to do it Correctly</a>".</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2203">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#globs-are-ignored-in-except-right-of-use-a-loop">Globs are ignored in [[ ]] except right of =/!=. Use a loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="globs-are-ignored-in-except-right-of-use-a-loop">Globs are ignored in <code>[[ ]]</code> except right of =/!=. Use a loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> current.log -nt backup/*.log <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the latest file"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">newerThanAll</span><span class="o">=</span><span class="nb">true</span>
<span class="k">for</span> log in backup/*.log
<span class="k">do</span>
  <span class="o">[[</span> current.log -nt <span class="s2">"</span><span class="nv">$log</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="nv">newerThanAll</span><span class="o">=</span><span class="nb">false</span>
<span class="k">done</span>
<span class="o">[[</span> <span class="s2">"</span><span class="nv">$newerThanAll</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the latest file"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Globs in <code>[[ ]]</code> will not filename expand, and will be treated literally (or as patterns on the right-hand side of <code>=</code>, <code>==</code> and <code>!=</code>).</p>
<p>The problematic code is equivalent to <code>[[ current.log -nt 'backup/*.png' ]</code>, and will look for a file with a literal asterisk in the name.</p>
<p>Instead, you can iterate over the filenames you want with a loop, and apply your condition to each filename.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1115">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-spaces-between-and-in-the-shebang">Remove spaces between # and ! in the shebang.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-spaces-between-and-in-the-shebang">Remove spaces between # and ! in the shebang.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># !/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script has spaces between the <code>#</code> and <code>!</code> in the shebang. This is not valid.</p>
<p>Remove the spaces so the OS can correctly recognize the file as a script.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2146">Improper use of '-o'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-action-ignores-everything-before-the-o-use-92-92-to-group">This action ignores everything before the -o. Use \( \) to group.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-action-ignores-everything-before-the-o-use-92-92-to-group">This action ignores everything before the -o. Use \( \) to group.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.avi'</span> -o -name <span class="s1">'*.mkv'</span> -exec cp <span class="o">{}</span> /media <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . <span class="se">\(</span> -name <span class="s1">'*.avi'</span> -o -name <span class="s1">'*.mkv'</span> <span class="se">\)</span> -exec cp <span class="o">{}</span> /media <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In <code>find</code>, two predicates with no operator between them is considered a logical, short-circuiting AND (as if using <code>-a</code>). E.g., <code>-name '*.mkv' -exec ..</code> is the same as <code>-name '*.mkv' -a -exec ..</code>.</p>
<p><code>-a</code> has higher precedence than <code>-o</code>, so <code>-name '*.avi' -o -name '*.mkv' -a -exec ..</code> is equivalent to <code>-name '*.avi' -o \( -name '*.mkv' -a -exec .. \)</code>.</p>
<p>In other words, the problematic code means "if name matches <code>*.avi</code>, do nothing. Otherwise, if it matches <code>*.mkv</code>, execute a command.".</p>
<p>In the correct code, we use <code>\( \)</code> to group to get the evaluation order we want. The correct code means "if name matches <code>*.avi</code> or <code>*.mkv</code>, then execute a command", which was what was intended.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of this, you can either ignore this error or group to make it explicit. For example, to decompress all gz files except tar.gz, you can use:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.tar.gz'</span> -o <span class="se">\(</span> -name <span class="s1">'*.gz'</span> -exec gzip -d <span class="o">{}</span> + <span class="se">\)</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2129">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#consider-using-cmd1-cmd2-file-instead-of-individual-redirects">Consider using { cmd1; cmd2; } &gt;&gt; file instead of individual redirects.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="consider-using-cmd1-cmd2-file-instead-of-individual-redirects">Consider using { cmd1; cmd2; } &gt;&gt; file instead of individual redirects.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> foo &gt;&gt; file
date &gt;&gt; file
cat stuff  &gt;&gt; file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">{</span>
  <span class="nb">echo</span> foo
  date
  cat stuff
<span class="o">}</span> &gt;&gt; file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Rather than adding <code>&gt;&gt; something</code> after every single line, you can simply group the relevant commands and redirect the group. So the file has to be opened and closed only once and it means a performance gain.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>This is mainly a stylistic issue, and can freely be ignored.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/014">BashFaq: How can I redirect the output of multiple commands at once?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2244">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#prefer-explicit-n-to-check-non-empty-string-or-use-ne-to-check-booleaninteger">Prefer explicit -n to check non-empty string (or use =/-ne to check boolean/integer).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="prefer-explicit-n-to-check-non-empty-string-or-use-ne-to-check-booleaninteger">Prefer explicit -n to check non-empty string (or use =/-ne to check boolean/integer).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Check if $1 is empty or non-empty</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True, </span><span class="nv">$1</span><span class="s2"> is a non-empty value"</span>
<span class="k">fi</span>

<span class="c1"># Check instead if $1 is true or false, as in Java</span>
<span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>

<span class="c1"># Check instead if $1 is non-zero or zero, as in C</span>
<span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> -ne <span class="m">0</span> <span class="o">]</span>

<span class="c1"># Check instead if $1 is defined (even if just assigned the empty string) or undefined</span>
<span class="o">[</span> <span class="s2">"</span><span class="si">${</span><span class="nv">1</span><span class="p">+x</span><span class="si">}</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"x"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ "$var" ]</code> is equivalent to <code>[ -n "$var" ]</code> and checks that a string is non-empty.</p>
<p>Users more familiar with other languages are often surprised to learn that <code>[ "$var" ]</code> is true when:</p>
<ul>
<li><code>var=false</code></li>
<li><code>var=0</code></li>
<li><code>var=null</code></li>
<li><code>var=" "</code></li>
</ul>
<p>Adding the explicit <code>-n</code> helps clarify that this is a string comparison, and not related to any concept of boolean values or "truthiness" as it is in most languages.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you are familiar with the semantics of <code>[</code>, you can [[ignore]] this stylistic suggestion with no ill effects.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1040">Bad indent</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#when-using-you-can-only-indent-with-tabs">When using &lt;&lt;-, you can only indent with tabs.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="when-using-you-can-only-indent-with-tabs">When using &lt;&lt;-, you can only indent with tabs.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<p>Any code using <code>&lt;&lt;-</code> that is indented with spaces. <code>cat -T script</code> shows</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    cat <span class="s">&lt;&lt;- foo</span>
<span class="s">        Hello world</span>
<span class="s">    foo</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Code using <code>&lt;&lt;-</code> must be indented with tabs. <code>cat -T script</code> shows</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>^Icat <span class="s">&lt;&lt;- foo</span>
<span class="s">^I^IHello world</span>
<span class="s">^Ifoo</span>
</pre></div>
</td></tr></table>
<p>Or simply don't indent the end token:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    cat <span class="s">&lt;&lt;- foo</span>
<span class="s">      Hello World</span>
<span class="s">foo</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>&lt;&lt;-</code>, by design, only strips tabs. Not spaces.</p>
<p>Your editor may be automatically replacing tabs with spaces, either when you type them or when you save the file or both. If you're unable to make it stop, just don't indent the end token.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None. But note that copy-pasting code to <a href="http://www.shellcheck.net">shellcheck.net</a> may also turn correct tabs into spaces on some OS.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2057">Unknown binary operator.</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unknown-binary-operator">Unknown binary operator.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="unknown-binary-operator">Unknown binary operator.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> -leq <span class="m">42</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> -le <span class="m">42</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using an unknown binary operator in a <code>test</code> expression. Choose one that exists.</p>
<p>In bash, use <code>help test</code> to see a list of supported operators:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  FILE1 -nt FILE2  True if file1 is newer than file2 (according to
                   modification date).

  FILE1 -ot FILE2  True if file1 is older than file2.

  FILE1 -ef FILE2  True if file1 is a hard link to file2.

  STRING1 = STRING2
                 True if the strings are equal.
  STRING1 != STRING2
                 True if the strings are not equal.
  STRING1 &lt; STRING2
                 True if STRING1 sorts before STRING2 lexicographically.
  STRING1 &gt; STRING2
                 True if STRING1 sorts after STRING2 lexicographically.

  arg1 OP arg2   Arithmetic tests.  OP is one of -eq, -ne,
                 -lt, -le, -gt, or -ge.

Arithmetic binary operators return true if ARG1 is equal, not-equal,
less-than, less-than-or-equal, greater-than, or greater-than-or-equal
than ARG2.
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you've tested and verified that the operator works but the latest version of ShellCheck says it's unknown, please <a href="https://github.com/koalaman/shellcheck/issues">submit a bug report</a>.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="http://wiki.bash-hackers.org/commands/classictest">The classic test command</a> on the Bash Hackers wiki.</li>
<li><a href="http://wiki.bash-hackers.org/syntax/ccmd/conditional_expression">The conditional expression</a> on the Bash Hackers wiki.</li>
<li><a href="https://mywiki.wooledge.org/BashGuide/TestsAndConditionals">Tests and conditionals</a> on the Wooledge BashGuide.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2046">Improper word splitting</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-this-to-prevent-word-splitting">Quote this to prevent word splitting</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="quote-this-to-prevent-word-splitting">Quote this to prevent word splitting</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls -l $(getfilename)
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span># getfilename outputs 1 file
ls -l "$(getfilename)"

# getfilename outputs multiple files, linefeed separated
getfilename | while IFS='' read -r line
do
  ls -l "$line"
done
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When command expansions are unquoted, word splitting and globbing will occur. This often manifests itself by breaking when filenames contain spaces.</p>
<p>Trying to fix it by adding quotes or escapes to the data will not work. Instead, quote the command substitution itself.</p>
<p>If the command substitution outputs multiple pieces of data, use a loop instead.</p>
<h3 id="exceptions">Exceptions</h3>
<p>In rare cases you actually want word splitting, such as in</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>gcc $(pkg-config --libs openssl) client.c
</pre></div>
</td></tr></table>
<p>This is because <code>pkg-config</code> outputs <code>-lssl -lcrypto</code>, which you want to break up by spaces into <code>-lssl</code> and <code>-lcrypto</code>. An alternative is to put the variables to an array and expand it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span># For bash
mapfile -t args <span class="err">&lt;</span> <span class="err">&lt;</span>(pkg-config --libs openssl)

# For ksh
pkg-config --libs openssl | while IFS="" read -r line; do array+=("<span class="nv">$line</span>"); done

# expand args
gcc "<span class="cp">${</span><span class="n">args</span><span class="p">[</span><span class="err">@</span><span class="p">]</span><span class="cp">}</span>" client.c
</pre></div>
</td></tr></table>
<p>The power of using an array becomes evident when you want to combine, for example, the command result with user-provided arguments:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>compile () {
    args=( $(pkg-config --libs openssl) "<span class="cp">${</span><span class="err">@</span><span class="cp">}</span>" )
    gcc "<span class="cp">${</span><span class="n">args</span><span class="p">[</span><span class="err">@</span><span class="p">]</span><span class="cp">}</span>" client.c
}
compile -DDEBUG
+ gcc -lssl -lcrypto -DDEBUG client.c
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2096">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#on-most-os-shebangs-can-only-specify-a-single-parameter">On most OS, shebangs can only specify a single parameter.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="on-most-os-shebangs-can-only-specify-a-single-parameter">On most OS, shebangs can only specify a single parameter.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash -x</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="nb">set</span> -x
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Most operating systems, including POSIX, Linux and FreeBSD, allow only a single parameter in the shebang. The example is equivalent to calling <code>env 'bash -x'</code> instead of <code>env 'bash' '-x'</code>, and it will therefore fail.</p>
<p>The shebang should be rewritten to use at most one parameter. Shell options can instead be set in the body of the script.</p>
<h3 id="exceptions">Exceptions</h3>
<p>macOS X currently allows multiple words in the shebang. Scripts running on OSX exclusively can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2072">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#decimals-are-not-supported-either-use-integers-only-or-use-bc-or-awk-to-compare">Decimals are not supported. Either use integers only, or use bc or awk to compare.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="decimals-are-not-supported-either-use-integers-only-or-use-bc-or-awk-to-compare">Decimals are not supported. Either use integers only, or use bc or awk to compare.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="m">2</span> -lt <span class="m">3</span>.14 <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="m">200</span> -lt <span class="m">314</span> <span class="o">]]</span>                   <span class="c1"># Use fixed point math</span>
<span class="o">[[</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"2 &amp;lt; 3.14"</span> <span class="p">|</span> bc<span class="k">)</span> <span class="o">==</span> <span class="m">1</span> <span class="o">]]</span>  <span class="c1"># Use bc</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash and Posix sh does not support decimals in numbers. Decimals should either be avoided, or compared using a tool that does support them.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If the strings happen to be version numbers and you're using <code>&lt;</code>, or <code>&gt;</code> to compare them as strings, and you consider this an acceptable thing to do, then you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2252">Constant expression result</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-probably-wanted-here-otherwise-its-always-true">You probably wanted &amp;&amp; here, otherwise it's always true.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-probably-wanted-here-otherwise-its-always-true">You probably wanted &amp;&amp; here, otherwise it's always true.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> !<span class="o">=</span> foo <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> !<span class="o">=</span> bar <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not foo or bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> !<span class="o">=</span> foo <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> !<span class="o">=</span> bar <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not foo or bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is not a bash issue, but a simple, common logical mistake applicable to all languages. </p>
<p><code>[ "$1" != foo ] || [ "$1" != bar ]</code> is always true (when <code>foo != bar</code>):</p>
<ul>
<li>If <code>$1 = foo</code> then <code>$1 != bar</code> is true, so the statement is true.</li>
<li>If <code>$1 = bar</code> then <code>$1 != foo</code> is true, so the statement is true.</li>
<li>If <code>$1 = cow</code> then <code>$1 != foo</code> is true, so the statement is true.</li>
</ul>
<p><code>[ $1 != foo ] &amp;&amp; [ $1 != bar ]</code> matches when <code>$1</code> is neither <code>foo</code> nor <code>bar</code>:</p>
<ul>
<li>If <code>$1 = foo</code>, then <code>$1 != foo</code> is false, so the statement is false.</li>
<li>If <code>$1 = bar</code>, then <code>$1 != bar</code> is false, so the statement is false.</li>
<li>If <code>$1 = cow</code>, then both <code>$1 != foo</code> and <code>$1  != bar</code> is true, so the statement is true.</li>
</ul>
<p>This statement is identical to <code>! [ "$1" = foo ] || [ "$1" = bar ]</code>, which also works correctly (by <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws">De Morgan's law</a>)</p>
<p>This warning is equivalent to [[SC2055]] and [[SC2056]], which trigger for intra-<code>test</code> expressions and arithmetic contexts respectively.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Rare.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2007">Expired expression style</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-instead-of-deprecated">Use $((..)) instead of deprecated $[..]</a><ul>
<li><a href="#problematic-code">Problematic code</a></li>
<li><a href="#correct-code">Correct code</a></li>
<li><a href="#rationale">Rationale</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#see-also">See also</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="use-instead-of-deprecated">Use $((..)) instead of deprecated $[..]</h1>
<h3 id="problematic-code">Problematic code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span>$<span class="o">[</span>n+1<span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">n</span><span class="o">=</span><span class="k">$((</span>n+1<span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale</h3>
<p>The <code>$[..]</code> syntax was deprecated in Bash 2.0 and replaced with the standard <code>$((..))</code> syntax from Korn shell</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
<h3 id="see-also">See also</h3>
<ul>
<li>http://unix.stackexchange.com/questions/209833/what-does-a-dollar-sign-followed-by-a-square-bracket-mean-in-bash</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1099">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-the">You need a space before the #.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-the">You need a space before the #.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> sleep <span class="m">1</span>
<span class="k">do</span><span class="c1"># show time</span>
  date
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> sleep <span class="m">1</span>
<span class="k">do</span> <span class="c1"># show time</span>
  date
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you have a keyword immediately followed by a <code>#</code>. In order for the <code>#</code> to start a comment, it needs to come after a word boundary such as a space.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2097">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-assignment-is-only-seen-by-the-forked-process">This assignment is only seen by the forked process.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-assignment-is-only-seen-by-the-forked-process">This assignment is only seen by the forked process.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">name</span><span class="o">=</span>World cmd -m <span class="s2">"Hello </span><span class="nv">$name</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">name</span><span class="o">=</span>World
cmd -m <span class="s2">"Hello </span><span class="nv">$name</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>To prevent setting the variable, this can also be done in a subshell:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">(</span>
   <span class="nb">export</span> <span class="nv">name</span><span class="o">=</span>World
   cmd -m <span class="s2">"Hello </span><span class="nv">$name</span><span class="s2">"</span>
<span class="o">)</span> <span class="c1"># 'name' does not leave this subshell</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In <code>name=World cmd "$name"</code>, <code>name=World</code> is passed in as part of the environment to <code>cmd</code> (i.e., in the <code>envp</code> parameter to <a href="http://linux.die.net/man/2/execve">execve(2)</a>).  This means that <code>cmd</code> and its children will see the parameter, but no other processes will.</p>
<p>However, <code>"$name"</code> is not expanded by <code>cmd</code>. <code>"$name"</code> is expanded by the shell before <code>cmd</code> is ever executed, and thus it will not use the new value.</p>
<p>The solution is to set the variable and export the variable first. If limited scope is desired, a <code>( subshell )</code> can be used.</p>
<h3 id="exceptions">Exceptions</h3>
<p>In the strange and fabricated scenarios where the script and a program uses a variable name for two different purposes, you can ignore this message. This is hard to conceive, since scripts should use lowercase variable names specifically to avoid collisions with the environment.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/104">BashFaq: Why doesn't foo=bar echo "$foo" print bar?</a></li>
<li><a href="https://stackoverflow.com/questions/36380569/prefixing-variable-assignment-doesnt-work-with-echo?rq=1">StackOverflow: Prefixing variable assignment doesn't work with echo</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1046">Missing 'fi' for 'if'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#couldnt-find-fi-for-this-if">Couldn't find 'fi' for this 'if'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="couldnt-find-fi-for-this-if">Couldn't find 'fi' for this 'if'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found an <code>if</code> statement that does not appear to have a matching terminating <code>fi</code>.</p>
<p>This could be because it's missing entirely, or because the <code>if</code> statement was incorrectly terminated by a mismatched <code>done</code>, <code>esac</code>, <code>)</code> or similar. A companion warning [[SC1047]] is emitted at the point where ShellCheck expected the <code>fi</code>.</p>
<p>Check that the <code>if</code> statement is completely and correctly terminated.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2039">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 4 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-posix-sh-something-is-undefined">In POSIX sh, something is undefined.</a><ul>
<li><a href="#c-style-escapes">$'c-style-escapes'</a></li>
<li><a href="#testing-equality">Testing Equality</a></li>
<li><a href="#msgid">$"msgid"</a></li>
<li><a href="#var1-substring-expansion">${var:1} (substring expansion)</a></li>
<li><a href="#arithmetic-for-loops">Arithmetic for loops</a></li>
<li><a href="#arithmetic-exponentiation">Arithmetic exponentiation</a></li>
<li><a href="#standalone">standalone ((..))</a></li>
<li><a href="#select-loops">select loops</a></li>
<li><a href="#here-strings">Here-strings</a></li>
<li><a href="#echo-flags">echo flags</a></li>
<li><a href="#varpatreplacement">${var/pat/replacement}</a></li>
<li><a href="#printf-q">printf %q</a></li>
<li><a href="#jobs-flags">jobs flags</a></li>
<li><a href="#redirect-both-stdout-and-stderr">Redirect both stdout and stderr</a></li>
<li><a href="#heredoc">Heredoc</a></li>
<li><a href="#prefixing-signal-names-with-sig">Prefixing signal names with SIG</a></li>
</ul>
</li>
<li><a href="#exception">Exception</a></li>
</ul>
</div>

            <div>
                
<h2 id="in-posix-sh-something-is-undefined">In POSIX sh, <em>something</em> is undefined.</h2>
<p>You have declared that your script works with <code>/bin/sh</code>, but you are using features that have undefined behavior according to the POSIX specification. </p>
<p>It may currently work for you, but it can or will fail on other OS, the same OS with different configurations, from different contexts (like initramfs/chroot), or in different versions of the same OS, including future updates to your current system.</p>
<p>Either declare that your script requires a specific shell like <code>#!/bin/bash</code> or <code>#!/bin/dash</code>, or rewrite the script in a portable way.</p>
<p>For help with rewrites, the Ubuntu wiki has <a href="https://wiki.ubuntu.com/DashAsBinSh">a list of portability issues</a> that broke people's <code>#!/bin/sh</code> scripts when Ubuntu switched from Bash to Dash. See also <a href="http://mywiki.wooledge.org/Bashism">Bashism</a> on wooledge's wiki. ShellCheck may not warn about all these issues.</p>
<h3 id="c-style-escapes"><code>$'c-style-escapes'</code></h3>
<p>bash, ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="o">=</span><span class="s1">$' \t\n'</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'%b_'</span> <span class="s1">' \t\n'</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span> <span class="nv">a</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">a</span><span class="p">%_</span><span class="si">}</span><span class="s2">"</span> <span class="c1"># protect trailing \n</span>
</pre></div>
</td></tr></table>
<p>Want some good news? See http://austingroupbugs.net/view.php?id=249#c590.</p>
<h3 id="testing-equality">Testing Equality</h3>
<p><code>==</code> operator is not supported in POSIX <code>sh</code></p>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$a</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$b</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"equal"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$a</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$b</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"equal"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="msgid"><code>$"msgid"</code></h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> $<span class="s2">"foo </span><span class="k">$(</span>bar<span class="k">)</span><span class="s2"> baz"</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>. gettext.sh <span class="c1"># GNU Gettext sh library</span>
<span class="c1"># ...</span>
<span class="nv">barout</span><span class="o">=</span><span class="k">$(</span>bar<span class="k">)</span>
eval_gettext <span class="s1">'foo $barout baz'</span> <span class="c1"># See GNU Gettext doc for more info.</span>
</pre></div>
</td></tr></table>
<p>Or you can change them to normal double quotes so you go without <code>gettext</code>.</p>
<h3 id="var1-substring-expansion"><code>${var:1}</code> (substring expansion)</h3>
<p>https://wiki.ubuntu.com/DashAsBinSh#A.24.7Bfoo:3.5B:1.5D.7D</p>
<h3 id="arithmetic-for-loops">Arithmetic <code>for</code> loops</h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">((</span>init<span class="p">;</span> test<span class="p">;</span> next<span class="o">))</span><span class="p">;</span> <span class="k">do</span> foo<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="k">$((</span>init<span class="k">))</span>
<span class="k">while</span> <span class="o">[</span> <span class="k">$((</span><span class="nb">test</span><span class="k">))</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> foo<span class="p">;</span> : <span class="k">$((</span>next<span class="k">))</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="arithmetic-exponentiation">Arithmetic exponentiation</h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"%s\n"</span> <span class="s2">"</span><span class="k">$((</span> <span class="m">2</span><span class="o">**</span><span class="m">63</span> <span class="k">))</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<p>The POSIX standard does not allow for exponents.  However, you can replicate them completely built-in using a POSIX compatible function.  As an example, the <code>pow</code> function from <a href="http://unix.stackexchange.com/a/7925">here</a>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>pow <span class="o">()</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="m">1</span>
    <span class="k">while</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
      <span class="nb">set</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">$((</span><span class="nv">$2</span><span class="o">-</span><span class="m">1</span><span class="k">))</span> <span class="k">$((</span><span class="nv">$1</span><span class="o">*</span><span class="nv">$3</span><span class="k">))</span>
    <span class="k">done</span>
    <span class="c1"># %d = signed decimal, %u = unsigned decimal</span>
    <span class="c1"># Either should overflow to 0</span>
    <span class="nb">printf</span> <span class="s2">"%d\n"</span> <span class="s2">"</span><span class="nv">$3</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>To compare:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span> <span class="m">2</span><span class="o">**</span><span class="m">62</span> <span class="k">))</span><span class="s2">"</span>
<span class="m">4611686018427387904</span>
$ pow <span class="m">2</span> <span class="m">62</span>
<span class="m">4611686018427387904</span>
</pre></div>
</td></tr></table>
<p>Alternatively, if you don't mind using an external program, you can use <code>bc</code>.  Be aware though: <code>bash</code> and other programs may abide by a certain maximum integer that <code>bc</code> does not (for <code>bash</code> that's: 64-bit signed long int, failing back to 32-bit signed long int).  </p>
<p>Example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Note the overflow that gives a negative number</span>
$ <span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span> <span class="m">2</span><span class="o">**</span><span class="m">63</span> <span class="k">))</span><span class="s2">"</span>
-9223372036854775808

<span class="c1"># No such problem</span>
$ <span class="nb">echo</span> <span class="m">2</span>^63 <span class="p">|</span> bc
<span class="m">9223372036854775808</span>

<span class="c1"># 'bc' just keeps on going</span>
$ <span class="nb">echo</span> <span class="m">2</span>^1280 <span class="p">|</span> bc
<span class="m">20815864389328798163850480654728171077230524494533409610638224700807</span><span class="se">\</span>
<span class="m">21611934672059602447888346464836968484322790856201558276713249664692</span><span class="se">\</span>
<span class="m">98162798132113546415258482590187784406915463666993231671009459188410</span><span class="se">\</span>
<span class="m">95379622423387354295096957733925002768876520583464697770622321657076</span><span class="se">\</span>
<span class="m">83317005651120933244966378183760369413644440628104205339687097746591</span><span class="se">\</span>
<span class="m">6057756101739472373801429441421111406337458176</span>
</pre></div>
</td></tr></table>
<h3 id="standalone">standalone <code>((..))</code></h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">((</span><span class="nv">a</span><span class="o">=</span>c+d<span class="o">))</span>
<span class="o">((</span>d<span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> d is true.
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="k">$((</span><span class="nv">a</span><span class="o">=</span>c+d<span class="k">))</span> <span class="c1"># discard the output of the arith expn with `:` command</span>
<span class="o">[</span> <span class="k">$((</span>d<span class="k">))</span> -ne <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> d is true. <span class="c1"># manually check non-zero =&gt; true</span>
</pre></div>
</td></tr></table>
<h3 id="select-loops"><code>select</code> loops</h3>
<p>It takes extra care over terminal columns to make select loop look like bash's, which generates a list with multiple items on one line, or like <code>ls</code>.</p>
<p>It is, however, still possible to make a naive translation for <code>select foo in bar baz; do eat; done</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span>
  <span class="nv">_i</span><span class="o">=</span><span class="m">0</span> <span class="nv">_foo</span><span class="o">=</span> <span class="nv">foo</span><span class="o">=</span>
  <span class="k">for</span> _name in bar baz<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span><span class="nv">_i</span><span class="o">+=</span><span class="m">1</span><span class="k">))</span><span class="s2">) </span><span class="nv">$_name</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
  <span class="nb">printf</span> <span class="s1">'$# '</span><span class="p">;</span> <span class="nb">read</span> _foo
<span class="k">do</span>
  <span class="k">case</span> _foo in <span class="m">1</span><span class="o">)</span> <span class="nv">foo</span><span class="o">=</span>bar<span class="p">;;</span> <span class="m">2</span><span class="o">)</span> <span class="nv">foo</span><span class="o">=</span>baz<span class="p">;;</span> *<span class="o">)</span> <span class="k">continue</span><span class="p">;;</span> <span class="k">esac</span>
  eat
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="here-strings">Here-strings</h3>
<p>Bash, ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep aaa <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># not exactly the same -- &lt;&lt;&lt; adds a trailing \n if $g doesn't end with \n</span>
<span class="nb">printf</span> <span class="s1">'%s'</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">"</span> <span class="p">|</span> grep aaa
</pre></div>
</td></tr></table>
<h3 id="echo-flags">echo flags</h3>
<p>See https://unix.stackexchange.com/tags/echo/info.</p>
<h3 id="varpatreplacement"><code>${var/pat/replacement}</code></h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">TERM</span><span class="p">/%-256*</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TERM</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s1">'s/-256.*$//g'</span>
<span class="c1"># Special case for this since we are matching the end:</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">TERM</span><span class="p">%-256*</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="printf-q"><code>printf %q</code></h3>
<p>Bash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'%q '</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># TODO: Interpret it back to printf escapes for hard-to-copy chars like \t?</span>
<span class="c1"># See also: http://git.savannah.gnu.org/cgit/libtool.git/tree/gl/build-aux/funclib.sh?id=c60e054#n1029</span>
reuse_quote<span class="o">()(</span>
  <span class="k">for</span> i<span class="p">;</span> <span class="k">do</span>
    <span class="nv">__i_quote</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s2">"s/'/'\\\\''/g"</span><span class="p">;</span> <span class="nb">echo</span> x<span class="k">)</span>
    <span class="nb">printf</span> <span class="s2">"'%s'"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">__i_quote</span><span class="p">%x</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">done</span>
<span class="o">)</span>
reuse_quote <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="jobs-flags"><code>jobs</code> flags</h3>
<p>The only acceptable flags under POSIX sh for <code>jobs</code> are <code>-l</code> and <code>-p</code> (<a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/jobs.html">see spec</a>). Common flags supported by other shells are <code>-s</code> and <code>-r</code>, to check for stopped/suspended jobs and running jobs. A portable alternative is using <code>grep</code> or <code>awk</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s2">"</span><span class="k">$(</span><span class="nb">jobs</span> <span class="p">|</span> awk <span class="s1">'/(S|s)(topped|uspended)/'</span><span class="k">)</span><span class="s2">"</span> <span class="c1"># instead of jobs -s</span>
<span class="s2">"</span><span class="k">$(</span><span class="nb">jobs</span> <span class="p">|</span> awk <span class="s1">'/(R|r)(unning)/'</span><span class="k">)</span><span class="s2">"</span>          <span class="c1"># instead of jobs -r</span>
</pre></div>
</td></tr></table>
<p>Although the state of stopped jobs is <code>Stopped</code> in Bash and dash, and it's the one specified by POSIX, <code>Suspended</code> is also a valid alternative (but Zsh happens to not respect the capitalization, that's why we try to match <code>suspended</code>). Similarly, the state of running jobs is <code>Running</code> according to POSIX. Bash and dash respect this, but Zsh uses <code>running</code>.</p>
<h3 id="redirect-both-stdout-and-stderr">Redirect both stdout and stderr</h3>
<p>Change:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&gt;&amp; and &amp;&gt;
</pre></div>
</td></tr></table>
<p>To:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>command &gt; file 2&gt;&amp;1 or command 2&gt;&amp;1 | othercommand
</pre></div>
</td></tr></table>
<p>No Comments / Exceptions</p>
<h3 id="heredoc">Heredoc</h3>
<p>Change:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sed 's/some_replacement//g' <span class="err">&lt;&lt;&lt;</span> "<span class="cp">${</span><span class="n">var</span><span class="cp">}</span>"
</pre></div>
</td></tr></table>
<p>To:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>printf '%s' "<span class="cp">${</span><span class="n">var</span><span class="cp">}</span>" | sed 's/some_replacement//g'
</pre></div>
</td></tr></table>
<p>No Comments / Exceptions</p>
<h3 id="prefixing-signal-names-with-sig">Prefixing signal names with <code>SIG</code></h3>
<p>Instead of e.g.:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> my_handler SIGTERM
</pre></div>
</td></tr></table>
<p>use:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> my_handler TERM
<span class="c1"># or (`trap -l` for a list of signal numbers):</span>
<span class="nb">trap</span> my_handler <span class="m">15</span>
</pre></div>
</td></tr></table>
<h2 id="exception">Exception</h2>
<p>Depends on what your expected POSIX shell providers would use.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2168">Using 'local' outside functions.</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#local-is-only-valid-in-functions">'local' is only valid in functions.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="local-is-only-valid-in-functions">'local' is only valid in functions.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">local</span> <span class="nv">foo</span><span class="o">=</span>bar
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span>bar
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In Bash, <code>local</code> can only be used in functions. In other contexts, it's an error.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>It's possible to source files containing <code>local</code> from a function context but not from any other context. This is not good practice, but in these cases you can [[ignore]] this error.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1064">Missing '{' at the start of a function</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-a-to-open-the-function-definition">Expected a { to open the function definition.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="expected-a-to-open-the-function-definition">Expected a { to open the function definition.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"hello world"</span>
<span class="o">}</span>
foo<span class="o">()</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"hello world"</span>
<span class="o">}</span>
foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found what appears to be the start of a function definition, but without a function body.</p>
<p>One common cause is that you are trying to call a function by appending parentheses, e.g. <code>foo()</code> like in C. Bash does not use or allow parentheses after a function name to call it. The function <code>foo</code> should be called using just <code>foo</code> like in the example. </p>
<p>If you are declaring a function, make sure it looks like the correct code above, and that it does not try to declare any parameters (parameters are instead accessed with <code>$1</code> and up). </p>
<p>If you are trying to do something else, look up the syntax for what you are trying to do.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>POSIX allows the body of a function to be any compound command, e.g. <code>foo() for i; do :; done</code>. Since this usage is rare, ShellCheck intentionally requires the body to be <code>{ ..; }</code> (or <code>( ..; )</code>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo() {
  for i; do :; done
}
</pre></div>
</td></tr></table>
<p>This additional structure requirement helps improve error messages and suggestions by not parsing down a path that less advanced users wouldn't expect.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1072">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unexpected">Unexpected ..</a></li>
</ul>
</div>

            <div>
                
<h1 id="unexpected">Unexpected ..</h1>
<p><em>Note: There is a <a href="../issues/1036">known bug</a> in the current version when <a href="../wiki/Directive">directives</a> appear within <code>then</code> clauses of <code>if</code> blocks that causes Shellcheck to report SC1072 on otherwise valid code. Avoid using directives within <code>then</code> clauses - instead place them at the top of the <code>if</code> block or another enclosing block. This is fixed on the <a href="https://www.shellcheck.net/">online version</a> and the next release.</em></p>
<p>See <a href="https://github.com/koalaman/shellcheck/wiki/Parser-Error">Parser Error</a>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1053">Improper Semicolons directly after 'else'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#semicolons-directly-after-else-are-not-allowed-just-remove-it">Semicolons directly after 'else' are not allowed. Just remove it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="semicolons-directly-after-else-are-not-allowed-just-remove-it">Semicolons directly after 'else' are not allowed. Just remove it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> mycommand<span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"True"</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"False"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> mycommand<span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"True"</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="s2">"False"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>else</code> keywords should not be followed by semicolons. It's not valid shell syntax.</p>
<p>You can follow them directly with a line break or another command.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1007">Redundant space after =</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-space-after-if-trying-to-assign-a-value-or-for-empty-string-use-var">Remove space after = if trying to assign a value (or for empty string, use var='' ... ).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="remove-space-after-if-trying-to-assign-a-value-or-for-empty-string-use-var">Remove space after = if trying to assign a value (or for empty string, use var='' ... ).</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># I want programs to show text in dutch!</span>
<span class="nv">LANGUAGE</span><span class="o">=</span> nl
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># I want to run the nl command with English error messages!</span>
<span class="nv">LANGUAGE</span><span class="o">=</span> nl
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># I want programs to show text in dutch!</span>
<span class="nv">LANGUAGE</span><span class="o">=</span>nl
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># I want to run the nl command with English error messages!</span>
<span class="nv">LANGUAGE</span><span class="o">=</span><span class="s1">''</span> nl
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>It's easy to think that <code>LANGUAGE= nl</code> would assign <code>"nl"</code> to the variable <code>LANGUAGE</code>. It doesn't.</p>
<p>Instead, it runs <code>nl</code> (the "number lines" command) and sets <code>LANGUAGE</code> to an empty string in its environment.</p>
<p>Since trying to assign values this way is a common mistake, ShellCheck warns about it and asks you to be explicit when assigning empty strings (except for <code>IFS</code>, due to the common <code>IFS= read ..</code> idiom).</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're familiar with this behavior and feel that the explicit version is unnecessary, you can [[ignore]] it.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2107">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#instead-of-a-b-use-a-b">Instead of [ a &amp;&amp; b ], use [ a ] &amp;&amp; [ b ].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="instead-of-a-b-use-a-b">Instead of [ a &amp;&amp; b ], use [ a ] &amp;&amp; [ b ].</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">&amp;&amp;</span> -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>&amp;&amp;</code> can not be used in a <code>[ .. ]</code> test expression. Instead, make two <code>[ .. ]</code> expressions and put the <code>&amp;&amp;</code> between them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf6">Bash Pitfalls: [ "$foo" = bar &amp;&amp; "$bar" = foo ]</a></li>
<li><a href="https://stackoverflow.com/questions/16396146/using-and-operator-in-if-statement-bash-script/16396181">StackOverflow: using and (&amp;&amp;) operator in if statement bash script
</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2242">Improper return value</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#can-only-exit-with-status-0-255-other-data-should-be-written-to-stdoutstderr">Can only exit with status 0-255. Other data should be written to stdout/stderr.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="can-only-exit-with-status-0-255-other-data-should-be-written-to-stdoutstderr">Can only exit with status 0-255. Other data should be written to stdout/stderr.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">exit</span> <span class="s2">"Bad filename"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Bad filename"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>exit</code> can only be used to signal success or failure (0 = success, 1-255 = failure). It can not be used to return string data, and it can not be used to print error messages.</p>
<p>String data should be written stdout, before an <code>exit 0</code> to exit with success.</p>
<p>Errors should instead be written to stderr, with an <code>exit 1</code> (or higher) to exit with failure:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>if [ ! -f "$1" ]
then
   echo "$1 is not a regular file" &gt;&amp;2
   exit 1
fi
</pre></div>
</td></tr></table>
<p>Note in particular that <code>exit -1</code> is equivalent to <code>exit 255</code>, but that <code>exit 1</code> is the more canonical way of expressing the first possible error code.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2254">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-expansions-in-case-patterns-to-match-literally-rather-than-as-a-glob">Quote expansions in case patterns to match literally rather than as a glob.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-expansions-in-case-patterns-to-match-literally-rather-than-as-a-glob">Quote expansions in case patterns to match literally rather than as a glob.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nv">$input</span> in
  -       <span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Reading from stdin..."</span> <span class="p">;;</span>
  <span class="nv">$output</span> <span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Input should be different from output"</span> <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nv">$input</span> in
  -         <span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Reading from stdin..."</span> <span class="p">;;</span>
  <span class="s2">"</span><span class="nv">$output</span><span class="s2">"</span> <span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Input should be different from output"</span> <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When unquoted variables and command expansions are used in case branch patterns, they will be interpreted as globs. </p>
<p>This can lead to some surprising behavior, such as <code>case $x in $x) trigger;; esac</code> not triggering in some cases, such as when <code>x='Pride and Prejudice [1813].epub'</code>.</p>
<p>To match the literal content of the variable or expansion, make sure to double quote the expansion.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you intended to match a dynamically generated pattern, you can ignore this suggestion with a directive.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>[[SC2053]], where the same effect can be seen with <code>[[ $x = $x ]]</code>.</li>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2152">Improper return value</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#can-only-return-0-255-other-data-should-be-written-to-stdout">Can only return 0-255. Other data should be written to stdout.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="can-only-return-0-255-other-data-should-be-written-to-stdout">Can only return 0-255. Other data should be written to stdout.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>myfunc<span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="s2">"Hello </span><span class="nv">$USER</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>myfunc<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$USER</span><span class="s2">"</span>
  <span class="k">return</span> <span class="m">0</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In many languages, <code>return</code> is used to return from the function with a final result.</p>
<p>In sh/bash, <code>return</code> can only be used to signal success or failure (0 = success, 1-255 = failure), more akin to <code>throw/raise</code> in other languages.</p>
<p>Results should instead be written to stdout and captured:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">message</span><span class="o">=</span><span class="k">$(</span>myfunc<span class="k">)</span>
<span class="nb">echo</span> <span class="s2">"The function wrote: </span><span class="nv">$message</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>In functions that return small integers, such as getting the cpu temperature, the value should still be written to stdout. <code>return</code> should be reserved for error conditions, such as "can't determine CPU temperature". Error or failure messages should be written to stderr.</p>
<p>Note in particular that <code>return -1</code> is equivalent to <code>return 255</code>, but that <code>return 1</code> is the more canonical way of expressing the first possible error code.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/084">BashFaq: How do I return a string (or large number, or negative number) from a function?</a> "return" only lets me give a number from 0 to 255.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1091">Not following directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#not-following-error-message-here">Not following: (error message here)</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="not-following-error-message-here">Not following: (error message here)</h2>
<p>Reasons include: file not found, no permissions, not included on the command line, not allowing <code>shellcheck</code> to follow files with <code>-x</code>, etc.</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">source</span> somefile
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>In case you have access to the file, e.g. if it is included in your source code repository:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck source=somefile</span>
<span class="nb">source</span> somefile
</pre></div>
</td></tr></table>
<p>In case you do not have access to the file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC1091</span>
<span class="nb">source</span> somefile
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck, for whichever reason, is not able to access the source file.</p>
<p>This could be because you did not include it on the command line, did not use <code>shellcheck -x</code> to allow following other files, don't have permissions or a variety of other problems.</p>
<p>Feel free to ignore the error with a [[directive]].</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you're fine with it, ignore the message with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2033">Improper execution shell function</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shell-functions-cant-be-passed-to-external-commands">Shell functions can't be passed to external commands.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="shell-functions-cant-be-passed-to-external-commands">Shell functions can't be passed to external commands.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span> bar --baz <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> frob --baz <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
find . -exec foo <span class="o">{}</span> +
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -exec sh -c <span class="s1">'bar --baz "$@"; frob --baz "$@";'</span> -- <span class="o">{}</span> +
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shell functions are only known to the shell. External commands like <code>find</code>, <code>xargs</code>, <code>su</code> and <code>sudo</code> do not recognize shell functions.</p>
<p>Instead, the function contents can be executed in a shell, either through <code>sh -c</code> or by creating a separate shell script as an executable file.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're intentionally passing a word that happens to have the same name as a declared function, you can quote it to make shellcheck ignore it, e.g.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>nobody<span class="o">()</span> <span class="o">{</span>
  sudo -u <span class="s2">"nobody"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2119">Improper parameter passing</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-foo-if-functions-1-should-mean-scripts-1">Use foo "$@" if function's $1 should mean script's $1.</a></li>
</ul>
</div>

            <div>
                
<h1 id="use-foo-if-functions-1-should-mean-scripts-1">Use foo "$@" if function's $1 should mean script's $1.</h1>
<p>See companion warning [[SC2120]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1000">Missing escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-not-used-specially-and-should-therefore-be-escaped">$ is not used specially and should therefore be escaped.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="is-not-used-specially-and-should-therefore-be-escaped">$ is not used specially and should therefore be escaped.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span>$<span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"\$"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>$</code> is special in double quotes, but there are some cases where it's interpreted literally:</p>
<ol>
<li>Following a backslash: <code>echo "\$"</code></li>
<li>In a context where the shell can't make sense of it, such as at the end of the string, (<code>"foo$"</code>) or before some constructs (<code>"$'foo'"</code>).</li>
</ol>
<p>To avoid relying on strange and shell-specific behavior, any <code>$</code> intended to be literal should be escaped with a backslash.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2116">Redundant 'echo'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sc2116-useless-echo-instead-of-cmd-echo-foo-just-use-cmd-foo">SC2116 Useless echo? Instead of 'cmd $(echo foo)', just use 'cmd foo'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sc2116-useless-echo-instead-of-cmd-echo-foo-just-use-cmd-foo">SC2116 Useless echo? Instead of 'cmd $(echo foo)', just use 'cmd foo'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">greeting</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"Hello, </span><span class="nv">$name</span><span class="s2">"</span><span class="k">)</span>
<span class="c1"># or</span>
tar czf <span class="s2">"</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>date +%F<span class="k">)</span><span class="s2">.tar.gz"</span><span class="k">)</span><span class="s2">"</span> *
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">greeting</span><span class="o">=</span><span class="s2">"Hello, </span><span class="nv">$name</span><span class="s2">"</span>
<span class="c1"># or</span>
tar czf <span class="s2">"</span><span class="k">$(</span>date +%F<span class="k">)</span><span class="s2">.tar.gz"</span> *
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be using <code>echo</code> to write a value to stdout, and then using <code>$(..)</code> or <code>`..`</code> to capture the value again. This is as pointless as mailing yourself a postcard: you already have what you want, so there's no need to send it on a round trip.</p>
<p>You can just replace <code>$(echo myvalue)</code> with <code>myvalue</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Sometimes this pattern is used because of side effect of <code>echo</code> or expansions. For example, here <code>$(echo ..)</code> is used to expand a glob.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>glob="*.png"
files="$(echo $var)"
</pre></div>
</td></tr></table>
<p>The <code>echo</code> is not useless, but this code is problematic because it concatenates filenames by spaces. This will break filenames containing spaces and other characters later when the list is split again. Better options are:</p>
<ul>
<li>Arrays, if supported by the shell: <code>files=( $glob ); echo "The first file is ${files[0]}"</code></li>
<li>Positional parameters when possible: <code>set -- $glob; echo "The first file is $1"</code></li>
<li>Delaying expansion until it's needed: <code>for file in $glob; do ...</code></li>
</ul>
<p>All three methods will let you avoid issues with special characters in filenames.</p>
<p>As another example, here <code>$(echo ..)</code> is used to expand escape sequences:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>unexpanded='var\tvalue'
expanded="$(echo "$var")"
</pre></div>
</td></tr></table>
<p>In this case, use <code>printf</code> instead. It's well defined with regard to escape sequences. </p>
<p>Finally, if you really do want to concatenate a series of elements by a character like space, consider doing it explicitly with <code>for</code> or <code>printf</code> (e.g. <code>printf '%s\n' $glob</code>).</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2128">Improper expansion of array</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expanding-an-array-without-an-index-only-gives-the-first-element">Expanding an array without an index only gives the first element.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="expanding-an-array-without-an-index-only-gives-the-first-element">Expanding an array without an index only gives the first element.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">myarray</span><span class="o">=(</span>foo bar<span class="o">)</span>
<span class="k">for</span> f in <span class="nv">$myarray</span>
<span class="k">do</span>
  cat <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">myarray</span><span class="o">=(</span>foo bar<span class="o">)</span>
<span class="k">for</span> f in <span class="s2">"</span><span class="si">${</span><span class="nv">myarray</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">do</span>
  cat <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When referencing arrays, <code>$myarray</code> is equivalent to <code>${myarray[0]}</code> -- it results in only the first of multiple elements.</p>
<p>To get all elements as separate parameters, use the index <code>@</code> (and make sure to double quote). In the example, <code>echo "${myarray[@]}"</code> is equivalent to <code>echo "foo" "bar"</code>.</p>
<p>To get all elements as a single parameter, concatenated by the first character in <code>IFS</code>, use the index <code>*</code>. In the example, <code>echo "${myarray[*]}"</code> is equivalent to <code>echo "foo bar"</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>ShellCheck can get confused by variable scope if the same variable name was used as an array previously, but is a string in the current context. You can [[ignore]] it in this case.</p>
<p>In the case of local variables, a workaround is to declare the local variable separately from assigning to it:</p>
<p><strong>Problematic Code:</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> -a baz
   <span class="nv">baz</span><span class="o">+=(</span><span class="s2">"foo"</span> <span class="s2">"bar"</span><span class="o">)</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">baz</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="o">}</span>

bar <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> <span class="nv">baz</span><span class="o">=</span><span class="s2">"qux"</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$baz</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p><strong>Correct Code:</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> -a baz
   <span class="nv">baz</span><span class="o">+=(</span><span class="s2">"foo"</span> <span class="s2">"bar"</span><span class="o">)</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">baz</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="o">}</span>

bar <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> baz
   <span class="nv">baz</span><span class="o">=</span><span class="s2">"qux"</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$baz</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1054">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-after-the">You need a space after the '{'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-after-the">You need a space after the '{'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span><span class="nb">echo</span> <span class="s2">"hello world;}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"hello world;}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>{</code> is only recognized as the start of a command group when it's a separate token.</p>
<p>If it's not a separate token, like in the problematic example, it will be considered a literal character, as if writing <code>"{echo"</code> with quotes, and therefore usually cause a syntax error.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1135">Missing escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#prefer-escape-over-ending-quote-to-make-literal-instead-of-it-costs-5-use-it-costs-5">Prefer escape over ending quote to make $ literal. Instead of "It costs $"5, use "It costs \$5"</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="prefer-escape-over-ending-quote-to-make-literal-instead-of-it-costs-5-use-it-costs-5">Prefer escape over ending quote to make <code>$</code> literal. Instead of <code>"It costs $"5</code>, use <code>"It costs \$5"</code></h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"The apples are </span>$<span class="s2">""1 each"</span>
<span class="nb">eval</span> <span class="s2">"var=</span>$<span class="s2">"</span>name
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"The apples are \$1 each"</span>
<span class="nb">eval</span> <span class="s2">"var=\$name"</span>
<span class="c1"># or better yet: var="${!name}"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script appears to be closing a double quoted string for the sole purpose of making a dollar sign <code>$</code> literal.</p>
<p>While this happens to work, the better solution is instead to escape it with a backslash. This allows the double quoted string to continue uninterrupted, thereby reducing the visual noise of stopping and starting quotes in the middle of a shell word.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2174">Improper using of '-m' with '-p'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#when-used-with-p-m-only-applies-to-the-deepest-directory">When used with -p, -m only applies to the deepest directory.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="when-used-with-p-m-only-applies-to-the-deepest-directory">When used with -p, -m only applies to the deepest directory.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mkdir -p -m <span class="m">0755</span> foo/bar/baz
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mkdir -p foo/bar/baz
chmod <span class="m">0755</span> foo/bar/baz foo/bar foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When using <code>-m 0755</code>, the mode of the directory created will be set to 0755. When using <code>-p</code>, parent directories which do not exist will be created, but the mode specified by <code>-m</code> will only be used on the last directory. The parent directories will get their access mode the default way, via <a href="http://man7.org/linux/man-pages/man2/umask.2.html">umask(2)</a>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck does not warn if the path only has one component, as in <code>mkdir -p -m 0755 mydir</code>, but will not attempt to determine whether this applies for a variable as in <code>mkdir -p -m 0755 "$mydir"</code>. You can mkdir/chmod separately or [[ignore]] this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2016">Improper quote usage</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expressions-dont-expand-in-single-quotes-use-double-quotes-for-that">Expressions don't expand in single quotes, use double quotes for that.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="expressions-dont-expand-in-single-quotes-use-double-quotes-for-that">Expressions don't expand in single quotes, use double quotes for that.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">name</span><span class="o">=</span>World
<span class="nb">echo</span> <span class="s1">'Hello $name'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">name</span><span class="o">=</span>World
<span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$name</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Single quotes prevent expansion of everything, including variables and command substitution.</p>
<p>If you want to use the values of variables and such, use double quotes instead.</p>
<p>Note that if you have other items that needs single quoting, you can use both in a single word:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'$1 USD is '</span><span class="s2">"</span><span class="nv">$rate</span><span class="s2"> GBP"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>If you want <code>$stuff</code> to be a literal dollar sign followed by the characters "stuff", you can [[ignore]] this message.</p>
<p>ShellCheck tries to be smart about it, and won't warn when this is used with awk, perl and similar, but there are some inherent ambiguities like <code>'I have $1 in my wallet'</code>, which could be "one dollar" or "whatever's in the first parameter".</p>
<p>In the particular case of <code>sed</code>, ShellCheck uses additional heuristics to try to separate cases like <code>'s/$foo/bar/'</code> (failing to replace the variable <code>$foo</code>) with from the false positives like <code>'$d'</code> (delete last line). If you're still triggering these, consider being more generous with your spaces: use <code>$ { s/foo/bar; }</code> instead of <code>${s/foo/bar/;}</code></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2147">~' in path</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#literal-tilde-in-path-works-poorly-across-programs">Literal tilde in PATH works poorly across programs.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="literal-tilde-in-path-works-poorly-across-programs">Literal tilde in PATH works poorly across programs.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:~/bin"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:</span><span class="nv">$HOME</span><span class="s2">/bin"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Having literal <code>~</code> in PATH is a bad idea. Bash handles it, but nothing else does.</p>
<p>This means that even if you're always using Bash, you should avoid it because any invoked program that relies on PATH will effectively ignore those entries.</p>
<p>For example, <code>make</code> may say <code>foo: Command not found</code> even though <code>foo</code> works fine from the shell and Make and Bash both use the same PATH. You'll get similar messages from any non-bash scripts invoked, and <code>whereis</code> will come up empty.</p>
<p>Use <code>$HOME</code> or full path instead.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If your directory name actually contains a literal tilde, you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2200">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#brace-expansions-dont-work-as-operands-in-use-a-loop">Brace expansions don't work as operands in [ ]. Use a loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="brace-expansions-dont-work-as-operands-in-use-a-loop">Brace expansions don't work as operands in [ ]. Use a loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">=</span> index.<span class="o">{</span>htm,html,php<span class="o">}</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the main file"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> main in index.<span class="o">{</span>htm,html,php<span class="o">}</span>
<span class="k">do</span>
  <span class="o">[</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$main</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the main file"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Brace expansions in <code>[ ]</code> will expand to a sequence of words. Operators work on single words.</p>
<p>The problematic code is equivalent to <code>[ "$file" = index.htm index.html index.php ]</code>, which is invalid syntax. A typical error message is <code>bash: [: too many arguments</code> or <code>dash: somefile: unexpected operator</code>. </p>
<p>Instead, use a <code>for</code> loop to iterate over values, and apply your condition to each.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2180">Improper array operations</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#bash-does-not-support-multidimensional-arrays-use-1d-or-associative-arrays">Bash does not support multidimensional arrays. Use 1D or associative arrays.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="bash-does-not-support-multidimensional-arrays-use-1d-or-associative-arrays">Bash does not support multidimensional arrays. Use 1D or associative arrays.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">2</span><span class="o">]=</span>bar
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="p">[1][2]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>In bash4, consider using associative arrays:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">declare</span> -A foo
foo<span class="o">[</span><span class="m">1</span>,2<span class="o">]=</span>bar
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="p">[1,2]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>Otherwise, do your own index arithmetic:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">size</span><span class="o">=</span><span class="m">10</span>
foo<span class="o">[</span><span class="m">1</span>*size+2<span class="o">]=</span>bar
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="p">[1*size+2]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash does not support multidimensional arrays. Rewrite it to use 1D arrays. Associative arrays map arbitrary strings to values, and are therefore useful since you can construct keys like <code>"1,2,3"</code> or <code>"val1;val2;val3"</code> to index them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2100">Improper arithmatic expression</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-for-arithmetics-eg-ii-2">Use $((..)) for arithmetics, e.g. i=$((i + 2))</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-for-arithmetics-eg-ii-2">Use <code>$((..))</code> for arithmetics, e.g. <code>i=$((i + 2))</code></h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">3</span>
<span class="nv">i</span><span class="o">=</span>i+2
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">3</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i <span class="o">+</span> <span class="m">2</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Unlike most languages, variable assignments (almost) always assigns strings and not expressions. In the example code, <code>i</code> will become the string <code>i+2</code> instead of the intended <code>5</code>. </p>
<p>To instead evaluate a mathematical expressions, use <code>$((..))</code> as in the correct code.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you wanted to assign a literal string, quote it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>description="friendly-looking"
</pre></div>
</td></tr></table>
<p>ShellCheck (as of v0.5) doesn't recognize Bash/Ksh numeric variables created with <code>declare -i</code> where this syntax is valid. Using <code>$((..))</code> still works, but you can also [[ignore]] this warning.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2014">Improper 'find' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-will-expand-once-before-find-runs-not-per-file-found">This will expand once before find runs, not per file found.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-will-expand-once-before-find-runs-not-per-file-found">This will expand once before find runs, not per file found.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.tar'</span> -exec tar xf <span class="o">{}</span> -C <span class="s2">"</span><span class="k">$(</span>dirname <span class="o">{}</span><span class="k">)</span><span class="s2">"</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.tar'</span> -exec sh -c <span class="s1">'tar xf "$1" -C "$(dirname "$1")"'</span> _ <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash evaluates any command substitutions before the command they feature in is executed. In this case, the command is <code>find</code>. This means that <code>$(dirname {})</code> will run <strong>before</strong> <code>find</code> runs, and not <strong>while</strong> <code>find</code> runs.</p>
<p>To run shell code for each file, we can write a tiny script and inline it with <code>sh -c</code>. We add <code>_</code> as a dummy argument that becomes <code>$0</code>, and a filename argument that becomes <code>$1</code> in the inlined script:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ sh -c <span class="s1">'echo "$1 is in $(dirname "$1")"'</span> _ <span class="s2">"mydir/myfile"</span>
mydir/myfile is in mydir
</pre></div>
</td></tr></table>
<p>This command can be executed by <code>find -exec</code>, with <code>{}</code> as the filename argument. It executes shell which interprets the inlined script once for each file. Note that the inlined script is single quoted, again to ensure that the expansion does not happen prematurely .</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you don't care (or if you prefer) that it's only expanded once, like when dynamically selecting the executable to be used by all invocations, you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2141">Ambiguous expression</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#did-you-mean-ifst">Did you mean IFS=$'\t' ?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="did-you-mean-ifst">Did you mean IFS=$'\t' ?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">IFS</span><span class="o">=</span><span class="s2">"\t"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$'\t'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>IFS="\t"</code> splits on backslash and the letter "t". <code>IFS=$'\t'</code> splits on tab.</p>
<h3 id="exceptions">Exceptions</h3>
<p>It's extremely rare to want to split on the letter "n" or "t", rather than linefeed or tab.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2149">Redundant $/${} for numeric index</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-for-numeric-index-or-escape-it-for-string">Remove $/${} for numeric index, or escape it for string.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-for-numeric-index-or-escape-it-for-string">Remove $/${} for numeric index, or escape it for string.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Regular array</span>
<span class="nv">index</span><span class="o">=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="k">$((</span>array<span class="o">[</span><span class="nv">$index</span><span class="o">]</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Associative array</span>
<span class="nv">index</span><span class="o">=</span>banana
<span class="nb">echo</span> <span class="k">$((</span>array<span class="o">[</span><span class="nv">$index</span><span class="o">]</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Regular array
index=42
echo $((array[index]))
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Associative array</span>
<span class="nv">index</span><span class="o">=</span>banana
<span class="nb">echo</span> <span class="k">$((</span>array<span class="o">[</span><span class="se">\$</span>index<span class="o">]</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>For a numerically indexed array, the <code>$</code> is mostly pointless and can be removed like in [[SC2004]].</p>
<p>For associative arrays, the <code>$</code> should be escaped to avoid accidental dereferencing:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">declare</span> -A array
<span class="nv">index</span><span class="o">=</span><span class="s1">'$1'</span>
array<span class="o">[</span><span class="nv">$index</span><span class="o">]=</span><span class="m">42</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span> array<span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="k">))</span><span class="s2">"</span>    <span class="c1"># bash: array: bad array subscript</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span> array<span class="o">[</span><span class="se">\$</span>index<span class="o">]</span> <span class="k">))</span><span class="s2">"</span>   <span class="c1"># 42</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1001">Improper escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-o-will-be-a-regular-o-in-this-context">This \o will be a regular 'o' in this context.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-o-will-be-a-regular-o-in-this-context">This <code>\o</code> will be a regular 'o' in this context.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Want literal backslash</span>
<span class="nb">echo</span> Yay <span class="se">\o</span>/

<span class="c1"># Want other characters</span>
<span class="nv">bell</span><span class="o">=</span><span class="se">\a</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'Yay \o/'</span>

<span class="nv">bell</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'\a'</span><span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have escaped something that has no special meaning when escaped. The backslash will be simply be ignored.</p>
<p>If the backslash was supposed to be literal, single quote or escape it.</p>
<p>If you wanted it to expand to something, rewrite the expression to use <code>printf</code> (or in bash, <code>$'\t'</code>). If the sequence in question is <code>\n</code>, <code>\t</code> or <code>\r</code>, you instead get a [[SC1012]] that describes this. </p>
<h3 id="exceptions">Exceptions</h3>
<p>None. ShellCheck (as of 2017-07-03, commit 31bb02d6) will not warn when the first letter of a command is unnecessarily escaped, as this is frequently used to suppress aliases interactively. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2010">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-use-ls-grep-use-a-glob-or-a-for-loop-with-a-condition-to-allow-non-alphanumeric-filenames">Don't use ls | grep. Use a glob or a for loop with a condition to allow non-alphanumeric filenames.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="dont-use-ls-grep-use-a-glob-or-a-for-loop-with-a-condition-to-allow-non-alphanumeric-filenames">Don't use ls | grep. Use a glob or a for loop with a condition to allow non-alphanumeric filenames.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls /directory <span class="p">|</span> grep mystring
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm <span class="k">$(</span>ls <span class="p">|</span> grep -v <span class="s1">'\.c$'</span><span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls /directory/*mystring*
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># BASH</span>
<span class="nb">shopt</span> -s extglob
rm -- !<span class="o">(</span>*.c<span class="o">)</span>

<span class="c1"># POSIX</span>
<span class="k">for</span> f in ./*
<span class="k">do</span>
  <span class="k">case</span> <span class="nv">$f</span> in
    *.c<span class="o">)</span> true<span class="p">;;</span>
    *<span class="o">)</span> rm <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><a href="https://mywiki.wooledge.org/ParsingLs">Parsing ls</a> is generally a bad idea because the output is fragile and human readable. To better handle non-alphanumeric filenames, use a glob. If you need more advanced matching than a glob can provide, use a <code>for</code> loop.</p>
<h3 id="exceptions">Exceptions:</h3>
<ul>
<li><code>ls</code> has sorting options that are tricky to get right with other commands. If a specific order of files is needed, ls <em>\&lt;sort options&gt;</em> | grep might be the best alternative.</li>
</ul>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/020">BashFaq: How can I find and safely handle file names containing newlines, spaces or both?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2037">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-assign-the-output-of-a-command-use-varcmd">To assign the output of a command, use var=$(cmd) .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="to-assign-the-output-of-a-command-use-varcmd">To assign the output of a command, use var=$(cmd) .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span>grep -c pattern file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="k">$(</span>grep -c pattern file<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>To assign the output of a command to a variable, use <code>$(command substitution)</code>. Just typing a command after the <code>=</code> sign does not work.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
<p>This warning triggers generally for <code>var=value -flag</code> and <code>var=value *glob*</code>. See related warning [[SC2209]] which matches <code>var=commonCommand</code>. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2063">Improper using of 'grep'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#grep-uses-regex-but-this-looks-like-a-glob">Grep uses regex, but this looks like a glob.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="grep-uses-regex-but-this-looks-like-a-glob">Grep uses regex, but this looks like a glob.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep <span class="s1">'*foo*'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep <span class="s1">'foo'</span>   <span class="c1"># or more explicitly,  grep '.*foo.*'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In globs, <code>*</code> matches any number of any character.</p>
<p>In regex, <code>*</code> matches any number of the preceding character.</p>
<p><code>grep</code> uses regex, not globs, so this means that <code>grep '*foo'</code> is nonsensical because there's no preceding character for <code>*</code>.</p>
<p>If the intention was to match "any number of characters followed by foo", use <code>'.*foo'</code>. Also note that since grep matches substrings, this will match "fishfood". Use anchors to prevent this, e.g. <code>foo$</code>.</p>
<p>This also means that <code>f*</code> will match "hello", because <code>f*</code> matches 0 (or more) "f"s and there are indeed 0 "f" characters in "hello". Again, use <code>grep 'f'</code> to find strings containing "f", or <code>grep '^f'</code> to find strings starting with "f".</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of the differences between globs and regex, you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2099">Improper arithmatic expression</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-for-arithmetics-eg-ii-2">Use $((..)) for arithmetics, e.g. i=$((i + 2))</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-for-arithmetics-eg-ii-2">Use <code>$((..))</code> for arithmetics, e.g. <code>i=$((i + 2))</code></h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">3</span>
<span class="nv">i</span><span class="o">=</span>i + <span class="m">2</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">3</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i <span class="o">+</span> <span class="m">2</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Unlike most languages, variable assignments in shell scripts are space sensitive and (almost) always assign strings.</p>
<p>To evaluate a mathematical expressions, use <code>$((..))</code> as in the correct code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>i=$((i + 2))   # Spaces are fine inside $((...))
</pre></div>
</td></tr></table>
<p>In the problematic code, <code>i=i + 2</code> will give an error <code>+: command not found</code> because the expression is interpreted similar to something like <code>LC_ALL=C wc -c</code> instead of numerical addition:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span> Prefix assignment    Command  Argument
 LC_ALL=C             wc       -c
 i=i                  +        2
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>If you wanted to assign a literal string, quote it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>game_score="0 - 2"
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2184">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-arguments-to-unset-so-theyre-not-glob-expanded">Quote arguments to unset so they're not glob expanded.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-arguments-to-unset-so-theyre-not-glob-expanded">Quote arguments to unset so they're not glob expanded.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">unset</span> foo<span class="o">[</span>index<span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">unset</span> <span class="s1">'foo[index]'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Arguments to <code>unset</code> are subject to regular glob expansion. This is especially relevant when unsetting indices in arrays, where <code>[..]</code> is considered a glob character group.</p>
<p>In the problematic code, having a file called <code>food</code> in the current directory will result in <code>unset foo[index]</code> expanding to <code>unset food</code>, which will silently succeed without unsetting the element.</p>
<p>Quoting so that the <code>[..]</code> is passed literally to <code>unset</code> solves the issue.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2077">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-spaces-around-the-comparison-operator">You need spaces around the comparison operator.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-spaces-around-the-comparison-operator">You need spaces around the comparison operator.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">0</span><span class="o">=</span><span class="m">1</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">0</span> <span class="o">=</span> <span class="m">1</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[[ 0 = 1 ]]</code> means "check if 0 and 1 are equal".</p>
<p><code>[[ str ]]</code> is short form for <code>[[ -n str ]]</code>, and means "check if <code>str</code> is non-empty". It doesn't matter if <code>str</code> happens to contain <code>0=1</code>.</p>
<p>Always use spaces around the comparison operator in <code>[..]</code> and <code>[[..]]</code>, otherwise it won't be recognized as an operator.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2178">Improper variable usage</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#variable-was-used-as-an-array-but-is-now-assigned-a-string">Variable was used as an array but is now assigned a string.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="variable-was-used-as-an-array-but-is-now-assigned-a-string">Variable was used as an array but is now assigned a string.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>flags<span class="o">[</span><span class="m">0</span><span class="o">]=</span><span class="s2">"-r"</span>
flags<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="s2">"--delete-after"</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$dryrun</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
   <span class="nv">flags</span><span class="o">=</span><span class="s2">"--dry-run"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>flags<span class="o">[</span><span class="m">0</span><span class="o">]=</span><span class="s2">"-r"</span>
flags<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="s2">"--delete-after"</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$dryrun</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
   <span class="nv">flags</span><span class="o">=(</span> <span class="s2">"--dry-run"</span> <span class="o">)</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck noticed that you have used a variable as an array, but then assign it a string. <code>array=foo</code> is equivalent to <code>array[0]=foo</code>, and leaves the rest of the elements unaffected.</p>
<p>In the incorrect code, <code>"${flags[@]}"</code> would contain <code>--dry-run</code> <code>--delete-after</code>.</p>
<p>To set an array to only a single, given element, you should use <code>array=( foo )</code>.</p>
<p>In the correct code, <code>"${flags[@]}"</code> will contain <code>--dry-run</code> only. </p>
<p>Another possible cause is accidentally missing the <code>$</code> on a previous assignment: <code>var=(my command); var=bar</code> instead of <code>var=$(my command); var=bar</code>. If the variable is not intended to be an array, ensure that it's never assigned as one.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck can get confused by variable scope if the same variable name was used as an array previously, but is a string in the current context. You can [[ignore]] it in this case.</p>
<p>In the case of local variables, a workaround is to declare the local variable separately from assigning to it:</p>
<p><strong>Problematic Code:</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> -a baz
   <span class="nv">baz</span><span class="o">+=(</span><span class="s2">"foo"</span> <span class="s2">"bar"</span><span class="o">)</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">baz</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="o">}</span>

bar <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> <span class="nv">baz</span><span class="o">=</span><span class="s2">"qux"</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$baz</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p><strong>Correct Code:</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> -a baz
   <span class="nv">baz</span><span class="o">+=(</span><span class="s2">"foo"</span> <span class="s2">"bar"</span><span class="o">)</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">baz</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="o">}</span>

bar <span class="o">()</span> <span class="o">{</span>
   <span class="nb">local</span> baz
   <span class="nv">baz</span><span class="o">=</span><span class="s2">"qux"</span>
   <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$baz</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1035">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-here">You need a space here</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-here">You need a space here</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> !<span class="o">[</span>-z foo <span class="o">]</span><span class="p">;</span> <span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span> <span class="c1"># if command `[-z' w/ args `foo', `]' fails..</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> ! <span class="o">[</span> -z foo <span class="o">]</span><span class="p">;</span> <span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span> <span class="c1"># if command `[' w/ args `-z', `foo', `]' fails..</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bourne shells are very whitespace sensitive. Adding or removing spaces can drastically alter the meaning of a script. In these cases, ShellCheck has noticed that you're missing a space at the position indicated.</p>
<h3 id="exceptions">Exceptions</h3>
<p>ShellCheck does not understand <a href="https://www.gnu.org/software/bash/manual/html_node/History-Interaction.html">Bash History Expansion</a>, an interactive shell feature also using <code>!</code> (such as <code>!!</code> to expand to the previous command). </p>
<p>These features are disabled by default in shells and very rarely used in scripts, but may occasionally be found in interactively sourced files like <code>.bashrc</code>. Please ignore the error in these cases.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2074">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#cant-use-in-use-instead">Can't use =~ in [ ]. Use [[..]] instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="cant-use-in-use-instead">Can't use <code>=~</code> in <code>[ ]</code>. Use <code>[[..]]</code> instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$input</span><span class="s2">"</span> <span class="o">=</span>~ DOC<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>*<span class="se">\.</span>txt <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"match"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$input</span><span class="s2">"</span> <span class="o">=</span>~ DOC<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>*<span class="se">\.</span>txt <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"match"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>=~</code> only works in <code>[[ .. ]]</code> tests. It does not work with <code>test</code> or <code>[</code> in any shell.</p>
<p>If you're targeting POSIX <code>sh</code>, rewrite in terms of <code>case</code> or <code>grep</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2205">Suspicious subshell</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-a-subshell-did-you-mean-a-test-expression">(..) is a subshell. Did you mean [ .. ], a test expression?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-a-subshell-did-you-mean-a-test-expression">(..) is a subshell. Did you mean [ .. ], a test expression?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span> <span class="m">1</span> -lt <span class="m">2</span> <span class="o">)</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"1 is less than 2"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="m">1</span> -lt <span class="m">2</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"1 is less than 2"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Tests like <code>-eq</code> to check numeric equality or <code>\&lt;</code> for string comparison only work are actually parameters to the <code>test</code> command, and only work as tests in that context. <code>[</code> is an alias for <code>test</code>, so you'll frequently see them written as <code>[ 1 -eq 2 ]</code>.</p>
<p><code>( .. )</code> is completely unrelated, and is a subshell mostly used to scope shell modifications. They should not be used in <code>if</code> or <code>while</code> statements in shell scripts.</p>
<p>If you wanted to test a condition, rewrite the <code>( .. )</code> to <code>[ .. ]</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>This error is triggered by having a binary operator as the first parameter in a subshell, and could falsely trigger on e.g. <code>if ( grep -eq "foo|bar" file )</code>. In these cases, check whether the subshell is actually needed.</p>
<p>Note that there's a similar looking error [[SC2204]] with a low false positive rate.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1037">Braces are required for positionals over 9</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#braces-are-required-for-positionals-over-9-eg-10">Braces are required for positionals over 9, e.g. ${10}.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="braces-are-required-for-positionals-over-9-eg-10">Braces are required for positionals over 9, e.g. ${10}.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Ninth parameter: </span><span class="nv">$9</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Tenth parameter: </span><span class="nv">$10</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Ninth parameter: </span><span class="nv">$9</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Tenth parameter: </span><span class="si">${</span><span class="nv">10</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>For legacy reasons, <code>$10</code> is interpreted as the variable <code>$1</code> followed by the literal string <code>0</code>.</p>
<p>Curly braces are needed to tell the shell that both digits are part of the parameter expansion.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you wanted the trailing digits to be literal, <code>${1}0</code> will make this clear to both humans and shellcheck.</p>
<p>In <code>dash</code>, <code>$10</code> is (<a href="https://gnu.org/s/autoconf/manual/html_node/Shell-Substitutions.html">wrongly</a>) interpreted as <code>${10}</code>, so some 'reversed' care should also be taken:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>bash -c <span class="s1">'set a b c d e f g h i j; echo $10 ${1}0'</span> <span class="c1"># POSIX: a0 a0</span>
dash -c <span class="s1">'set a b c d e f g h i j; echo $10 ${1}0'</span> <span class="c1"># WRONG: j a0</span>
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/025">BashFaq: How can I access positional parameters after $9?</a></li>
<li><a href="https://stackoverflow.com/questions/4912733/how-to-handle-more-than-10-parameters-in-shell">StackOverflow: How to handle more than 10 parameters in shell
</a></li>
<li><a href="https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/html_node/Shell-Substitutions.html">Autoconf Manual: Shell Substitutions</a> - documents some non-POSIX older shells too</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1050">Missing 'then' for 'if'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-then">Expected 'then'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="expected-then">Expected 'then'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found an <code>if</code> statement that appears to be missing a <code>then</code>.</p>
<p>Make sure the <code>then</code> exists, and that it is the first word of the line (or immediately preceded by a semicolon).</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2095">Improper using stdin in ssh</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-ssh-n-to-prevent-ssh-from-swallowing-stdin">Use ssh -n to prevent ssh from swallowing stdin.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-ssh-n-to-prevent-ssh-from-swallowing-stdin">Use ssh -n to prevent ssh from swallowing stdin.</h2>
<p>The same error applies to multiple commands, like <code>ffmpeg -nostdin</code> and <code>mplayer -noconsolecontrols</code>.</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">read</span> -r host
<span class="k">do</span>
  ssh <span class="s2">"</span><span class="nv">$host</span><span class="s2">"</span> <span class="s2">"uptime"</span>
<span class="k">done</span> &lt; hosts.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">read</span> -r host
<span class="k">do</span>
  ssh -n <span class="s2">"</span><span class="nv">$host</span><span class="s2">"</span> <span class="s2">"uptime"</span>
<span class="k">done</span> &lt; hosts.txt
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Commands that process stdin will compete with the <code>read</code> statement for input. This is especially tricky for commands you wouldn't expect reads from stdin, like <code>ssh .. uptime</code>, <code>ffmpeg</code> and <code>mplayer</code>.</p>
<p>The most common symptom of this is a <code>while read</code> loop only running once, even though the input contains many lines. This is because the rest of the lines are swallowed by the offending command.</p>
<p>To refuse such commands input, you can use a command specific option like <code>ssh -n</code> or <code>ffmpeg -nostdin</code>. </p>
<p>More generally, you can also redirect their stdin with <code>&lt; /dev/null</code>. This works for all commands with this behavior.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/089">BashFaq: I'm reading a file line by line and running ssh or ffmpeg, only the first line gets processed!</a></li>
<li><a href="https://stackoverflow.com/questions/13800225/shell-script-while-read-line-loop-stops-after-the-first-line">StackOverflow: Shell script while read line loop stops after the first line
</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1079">Missing escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-actually-an-end-quote-but-due-to-next-char-it-looks-suspect">This is actually an end quote, but due to next char it looks suspect.</a></li>
</ul>
</div>

            <div>
                
<h2 id="this-is-actually-an-end-quote-but-due-to-next-char-it-looks-suspect">This is actually an end quote, but due to next char it looks suspect.</h2>
<p>See companion warning [[SC1078]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2032">Improper execution shell function</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-own-script-or-sh-c-to-run-this-from-su">Use own script or sh -c '..' to run this from su.</a></li>
</ul>
</div>

            <div>
                
<h1 id="use-own-script-or-sh-c-to-run-this-from-su">Use own script or sh -c '..' to run this from su.</h1>
<p>See [[SC2033]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1078">Missing double quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#did-you-forget-to-close-this-double-quoted-string">Did you forget to close this double quoted string?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="did-you-forget-to-close-this-double-quoted-string">Did you forget to close this double quoted string?</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">greeting</span><span class="o">=</span><span class="s2">"hello</span>
<span class="s2">target="</span>world<span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">greeting</span><span class="o">=</span><span class="s2">"hello"</span>
<span class="nv">target</span><span class="o">=</span><span class="s2">"world"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The first line is missing a quote.</p>
<p>ShellCheck warns when it detects multi-line double quoted, single quoted or backticked strings when the character that follows it looks out of place (and gives a companion warning [[SC1079]] at that spot).</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you do want a multiline variable, just make sure the character after it is a quote, space or line feed.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s1">'multiline</span>
<span class="s1">'</span>value
</pre></div>
</td></tr></table>
<p>can be rewritten for readability and to remove the warning:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s1">'multiline</span>
<span class="s1">value'</span>
</pre></div>
</td></tr></table>
<p>As always <code>`..`</code> should be rewritten to <code>$(..)</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2248">Bad variable reference</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>


            <div>
                <p>[TOC]
 # Warn about variable references without braces.</p>
<p>This error is optional and not enabled by default.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1117">Literal escaping</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#backslash-is-literal-in-n-prefer-explicit-escaping-n">Backslash is literal in "\n". Prefer explicit escaping: "\\n".</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#retired">Retired:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="backslash-is-literal-in-n-prefer-explicit-escaping-n">Backslash is literal in <code>"\n"</code>. Prefer explicit escaping: <code>"\\n"</code>.</h2>
<p><strong>Note: this warning has been retired due to being too pedantic</strong></p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"%s\n"</span> <span class="s2">"Hello"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"%s\\n"</span> <span class="s2">"Hello"</span>
</pre></div>
</td></tr></table>
<p>or alternatively, with single quotes:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"Hello"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In a double quoted string, you have escaped a character that has no special behavior when escaped. Instead, it's invoking the fallback behavior of being interpreted literally.</p>
<p>Instead of relying on this implicit fallback, you should escape the backslash explicitly. This makes it clear that it's meant to be passed as a literal backslash in the string parameter.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. This is a stylistic issue which can be [[ignored]]. But can you name the 5 characters that <em>are</em> special when escaped in double quotes? </p>
<p>They are $, `, ", \, or newline. More infos are available in the <a href="https://www.gnu.org/software/bash/manual/html_node/Double-Quotes.html">bash manual</a>.</p>
<h3 id="retired">Retired:</h3>
<p>This warning is no longer emitted as of d8a32da07 (strictly after v0.5).</p>
<p>The number of harmlessly affected <code>printf</code>, <code>sed</code> and <code>grep</code> statements was significantly higher than the number of actual unexpanded escape sequences. It may return some day under a <code>-pedantic</code> type flag.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2103">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-a-subshell-to-avoid-having-to-cd-back">Use a ( subshell ) to avoid having to cd back.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="use-a-subshell-to-avoid-having-to-cd-back">Use a ( subshell ) to avoid having to cd back.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> dir in */
<span class="k">do</span>
  <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
  convert index.png index.jpg
  <span class="nb">cd</span> ..
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> dir in */
<span class="k">do</span>
  <span class="o">(</span>
  <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit</span>
  convert index.png index.jpg
  <span class="o">)</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> dir in */
<span class="k">do</span>
  <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit</span>
  convert index.png index.jpg
  <span class="nb">cd</span> ..
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When doing <code>cd dir; somestuff; cd ..</code>, <code>cd dir</code> can fail when permissions are lacking, if the dir was deleted, or if <code>dir</code> is actually a file.</p>
<p>In this case, <code>somestuff</code> will run in the wrong directory and <code>cd ..</code> will take you to an even more wrong directory. In a loop, this will likely cause the next <code>cd</code> to fail as well, propagating this error and running these commands far away from the intended directories.</p>
<p>Check <code>cd</code>s exit status and/or use subshells to limit the effects of <code>cd</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you set variables you can't use a subshell. In that case, you should definitely check the exit status of <code>cd</code>, which will also silence this suggestion.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2117">Improper running commands upon another user</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-run-commands-as-another-user-use-su-c-or-sudo">To run commands as another user, use su -c or sudo.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="to-run-commands-as-another-user-use-su-c-or-sudo">To run commands as another user, use su -c or sudo.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>whoami
su
whoami
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>whoami
sudo whoami
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>It's commonly believed that <code>su</code> makes a session run as another user. In reality, it starts an entirely new shell, independent of the one currently running your script.</p>
<p><code>su; whoami</code> will start a root shell and wait for it to exit before running <code>whoami</code>. It will not start a root shell and then proceed to run <code>whoami</code> in it.</p>
<p>To run commands as another user, use <code>sudo some command</code> or <code>su -c 'some command'</code>. <code>sudo</code> is preferred when available, as it doesn't require additional quoting and can be configured to run passwordless if desired.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of the above and want to e.g. start an interactive shell for a user, feel free to ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2054">Using commas on separating array elements</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-spaces-not-commas-to-separate-array-elements">Use spaces, not commas, to separate array elements.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-spaces-not-commas-to-separate-array-elements">Use spaces, not commas, to separate array elements.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">flags</span><span class="o">=(</span><span class="s2">"-l"</span>, <span class="s2">"-d"</span>, <span class="s2">"--sort=size"</span><span class="o">)</span>
ls <span class="s2">"</span><span class="si">${</span><span class="nv">flags</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">flags</span><span class="o">=(</span><span class="s2">"-l"</span> <span class="s2">"-d"</span> <span class="s2">"--sort=size"</span><span class="o">)</span>
ls <span class="s2">"</span><span class="si">${</span><span class="nv">flags</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to have used commas to separate array elements in an array assignment. Other languages require this, but bash instead treats the commas as literal strings.</p>
<p>In the problematic code, the first element is <code>-l,</code> with the trailing comma, and the executed command ends up being <code>ls -l, -d, --sort=size</code>.</p>
<p>In the correct code, the trailing commas have been removed, and the command will be <code>ls -l -d --sort=size</code> as expected.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None (if you actually want a trailing comma in your strings, move them inside the quotes).</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2088">Using tilde in quotes</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#tilde-does-not-expand-in-quotes-use-home">Tilde does not expand in quotes. Use $HOME.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="tilde-does-not-expand-in-quotes-use-home">Tilde does not expand in quotes. Use $HOME.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm <span class="s2">"~/Desktop/</span><span class="nv">$filename</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Desktop/</span><span class="nv">$filename</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Tilde does not expand to the user's home directory when it's single or double quoted. Use double quotes and <code>$HOME</code> instead.</p>
<p>Alternatively, the <code>~/</code> can be left unquoted, as in <code>rm ~/"Desktop/$filename"</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you don't want the tilde to be expanded, you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2059">Using variables in printf</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-use-variables-in-the-printf-format-string-use-printf-s-foo">Don't use variables in the printf format string. Use printf "..%s.." "$foo".</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="dont-use-variables-in-the-printf-format-string-use-printf-s-foo">Don't use variables in the printf format string. Use printf "..%s.." "$foo".</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Hello, </span><span class="nv">$NAME</span><span class="s2">\n"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Hello, %s\n"</span> <span class="s2">"</span><span class="nv">$NAME</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>printf</code> interprets escape sequences and format specifiers in the format string. If variables are included, any escape sequences or format specifiers in the data will be interpreted too, when you most likely wanted to treat it as data. Example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">coverage</span><span class="o">=</span><span class="s1">'96%'</span>
<span class="nb">printf</span> <span class="s2">"Unit test coverage: %s\n"</span> <span class="s2">"</span><span class="nv">$coverage</span><span class="s2">"</span>
<span class="nb">printf</span> <span class="s2">"Unit test coverage: </span><span class="nv">$coverage</span><span class="s2">\n"</span>
</pre></div>
</td></tr></table>
<p>The first printf writes <code>Unit test coverage: 96%</code>.</p>
<p>The second writes <code>bash: printf: `\': invalid format character</code></p>
<h3 id="exceptions">Exceptions</h3>
<p>Sometimes you may actually want to interpret data as a format string, like in:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>octToAscii<span class="o">()</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s2">"\\</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
octToAscii <span class="m">130</span>
</pre></div>
</td></tr></table>
<p>In Bash, Ksh and BusyBox, there's a <code>%b</code> format specifier that expands escape sequences without interpreting other format specifiers: <code>printf '%b' "\\$1"</code>. In POSIX, you can instead [[ignore]] this warning.</p>
<p>Other times, you might have a pattern in a variable:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">filepattern</span><span class="o">=</span><span class="s2">"file-%d.jpg"</span>
<span class="nb">printf</span> -v filename <span class="s2">"</span><span class="nv">$filepattern</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$number</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>This has no good rewrite. Please [[ignore]] the warning with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1029">Improper escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-you-shouldnt-escape-or">In [[..]] you shouldn't escape ( or ).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="in-you-shouldnt-escape-or">In <code>[[..]]</code> you shouldn't escape <code>(</code> or <code>)</code>.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> -e ~/.bashrc -a <span class="se">\(</span> -x /bin/dash -o -x /bin/ash <span class="se">\)</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> -e ~/.bashrc -a <span class="o">(</span> -x /bin/dash -o -x /bin/ash <span class="o">)</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You don't have to -- and can't -- escape <code>(</code> or <code>)</code> inside a <code>[[ .. ]]</code> expression like you do in <code>[ .. ]</code>. Just remove the escaping.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1062">Missing 'done' for 'do'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-done-matching-previously-mentioned-do">Expected 'done' matching previously mentioned 'do'.</a></li>
</ul>
</div>

            <div>
                
<h2 id="expected-done-matching-previously-mentioned-do">Expected 'done' matching previously mentioned 'do'.</h2>
<p>See companion warning [[SC1061]]</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1061">Missing 'done' for 'do'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#couldnt-find-done-for-this-do">Couldn't find 'done' for this 'do'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="couldnt-find-done-for-this-do">Couldn't find 'done' for this 'do'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>yes<span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="nb">echo</span> <span class="s2">"y"</span>
  <span class="k">do</span>
    <span class="nb">true</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>yes<span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="nb">echo</span> <span class="s2">"y"</span>
  <span class="k">do</span>
    <span class="nb">true</span>
  <span class="k">done</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a <code>do</code> without a corresponding <code>done</code>.</p>
<p>Double check that the <code>done</code> exists, and that it correctly matches the indicated <code>do</code>. A companion warning [[SC1062]] is emitted where ShellCheck first noticed it was missing. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2026">Improper quote usage</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-word-is-outside-of-quotes-did-you-intend-to-nest-single-quotes-instead">This word is outside of quotes. Did you intend to 'nest '"'single quotes'"' instead'?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-word-is-outside-of-quotes-did-you-intend-to-nest-single-quotes-instead">This word is outside of quotes. Did you intend to <code>'nest '"'single quotes'"'</code> instead'?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">alias</span> <span class="nv">server_uptime</span><span class="o">=</span><span class="s1">'ssh $host '</span>uptime -p<span class="s1">''</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">alias</span> <span class="nv">server_uptime</span><span class="o">=</span><span class="s1">'ssh $host '</span><span class="s2">"'uptime -p'"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In the first case, the user has four single quotes on a line, wishfully hoping that the shell will match them up as outer quotes around a string with literal single quotes:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#                   v--------match--------v</span>
<span class="nb">alias</span> <span class="nv">server_uptime</span><span class="o">=</span><span class="s1">'ssh $host '</span>uptime -p<span class="s1">''</span>
<span class="c1">#                              ^--match--^</span>
</pre></div>
</td></tr></table>
<p>The shell, meanwhile, always terminates single quoted strings at the first possible single quote:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#                   v---match--v</span>
<span class="nb">alias</span> <span class="nv">server_uptime</span><span class="o">=</span><span class="s1">'ssh $host '</span>uptime -p<span class="s1">''</span>
<span class="c1">#                                        ^^</span>
</pre></div>
</td></tr></table>
<p>Which is the same thing as <code>alias server_uptime='ssh $host uptime' -p</code>.</p>
<p>There is no way to nest single quotes. However, single quotes can be placed literally in double quotes, so we can instead concatenate a single quoted string and a double quoted string:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#                   v--match---v</span>
<span class="nb">alias</span> <span class="nv">server_uptime</span><span class="o">=</span><span class="s1">'ssh $host '</span><span class="s2">"'uptime -p'"</span>
<span class="c1">#                               ^---match---^</span>
</pre></div>
</td></tr></table>
<p>This results in an alias with embedded single quotes.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1048">Empty 'then' branch</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#cant-have-empty-then-clauses-use-true-as-a-no-op">Can't have empty then clauses (use 'true' as a no-op).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="cant-have-empty-then-clauses-use-true-as-a-no-op">Can't have empty then clauses (use 'true' as a no-op).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e foo <span class="o">]</span>
<span class="k">then</span>
  <span class="c1"># TODO: handle this</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e foo <span class="o">]</span>
<span class="k">then</span>
  <span class="c1"># TODO: handle this</span>
  <span class="nb">true</span>
<span class="k">fi</span>

<span class="c1"># Or use the no-op colon operator ":"</span>
<span class="k">if</span> <span class="o">[</span> -e foo <span class="o">]</span>
<span class="k">then</span>
  <span class="c1"># TODO: handle this</span>
  :
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shells do not allow empty <code>then</code> clauses. They need at least one command (and comments are not commands).</p>
<p>If you want a <code>then</code> clause that does nothing, use a dummy command like <code>true</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1100">Using unicode dash</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-dash-delete-and-retype-as-ascii-minus">This is a unicode dash. Delete and retype as ASCII minus.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-dash-delete-and-retype-as-ascii-minus">This is a unicode dash. Delete and retype as ASCII minus.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="m">3</span> –gt <span class="m">2</span> <span class="o">]]</span> <span class="c1"># Uses unicode en-dash character</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="m">3</span> -gt <span class="m">2</span> <span class="o">]]</span> <span class="c1"># Uses regular ASCII hyphen-minus character</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>A character that looks similar to <code>-</code> has made its way into your code. This is usually due to copy-pasting from blogs and other websites that formatted code as text, replacing the ASCII hyphen-minus with a Unicode dash character.</p>
<p>To fix it, simply delete and retype it.</p>
<p>For a large script, you can use your editor's Search&amp;Replace by copy-pasting the bad dash.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you want a literal Unicode dash character, just quote it.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1097">Unexpected ==</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unexpected-for-assignment-use-for-comparison-use">Unexpected ==. For assignment, use =. For comparison, use [/[[.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="unexpected-for-assignment-use-for-comparison-use">Unexpected ==. For assignment, use =. For comparison, use [/[[.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">==</span>value
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Assignment:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span>value
</pre></div>
</td></tr></table>
<p>Comparison:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">=</span> value <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has noticed that you're using <code>==</code> in an unexpected way. The two most common reasons for this is:</p>
<ul>
<li>
<p>You wanted to assign a value but accidentally used <code>==</code> instead of <code>=</code>.</p>
</li>
<li>
<p>You wanted to compare two values, but neglected to use <code>[ .. ]</code> or <code>[[ .. ]]</code>.</p>
</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>If you wanted to assign a literal equals sign, use quotes to make this clear:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"=sum(A1:A10)"</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2181">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#check-exit-code-directly-with-eg-if-mycmd-not-indirectly-with">Check exit code directly with e.g. 'if mycmd;', not indirectly with $?.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="check-exit-code-directly-with-eg-if-mycmd-not-indirectly-with">Check exit code directly with e.g. 'if mycmd;', not indirectly with $?.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make mytarget

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Build failed"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> ! make mytarget
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Build failed"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Running a command and then checking its exit status <code>$?</code> against 0 is redundant.</p>
<p>Instead of just checking the exit code of a command, it checks the exit code of a command (e.g. <code>[</code>) that checks the exit code of a command.</p>
<p>Apart from the redundancy, there are other reasons to avoid this pattern:</p>
<ul>
<li>Since the command and its status test are decoupled, inserting an innocent command like <code>echo "make finished"</code> after <code>make</code> will cause the <code>if</code> statement to silently start comparing <code>echo</code>'s status instead.</li>
<li>Scripts that run or are called with <code>set -e</code> aka <code>errexit</code> will exit immediately if the command fails, even though they're followed by a clause that handles failure. </li>
<li>The value of <code>$?</code> is overwritten by <code>[</code>/<code>[[</code>, so you can't get the original value in the relevant then/else block (e.g. <code>if mycmd; then echo "Success"; else echo "Failed with $?"; fi</code>).</li>
</ul>
<p>To check that a command returns success, use <code>if mycommand; then ...</code>.</p>
<p>To check that a command returns failure, use <code>if ! mycommand; then ...</code>. Notice that <code>!</code> will overwrite <code>$?</code> value.</p>
<p>To additionally capture output with command substitution: <code>if ! output=$(mycommand); then ...</code></p>
<p>This also applies to <code>while</code>/<code>until</code> loops.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>The default Solaris 10 bourne shell does not support '!' outside of the test command (<code>if ! mycommand; then ...</code> returns <code>!: not found</code>)</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1129">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-the">You need a space before the !.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-the">You need a space before the !.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span>! <span class="o">[</span> -f file <span class="o">]</span>
<span class="k">do</span> sleep <span class="m">1</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> ! <span class="o">[</span> -f file <span class="o">]</span>
<span class="k">do</span> sleep <span class="m">1</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a keyword immediately followed by a <code>!</code>. There needs to be a space between them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2079">Using float numbers in (( ))</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#doesnt-support-decimals-use-bc-or-awk">(( )) doesn't support decimals. Use bc or awk.</a></li>
</ul>
</div>

            <div>
                
<h1 id="doesnt-support-decimals-use-bc-or-awk">(( )) doesn't support decimals. Use bc or awk.</h1>
<p>Bash <a href="https://www.tldp.org/LDP/abs/html/comparison-ops.html">arithmetic conditional evaluation can only be performed on integers</a>. More detail: Bash has limited data types which <a href="http://www.tldp.org/LDP/abs/html/declareref.html">include integer</a>, but everything is effectively <a href="http://www.tldp.org/LDP/abs/html/untyped.html">untyped</a>.</p>
<p>Suggested workarounds to this constraint use bc or awk, here are 
<a href="https://stackoverflow.com/questions/11237794/how-to-compare-two-decimal-numbers-in-bash-awk">some examples</a>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2232">Using sudo with builtins</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#cant-use-sudo-with-builtins-like-cd-did-you-want-sudo-sh-c-instead">Can't use sudo with builtins like cd. Did you want sudo sh -c .. instead?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="cant-use-sudo-with-builtins-like-cd-did-you-want-sudo-sh-c-instead">Can't use sudo with builtins like cd. Did you want sudo sh -c .. instead?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo <span class="nb">cd</span> /root
<span class="nb">pwd</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo sh -c <span class="s1">'cd /root &amp;&amp; pwd'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Due to the Unix process model, <code>sudo</code> can only change the privileges of a new, external process. It can not grant privileges to a currently running process.</p>
<p>This means that shell builtins -- commands that are interpreted by the current shell rather than through program invocation -- cannot be run with <code>sudo</code>. This includes <code>cd</code>, <code>source</code>, <code>read</code>, and others.</p>
<p>Instead you can run a shell with <code>sudo</code>, and have that shell run the builtins you want. Just be aware that what happens in that shell stays in that shell:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo sh -c 'cd /root &amp;&amp; pwd'  # This shows /root
pwd                           # This shows the original directory
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://superuser.com/questions/241129/why-wont-sudo-cd-work">SuperUser</a>: Why won't “sudo cd” work?</li>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2060">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-parameters-to-tr-to-prevent-glob-expansion">Quote parameters to tr to prevent glob expansion.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="quote-parameters-to-tr-to-prevent-glob-expansion">Quote parameters to tr to prevent glob expansion.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -cd <span class="o">[</span>:digit:<span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -cd <span class="s1">'[:digit:]'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>From the shell's point of view, unquoted <code>[:digit:]</code> is a glob equivalent to <code>[dgit:]</code> that matches any single character filename from the group, such as <code>d</code> or <code>t</code>, in the current directory. </p>
<p>If someone starts learning D and creates a directory named <code>d</code> to hold the source code, the glob will be expanded and the script will end up executing <code>tr -cd d</code> instead, which is clearly unintended.</p>
<p>Quoting the argument prevents this, and will pass it correctly as the literal string <code>[:digit:]</code> no matter which files exist in the current directory.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2213">Improper use of 'getops'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#getopts-specified-n-but-its-not-handled-by-this-case">getopts specified -n, but it's not handled by this 'case'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="getopts-specified-n-but-its-not-handled-by-this-case">getopts specified -n, but it's not handled by this 'case'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vrn"</span> n
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Recursive"</span> <span class="p">;;</span>
    <span class="se">\?</span><span class="o">)</span> usage<span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vrn"</span> n
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Recursive"</span> <span class="p">;;</span>
    n<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Dry-run"</span> <span class="p">;;</span>    <span class="c1"># -n handled here</span>
    <span class="se">\?</span><span class="o">)</span> usage<span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have a <code>while getopts</code> loop where the corresponding <code>case</code> statement fails to handle one of the flags.</p>
<p>Either add a case to handle the flag, or remove it from the <code>getopts</code> option string.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2220">Missing default case branch</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#invalid-flags-are-not-handled-add-a-case">Invalid flags are not handled. Add a *) case.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="invalid-flags-are-not-handled-add-a-case">Invalid flags are not handled. Add a <code>*)</code> case.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vr"</span> f
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"recursive"</span> <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vr"</span> f
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"recursive"</span> <span class="p">;;</span>
    *<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"usage: </span><span class="nv">$0</span><span class="s2"> [-v] [-r]"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
       <span class="nb">exit</span> <span class="m">1</span> <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The <code>case</code> statement handling <code>getopts</code> arguments does not have a default branch to handle unknown flags.</p>
<p>When a flag is not recognized, such as if passing <code>-Z</code> to the example code, <code>getopts</code> will set the variable to a literal question mark <code>?</code>. This should be handled along with all the valid flags, usually by printing a usage message and exiting with failure.</p>
<p>Using a <code>\?)</code> or <code>?)</code> case will also match invalid flags, but<code>*)</code> would additionally match things like the empty string if the variable name was misspelled.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If your script's logic handles unrecognized flags in another way, e.g. after the <code>case</code> statement, you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1017">Literal carriage return</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#literal-carriage-return-run-script-through-tr-d-r">Literal carriage return. Run script through tr -d '\r' .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="literal-carriage-return-run-script-through-tr-d-r">Literal carriage return. Run script through <code>tr -d '\r'</code> .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cat -v myscript
<span class="c1">#!/bin/sh^M</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>^M
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cat -v myscript
<span class="c1">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script uses Windows/DOS style <code>\r\n</code> line terminators instead of UNIX style <code>\n</code> terminators. The additional <code>\r</code> aka <code>^M</code> aka carriage return characters will be treated literally, and results in all sorts strange bugs and messages.</p>
<p>You can verify this with <code>cat -v yourfile</code> and see whether or not each line ends with a <code>^M</code>. To delete them, open the file in your editor and save the file as "Unix", "UNIX/OSX Format", <code>:set ff=unix</code> or similar if it supports it.</p>
<p>If you don't know how to get your editor to save a file with Unix line terminators, you can use <code>tr</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -d '\r' &lt; badscript   &gt; goodscript
</pre></div>
</td></tr></table>
<p>This will read a script <code>badscript</code> with possible carriage returns, and write <code>goodscript</code> without them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/052">BashFaq: How do I convert a file from DOS format to UNIX format (remove CRs from CR-LF line terminators)?</a></li>
<li><a href="https://stackoverflow.com/questions/39527571/are-shell-scripts-sensitive-to-encoding-and-line-endings">StackOverflow: Are shell scripts sensitive to encoding and line endings?
</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2122">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-not-a-valid-operator-use-a-b-instead">&gt;= is not a valid operator. Use '! a &lt; b' instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-not-a-valid-operator-use-a-b-instead">&gt;= is not a valid operator. Use '! a &lt; b' instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> a <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span> b <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> ! a &gt; b <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The operators <code>&lt;=</code> and <code>&gt;=</code> are not supported by Bourne shells. Instead of "less than or equal", rewrite as "not greater than".</p>
<h3 id="exceptions">Exceptions</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2150">Improper use of '-exec'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#-exec-does-not-automatically-invoke-a-shell-use-exec-sh-c-for-that">-exec does not automatically invoke a shell. Use -exec sh -c .. for that.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="-exec-does-not-automatically-invoke-a-shell-use-exec-sh-c-for-that">-exec does not automatically invoke a shell. Use -exec sh -c .. for that.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -exec <span class="s1">'cat {} | wc -l'</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -exec sh -c <span class="s1">'cat {} | wc -l'</span> <span class="se">\;</span>         <span class="c1"># Insecure</span>
find . -type f -exec sh -c <span class="s1">'cat "$1" | wc -l'</span> _ <span class="o">{}</span> <span class="se">\;</span>  <span class="c1"># Secure</span>
</pre></div>
</td></tr></table>
<p>Sometimes the command can also be rewritten to not require <code>find</code> to invoke a shell:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -exec wc -l <span class="o">{}</span> <span class="se">\;</span> <span class="p">|</span> cut -d <span class="s1">' '</span> -f <span class="m">1</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>find <code>-exec</code> and <code>-execdir</code> uses <code>execve(2)</code> style semantics, meaning it expects an executable and zero or more arguments that should be passed to it.</p>
<p>It does not use <code>system(3)</code> style semantics, meaning it does not accept a shell command as a string, to be parsed and evaluated by the system's command interpreter.</p>
<p>If you want <code>find</code> to execute a shell command, you have to specify <code>sh</code> (or <code>bash</code>) as the executable, <code>-c</code> as first argument and your shell command as the second.</p>
<p>To prevent command injection, the filename can be passed as a separate argument to sh and referenced as a positional parameter.</p>
<h3 id="exceptions">Exceptions</h3>
<p>This warning would trigger falsely if executing a program with spaces in the path, if no other arguments were specified.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1051">Improper Semicolons directly after 'then'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#semicolons-directly-after-then-are-not-allowed-just-remove-it">Semicolons directly after 'then' are not allowed. Just remove it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="semicolons-directly-after-then-are-not-allowed-just-remove-it">Semicolons directly after 'then' are not allowed. Just remove it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> true<span class="p">;</span> <span class="k">then</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Hi"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> true<span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"Hi"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>then</code> keywords should not be followed by semicolons. It's not valid shell syntax.</p>
<p>You can follow them directly with a line break or another command.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2065">Ambiguous '>'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-interpreted-as-a-shell-file-redirection-not-a-comparison">This is interpreted as a shell file redirection, not a comparison.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-interpreted-as-a-shell-file-redirection-not-a-comparison">This is interpreted as a shell file redirection, not a comparison.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="m">1</span> &gt;2 <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="m">3</span>&gt;<span class="s1">'aaa bb'</span> <span class="o">]</span> <span class="c1"># Simple example of problematic code</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="m">1</span> -gt <span class="m">2</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="m">3</span> <span class="se">\&gt;</span> <span class="s1">'aaa bb'</span> <span class="o">]</span> <span class="c1"># arithmetical, lexicographical</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>A word that looks like a redirection in simple shell commands causes it to be interpreted as a redirection.
ShellCheck would guess that you don't want it in tests.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>When it's among a continuous list of redirections at the end of a simple <code>test</code> command, it's more likely that
the user really meant to do a redirection. Or any other case that you mean to do that.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1041">eof' not in a separate line</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#found-eof-further-down-but-not-on-a-separate-line">Found 'eof' further down, but not on a separate line.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="found-eof-further-down-but-not-on-a-separate-line">Found 'eof' further down, but not on a separate line.</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Close matches include '-eof' (!= 'eof').
</pre></div>
</td></tr></table>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt;-eof</span>
<span class="s">Hello World</span>
<span class="s">-eof</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt;- eof</span>
<span class="s">Hello World</span>
<span class="s">eof</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Your here document isn't properly terminated.</p>
<p>There is a line containing the terminator you've chosen, but it's not by itself on a separate line.</p>
<p>In the example code, the script uses <code>&lt;&lt;-eof</code>, which is the operator <code>&lt;&lt;-</code> followed by <code>eof</code>. The script therefore looks for <code>eof</code> and skips right past the intended terminator because it starts with a dash.</p>
<p>You will get some companion SC1042 errors mentioning lines that contain the string as a substring, though they all point to the start of the here document and not the relevant line:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>In foo line 4:
Hello
^-- SC1041: Found 'eof' further down, but not on a separate line.
^-- SC1042: Close matches include '-eof' (!= 'eof').
</pre></div>
</td></tr></table>
<p>Look at your here document and see which line was supposed to terminate it. Then ensure it matches the token exactly, and that it's on its own line with no text before or after.</p>
<p>Under Windows the error might occur due to the standard CRLF line-ending, which is Windows-specific.
Try to change the line ending into LF.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<hr/>
<p>Note that SC1041 and SC1042 swapped numbers after v0.4.6 to improve the display order. This rare instance of number reuse was justified by them always occuring together on the same line.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2212">Empty condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-false-instead-of-empty-conditionals">Use 'false' instead of empty [/[[ conditionals.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-false-instead-of-empty-conditionals">Use 'false' instead of empty [/[[ conditionals.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Temporarily disabled"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">false</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Temporarily disabled"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ ]</code> is a somewhat obscure way of expressing falsehood, and the behavior is likely intended to allow the incorrectly quoted command <code>[ $var ]</code> to still work when the variable is unset.</p>
<p>POSIX has a more descriptive command <code>false</code> for this.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. This is a stylistic suggestion, and has no effect on how the script works.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2044">Looping on 'find' directive results</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#for-loops-over-find-output-are-fragile-use-find-exec-or-a-while-read-loop">For loops over find output are fragile. Use find -exec or a while read loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a><ul>
<li><a href="#if-find-is-just-matching-globs-recursively">If find is just matching globs recursively</a></li>
<li><a href="#for-posix">For POSIX</a></li>
<li><a href="#for-simple-commands-with-no-aggregation">For simple commands with no aggregation</a></li>
<li><a href="#for-shell-commands-with-no-aggregation">For shell commands with no aggregation</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="for-loops-over-find-output-are-fragile-use-find-exec-or-a-while-read-loop">For loops over find output are fragile. Use find -exec or a while read loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in <span class="k">$(</span>find mydir -mtime -7 -name <span class="s1">'*.mp3'</span><span class="k">)</span>
<span class="k">do</span>
  <span class="nb">let</span> count++
  <span class="nb">echo</span> <span class="s2">"Playing file no. </span><span class="nv">$count</span><span class="s2">"</span>
  play <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="s2">"Played </span><span class="nv">$count</span><span class="s2"> files"</span>
</pre></div>
</td></tr></table>
<p>This will fail for filenames containing spaces and similar, such as <code>My File.mp3</code>, and has a series of potential globbing issues depending on other filenames in the directory like (if you have <code>MyFile2.mp3</code> and <code>MyFile[2014].mp3</code>, the former file will play twice and the latter will not play at all).</p>
<h3 id="correct-code">Correct code:</h3>
<p>There are many possible fixes, each with its pros and cons.</p>
<p>The most general fix (that requires the least amount of thinking to apply) is having <code>find</code> output a <code>\0</code> separated list of files and consuming them in a <code>while read</code> loop:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r -d <span class="s1">''</span> file
<span class="k">do</span>
  <span class="nb">let</span> count++
  <span class="nb">echo</span> <span class="s2">"Playing file no. </span><span class="nv">$count</span><span class="s2">"</span>
  play <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span> &lt;   &lt;<span class="o">(</span>find mydir -mtime -7 -name <span class="s1">'*.mp3'</span> -print0<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"Played </span><span class="nv">$count</span><span class="s2"> files"</span>
</pre></div>
</td></tr></table>
<p>In usage it's very similar to the <code>for</code> loop: it gets its output from a <code>find</code> statement, it executes a shell script body, it allows updating/aggregating variables, and the variables are available when the loop ends.</p>
<p>It requires Bash, and works with GNU, Busybox, OS X, FreeBSD and OpenBSD find, but not POSIX find.</p>
<h5 id="if-find-is-just-matching-globs-recursively">If <code>find</code> is just matching globs recursively</h5>
<p>If you don't need <code>find</code> logic like <code>-mtime -7</code> and just use it to match globs recursively (all <code>*.mp3</code> files under a directory), you can instead use <code>globstar</code> and <code>nullglob</code> instead of <code>find</code>, and still use a <code>for</code> loop:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">shopt</span> -s globstar nullglob
<span class="k">for</span> file in mydir/**/*.mp3
<span class="k">do</span>
  <span class="nb">let</span> count++
  <span class="nb">echo</span> <span class="s2">"Playing file no. </span><span class="nv">$count</span><span class="s2">"</span>
  play <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="s2">"Played </span><span class="nv">$count</span><span class="s2"> files"</span>
</pre></div>
</td></tr></table>
<p>This is bash 4 specific.</p>
<h5 id="for-posix">For POSIX</h5>
<p>If you need POSIX compliance, this is a fair approach:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find mydir ! -name <span class="s2">"</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">"*\n*"</span><span class="k">)</span><span class="s2">"</span> -name <span class="s1">'*.mp3'</span> &gt; tmp
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r file
<span class="k">do</span>
  <span class="nb">let</span> count++
  <span class="nb">echo</span> <span class="s2">"Playing file #</span><span class="nv">$count</span><span class="s2">"</span>
  play <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span> &lt; tmp
rm tmp
<span class="nb">echo</span> <span class="s2">"Played </span><span class="nv">$count</span><span class="s2"> files"</span>
</pre></div>
</td></tr></table>
<p>The only problem is for filenames containing line feeds. A <code>! -name "$(printf "*\n*")"</code> has been added to simply skip these files, just in case there are any.</p>
<p>If you don't need variables to be available after the loop (here, if you don't need to print the final play count at the end), you can skip the <code>tmp</code> file and just pipe from <code>find</code> to <code>while</code>.</p>
<h5 id="for-simple-commands-with-no-aggregation">For simple commands with no aggregation</h5>
<p>If you don't need a shell script loop body or any form of variable  like if we only wanted to play the file, we can dramatically simplify while maintaining POSIX compatibility:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Simple and POSIX</span>
find mydir -name <span class="s1">'*.mp3'</span> -exec play <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<p>This does not allow things like <code>let counter++</code> because <code>let</code> is a shell builtin, not an external command.</p>
<h5 id="for-shell-commands-with-no-aggregation">For shell commands with no aggregation</h5>
<p>If we do need a shell script body but no aggregation, you can do the above but invoking <code>sh</code> (this is still POSIX):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find mydir -name <span class="s1">'*.mp3'</span> -exec sh -c <span class="s1">'</span>
<span class="s1">    echo "Playing ${1%.mp3}"</span>
<span class="s1">    play "$1"</span>
<span class="s1">  '</span> sh <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<p>This would not be possible without <code>sh</code>, because <code>${1%.mp3}</code> is a shell construct that <code>find</code> can't evaluate by itself. If we had tried to <code>let counter++</code> in this loop, we would have found that the value never changes.</p>
<p>Note that using <code>+</code> instead of <code>\;</code>, and using an embedded <code>for file in "$@"</code> loop rather than <code>"$1"</code>, will not allow aggregating variables. This is because for large lists, <code>find</code> will invoke the command multiple times, each time with some chunk of the input.</p>
<h3 id="rationale">Rationale:</h3>
<p><code>for var in $(find ...)</code>  loops rely on word splitting and will evaluate globs, which will wreck havoc with filenames containing whitespace or glob characters.</p>
<p><code>find -exec</code> <code>for i in glob</code> and <code>find</code>+<code>while</code> do not rely on word splitting, so they avoid this problem.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you know about and carefully apply <code>IFS=$'\n'</code> and <code>set -f</code>, you could choose to ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2144">Improper use of '-e'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#-e-doesnt-work-with-globs-use-a-for-loop">-e doesn't work with globs. Use a for loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="-e-doesnt-work-with-globs-use-a-for-loop">-e doesn't work with globs. Use a for loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e dir/*.mp3 <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"There are mp3 files."</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in dir/*.mp3
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> -e <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"There are mp3 files"</span>
    <span class="nb">break</span>
  <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ -e file* ]</code> only works if there's 0 or 1 matches. If there are multiple, it becomes <code>[ -e file1 file2 ]</code>, and the test fails.</p>
<p><code>[[ -e file* ]]</code> doesn't work at all.</p>
<p>Instead, use a for loop to expand the glob and check each result individually.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/004">BashFaq: How can I check whether a directory is empty or not? How do I check for any *.mpg files, or count how many there are?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2108">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-91-use-instead-of-a">In [[..]], use &amp;&amp; instead of -a.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="in-91-use-instead-of-a">In [[..]], use &amp;&amp; instead of -a.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> -a -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">&amp;&amp;</span> -z <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>-a</code> for logical AND is not supported in a <code>[[ .. ]]</code> expression. Use <code>&amp;&amp;</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2036">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#if-you-wanted-to-assign-the-output-of-the-pipeline-use-ab-c">If you wanted to assign the output of the pipeline, use a=$(b | c) .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="if-you-wanted-to-assign-the-output-of-the-pipeline-use-ab-c">If you wanted to assign the output of the pipeline, use a=$(b | c) .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">sum</span><span class="o">=</span>find <span class="p">|</span> wc -l
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">sum</span><span class="o">=</span><span class="k">$(</span>find <span class="p">|</span> wc -l<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The intention in this code was that <code>sum</code> would in some way get the value of the command <code>find | wc -l</code>.</p>
<p>However, <code>|</code> has precedence over the <code>=</code>, so the command is a two stage pipeline consisting of <code>sum=find</code> and <code>wc -l</code>.</p>
<p><code>sum=find</code> is a plain string assignment. Since it happens by itself in an independent pipeline stage, it has no effect: it produces no output, and the variable disappears when the pipeline stage finishes. Because the assignment produces no output, <code>wc -l</code> will count 0 lines.</p>
<p>To instead actually assign a variable with the output of a command, command substitution <code>$(..)</code> can be used.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. This warning is triggered whenever the first stage of a pipeline is a single assignment, which is never correct.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2043">Improper loop</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-loop-will-only-ever-run-once-for-a-constant-value-did-you-perhaps-mean-to-loop-over-dir-var-or-cmd">This loop will only ever run once for a constant value. Did you perhaps mean to loop over dir/*, $var or $(cmd)?"</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-loop-will-only-ever-run-once-for-a-constant-value-did-you-perhaps-mean-to-loop-over-dir-var-or-cmd">This loop will only ever run once for a constant value. Did you perhaps mean to loop over dir/*, $var or $(cmd)?"</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> var in value
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Correct code depends on what you want to do.</p>
<p>To iterate over files in a directory, instead of <code>for var in /my/dir</code> use:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> var in /my/dir/* <span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>To iterate over lines in a file or command output, use a while read loop instead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mycommand <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r line<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>To iterate over <em>words</em> written to a command or function's stdout, instead of <code>for var in myfunction</code>, use</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> var in <span class="k">$(</span>myfunction<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<p>To iterate over <em>words</em> in a variable, instead of  <code>for var in myvariable</code>, use</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> var in <span class="nv">$myvariable</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has detected that your for loop iterates over a single, constant value. This is most likely a bug in your code, caused by you not expanding the value in the way you want.</p>
<p>You should make sure that whatever you loop over will expand into multiple words.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2235">Redundant braces</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-instead-of-to-avoid-subshell-overhead">Use { ..; } instead of (..) to avoid subshell overhead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-instead-of-to-avoid-subshell-overhead">Use <code>{ ..; }</code> instead of <code>(..)</code> to avoid subshell overhead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">([</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$y</span><span class="s2">"</span> <span class="o">])</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$z</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">{</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$y</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$z</span><span class="s2">"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be using <code>(..)</code> to group test commands. This creates a subshell, making it unnecessarily slow. Avoid this by using <code>{ ..; }</code> to group.</p>
<p>Be careful to note that unlike <code>(..)</code>, this requires both a space after the <code>{</code> and a semicolon before the <code>}</code>.</p>
<p>For example, <code>(cmd)</code>, <code>(cmd;)</code> and <code>( cmd )</code> are all valid, but <code>{cmd}</code>, <code>{cmd;}</code> and <code>{ cmd }</code> are all syntax errors because they lack either or both of the spaces and semicolon. The correct form is <code>{ cmd; }</code></p>
<p>Here's a small benchmark showing that the subshell version is more than 100x slower:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">for</span> i in <span class="o">{</span><span class="m">1</span>..10000<span class="o">}</span><span class="p">;</span> <span class="k">do</span> <span class="o">([</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$y</span><span class="s2">"</span> <span class="o">])</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$z</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">done</span>
real    0m7.122s
user    0m4.204s
sys     0m2.825s

$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">for</span> i in <span class="o">{</span><span class="m">1</span>..10000<span class="o">}</span><span class="p">;</span> <span class="k">do</span> <span class="o">{</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$y</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$z</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">done</span>
real    0m0.055s
user    0m0.055s
sys     0m0.000s
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2020">Improper 'tr' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#tr-replaces-sets-of-chars-not-words-mentioned-due-to-duplicates">tr replaces sets of chars, not words (mentioned due to duplicates).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="tr-replaces-sets-of-chars-not-words-mentioned-due-to-duplicates">tr replaces sets of chars, not words (mentioned due to duplicates).</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'hello world'</span> <span class="p">|</span> tr <span class="s1">'hello'</span> <span class="s1">'goodbye'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'hello world'</span> <span class="p">|</span> sed -e <span class="s1">'s/hello/goodbye/g'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>tr</code> is for <code>tr</code>ansliteration, turning some characters into other characters. It doesn't match strings or words, only individual characters.</p>
<p>In this case, it transliterates h-&gt;g, e-&gt;o, l-&gt;d, o-&gt;y, resulting in the string "goddb wbrdd" instead of "goodbye world".</p>
<p>The solution is to use a tool that does string search and replace, such as sed.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2086">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#double-quote-to-prevent-globbing-and-word-splitting">Double quote to prevent globbing and word splitting.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="double-quote-to-prevent-globbing-and-word-splitting">Double quote to prevent globbing and word splitting.</h1>
<h2 id="problematic-code">Problematic code:</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="nv">$1</span>
<span class="k">for</span> i in <span class="nv">$*</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span> <span class="c1"># this one and the next one also apply to expanding arrays.</span>
<span class="k">for</span> i in <span class="nv">$@</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h2 id="correct-code">Correct code:</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="k">for</span> i in <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span> <span class="c1"># or, 'for i; do'</span>
</pre></div>
</td></tr></table>
<h2 id="rationale">Rationale</h2>
<p>The first code looks like "print the first argument". It's actually "Split the first argument by IFS (spaces, tabs and line feeds). Expand each of them as if it was a glob. Join all the resulting strings and filenames with spaces. Print the result."</p>
<p>The second one looks like "iterate through all arguments". It's actually "join all the arguments by the first character of IFS (space), split them by IFS and expand each of them as globs, and iterate on the resulting list". The third one skips the joining part.</p>
<p>Quoting variables prevents word splitting and glob expansion, and prevents the script from breaking when input contains spaces, line feeds, glob characters and such.</p>
<p>Strictly speaking, only expansions themselves need to be quoted, but for stylistic reasons, entire arguments with multiple variable and literal parts are often quoted as one:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/<span class="nv">$dir</span>/dist/bin/<span class="nv">$file</span>        <span class="c1"># Unquoted (bad)</span>
<span class="s2">"</span><span class="nv">$HOME</span><span class="s2">"</span>/<span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>/dist/bin/<span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>  <span class="c1"># Minimal quoting (good)</span>
<span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/</span><span class="nv">$dir</span><span class="s2">/dist/bin/</span><span class="nv">$file</span><span class="s2">"</span>      <span class="c1"># Canonical quoting (good)</span>
</pre></div>
</td></tr></table>
<p>When quoting composite arguments, make sure to exclude globs and brace expansions, which lose their special meaning in double quotes: <code>"$HOME/$dir/src/*.c"</code> will not expand, but <code>"$HOME/$dir/src"/*.c</code> will.</p>
<p>Note that <code>$( )</code> starts a new context, and variables in it have to be quoted independently:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"This </span><span class="nv">$variable</span><span class="s2"> is quoted </span><span class="k">$(</span>but this <span class="nv">$variable</span> is not<span class="k">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"This </span><span class="nv">$variable</span><span class="s2"> is quoted </span><span class="k">$(</span>and now this <span class="s2">"</span><span class="nv">$variable</span><span class="s2">"</span> is too<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>Sometimes you want to split on spaces, like when building a command line:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">options</span><span class="o">=</span><span class="s2">"-j 5 -B"</span>
make <span class="nv">$options</span> file
</pre></div>
</td></tr></table>
<p>Just quoting this doesn't work. Instead, you should have used an array (bash, ksh, zsh):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">options</span><span class="o">=(</span>-j <span class="m">5</span> -B<span class="o">)</span> <span class="c1"># ksh: set -A options -- -j 5 -B</span>
make <span class="s2">"</span><span class="si">${</span><span class="nv">options</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> file
</pre></div>
</td></tr></table>
<p>or a function (POSIX):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make_with_flags<span class="o">()</span> <span class="o">{</span> make -j <span class="m">5</span> -B <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
make_with_flags file
</pre></div>
</td></tr></table>
<p>To split on spaces but not perform glob expansion, Posix has a <code>set -f</code> to disable globbing.  You can disable word splitting by setting <code>IFS=''</code>.</p>
<p>Similarly, you might want an optional argument:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">debug</span><span class="o">=</span><span class="s2">""</span>
<span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"--trace-commands"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">"-x"</span>
bash <span class="nv">$debug</span> script
</pre></div>
</td></tr></table>
<p>Quoting this doesn't work, since in the default case, <code>"$debug"</code> would expand to one empty argument while <code>$debug</code> would expand into zero arguments. In this case, you can use an array with zero or one elements as outlined above, or you can use an unquoted expansion with an alternate value:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">debug</span><span class="o">=</span><span class="s2">""</span>
<span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"--trace-commands"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">"yes"</span>
bash <span class="si">${</span><span class="nv">debug</span><span class="p">:+</span><span class="s2">"-x"</span><span class="si">}</span> script
</pre></div>
</td></tr></table>
<p>This is better than an unquoted value because the alternative value can be properly quoted, e.g. <code>wget ${output:+ -o "$output"}</code>.</p>
<hr/>
<p>Here are two common cases where this warning seems unnecessary but may still be beneficial:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cmd <span class="o">&lt;&lt;&lt;</span> <span class="nv">$var</span>         <span class="c1"># Requires quoting on Bash 3 (but not 4+)</span>
: <span class="si">${</span><span class="nv">var</span><span class="p">=default</span><span class="si">}</span>     <span class="c1"># Should be quoted to avoid DoS when var='*/*/*/*/*/*'</span>
</pre></div>
</td></tr></table>
<hr/>
<p>As always, this warning can be [[ignored|ignore]] on a case-by-case basis.</p>
<p>This is especially relevant when BASH may not be available for the array work around.
For example, use in eval or in command options where script has total control of the variables...</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">FLAGS</span><span class="o">=</span><span class="s2">"-av -e 'ssh -x' --delete --delete-excluded"</span>
...
<span class="c1"># shellcheck disable=SC2086</span>
<span class="nb">eval</span> rsync <span class="nv">$FLAGS</span> ~/dir remote_host:dir
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2233">Redundant braces</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-superfluous-around-condition">Remove superfluous (..) around condition.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-superfluous-around-condition">Remove superfluous <code>(..)</code> around condition.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">([</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> -gt <span class="m">0</span> <span class="o">])</span>
<span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$x</span><span class="s2">"</span> -gt <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The shell syntax is <code>if cmd</code>, <code>elif cmd</code>, <code>while cmd</code> and <code>until cmd</code> without any parentheses. Instead, parentheses are an independent construct used to create subshells.</p>
<p>ShellCheck has noticed that you're wrapping <code>(..)</code> around one or more test commands. This is unnecessary, and the resulting fork adds quite a lot of overhead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">while</span> <span class="o">(</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> -lt <span class="m">10000</span> <span class="o">]</span> <span class="o">)</span><span class="p">;</span> <span class="k">do</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">;</span> <span class="k">done</span>
real    0m6.998s
user    0m3.453s
sys     0m3.464s

$ <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nb">time</span> <span class="k">while</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> -lt <span class="m">10000</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">;</span> <span class="k">done</span>
real    0m0.055s
user    0m0.054s
sys     0m0.001s
</pre></div>
</td></tr></table>
<p>Just delete the surrounding <code>(..)</code> since they serve no purpose and only slows the script down.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1101">Redundant space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#delete-trailing-spaces-after-to-break-line-or-use-quotes-for-literal-space">Delete trailing spaces after \ to break line (or use quotes for literal space).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="delete-trailing-spaces-after-to-break-line-or-use-quotes-for-literal-space">Delete trailing spaces after \ to break line (or use quotes for literal space).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># There are spaces after the backslash:</span>
<span class="nb">echo</span> hello <span class="se">\ </span> 
     world
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># No spaces after the backslash:</span>
<span class="nb">echo</span> hello <span class="se">\</span>
     world
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>To break a line you can use <code>\</code> before the line break. However, if there are spaces after the backslash, the escape will apply to them instead of the line break, and the command will not continue on the next line.</p>
<p>Delete the trailing spaces to make the line break work correctly.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want a literal escaped space at the end of a line you can ignore this error, but please reconsider and use quotes instead. Trailing whitespace is invisible and frequently stripped on purpose (by editor settings / precommits) or accident (copy-paste), and so should not be relied upon for correctness.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2081">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#cant-match-globs-use-or-grep">[ .. ] can't match globs. Use [[ .. ]] or grep.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="cant-match-globs-use-or-grep"><code>[ .. ]</code> can't match globs. Use <code>[[ .. ]]</code> or grep.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="nv">$var</span> <span class="o">==</span> *<span class="o">[</span>^0-9<span class="o">]</span>* <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2"> is not numeric"</span>
<span class="k">fi</span> 
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">==</span> *<span class="o">[</span>^0-9<span class="o">]</span>* <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2"> is not numeric"</span>
<span class="k">fi</span> 
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ .. ]</code> aka <code>test</code> can not match against globs. </p>
<p>In bash/ksh, you can instead use <code>[[ .. ]]</code> which supports this behavior.</p>
<p>In sh, you can rewrite to use <code>grep</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you are not trying to match a glob, quote the argument (e.g. <code>[ $var == '*' ]</code> to match literal asterisk. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1018">Unicode non-breaking space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-non-breaking-space-delete-it-and-retype-as-space">This is a unicode non-breaking space. Delete it and retype as space.</a></li>
</ul>
</div>

            <div>
                
<h1 id="this-is-a-unicode-non-breaking-space-delete-it-and-retype-as-space">This is a unicode non-breaking space. Delete it and retype as space.</h1>
<p>You copy-pasted some code, probably from a blog or web site, which for formatting reasons contained unicode no-break spaces or unicode zero-width spaces instead of regular spaces or in words.</p>
<p>To humans, a zero-width space is invisible and a non-breaking space is indistinguishable from a regular space, but the shell does not agree.</p>
<p>If you have just a few, delete the indiciated space/word and retype it. If you have tons, do a search&amp;replace in your editor (copy-paste an offending space into the search field, and type a regular space into the replace field), or use <code>sed -e $'s/\xC2\xA0/ /g' -e $'s/\xE2\x80\x8b//g' -i yourfile</code> to remove them.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1110">Using unicode quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-quote-delete-and-retype-it-or-quote-to-make-literal">This is a unicode quote. Delete and retype it (or quote to make literal).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-quote-delete-and-retype-it-or-quote-to-make-literal">This is a unicode quote. Delete and retype it (or quote to make literal).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> ‘hello world’
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'hello world'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Some software, like OS X, Word and WordPress, may automatically replace your regular quotes with slanted Unicode quotes. Try deleting and retyping them, and/or disable “smart quotes” in your editor or OS.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to use typographic single quotes, you can put them in double quotes (or typographic double quotes in single quotes) to make shellcheck ignore them, e.g.,</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Warning: ‘wakeonlan’ is not installed.\n"</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2221">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-pattern-always-overrides-a-later-one">This pattern always overrides a later one.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-pattern-always-overrides-a-later-one">This pattern always overrides a later one.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  -?<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [-n]"</span><span class="p">;;</span>
  -n<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Hello World"</span><span class="p">;;</span>
   *<span class="o">)</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  -<span class="se">\?</span><span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [-n]"</span><span class="p">;;</span>
<span class="c1"># '-?') echo "Usage: $0 [-n]";;  # Also valid</span>
  -n<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Hello World"</span><span class="p">;;</span>
   *<span class="o">)</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have specified multiple patterns in a <code>case</code> statement, where one will always override the other. The pattern being overridden is indicated with a [[SC2222]] warning.</p>
<p>In the example, <code>-?</code> actually matches a dash followed by any character, such as <code>-n</code>. This means that the later <code>-n</code> branch will never trigger. In this case, the correct solution is to escape the <code>-\?</code> so that it doesn't match <code>-n</code>. </p>
<p>Another common reason for this is accidentally duplicating a branch. In this case, fix or delete the duplicate branch.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. One could argue that having <code>-*|--*) echo "Invalid flag";</code> is a readability issue, even though the second pattern follows from the first. In this case, you can either rearrange the pattern from most to least specific, i.e. <code>--*|-*)</code> or ignore the error.</p>
<p>When ignoring this error, remember that ShellCheck directives have to go in front of the <code>case</code> statement, and not in front of the branch:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span># shellcheck disable=SC2221,SC2222
case "$1" in
  -n) ...;;
  # no directive here
  -*|--*) echo "Unknown flag" ;;
esac
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2151">Improper return value</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#only-one-integer-0-255-can-be-returned-use-stdout-for-other-data">Only one integer 0-255 can be returned. Use stdout for other data.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="only-one-integer-0-255-can-be-returned-use-stdout-for-other-data">Only one integer 0-255 can be returned. Use stdout for other data.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>myfunc<span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> foo bar
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>myfunc<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> foo
  <span class="nb">echo</span> bar
  <span class="k">return</span> <span class="m">0</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In bash, <code>return</code> can only be used to signal success or failure (0 = success, 1-255 = failure).</p>
<p>To return textual or multiple values from a function, write them to stdout and capture them with command substitution instead.</p>
<p>See [[SC2152]] for more information.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2208">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-or-quote-arguments-to-v-to-avoid-glob-expansion">Use [[ ]] or quote arguments to -v to avoid glob expansion.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-or-quote-arguments-to-v-to-avoid-glob-expansion">Use <code>[[ ]]</code> or quote arguments to -v to avoid glob expansion.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -v foo<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">]</span> 
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -v <span class="s1">'foo[0]'</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>With <code>[</code>, arguments will undergo glob expansion. If a file <code>foo0</code> exists when the problematic code is run, it will check for the variable <code>foo0</code> instead of the array entry <code>foo[0]</code>. If there additionally exists a <code>foo1</code>, it will simply fail with an error.</p>
<p>Use <code>[[ ]]</code> or quote the argument.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2148">Missing shebang line</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>


            <div>
                <p>[TOC]
Add a shebang line to the top of your script:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
</pre></div>
</td></tr></table>

<p>Or, for scripts that will not be executed (<em>e.g.</em>, <code>~/.bashrc</code>), use a directive:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck shell=sh</span>
</pre></div>
</td></tr></table>

<p>If neither of those options are possible or desirable, you can invoke ShellCheck with the <code>--shell</code> switch:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>shellcheck --shell<span class="o">=</span>bash without-shebang.sh
</pre></div>
</td></tr></table>

<p>See <code>shellcheck --help</code> for a list of supported flavors.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2236">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-n-instead-of-z">Use -n instead of ! -z.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-n-instead-of-z">Use <code>-n</code> instead of <code>! -z</code>.</h2>
<p>(or "Use <code>-z</code> instead of <code>! -n</code>")</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"JAVA_HOME not specified"</span><span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> ! -z <span class="s2">"</span><span class="nv">$STY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>       <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"You are already running screen"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"JAVA_HOME not specified"</span><span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$STY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>       <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"You are already running screen"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have negated <code>test -z</code> or <code>test -n</code>, resulting in a needless double-negative. You can just use the other operator instead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Identical tests to verify that a value is assigned
[ ! -z foo ] # Not has no value
[ -n foo ]   # Has value

# Identical tests to verify that a value is empty
[ ! -n foo ] # Not is non-empty
[ -z foo ]   # Is empty
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>This is a stylistic issue that does not affect correctness. If you prefer the original expression, you can [[Ignore]] it with a directive or flag.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html#Bash-Conditional-Expressions">Bash reference manual for -z and -n</a>.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1121">Improper ;/& terminators</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#add-terminators-and-other-syntax-on-the-line-with-the-not-here">Add ;/&amp; terminators (and other syntax) on the line with the &lt;&lt;, not here.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="add-terminators-and-other-syntax-on-the-line-with-the-not-here">Add ;/&amp; terminators (and other syntax) on the line with the &lt;&lt;, not here.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo bash -s &lt;&lt; <span class="s2">"END"</span>
  cmd1
  cmd2
END <span class="p">&amp;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo bash -s &lt;&lt; <span class="s2">"END"</span> <span class="p">&amp;</span>
  cmd1
  cmd2
END
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using <code>&amp;</code>, <code>;</code>, <code>&amp;&gt;</code> or similar after a here document. This is not allowed.</p>
<p>This should instead be part of the line that initiated the here document, i.e. the one with the <code>&lt;&lt;</code>. </p>
<p>If it helps, look at <code>&lt;&lt; "END"</code> as if it was <code>&lt; file</code>, and make sure the resulting command is valid. This is what the shell does. You can then append here document data after the command.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2246">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-shebang-specifies-a-directory-ensure-the-interpreter-is-a-file">This shebang specifies a directory. Ensure the interpreter is a file.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-shebang-specifies-a-directory-ensure-the-interpreter-is-a-file">This shebang specifies a directory. Ensure the interpreter is a file.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh/</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The shebang specifies which file to use as an interpreter, but probably due to some kind of typo, your script's interpreter ends in a <code>/</code>, indicating a directory.</p>
<p>Ensure it points to a valid executable filename.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1042">eof' not in a separate line</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>


            <div>
                <p>[TOC]
    Found 'eof' further down, but not on a separate line.
    Close matches include '-eof' (!= 'eof').</p>
<p>See companion error [[SC1041]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2170">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#numerical-eq-does-not-dereference-in-expand-or-use-string-operator">Numerical -eq does not dereference in [..]. Expand or use string operator.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="numerical-eq-does-not-dereference-in-expand-or-use-string-operator">Numerical -eq does not dereference in [..]. Expand or use string operator.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> -r n
<span class="k">if</span> <span class="o">[</span> n -lt <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
   <span class="nb">echo</span> <span class="s2">"bad input"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> -r n
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> -lt <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
   <span class="nb">echo</span> <span class="s2">"bad input"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are comparing a string value with a numerical operator, such as <code>-eq</code>, <code>-ne</code>, <code>-lt</code> or <code>-gt</code>.</p>
<p>In <code>[[ .. ]]</code>, this would automatically dereference the string, looking to see if there are variables by that name.</p>
<p>In <code>[ .. ]</code>, which you are using, the string is just treated as an invalid number.</p>
<p>If you want to compare numbers, expand yourself (e.g. use <code>$var</code> instead of <code>var</code>). If you are trying to compare strings and not numbers, use <code>=</code>, <code>!=</code> <code>\&lt;</code> or <code>\&gt;</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2093">Improper use of "exec "</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-exec-if-script-should-continue-after-this-command">Remove "exec " if script should continue after this command.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-exec-if-script-should-continue-after-this-command">Remove "exec " if script should continue after this command.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Starting compilation"</span>
<span class="nb">exec</span> ./compile
<span class="nb">echo</span> <span class="s2">"Starting deployment"</span>
<span class="nb">exec</span> ./deploy
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Starting compilation"</span>
./compile
<span class="nb">echo</span> <span class="s2">"Starting deployment"</span>
./deploy
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script contains an <code>exec</code> command followed by other commands in the same block. This is likely an error because the script will not resume after an <code>exec</code> command.</p>
<p>Instead, "exec" refers to the Unix process model's idea of execution (see <a href="http://man7.org/linux/man-pages/man2/execve.2.html"><code>execve(2)</code></a>), in which the current process stops its current program and replaces it with a new one. This is mainly used in wrapper scripts.</p>
<p>To execute another script or program and then continue, simply drop the <code>exec</code> as in the example.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the code after the <code>exec</code> is only there to handle a failure in executing the command you can ignore this warning. For this reason, ShellCheck suppresses the warning if <code>exec</code> is only followed by <code>echo</code>/<code>exit</code> commands.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>StackOverflow: <a href="https://stackoverflow.com/questions/3877657/my-shell-script-stops-after-exec">My shell script stops after exec</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2125">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#brace-expansions-and-globs-are-literal-in-assignments-quote-it-or-use-an-array">Brace expansions and globs are literal in assignments. Quote it or use an array.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="brace-expansions-and-globs-are-literal-in-assignments-quote-it-or-use-an-array">Brace expansions and globs are literal in assignments. Quote it or use an array.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">={</span><span class="m">1</span>..9<span class="o">}</span>
<span class="nb">echo</span> <span class="nv">$foo</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=(</span> <span class="o">{</span><span class="m">1</span>..9<span class="o">}</span> <span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>echo *.png {1..9}</code> expands to all png files and numbers from 1 to 9, but <code>var=*.png</code> or <code>var={1..9}</code> will just assign the literal strings <code>'*.png'</code> and <code>'{1..9}'</code>.</p>
<p>To make the variable contain all png files or 1 through 9, use an array as demonstrated.</p>
<p>If you intended to assign these values as literals, quote them (e.g. <code>var="*.png"</code>).</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1039">Bad indent</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-indentation-before-end-token-or-use-and-indent-with-tabs">Remove indentation before end token (or use &lt;&lt;- and indent with tabs).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-indentation-before-end-token-or-use-and-indent-with-tabs">Remove indentation before end token (or use <code>&lt;&lt;-</code> and indent with tabs).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in *.png
<span class="k">do</span>
  cat <span class="s">&lt;&lt; EOF</span>
<span class="s">     &lt;img src="$f" /&gt;&lt;br/&gt;</span>
<span class="s">  EOF</span>
<span class="k">done</span> &gt; index.html
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in *.png
<span class="k">do</span>
  cat <span class="s">&lt;&lt; EOF</span>
<span class="s">     &lt;img src="$f" /&gt;&lt;br/&gt;</span>
<span class="s">EOF</span>
<span class="k">done</span> &gt; index.html
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The here document delimiter will not be recognized if it is indented.</p>
<p>You can fix it in one of two ways:</p>
<ol>
<li>Simply remove the indentation, even though this may break formatting.</li>
<li>Use <code>&lt;&lt;-</code> instead of <code>&lt;&lt;</code>, and indent the script with tabs only (spaces will not be recognized).</li>
</ol>
<p>Removing the indentation is preferred, since the script won't suddenly break if it's reformatted, copy-pasted, or saved with a different editor.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the line was supposed to be a literal part of the here document, consider choosing a less ambiguous token.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2239">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#ensure-the-shebang-uses-the-absolute-path-to-the-interpreter">Ensure the shebang uses the absolute path to the interpreter.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="ensure-the-shebang-uses-the-absolute-path-to-the-interpreter">Ensure the shebang uses the absolute path to the interpreter.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The script's interpreter, as specified in the shebang, does not start with a <code>/</code>.</p>
<p>The interpreter should always be specified by absolute path to ensure that the script can be executed from any directory. When it's not, it's generally a typo like in the problematic example.</p>
<p>If you don't know where the interpreter is and you hoped to use <code>#! bash</code>, this is not an option. Use <code>/usr/bin/env</code> instead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="nb">echo</span> <span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<p>While not required by POSIX, <code>env</code> can essentially always be found in <code>/usr/bin</code> and will search the PATH for the specified executable.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1014">Missing checking of output</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-if-cmd-then-to-check-exit-code-or-if-cmd-to-check-output">Use 'if cmd; then ..' to check exit code, or 'if [ "$(cmd)" = .. ]' to check output.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-if-cmd-then-to-check-exit-code-or-if-cmd-to-check-output">Use 'if cmd; then ..' to check exit code, or 'if [ "$(cmd)" = .. ]' to check output.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> grep -q pattern file <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Found a match"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> grep -q pattern file
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Found a match"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ .. ]</code> is not part of shell syntax like <code>if</code> statements. It is not equivalent to parentheses in C-like languages, <code>if (foo) { bar; }</code>, and should not be wrapped around commands to test. </p>
<p><code>[</code> is just regular command, like <code>whoami</code> or <code>grep</code>, but with a funny name (see <code>ls -l /bin/[</code>). It's a shorthand for <code>test</code>. </p>
<p>If you want to check the exit status of a certain command, use that command directly as demonstrated in the correct code.</p>
<p>If you want to check the output of a command, use <code>"$(..)"</code> to get its output, and then use <code>test</code> or  <code>[</code>/<code>[[</code> to do a string comparison:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Check output of `whoami` against the string `root`
if [ "$(whoami)" = "root" ]
then
  echo "Running as root"
fi
</pre></div>
</td></tr></table>
<p>For more information, see <a href="http://mywiki.wooledge.org/BashPitfalls#if_.5Bgrep_foo_myfile.5D">this problem in the Bash Pitfall</a> list, or generally <a href="http://mywiki.wooledge.org/BashGuide/TestsAndConditionals">Tests and Conditionals</a> in the WoolEdge BashGuide </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/2480584/how-do-i-use-a-file-grep-comparison-inside-a-bash-if-else-statement">How do I use a file grep comparison inside a bash if/else statement?</a></li>
<li>Bash Pitfalls: <a href="https://mywiki.wooledge.org/BashPitfalls#if_.5Bgrep_foo_myfile.5D"> if [grep foo myfile] </a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1083">Improper string value</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-literal-check-expression-missing-n-or-quote-it">This {/} is literal. Check expression (missing ;/\n?) or quote it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-literal-check-expression-missing-n-or-quote-it">This <code>{</code>/<code>}</code> is literal. Check expression (missing <code>;/\n?</code>) or quote it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rmf<span class="o">()</span> <span class="o">{</span> rm -f <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\$</span><span class="o">{</span>foo<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rmf<span class="o">()</span> <span class="o">{</span> rm -f <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<p>and</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="s2">"echo \${foo}"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Curly brackets are normally used as syntax in parameter expansion, command grouping and brace expansion.</p>
<p>However, if they don't appear alone at the start of an expression or as part of a parameter or brace expansion, the shell silently treats them as literals. This frequently indicates a bug, so ShellCheck warns about it.</p>
<p>In the example function, the <code>}</code> is literal because it's not at the start of an expression. We fix it by adding a <code>;</code> before it.</p>
<p>In the example eval, the code works fine. However, we can quiet the warning and follow good practice by adding quotes around the literal data.</p>
<p>ShellCheck does not warn about <code>{}</code>, since this is frequently used with <code>find</code> and rarely indicates a bug.</p>
<h3 id="exceptions">Exceptions</h3>
<p>This error is harmless when the curly brackets are supposed to be literal, in e.g. <code>awk {'print $1'}</code>. However, it's cleaner and less error prone to simply include them inside the quotes: <code>awk '{print $1}'</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2240">Improper using of dot</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-dot-command-does-not-support-arguments-in-shdash-set-them-as-variables">The dot command does not support arguments in sh/dash. Set them as variables.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-dot-command-does-not-support-arguments-in-shdash-set-them-as-variables">The dot command does not support arguments in sh/dash. Set them as variables.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
. include/myscript example.com <span class="m">80</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nv">host</span><span class="o">=</span>example.com <span class="nv">port</span><span class="o">=</span><span class="m">80</span> . include/myscript 
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In Bash and Ksh, you can use <code>. myscript arg1 arg2..</code> to set <code>$1</code> and <code>$2</code> in the sourced script.</p>
<p>This is not the case in Dash, where any additional arguments are ignored, or in POSIX sh where the behavior is unspecified.</p>
<p>Instead, assign arguments to variables and rewrite the sourced script to read from them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2190">Improper array operations</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#elements-in-associative-arrays-need-index-eg-array-indexvalue">Elements in associative arrays need index, e.g. array=( [index]=value ) .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="elements-in-associative-arrays-need-index-eg-array-indexvalue">Elements in associative arrays need index, e.g. array=( [index]=value ) .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">declare</span> -A foo
<span class="nv">foo</span><span class="o">=(</span> myvalue <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">declare</span> -A foo
<span class="nv">foo</span><span class="o">=(</span> <span class="o">[</span>key<span class="o">]=</span>myvalue <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be initializing or appending an array element to an associative array without giving it an index. In an indexed array, elements will be auto-indexed by incremented characters. In associative arrays, the index must be given explicitly.</p>
<p>This could happen because of invalid spaces or otherwise malformed index assignment, such as <code>array=( [key] = value )</code>. This should instead be <code>array=( [key]=value )</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck may be confused when a variable name is reused in different contexts. If shellcheck mistakenly believes the array is associated, please [[ignore]] this error. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2091">Improper executing output</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-surrounding-to-avoid-executing-output">Remove surrounding $() to avoid executing output.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-surrounding-to-avoid-executing-output">Remove surrounding $() to avoid executing output.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="k">$(</span>which epstopdf<span class="k">)</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Found epstopdf"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> which epstopdf
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Found epstopdf"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has detected that you have a command that just consists of a command substitution.</p>
<p>This is typically done in order to try to get the shell to execute a command, because <code>$(..)</code> does indeed execute commands. However, it's also replaced by the output of that command.</p>
<p>When you run <code>echo "The date is $(date +%F)"</code>, bash evalutes the <code>$(..)</code>. The command then becomes <code>echo "The date is 2015-04-29"</code>, which writes out the string <code>The date is 2015-04-29</code></p>
<p>The problem is when you use <code>$(date +%F)</code> alone as a command. Bash evaluates the <code>$(..)</code>, and the command then becomes <code>2015-04-29</code>. There is no command called <code>2015-04-29</code>, so you get <code>bash: 2015-04-29: command not found</code>.</p>
<p>Sometimes this results in this confounding <code>command not found</code> messages. Other times you get even stranger issues, like the example problematic code which always evaluates to false.</p>
<p>The solution is simply to remove the surrounding <code>$()</code>. This will execute the command instead of the command's output.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you really want to execute the output of a command rather than the command itself, you can ignore this message or assign the output to a new variable first:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">readonly</span> <span class="nv">command_to_execute</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>print_the_command<span class="k">)</span><span class="s2">"</span>
<span class="nv">$command_to_execute</span>
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>StackOverflow: <a href="https://stackoverflow.com/questions/18611842/bash-function-command-not-found">Bash Function -&gt; Command not found</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2175">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-this-invalid-brace-expansion-since-it-should-be-passed-literally-to-eval">Quote this invalid brace expansion since it should be passed literally to eval</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-this-invalid-brace-expansion-since-it-should-be-passed-literally-to-eval">Quote this invalid brace expansion since it should be passed literally to eval</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="nb">echo</span> <span class="o">{</span><span class="m">1</span>..<span class="nv">$n</span><span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="s2">"echo {1..</span><span class="nv">$n</span><span class="s2">}"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Using <code>eval somecommand {1..$n}</code> depends both on bash silently failing to interpret the brace expansion, and on it passing failing brace expansions literally. </p>
<p>Rather than depending on these questionable features (which already behave differently in other shells), use the explicit, predictable way of passing values literally: quoting.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1102">Improper '$(('</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shells-disambiguate-differently-or-not-at-all-for-command-substition-add-space-after-for-arithmetics-fix-parsing-errors">Shells disambiguate $(( differently or not at all. For $(command substition), add space after $( . For $((arithmetics)), fix parsing errors.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="shells-disambiguate-differently-or-not-at-all-for-command-substition-add-space-after-for-arithmetics-fix-parsing-errors">Shells disambiguate <code>$((</code> differently or not at all. For <code>$(command substition)</code>, add space after <code>$(</code> . For <code>$((arithmetics))</code>, fix parsing errors.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="k">$((</span>cmd <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="o">)</span> <span class="m">2</span>&gt;<span class="o">&amp;</span><span class="m">1</span><span class="o">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span> <span class="o">(</span>cmd <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="k">)</span><span class="s2"> 2&gt;&amp;1)"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be using <code>$((</code> with two (or more) parentheses in a row, where the first <code>$(</code> should open a subshell. </p>
<p>This is an ill-defined structure that is parsed differently between different shells and shell versions. Prefer adding spaces to make it unambiguous, both to shells and humans.</p>
<p>Consider the <code>$(((</code> in <code>$(((1)) )</code>:</p>
<p>Ash, dash and Bash 1 parses it as <code>$(( (</code> and subsequently fail to find the matching <code>))</code>. Zsh and Bash 2+ looks ahead and parses it as <code>$( ((</code>. Ksh parses it as <code>$( ( (</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p><strong>Alternatively</strong>, you may indeed have correctly spaced your parentheses, but ShellCheck failed to parse <code>$((</code> as an arithmetic expression while accidentally succeeding in parsing it as <code>$(</code> + <code>(</code>. </p>
<p>In these cases, double check the syntax to ensure ShellCheck can parse the <code>$((</code>, or ignore this error and hope that it won't affect analysis too severely. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2027">Improper quote usage</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-surrounding-quotes-actually-unquote-this-remove-or-escape-them">The surrounding quotes actually unquote this. Remove or escape them.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-surrounding-quotes-actually-unquote-this-remove-or-escape-them">The surrounding quotes actually unquote this. Remove or escape them.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"You enter "</span><span class="nv">$HOSTNAME</span><span class="s2">". You can smell the wumpus."</span> &gt;&gt; /etc/issue
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"You enter </span><span class="nv">$HOSTNAME</span><span class="s2">. You can smell the wumpus."</span> &gt;&gt; /etc/issue
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Always quoting variables and command expansions is good practice, but blindly putting quotes left and right of them is not.</p>
<p>In this case, ShellCheck has noticed that the quotes around the expansion are unquoting it, because the left quote is terminating an existing double quoted string, while the right quote starts a new one:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"You enter "</span><span class="nv">$HOSTNAME</span><span class="s2">". You can smell the wumpus."</span>
     <span class="p">|</span>----------<span class="p">|</span>         <span class="p">|</span>---------------------------<span class="p">|</span>
        Quoted   No quotes           Quoted
</pre></div>
</td></tr></table>
<p>If the quotes were supposed to be literal, they should be escaped. If the quotes were supposed to quote an expansion (as in the example), they should be removed because this is already a double quoted string.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2019">Missing '[:upper:]' for non-english charactors</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-upper-to-support-accents-and-foreign-alphabets">Use '[:upper:]' to support accents and foreign alphabets.</a></li>
</ul>
</div>

            <div>
                
<h2 id="use-upper-to-support-accents-and-foreign-alphabets">Use '[:upper:]' to support accents and foreign alphabets.</h2>
<p>See the equivalent warning for lowercase matching: [[SC2018]]</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2229">Misuse of '$/${}'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-does-not-read-foo-remove-for-that-or-use-var-to-quiet">This does not read 'foo'. Remove $/${} for that, or use ${var?} to quiet.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-does-not-read-foo-remove-for-that-or-use-var-to-quiet">This does not read 'foo'. Remove $/${} for that, or use ${var?} to quiet.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> <span class="nv">$foo</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>read</code> takes a variable name, but shellcheck has noticed that you give it an expanded variable instead. This will populate whatever the variable expans to instead of the variable itself. For example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo=bar
read $foo   # Reads data into 'bar', not into 'foo'
read foo    # Reads data into 'foo'
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>If this is intentional and you do want to read a variable through an indirect reference, you can silence this warning with a directive:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck disable=SC2229</span>
<span class="nb">read</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>Or take advantage of the fact that ShellCheck only warns when no parameter expansion modifiers are applied:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">read</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="si">}</span><span class="s2">"</span>    <span class="c1"># ShellCheck warns</span>
<span class="nb">read</span> <span class="s2">"</span><span class="si">${</span><span class="nv">foo</span><span class="p">?</span><span class="si">}</span><span class="s2">"</span>   <span class="c1"># No warning</span>
</pre></div>
</td></tr></table>
<p><code>${foo?}</code> fails when <code>foo</code> is unset, which is fine since <code>read</code> would have failed too. The main side effect is an improved runtime error message in that case.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf12">Bash Pitfalls #12</a>: <code>read $foo</code></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2078">Constant expression result</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-expression-is-constant-did-you-forget-a-somewhere">This expression is constant. Did you forget a $ somewhere?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-expression-is-constant-did-you-forget-a-somewhere">This expression is constant. Did you forget a <code>$</code> somewhere?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"myvar"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"myvar is set"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$myvar</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"myvar is set"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a <code>[ .. ]</code> or <code>[[ .. ]]</code> statement that just contains a literal string. Such a check does not do anything useful, and will always be true (or always false, for empty strings).</p>
<p>This is usually due to missing <code>$</code> or bad quoting:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>if [[ STY ]             # always true
if [[ $STY ]]           # checks variable $STY

if [[ 'grep foo bar' ]] # always true
if [[ `grep foo bar` ]] # checks grep output (poorly)
if grep -q foo bar      # checks for grep match (preferred)
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2225">Improper 'cp' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-cp-has-no-destination-check-the-arguments">This cp has no destination. Check the arguments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-cp-has-no-destination-check-the-arguments">This cp has no destination. Check the arguments.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="s2">"</span><span class="nv">$file</span><span class="s2"> </span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a <code>cp</code> command with a single parameter. This may be because the source and destination was accidentally merged into a single argument, or because the line was broken in an invalid way.</p>
<p>Fix the <code>cp</code> statement by correctly specifying both source and destination.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1088">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#parsing-stopped-here-invalid-use-of-parentheses">Parsing stopped here. Invalid use of parentheses?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="parsing-stopped-here-invalid-use-of-parentheses">Parsing stopped here. Invalid use of parentheses?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep ^<span class="o">(</span>.*<span class="o">)</span><span class="se">\1</span>$ file
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span> <span class="o">=</span> myfunction<span class="o">(</span>value<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep <span class="s1">'^(.*)\1$'</span> file
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="k">$(</span>myfunction value<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Parentheses are shell syntax and must be used correctly.</p>
<p>For commands that expect literal parentheses, such as <code>grep</code> or <code>find</code>, the parentheses need to be quoted or escaped so the shell does not interpret them, but instead passes them to the command.</p>
<p>For shell syntax, the shell does not use them the way most other languages do, so avoid guessing at syntax based on previous experience. In particular:</p>
<ul>
<li>Parentheses are NOT used to call functions.</li>
<li>Parentheses are NOT used to group expressions, except in arithmetic contexts.</li>
<li>Parentheses are NOT used in conditional statements or loops.</li>
<li>Parentheses are used differently in different contexts. <code>( .. )</code>, <code>$( .. )</code>, <code>$(( .. ))</code> and <code>var=(..)</code> are completely separate and independent structures with different meanings, and can not be broken down into operations on expressions in parentheses.</li>
</ul>
<p>In C-like languages, <code>++</code> can't be broken down into two <code>+</code> operations, so you can't e.g. use <code>+ +</code> or <code>+(+)</code>. In the same way, all of the above are completely unrelated so that you can't do <code>$(1+1)</code> or <code>$( (1+1) )</code> in place of <code>$(( 1+1 ))</code>.</p>
<p>If you are trying to use parentheses for shell syntax, look up the actual syntax of the statement you are trying to use.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1089">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#parsing-stopped-here-is-this-keyword-correctly-matched-up">Parsing stopped here. Is this keyword correctly matched up?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="parsing-stopped-here-is-this-keyword-correctly-matched-up">Parsing stopped here. Is this keyword correctly matched up?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> hello
<span class="k">fi</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> hello
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This error is typically seen when there are too many <code>fi</code>, <code>done</code> or <code>esac</code>s, or when there's a <code>do</code> or <code>then</code> without a corresponding <code>while</code>, <code>for</code> or <code>if</code>. This is often due to deleting a loop or conditional statement but not its terminator.</p>
<p>In some cases, it can even be caused by bad quoting:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s2">"foo</span>
<span class="s2">if [[ </span><span class="nv">$var</span><span class="s2"> = "</span>bar <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="nb">true</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>In this case, the <code>if</code> ends up inside the double quotes, leaving the <code>then</code> dangling.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2002">Redundant 'cat' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#useless-cat-consider-cmd-file-or-cmd-file-instead">Useless cat. Consider 'cmd &lt; file | ..' or 'cmd file | ..' instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="useless-cat-consider-cmd-file-or-cmd-file-instead">Useless cat. Consider 'cmd &lt; file | ..' or 'cmd file | ..' instead.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat file <span class="p">|</span> tr <span class="s1">' '</span> _ <span class="p">|</span> nl
cat file <span class="p">|</span> <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r i<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">i</span><span class="p">%?</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt; file tr <span class="s1">' '</span> _ <span class="p">|</span> nl  
<span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r i<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">i</span><span class="p">%?</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span> &lt; file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>cat</code> is a tool for con"cat"enating files. Reading a single file as input to a program is considered a <a href="http://en.wikipedia.org/wiki/Cat_(Unix)#Useless_use_of_cat">Useless Use Of Cat (UUOC)</a>.</p>
<p>It's more efficient and less roundabout to simply use redirection. This is especially true for programs that can benefit from seekable input, like <code>tail</code> or <code>tar</code>.</p>
<p>Many tools also accept optional filenames, e.g. <code>grep -q foo file</code> instead of <code>cat file | grep -q foo</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Pointing out UUOC is a long standing shell programming tradition, and removing them from a short-lived pipeline in a loop can speed it up by 2x. However, it's not necessarily a good use of time in practice, and rarely affects correctness. [[Ignore]] as you see fit.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2227">Improper 'find' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#redirection-applies-to-the-find-command-itself-rewrite-to-work-per-action-or-move-to-end">Redirection applies to the find command itself. Rewrite to work per action (or move to end).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="redirection-applies-to-the-find-command-itself-rewrite-to-work-per-action-or-move-to-end">Redirection applies to the find command itself. Rewrite to work per action (or move to end).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.ppm'</span> -exec pnmtopng <span class="o">{}</span> &gt; <span class="o">{}</span>.png <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.ppm'</span> -exec sh -c <span class="s1">'pnmtopng "$1" &gt; "$1.png"'</span> _ <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck detected a <code>find</code> command with a redirection in the middle.</p>
<p>This redirection may have been intended to apply only to a specific action like <code>-exec</code> or <code>-print</code>, but it does in fact apply to the entire <code>find</code> command:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span># This command
find . -name '*.ppm' -exec pnmtopng {} &gt; {}.png \;

# Is the same as this
{
   find . -name '*.ppm' -exec pnmtopng {} \;
} &gt; {}.png
</pre></div>
</td></tr></table>
<p>To perform a redirection per action, rewrite it with e.g. <code>-exec sh -c '...' _ {} \;</code> </p>
<p>If the redirection is something like <code>&gt; /dev/null</code> where you don't mind it applying to the whole <code>find</code> and not individual results, move the redirection to the end of command:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -exec foo {} &gt; /dev/null \;     # Ambiguous syntax. Is it per -exec or not?
find . -exec foo {} \;  &gt; /dev/null    # Identical command with clear intent.
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2185">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#some-finds-dont-have-a-default-path-specify-explicitly">Some finds don't have a default path. Specify '.' explicitly.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="some-finds-dont-have-a-default-path-specify-explicitly">Some finds don't have a default path. Specify '.' explicitly.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find -type f
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When not provided a search path, GNU and Busybox <code>find</code> will use a default path of <code>.</code>, the current directory.</p>
<p>On POSIX, macOS/OSX, FreeBSD, OpenBSD and NetBSD, it will instead result in an error.</p>
<p>Explicitly specifying a path works across all implementations, and is therefore preferred.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>You will get a false positive if you concatenate a series of pre-path flags:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find -XLE .
</pre></div>
</td></tr></table>
<p>In such cases, please either use <code>find -X -L -E .</code> or [[ignore]] the message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2159">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#0-is-true-use-false-instead">[ 0 ] is true. Use 'false' instead</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="0-is-true-use-false-instead">[ 0 ] is true. Use 'false' instead</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"always triggers"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">false</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"never triggers"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ str ]</code> checks whether <code>str</code> is non-empty. It doesn't matter if <code>str</code> is <code>0</code>, it will still be evaluated for non-emptyness.</p>
<p>Instead, use the command <code>false</code> which -- as the manual puts it -- does nothing, unsuccessfully.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2155">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#declare-and-assign-separately-to-avoid-masking-return-values">Declare and assign separately to avoid masking return values.</a><ul>
<li><a href="#problematic-code-in-the-case-of-export">Problematic code in the case of export:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#problematic-code-in-the-case-of-local">Problematic code in the case of local:</a></li>
<li><a href="#correct-code_1">Correct code:</a></li>
<li><a href="#rationale_1">Rationale</a></li>
<li><a href="#problematic-code-in-the-case-of-readonly">Problematic code in the case of readonly:</a></li>
<li><a href="#correct-code_2">Correct code:</a></li>
<li><a href="#word-splitting-and-quoting-issue-with-dash-maybe-others">Word splitting and quoting issue with dash, maybe others</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="declare-and-assign-separately-to-avoid-masking-return-values">Declare and assign separately to avoid masking return values.</h2>
<h3 id="problematic-code-in-the-case-of-export">Problematic code in the case of <code>export</code>:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">foo</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mycmd<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mycmd<span class="k">)</span><span class="s2">"</span>
<span class="nb">export</span> foo
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In the original code, the return value of <code>mycmd</code> is ignored, and <code>export</code> will instead always return true. This may prevent conditionals, <code>set -e</code> and traps from working correctly.</p>
<p>When first marked for export and assigned separately, the return value of the assignment will be that of <code>mycmd</code>. This avoids the problem.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you intend to ignore the return value of an assignment, you can either ignore this warning or use</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="k">$(</span>mycmd<span class="k">)</span> <span class="o">||</span> <span class="nb">true</span>
<span class="nb">export</span> foo
</pre></div>
</td></tr></table>
<p>Shellcheck does not warn about <code>export foo=bar</code> because <code>bar</code> is a literal and not a command substitution with an independent return value. It also does not warn about <code>local -r foo=$(cmd)</code>, where declaration and assignment must be in the same command.</p>
<h3 id="problematic-code-in-the-case-of-local">Problematic code in the case of <code>local</code>:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">local</span> <span class="nv">foo</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mycmd<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code_1">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">local</span> foo
<span class="nv">foo</span><span class="o">=</span><span class="k">$(</span>mycmd<span class="k">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale_1">Rationale</h3>
<p>The exit status of the command is overridden by the exit status of the creation of the local variable. For example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ f<span class="o">()</span> <span class="o">{</span> <span class="nb">local</span> <span class="nv">foo</span><span class="o">=</span><span class="k">$(</span><span class="nb">false</span><span class="k">)</span> <span class="o">||</span> <span class="nb">echo</span> foo<span class="p">;</span> <span class="o">}</span><span class="p">;</span> f
$ f<span class="o">()</span> <span class="o">{</span> <span class="nb">local</span> foo<span class="p">;</span> <span class="nv">foo</span><span class="o">=</span><span class="k">$(</span><span class="nb">false</span><span class="k">)</span> <span class="o">||</span> <span class="nb">echo</span> foo<span class="p">;</span> <span class="o">}</span><span class="p">;</span> f
foo
</pre></div>
</td></tr></table>
<h3 id="problematic-code-in-the-case-of-readonly">Problematic code in the case of <code>readonly</code>:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">readonly</span> <span class="nv">foo</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mycmd<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code_2">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">foo</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mycmd<span class="k">)</span><span class="s2">"</span>
<span class="nb">readonly</span> foo
</pre></div>
</td></tr></table>
<h3 id="word-splitting-and-quoting-issue-with-dash-maybe-others">Word splitting and quoting issue with dash, maybe others</h3>
<p>A serious quoting problem with dash is another reason to declare and assign separately. Dash is the <a href="https://wiki.ubuntu.com/DashAsBinSh">default, <code>/bin/sh</code> shell on Ubuntu</a>. More specifically, dash version 0.5.8-2.10 and others cannot run this code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">VAR1</span><span class="o">=</span><span class="s1">'white spa/ce'</span>
<span class="nb">local</span> <span class="nv">var2</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">'%s'</span> <span class="s2">"</span><span class="si">${</span><span class="nv">VAR1</span><span class="si">}</span><span class="s2">"</span><span class="k">)</span>
</pre></div>
</td></tr></table>
<p>While this runs fine in other shells, <a href="http://mywiki.wooledge.org/BashPitfalls#local_var.3D.24.28cmd.29">dash doesn't treat this as an assignment</a> and fails like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">local</span><span class="o">:</span> <span class="n">spa</span><span class="o">/</span><span class="n">ce</span><span class="o">:</span> <span class="n">bad</span> <span class="n">variable</span> <span class="n">name</span>
</pre></div>
</td></tr></table>
<p>After separating this runs fine in any shell.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2218">Using undefined function</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-function-is-only-defined-later-move-the-definition-up">This function is only defined later. Move the definition up.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-function-is-only-defined-later-move-the-definition-up">This function is only defined later. Move the definition up.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
myfunction

myfunction<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Hello World"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
myfunction<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Hello World"</span>
<span class="o">}</span>
myfunction
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are calling a function that you are defining later in the file. The function definition must come first.</p>
<p>Function definitions are much like variable assignments, and define a name at the point the definition is "executed". This is why they must happen before their first use.</p>
<p>This is especially apparent when defining functions conditionally:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>case "$(uname -s)" in
  Linux) hi() { echo "Hello from Linux"; } ;;
  Darwin) hi() { echo "Hello from macOS"; } ;;
  *) hi() { echo "Hello from something else"; } ;;
esac

hi
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2214">Improper use of 'getops'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-case-is-not-specified-by-getopts">This case is not specified by getopts.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-case-is-not-specified-by-getopts">This case is not specified by getopts.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vr"</span> n
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Recursive"</span> <span class="p">;;</span>
    n<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Dry-run"</span> <span class="p">;;</span>
    *<span class="o">)</span> usage<span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">getopts</span> <span class="s2">"vrn"</span> n    <span class="c1"># 'n' added here</span>
<span class="k">do</span>
  <span class="k">case</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span> in
    v<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Verbose"</span> <span class="p">;;</span>
    r<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Recursive"</span> <span class="p">;;</span>
    n<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Dry-run"</span> <span class="p">;;</span>
    *<span class="o">)</span> usage<span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have a <code>case</code> statement in a <code>while getopts</code> loop that matches a flag that hasn't been provided in the <code>getopts</code> option string.</p>
<p>Either add the flag to the options list, or delete the case statement.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2120">Improper parameter passing</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#foo-references-arguments-but-none-are-ever-passed">foo references arguments, but none are ever passed.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="foo-references-arguments-but-none-are-ever-passed">foo references arguments, but none are ever passed.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sayhello<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
sayhello
</pre></div>
</td></tr></table>
<p><code>./myscript World</code> just prints "Hello " instead of "Hello World".</p>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sayhello<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
sayhello <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p><code>./myscript World</code> now prints "Hello World".</p>
<h3 id="rationale">Rationale:</h3>
<p>In a function, <code>$1</code> and up refers to the function's parameters, not the script's parameters.</p>
<p>If you want to process your script's parameters in a function, you have to explicitly pass them. You can do this with <code>myfunction "$@"</code>.</p>
<p>Note that <code>"$@"</code> refers to the current context's positional parameters, so if you call a function from a function, you have to pass in <code>"$@"</code> to both of them:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>first<span class="o">()</span> <span class="o">{</span> second <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
second<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"The first script parameter is: </span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
first <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>If the parameters are optional and you currently just don't want to use them, you can ignore this message. In versions strictly greater than v0.6.0, ignoring SC2120 on a function will also disable SC2119 on each of the call sites.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2219">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#instead-of-let-expr-prefer-expr">Instead of let expr, prefer (( expr )) .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#more-information">More information</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="instead-of-let-expr-prefer-expr">Instead of <code>let expr</code>, prefer <code>(( expr ))</code> .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">let</span> a++
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">((</span> a++ <span class="o">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The <code>(( .. ))</code> arithmetic compound command evaluates expressions in the same way as <code>let</code>, except it's not subject to glob expansion and therefore requires no additional quoting or escaping. </p>
<p>This warning only triggers in Bash/Ksh scripts. In Sh/Dash, neither <code>let</code> nor <code>(( .. ))</code> are defined, but can be simulated with <code>[ $(( expr )) -ne 0 ]</code> to retain exit code, or <code>: $(( expr ))</code> to ignore it.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="more-information">More information</h3>
<ul>
<li>Bash Hacker's Wiki: <a href="http://wiki.bash-hackers.org/commands/builtin/let">The let builtin command</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1105">Ambiguous '(('</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shells-disambiguate-differently-or-not-at-all-if-the-first-should-start-a-subshell-add-a-space-after-it">Shells disambiguate (( differently or not at all. If the first ( should start a subshell, add a space after it.</a></li>
</ul>
</div>

            <div>
                
<h2 id="shells-disambiguate-differently-or-not-at-all-if-the-first-should-start-a-subshell-add-a-space-after-it">Shells disambiguate (( differently or not at all. If the first ( should start a subshell, add a space after it.</h2>
<p>See [[SC1102]], the similar warning for ambiguous <code>$((</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2015">Improper 'if-then-else'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#note-that-a-b-c-is-not-if-then-else-c-may-run-when-a-is-true">Note that A &amp;&amp; B || C is not if-then-else. C may run when A is true.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#boring-detail">Boring detail:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="note-that-a-b-c-is-not-if-then-else-c-may-run-when-a-is-true">Note that A &amp;&amp; B || C is not if-then-else. C may run when A is true.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$dryrun</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Would delete file"</span> <span class="o">||</span> rm file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$dryrun</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Would delete file"</span>
<span class="k">else</span>
  rm file
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>It's common to use <code>A &amp;&amp; B</code> to run <code>B</code> when <code>A</code> is true, and <code>A || C</code> to run <code>C</code> when <code>A</code> is false.</p>
<p>However, combining them into <code>A &amp;&amp; B || C</code> is not the same as <code>if A then B else C</code>.</p>
<p>In this case, if <code>A</code> is true but <code>B</code> is false, <code>C</code> will run.</p>
<p>For the code sample above, if the script was run with stdout closed for any reason (such as explicitly running <code>script --dryrun &gt;&amp;-</code>), echo would fail and the file would be deleted, even though <code>$dryrun</code> was set!</p>
<p>If an <code>if</code> clause is used instead, this problem is avoided.</p>
<h3 id="boring-detail">Boring detail:</h3>
<p>We can think of the example above as</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">((([[</span> <span class="nv">$dryrun</span> <span class="o">]])</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Would delete file"</span><span class="o">)</span> <span class="o">||</span> rm file<span class="o">)</span>
</pre></div>
</td></tr></table>
<p>expressing the left-associativity of the <code>&amp;&amp;</code> <code>||</code> operators.</p>
<p>Whenever a command (strictly, a pipeline) succeeds or fails, the execution proceeds following the next <code>&amp;&amp;</code> (for success) or <code>||</code> (for failure).</p>
<h3 id="exceptions">Exceptions</h3>
<p>Ignore this warning when you actually do intend to run C when either A or B fails.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2105">Using 'break' outside loops</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#break-is-only-valid-in-loops">break is only valid in loops</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="break-is-only-valid-in-loops"><code>break</code> is only valid in loops</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
    -v<span class="o">)</span>
       <span class="nv">verbose</span><span class="o">=</span><span class="m">1</span>
       <span class="nb">break</span>
       <span class="p">;;</span>
    -d<span class="o">)</span>
       <span class="nv">debug</span><span class="o">=</span><span class="m">1</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
    -v<span class="o">)</span>
       <span class="nv">verbose</span><span class="o">=</span><span class="m">1</span>
       <span class="p">;;</span>
    -d<span class="o">)</span>
       <span class="nv">debug</span><span class="o">=</span><span class="m">1</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>break</code> or <code>continue</code> was found outside a loop. These statements are only valid in loops. In particular, <code>break</code> is not required in <code>case</code> statements as there is no implicit fall-through.</p>
<p>To return from a function or sourced script, use <code>return</code>. To exit a script, use <code>exit</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>It's possible to <code>break</code>/<code>continue</code> in a function without a loop. The call will then affect the loop -- if any -- that the function is invoked from. This is obviously not good coding practice.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2130">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#-eq-is-for-integer-comparisons-use-instead">-eq is for integer comparisons. Use = instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="-eq-is-for-integer-comparisons-use-instead">-eq is for integer comparisons. Use = instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$foo</span> -eq <span class="s2">"Y"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="s2">"Y"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shells have two sets of comparison operators: for integers (<code>-eq</code>, <code>-gt</code>, ...) and strings (<code>=</code>, <code>&gt;</code>, ...). ShellCheck has noticed that you're using an integer comparison with string data.</p>
<p>If you are in fact comparing integers, double check your parameters. Certain mistakes like <code>$$foo</code> or <code>${bar}}</code> can introduce non-numeric characters into otherwise numeric arguments.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2038">Improper 'find' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-print0-0-or-find-exec-to-allow-for-non-alphanumeric-filenames">Use -print0/-0 or find -exec + to allow for non-alphanumeric filenames.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-print0-0-or-find-exec-to-allow-for-non-alphanumeric-filenames">Use -print0/-0 or find -exec + to allow for non-alphanumeric filenames.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f <span class="p">|</span> xargs md5sum
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -type f -print0 <span class="p">|</span> xargs -0 md5sum
find . -type f -exec md5sum <span class="o">{}</span> +
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>By default, <code>xargs</code> interprets spaces and quotes in an unsafe and unexpected way. Whenever it's used, it should be used with <code>-0</code> or <code>--null</code> to split on <code>\0</code> bytes, and <code>find</code> should be made to output <code>\0</code> separated filenames.</p>
<p>POSIX does not require find or xargs to support null terminators, so you can also use <code>find -exec +</code>. </p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1066">Using '$' on the left side of assignments</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-use-on-the-left-side-of-assignments">Don't use $ on the left side of assignments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="dont-use-on-the-left-side-of-assignments">Don't use $ on the left side of assignments.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$greeting</span><span class="o">=</span><span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">greeting</span><span class="o">=</span><span class="s2">"Hello World"</span>
</pre></div>
</td></tr></table>
<p>Alternatively, if the goal was to assign to a variable whose name is in another variable (indirection), use <code>declare</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">name</span><span class="o">=</span>foo
<span class="nb">declare</span> <span class="s2">"</span><span class="nv">$name</span><span class="s2">=hello world"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$foo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Unlike Perl or PHP, <code>$</code> is not used when assigning to a variable.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1133">Unexpected start of line</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unexpected-start-of-line-if-breaking-lines-should-be-at-the-end-of-the-previous-one">Unexpected start of line. If breaking lines, |/||/&amp;&amp; should be at the end of the previous one.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="unexpected-start-of-line-if-breaking-lines-should-be-at-the-end-of-the-previous-one">Unexpected start of line. If breaking lines, |/||/&amp;&amp; should be at the end of the previous one.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>dmesg
  <span class="p">|</span> grep <span class="s2">"error"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>dmesg <span class="p">|</span>
  grep <span class="s2">"error"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a line that unexpectedly started with <code>|</code>, <code>||</code> or <code>&amp;&amp;</code>. This usually happens when a line is broken incorrectly.</p>
<p>When breaking around a <code>|</code>, <code>||</code> or <code>&amp;&amp;</code>, there are two options:</p>
<ul>
<li>Break the line <em>after</em> this token. <code>dmesg</code> is a complete command by itself, but <code>dmesg |</code> is not so the shell knows to continue on the next line.</li>
<li>Use a <code>\</code> at the end of the previous line to explicitly tell the shell to continue on the next.</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>None. This is a syntax error.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2160">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#instead-of-true-just-use-true">Instead of '[ true ]', just use 'true'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="instead-of-true-just-use-true">Instead of '[ true ]', just use 'true'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="nb">true</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"always triggers"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"always triggers"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is a stylistic suggestion to use <code>true</code> instead of <code>[ true ]</code>.</p>
<p><code>[ true ]</code> seems to suggest that the value "true" is somehow relevant to the statement. This is not the case, it doesn't matter. You can replace it with <code>[ false ]</code> or <code>[ wombat ]</code>, and it will still always be true:</p>
<table>
<thead>
<tr>
<th>String</th>
<th>In brackets</th>
<th>Outside brackets</th>
</tr>
</thead>
<tbody>
<tr>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>wombat</td>
<td>true</td>
<td>unknown command</td>
</tr>
</tbody>
</table>
<p>It's therefore better to use it without brackets, so that the "true" actually matters.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2215">Bad command name</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-flag-is-used-as-a-command-name-bad-line-break-or-missing">This flag is used as a command name. Bad line break or missing [ .. ]?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-flag-is-used-as-a-command-name-bad-line-break-or-missing">This flag is used as a command name. Bad line break or missing <code>[ .. ]</code>?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> -e .bashrc
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">".bashrc already exists"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.mkv'</span>
       -exec mplayer <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e .bashrc <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">".bashrc already exists"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.mkv'</span> <span class="se">\</span>
       -exec mplayer <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using a name that starts with a dash as a command name. This is almost always a bug.</p>
<p>There are two typical ways in which this happens:</p>
<ul>
<li>Missing <code>[ .. ]</code> or <code>[[ .. ]]</code> around a test expression, like in the first example example. </li>
<li>An invalid line break that splits a command in two, like in the second example.</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>If you actually have a command that starts with a dash -- which you should really reconsider -- you can quote the name (or at least the leading dash). This makes no difference to the shell, but makes it clear to ShellCheck and humans that this is not intended as a flag.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2193">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-arguments-to-this-comparison-can-never-be-equal-make-sure-your-syntax-is-correct">The arguments to this comparison can never be equal. Make sure your syntax is correct.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-arguments-to-this-comparison-can-never-be-equal-make-sure-your-syntax-is-correct">The arguments to this comparison can never be equal. Make sure your syntax is correct.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="nv">$var</span>+1 <span class="o">==</span> <span class="m">5</span> <span class="o">]</span>              <span class="c1"># Unevaluated math</span>
<span class="o">[</span> <span class="s2">"{</span><span class="nv">$var</span><span class="s2">}"</span> <span class="o">==</span> <span class="s2">"value"</span> <span class="o">]</span>      <span class="c1"># Swapped around $ and {</span>
<span class="o">[</span> <span class="s2">"</span><span class="k">$(</span>cmd1<span class="k">)</span><span class="s2"> | cmd2"</span> <span class="o">==</span> <span class="s2">"42"</span> <span class="o">]</span> <span class="c1"># Ended with ) too soon</span>
<span class="o">[[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2"> "</span> <span class="o">==</span> *.png <span class="o">]]</span>       <span class="c1"># Trailing space</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="k">$((</span>var+1<span class="k">))</span> <span class="o">==</span> <span class="m">5</span> <span class="o">]</span>          <span class="c1"># Evaluated math</span>
<span class="o">[</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="si">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"value"</span> <span class="o">]</span>      <span class="c1"># Correct variable expansion</span>
<span class="o">[</span> <span class="s2">"</span><span class="k">$(</span>cmd1 <span class="p">|</span> cmd2<span class="k">)</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"42"</span> <span class="o">]</span> <span class="c1"># Correct command substitution</span>
<span class="o">[[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">==</span> *.png <span class="o">]]</span>        <span class="c1"># No trailing space</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has determined that the two values you're comparing can never be equal. </p>
<p>Most of the time, this happens because of a syntax issue that introduced unintended literal characters into one of the arguments.</p>
<p>The left-hand side in the problematic examples will always contain (respectively) curly braces, pipe and trailing space. The right-hand sides are literal values and a pattern without trailing spaces, so they will never be equal. The statement is therefore useless, strongly indicating a bug. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1081">Improper case of keywords</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#scripts-are-case-sensitive-use-if-not-if">Scripts are case sensitive. Use 'if', not 'If'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="scripts-are-case-sensitive-use-if-not-if">Scripts are case sensitive. Use 'if', not 'If'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>If <span class="nb">true</span>
Then
  <span class="nb">echo</span> <span class="s2">"hello"</span>
Fi
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"hello"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Shells are case sensitive and do not accept <code>If</code> or <code>IF</code> in place of lowercase <code>if</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of this and insist on naming a function <code>WHILE</code>, you can quote the name to prevent shellcheck from thinking you meant <code>while</code>. Or if you really want the names, add things like <code>alias If=if IF=if</code> to replace those keywords and ask shellcheck to ignore them.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1082">Improper encoding marking</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-file-has-a-utf-8-bom-remove-it-with-lc_ctypec-sed-1s-yourscript">This file has a UTF-8 BOM. Remove it with: LC_CTYPE=C sed '1s/^...//' &lt; yourscript .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-file-has-a-utf-8-bom-remove-it-with-lc_ctypec-sed-1s-yourscript">This file has a UTF-8 BOM. Remove it with: LC_CTYPE=C sed '1s/^...//' &lt; yourscript .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<p>This is an encoding error that can't be seen in the script itself, but <code>cat -v</code> will show three bytes of garbage at the start of the file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ cat -v file
M-oM-<span class="p">;</span>M-?#!/bin/bash
<span class="nb">echo</span> <span class="s2">"hello world"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>The code is correct when this garbage does not appear.</p>
<h3 id="rationale">Rationale:</h3>
<p>Some editors may save a file with a <a href="https://en.wikipedia.org/wiki/Byte_order_mark">Byte Order Mark</a> to mark the file as UTF-8. Shells do not understand this and will give errors on the first line:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ bash myscript
myscript: line <span class="m">1</span>: <span class="c1">#!/bin/sh: No such file or directory</span>

$ dash myscript
myscript: <span class="m">1</span>: myscript: <span class="c1">#!/bin/sh: not found</span>
</pre></div>
</td></tr></table>
<p>To fix it, remove the byte order mark. One way of doing this is <code>LC_CTYPE=C sed '1s/^...//' &lt; yourscript</code>. Verify that it's not there with <code>cat -v</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2204">Suspicious subshell</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-a-subshell-did-you-mean-a-test-expression">(..) is a subshell. Did you mean [ .. ], a test expression?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-a-subshell-did-you-mean-a-test-expression">(..) is a subshell. Did you mean [ .. ], a test expression?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span> -d mydir <span class="o">)</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"It's a directory"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -d mydir <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"It's a directory"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Tests like <code>-d</code> to see if something is a directory or <code>-z</code> to see if it's non-empty are actually flags to the <code>test</code> command, and only work as tests in that context. <code>[</code> is an alias for <code>test</code>, so you'll frequently see them written as <code>[ -d mydir ]</code>.</p>
<p><code>( .. )</code> is completely unrelated, and is a subshell mostly used to scope shell modifications. They should not be used in <code>if</code> or <code>while</code> statements in shell scripts.</p>
<p>If you wanted to test a condition, rewrite the <code>( .. )</code> to <code>[ .. ]</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
<p>This error is triggered by having a unary test operator as the first command name in a subshell, which won't normally happen. Note that there's a similar warning [[SC2205]] with a higher false positive rate.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1067">Improper variable decleration</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#for-indirection-use-arrays-declare-varnvalue-or-for-sh-readeval">For indirection, use arrays, declare "var$n=value", or (for sh) read/eval</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="for-indirection-use-arrays-declare-varnvalue-or-for-sh-readeval">For indirection, use arrays, <code>declare "var$n=value"</code>, or (for sh) read/eval</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">1</span>
var<span class="nv">$n</span><span class="o">=</span><span class="s2">"hello"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>For integer indexing in ksh/bash, consider using an indexed array:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">1</span>
var<span class="o">[</span>n<span class="o">]=</span><span class="s2">"hello"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="p">[n]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>For string indexing in ksh/bash, use an associative array:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">typeset</span> -A var
<span class="nv">n</span><span class="o">=</span><span class="s2">"greeting"</span>
var<span class="o">[</span><span class="nv">$n</span><span class="o">]=</span><span class="s2">"hello"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="p">[</span><span class="nv">$n</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>If you actually need a variable with the constructed name in bash, use <code>declare</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="s2">"Foo"</span>
<span class="nb">declare</span> <span class="s2">"var</span><span class="nv">$n</span><span class="s2">=42"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$varFoo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>For <code>sh</code>, with single line contents, consider <code>read</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="s2">"Foo"</span>
<span class="nb">read</span> -r <span class="s2">"var</span><span class="nv">$n</span><span class="s2">"</span> <span class="s">&lt;&lt; EOF</span>
<span class="s">hello</span>
<span class="s">EOF</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$varFoo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or with careful escaping, <code>eval</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span>Foo
<span class="nb">eval</span> <span class="s2">"var</span><span class="nv">$n</span><span class="s2">='hello'"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$varFoo</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>var$n=value</code> is not a valid way of assigning to a dynamically created variable name in any shell. Please use one of the other methods to assign to names via expanded strings. <a href="https://mywiki.wooledge.org/BashFAQ/006">Wooledge BashFaq #6</a> has significantly more information on the subject.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/006">Wooledge BashFaq #6</a>: How can I use variable variables (indirect variables, pointers, references) or associative arrays?</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2017">Precision lost of arithmatic</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#increase-precision-by-replacing-ab42c-with-a42cb">Increase precision by replacing a/b*c with a*c/b.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="increase-precision-by-replacing-ab42c-with-a42cb">Increase precision by replacing a/b*c with a*c/b.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">percent</span><span class="o">=</span><span class="k">$((</span>count/total*100<span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">percent</span><span class="o">=</span><span class="k">$((</span>count*100/total<span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>If integer division is performed before multiplication, the intermediate result will be truncated causing a loss of precision.</p>
<p>In this case, if  <code>count=1</code> and <code>total=2</code>, then the problematic code results in <code>percent=0</code>, while the correct code gives <code>percent=50</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you want and expect truncation you can ignore this message.</p>
<p>ShellCheck doesn't warn when <code>b</code> and <code>c</code> are identical expressions, e.g. <code>a/10*10</code>, under the assumption that the intent is to rounded to the nearest 10 rather than the no-op of multiply by <code>1</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1020">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-the-if-single-then-else">You need a space before the if single then "]" else "]]"</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#ignore">Ignore</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-the-if-single-then-else">You need a space before the if single then "]" else "]]"</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>if [ "$STUFF" = ""]; then
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>if [ "$STUFF" = "" ]; then
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bourne shells are very whitespace sensitive. Adding or removing spaces can drastically alter the meaning of a script. In these cases, ShellCheck has noticed that you're missing a space at the position indicated.</p>
<h3 id="exceptions">Exceptions</h3>
<p>none.</p>
<h3 id="ignore">Ignore</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># shellcheck disable=SC1020
if [ "$STUFF" = ""]; then
...
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2192">Improper array operations</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-array-element-has-no-value-remove-spaces-after-or-use-for-empty-string">This array element has no value. Remove spaces after = or use "" for empty string.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-array-element-has-no-value-remove-spaces-after-or-use-for-empty-string">This array element has no value. Remove spaces after = or use "" for empty string.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=([</span><span class="m">1</span><span class="o">]=</span>one <span class="o">[</span><span class="m">2</span><span class="o">]=</span> two<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=([</span><span class="m">1</span><span class="o">]=</span>one <span class="o">[</span><span class="m">2</span><span class="o">]=</span>two<span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have an array element on the form <code>[index]=</code>. The shell will interpret this as an independent element with index <code>index</code> and value <code>&lt;empty string&gt;</code>.</p>
<p>This may happen as part of the expression <code>[index]= value</code>, where the space is not allowed and causes the shell to interpret it as <code>[index]="" [index+1]=value</code>.</p>
<p>If you wanted the element to have a value, remove the spaces after <code>=</code>, e.g. <code>[index]=value</code>.</p>
<p>If you wanted to assign an empty string, explicitly use empty quotes: <code>[index]=""</code>. This makes no difference to the shell, but will make your intention clear to shellcheck and other humans. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2211">Suspicious wildcard in file name</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-glob-used-as-a-command-name-was-it-supposed-to-be-in-array-or-is-it-missing-quoting">This is a glob used as a command name. Was it supposed to be in ${..}, array, or is it missing quoting?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-glob-used-as-a-command-name-was-it-supposed-to-be-in-array-or-is-it-missing-quoting">This is a glob used as a command name. Was it supposed to be in ${..}, array, or is it missing quoting?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in <span class="k">$(</span>*.png<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>   <span class="c1"># Trying to loop over a glob</span>
<span class="nv">array</span><span class="o">=</span><span class="k">$(</span>*.txt<span class="k">)</span>                          <span class="c1"># Trying to assign an array</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>array<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="k">)</span><span class="s2">"</span>                      <span class="c1"># Trying to expand an array</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in *.png<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span>
<span class="nv">array</span><span class="o">=(</span>*.txt<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">array</span><span class="p">[1]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using a glob as a command name. This is usually a mistake caused by one of the following:</p>
<ul>
<li>Trying to use <code>`*foo*`</code> or <code>$(*foo*)</code> to expand a glob. </li>
<li>Using <code>var=$(*.txt)</code> instead of <code>var=(*.txt)</code> to assign an array.</li>
<li>Using <code>$(..)</code> instead of <code>${..}</code> when expanding an array element.</li>
<li>Running a program with a name or directory that contains glob characters without escaping them.</li>
</ul>
<p>Look up and double check the syntax of what you're trying to do.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you want to specify a command name via glob, e.g. to not hard code version in <code>./myprogram-*/foo</code>, expand to array or parameters first to allow handling the cases of 0 or 2+ matches. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2022">Ambiguous string matching</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#note-that-unlike-globs-o-here-matches-ooo-but-not-oscar">Note that unlike globs, o* here matches 'ooo' but not 'oscar'</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="note-that-unlike-globs-o-here-matches-ooo-but-not-oscar">Note that unlike globs, o* here matches 'ooo' but not 'oscar'</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep <span class="s1">'foo*'</span>
</pre></div>
</td></tr></table>
<p>when wanting to match <code>food</code> and <code>foosball</code>, but not <code>mofo</code> or <code>keyfob</code>.</p>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep <span class="s1">'^foo'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>As a glob, <code>foo*</code> means "Any string starting with foo", e.g. <code>food</code> and <code>foosball</code>.</p>
<p>As a regular expression, "foo*" means "f followed by 1 or more o's, anywhere", e.g. "mofo" or "keyfob".</p>
<p>This construct is way more common as a glob than as a regex, so ShellCheck notifies you about it.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of the above, you can ignore this message. If you'd like shellcheck to be quiet, use a [[directive]] or <code>'fo[o]*'</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1058">Missing 'do'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-do">Expected do.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="expected-do">Expected <code>do</code>.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in *
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in *
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a loop that appears to be missing a <code>do</code> statement. In the problematic code, it was simply forgotten.</p>
<p>Verify that the <code>do</code> exists, and that it's in the correct place.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1109">Unquoted HTML entity</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-an-unquoted-html-entity-replace-with-corresponding-character">This is an unquoted HTML entity. Replace with corresponding character.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-an-unquoted-html-entity-replace-with-corresponding-character">This is an unquoted HTML entity. Replace with corresponding character.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="o">&amp;&amp;</span> bar
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>There is an unquoted HTML entity, such as <code>&amp;amp;</code>, <code>&amp;gt;</code> or <code>&amp;lt;</code> (instead of <code>&amp;</code>, <code>&gt;</code> and <code>&lt;</code>) in your code. This usually happens when copy-pasting from a web site that has mismanaged its code formatting.</p>
<p>You should go through the entire script and replace HTML entities with their corresponding characters. </p>
<p>Don't rely on ShellCheck to detect all of them. ShellCheck only warns about certain cases in certain contexts, while this issue tends to affect the entire script.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you want to run a command called <code>amp</code> after backgrounding another command, add a space: <code>foo &amp; amp;</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2098">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-expansion-will-not-see-the-mentioned-assignment">This expansion will not see the mentioned assignment.</a></li>
</ul>
</div>

            <div>
                
<h2 id="this-expansion-will-not-see-the-mentioned-assignment">This expansion will not see the mentioned assignment.</h2>
<p>See companion warning [[SC2097]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1116">Missing $ on $((..))</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#missing-on-a-expression-or-use-for-arrays">Missing $ on a $((..)) expression? (or use ( ( for arrays).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="missing-on-a-expression-or-use-for-arrays">Missing $ on a $((..)) expression? (or use ( ( for arrays).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=((</span>foo+1<span class="o">))</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="k">$((</span>foo+1<span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be missing the <code>$</code> on an assignment from an arithmetic expression <code>var=$((..))</code> .</p>
<p>Without the <code>$</code>, this is an array expression which is either nested (ksh) or invalid (bash). </p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you are trying to define a multidimensional Ksh array, add spaces between the <code>( (</code> to clarify:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>var=( (1 2 3) (4 5 6) )
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2245">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#-d-only-applies-to-the-first-expansion-of-this-glob-use-a-loop-to-check-anyall">-d only applies to the first expansion of this glob. Use a loop to check any/all.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="-d-only-applies-to-the-first-expansion-of-this-glob-use-a-loop-to-check-anyall">-d only applies to the first expansion of this glob. Use a loop to check any/all.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -f ksh* <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"The file exists"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in ksh*
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"Found a matching file: </span><span class="nv">$f</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Ksh has the curious behavior of ignoring anything after an unrecognized flag to <code>test</code>/<code>[</code>, which means that file checking operators against globs will effectively apply the operator to the first expansion:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -f ksh* <span class="o">]</span>                              <span class="c1"># This</span>
<span class="o">[</span> -f ksh93u ksh93u.tar ksh93u.tar.gz <span class="o">]</span>   <span class="c1"># Becomes this</span>
<span class="o">[</span> -f ksh93u <span class="o">]</span>                            <span class="c1"># And is interpreted like this</span>
</pre></div>
</td></tr></table>
<p>This is an issue when you have multiple matches for a glob. Instead of checking some or all, it only checks the first result and ignores the rest. To ensure that all results are considered (either to check that <em>any</em> or <em>all</em> results match the operator), use a loop explicitly.</p>
<p>If you really only want to match the first result of the glob expansion as sorted alphabetically in the current locale, you can make this intention explicit:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>matches=( ksh* )
if [ -f "<span class="cp">${</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="cp">}</span>" ]
then
  echo "The first result is a file"
fi
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>If you only care that entries exists, use <code>-e</code>. ShellCheck does not warn in this case, since all files resulting from glob expansion necessarily exist.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2090">Improper use of Quotes/backslashes</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quotesbackslashes-in-this-variable-will-not-be-respected">Quotes/backslashes in this variable will not be respected.</a></li>
</ul>
</div>

            <div>
                
<h1 id="quotesbackslashes-in-this-variable-will-not-be-respected">Quotes/backslashes in this variable will not be respected.</h1>
<p>See companion warning, [[SC2089]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1036">Missing escape</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-invalid-here-did-you-forget-to-escape-it">( is invalid here. Did you forget to escape it?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-invalid-here-did-you-forget-to-escape-it"><code>(</code> is invalid here. Did you forget to escape it?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="o">(</span>foo<span class="o">)</span> bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Depends on your intention:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"(foo) bar"</span>  <span class="c1"># Literal parentheses</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>foo<span class="k">)</span><span class="s2"> bar"</span> <span class="c1"># Command expansion</span>
<span class="nb">echo</span> <span class="s2">"foo bar"</span>    <span class="c1"># Tried to use parentheses for grouping or function invocation</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck expected an ordinary shell word but found an opening parenthesis instead.</p>
<p>Determine what you intended the parenthesis to do and rewrite accordingly. Common issues include:</p>
<ul>
<li>Wanting them to be literal, as in <code>echo (FAIL) Some tests failed</code>. In this case, it requires quoting.</li>
<li>Wanting command expansion, as in <code>echo Today is (date)</code>. Add the missing <code>$</code>: <code>echo "Today is $(date)"</code></li>
<li>Adding parentheses because other languages need them in that context, such as <code>foo (bar, 42)</code> to call a function. This should be <code>foo bar 42</code>. Also, shells do not support tuples or passing arrays as single parameters.</li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>Bash allows some parentheses as part of assignment-like tokens to certain commands, including <code>export</code> and <code>eval</code>. This is a workaround in Bash to allow commands that normally would not be valid:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>eval foo=(bar)       # Valid command
echo foo=(bar)       # Invalid syntax
f=foo; eval $f=(bar) # Also invalid
</pre></div>
</td></tr></table>
<p>In these cases, please quote the command, such as `eval "foo=(bar)". This does not change the behavior, but stops relying on bash specific parsing quirks.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2004">Unnecessary $/${} on arithmetic variables</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-unnecessary-on-arithmetic-variables">$/${} is unnecessary on arithmetic variables.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="is-unnecessary-on-arithmetic-variables">$/${} is unnecessary on arithmetic variables.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="k">$((</span><span class="nv">$n</span> <span class="o">+</span> <span class="si">${</span><span class="nv">arr</span><span class="p">[i]</span><span class="si">}</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="k">$((</span>n <span class="o">+</span> arr<span class="o">[</span>i<span class="o">]</span><span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The <code>$</code> or <code>${..}</code> on regular variables in arithmetic contexts is unnecessary, and can even lead to subtle bugs. This is because the contents of <code>$((..))</code> is first expanded into a string, and then evaluated as an expression:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">a</span><span class="o">=</span><span class="s1">'1+1'</span>
$ <span class="nb">echo</span> <span class="k">$((</span><span class="nv">$a</span> <span class="o">*</span> <span class="m">5</span><span class="k">))</span>    <span class="c1"># becomes 1+1*5</span>
<span class="m">6</span>
$ <span class="nb">echo</span> <span class="k">$((</span>a <span class="o">*</span> <span class="m">5</span><span class="k">))</span>     <span class="c1"># evaluates as (1+1)*5</span>
<span class="m">10</span>
</pre></div>
</td></tr></table>
<p>The <code>$</code> is unavoidable for special variables like <code>$1</code> vs <code>1</code>, <code>$#</code> vs <code>#</code>. It's also required when adding modifiers to parameters expansions, like <code>${#var}</code> or <code>${var%-}</code>. ShellCheck does not warn about these cases.</p>
<p>The <code>$</code> is also required (and not warned about) when you need to specify the <em>base</em> for a variable value:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">a</span><span class="o">=</span><span class="m">09</span>
$ <span class="nb">echo</span> <span class="k">$((</span>a <span class="o">+</span> <span class="m">1</span><span class="k">))</span>          <span class="c1"># leading zero forces octal interpretation</span>
bash: <span class="m">09</span>: value too great <span class="k">for</span> base <span class="o">(</span>error token is <span class="s2">"09"</span><span class="o">)</span>
$ <span class="nb">echo</span> <span class="k">$((</span><span class="m">10#</span>a <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
bash: <span class="m">10</span><span class="c1">#a: value too great for base (error token is "10#a")</span>
$ <span class="nb">echo</span> <span class="k">$((</span><span class="m">10#</span><span class="nv">$a</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
<span class="m">10</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1047">Missing 'fi' for 'if'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#expected-fi-matching-previously-mentioned-if">"Expected 'fi' matching previously mentioned 'if'.</a></li>
</ul>
</div>

            <div>
                
<h2 id="expected-fi-matching-previously-mentioned-if">"Expected 'fi' matching previously mentioned 'if'.</h2>
<p>See companion warning [[SC1046]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1045">Improper ';' after '&'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#its-not-foo-bar-just-foo-bar">It's not 'foo &amp;; bar', just 'foo &amp; bar'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="its-not-foo-bar-just-foo-bar">It's not 'foo &amp;; bar', just 'foo &amp; bar'.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="p">&amp;;</span> bar
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo <span class="p">&amp;</span> bar
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Both <code>&amp;</code> and <code>;</code> terminate the command. You should only use one of them.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2195">Dead code</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-pattern-will-never-match-the-case-statements-word-double-check-them">This pattern will never match the case statement's word. Double check them.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-pattern-will-never-match-the-case-statements-word-double-check-them">This pattern will never match the case statement's word. Double check them.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2"> "</span> in      <span class="c1"># Trailing space</span>
  value<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Match"</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="si">}</span><span class="s2">"</span> in     <span class="c1"># No trailing space</span>
  value<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Match"</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has detected that one of the patterns in a <code>case</code> statement will never match. </p>
<p>Often, this is due to mistakes in the case statement word that results in unintended literal characters. In the problematic code, there's a trailing space that will prevent the match from ever succeeding.</p>
<p>For more examples of when this could happen, see <a href="https://github.com/koalaman/shellcheck/wiki/SC2193">SC2193</a> for the equivalent warning for <code>[[ .. ]]</code> statements.</p>
<p>Note that ShellCheck warns about individual patterns in a branch, and will flag <code>*.png</code> in this example even though the branch is not dead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>case "<span class="cp">${</span><span class="n">img</span><span class="cp">}</span>.jpg" in
  *.png | *.jpg) echo "It's an image"
esac
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you encounter a bug and wish to [[ignore]] this warning, make sure the directive goes in front of the <code>case</code> and not the individual branch. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2109">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#instead-of-a-b-use-a-b">Instead of [ a || b ], use [ a ] || [ b ].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="instead-of-a-b-use-a-b">Instead of [ a || b ], use [ a ] || [ b ].</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">||</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-help"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-help"</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>||</code> can not be used in a <code>[ .. ]</code> test expression. Instead, make two <code>[ .. ]</code> expressions and put the <code>||</code> between them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1073">Parser error</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#couldnt-parse-this-thing-fix-to-allow-more-checks">Couldn't parse this (thing). Fix to allow more checks.</a></li>
</ul>
</div>

            <div>
                
<h1 id="couldnt-parse-this-thing-fix-to-allow-more-checks">Couldn't parse this (thing). Fix to allow more checks.</h1>
<p>This parsing error points to the structure ShellCheck was trying to parse when a parser error occurred. </p>
<p>Make any necessary fixes and check the script again, since most of ShellCheck's functionality can only be applied to scripts that parse successfully.</p>
<p>See [[Parser error]] for more information.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2082">Incorrect expension</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-expand-via-indirection-use-namefoon-echo-name">To expand via indirection, use name="foo$n"; echo "${!name}".</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="to-expand-via-indirection-use-namefoon-echo-name">To expand via indirection, use name="foo$n"; echo "${!name}".</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var_1</span><span class="o">=</span><span class="s2">"hello world"</span>
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var_$n</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Bash/ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Use arrays instead of dynamic names</span>
<span class="nb">declare</span> -a var
var<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="s2">"hello world"</span>
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">var</span><span class="p">[n]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Expand variable names dynamically</span>
<span class="nv">var_1</span><span class="o">=</span><span class="s2">"hello world"</span>
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">name</span><span class="o">=</span><span class="s2">"var_</span><span class="nv">$n</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="p">!name</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>POSIX sh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Expand dynamically with eval</span>
<span class="nv">var_1</span><span class="o">=</span><span class="s2">"hello world"</span>
<span class="nv">n</span><span class="o">=</span><span class="m">1</span>
<span class="nb">eval</span> <span class="s2">"tmp=\$var_</span><span class="nv">$n</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">tmp</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You can expand a variable <code>var_1</code> with <code>${var_1}</code>, but you can not generate the string <code>var_1</code> with an embedded expansion, like <code>${var_$n}</code>.</p>
<p>Instead, if at all possible, you should use an array. Bash and ksh support both numerical and associative arrays, and an example is shown above.</p>
<p>If you can't use arrays, you can indirectly reference variables by creating a temporary variable with its name, e.g. <code>myvar="var_$n"</code> and then expanding it indirectly with <code>${!myvar}</code>. This will give the contents of the variable <code>var_1</code>.</p>
<p>If using POSIX sh, where neither arrays nor <code>${!var}</code> is available, <code>eval</code> can be used. You must be careful in sanitizing the data used to construct the variable name to avoid arbitrary code execution.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/006">BashFaq: How can I use variable variables (indirect variables, pointers, references) or associative arrays?</a></li>
<li><a href="https://stackoverflow.com/questions/16553089/dynamic-variable-names-in-bash">StackOverflow: Dynamic variable names in Bash</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2115">Improper '/*'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-var-to-ensure-this-never-expands-to">Use "${var:?}" to ensure this never expands to /* .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-var-to-ensure-this-never-expands-to">Use "${var:?}" to ensure this never expands to /* .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -rf <span class="s2">"</span><span class="nv">$STEAMROOT</span><span class="s2">/"</span>*
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -rf <span class="s2">"</span><span class="si">${</span><span class="nv">STEAMROOT</span><span class="p">:?</span><span class="si">}</span><span class="s2">/"</span>*
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>If <code>STEAMROOT</code> is empty, this will <a href="https://github.com/ValveSoftware/steam-for-linux/issues/3671">end up deleting everything</a> in the system's root directory.</p>
<p>Using <code>:?</code> will cause the command to fail if the variable is null or unset. Similarly, you can use <code>:-</code> to set a default value if applicable.</p>
<p>In the case command substitution, assign to a variable first and then use <code>:?</code>. This is relevant even if the command seems simple and obviously correct, since forks and execs can fail due to external system limits and conditions, resulting in a blank substitution.</p>
<p>For more details about <code>:?</code> see the "Parameter Expansion" section of the Bash man page.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2055">Improper logic</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-probably-wanted-here-otherwise-its-always-true">You probably wanted &amp;&amp; here, otherwise it's always true.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-probably-wanted-here-otherwise-its-always-true">You probably wanted &amp;&amp; here, otherwise it's always true.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> !<span class="o">=</span> foo <span class="o">||</span> <span class="nv">$1</span> !<span class="o">=</span> bar <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not foo or bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> !<span class="o">=</span> foo <span class="o">&amp;&amp;</span> <span class="nv">$1</span> !<span class="o">=</span> bar <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not foo or bar"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is not a bash issue, but a simple, common logical mistake applicable to all languages.</p>
<p><code>[[ $1 != foo || $1 != bar ]]</code> is always true (when <code>foo != bar</code>):</p>
<ul>
<li>If <code>$1 = foo</code> then <code>$1 != bar</code> is true, so the statement is true.</li>
<li>If <code>$1 = bar</code> then <code>$1 != foo</code> is true, so the statement is true.</li>
<li>If <code>$1 = cow</code> then <code>$1 != foo</code> is true, so the statement is true.</li>
</ul>
<p><code>[[ $1 != foo &amp;&amp; $1 != bar ]]</code> matches when <code>$1</code> is neither <code>foo</code> nor <code>bar</code>:</p>
<ul>
<li>If <code>$1 = foo</code>, then <code>$1 != foo</code> is false, so the statement is false.</li>
<li>If <code>$1 = bar</code>, then <code>$1 != bar</code> is false, so the statement is false.</li>
<li>If <code>$1 = cow</code>, then both <code>$1 != foo</code> and <code>$1  != bar</code> is true, so the statement is true.</li>
</ul>
<p>This statement is identical to <code>! [[ $1 = foo || $1 = bar ]]</code>, which also works correctly.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Rare.</p>
<ul>
<li>If I want to check that $FOO, $BAR and $COW are all equal:</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$FOO</span> !<span class="o">=</span> <span class="nv">$BAR</span> <span class="o">||</span> <span class="nv">$FOO</span> !<span class="o">=</span> <span class="nv">$COW</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FOO</span><span class="s2"> and </span><span class="nv">$BAR</span><span class="s2"> and </span><span class="nv">$COW</span><span class="s2"> are not all equal"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2142">Improper aliases</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#aliases-cant-use-positional-parameters-use-a-function">Aliases can't use positional parameters. Use a function.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="aliases-cant-use-positional-parameters-use-a-function">Aliases can't use positional parameters. Use a function.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">alias</span> <span class="nv">archive</span><span class="o">=</span><span class="s1">'mv "$@" /backup'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>archive<span class="o">()</span> <span class="o">{</span> mv <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> /backup<span class="p">;</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Aliases just substitute the start of a command with something else. They therefore can't use positional parameters, such as <code>$1</code>. Rewrite your alias as a function.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If your alias ends up quoting the value, e.g. <code>alias cut_first="awk '{print \$1}'"</code>, you can technically [[ignore]] this error. However, you should consider turning this alias into a more readable function instead: <code>cut_first() { awk '{print $1}' "$@"; }</code></p>
<p>You can also [[ignore]] this warning if you intentionally referenced the positional parameters of its relevant context, knowing that it won't refer to the parameters of the alias itself. For example, <code>alias whatisthis='echo "This is $0 -$-" #'</code> will show the shell name with flags, i.e. <code>This is dash -smi</code> or <code>This is bash -himBs</code>, and is correct usage because it does not intend for <code>$0</code> to reflect anything related to the <code>whatisthis</code> alias or its invocation.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashFAQ/080">BashFaq: How can I make an alias that takes an argument?</a></li>
<li><a href="https://stackoverflow.com/questions/7131670/make-a-bash-alias-that-takes-a-parameter">StackOverflow: Make a Bash alias that takes a parameter?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1028">Not escaping back slash</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-you-have-to-escape-92-92-or-preferably-combine-expressions">In [..] you have to escape \( \) or preferably combine [..] expressions.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="in-you-have-to-escape-92-92-or-preferably-combine-expressions">In [..] you have to escape \( \) or preferably combine [..] expressions.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -e ~/.bashrc -a <span class="o">(</span> -x /bin/dash -o -x /bin/ash <span class="o">)</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>In POSIX:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -e ~/.bashrc <span class="o">]</span> <span class="o">&amp;&amp;</span>  <span class="o">{</span> <span class="o">[</span> -x /bin/dash <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> -x /bin/ash <span class="o">]</span><span class="p">;</span> <span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Obsolete XSI syntax:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -e ~/.bashrc -a <span class="se">\(</span> -x /bin/dash -o -x /bin/ash <span class="se">\)</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[</code> is implemented as a regular command, so <code>(</code> is not special.</p>
<p>The preferred way is not to group inside <code>[ .. ]</code> and instead compose multiple <code>[ .. ]</code> statments using the shell's <code>&amp;&amp;</code>, <code>||</code> and <code>{ ..; }</code> syntax, since this is well defined by POSIX.</p>
<p>Some shells, such as Bash, support grouping with <code>\( .. \)</code>, but this is an obsolete XSI-only extension.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2199">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#arrays-implicitly-concatenate-in-use-a-loop-or-explicit-instead-of">Arrays implicitly concatenate in [[ ]]. Use a loop (or explicit * instead of @).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="arrays-implicitly-concatenate-in-use-a-loop-or-explicit-instead-of">Arrays implicitly concatenate in <code>[[ ]]</code>. Use a loop (or explicit * instead of @).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">ext</span><span class="o">=</span>png
<span class="nv">allowedExt</span><span class="o">=(</span>jpg bmp png<span class="o">)</span>
<span class="o">[[</span> <span class="s2">"</span><span class="nv">$ext</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">allowedExt</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Extension is valid"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">ext</span><span class="o">=</span>png
<span class="nv">allowedExt</span><span class="o">=(</span>jpg bmp png<span class="o">)</span>
<span class="k">for</span> value in <span class="s2">"</span><span class="si">${</span><span class="nv">allowedExt</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">do</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$ext</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Extension is valid"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Array expansions in <code>[[ .. ]]</code> will implicitly concatenate into a single string, much like in assignments. The problematic code is equivalent to <code>[ "$ext" = "jpg bmp png" ]</code>. </p>
<p>Instead, use a <code>for</code> loop to iterate over values, and apply your condition to each.</p>
<p>Alternatively, if you do want to concatenate all the values in the array into a single string for your test, use <code>"$*"</code> or <code>"${array[*]}"</code> to make this explicit.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2172">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#trapping-signals-by-number-is-not-well-defined-prefer-signal-names">Trapping signals by number is not well defined. Prefer signal names.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="trapping-signals-by-number-is-not-well-defined-prefer-signal-names">Trapping signals by number is not well defined. Prefer signal names.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> myfunc <span class="m">28</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> myfunc WINCH
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Signal numbers can vary between platforms. Prefer signal names, which are fixed.</p>
<p>Signal numbers 1, 2, 3, 6, 9, 14 and 15 are specified as parts of the optional POSIX XSI and ShellCheck will not warn about these. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2196">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#egrep-is-non-standard-and-deprecated-use-grep-e-instead">egrep is non-standard and deprecated. Use grep -E instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="egrep-is-non-standard-and-deprecated-use-grep-e-instead">egrep is non-standard and deprecated. Use grep -E instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>egrep <span class="s1">'foo|bar'</span> file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep -E <span class="s1">'foo|bar'</span> file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>egrep</code> is a non-standard command. Its functionality is provided in POSIX by <code>grep -E</code>. <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html">POSIX grep</a> says:</p>
<blockquote>
<p>This grep has been enhanced in an upwards-compatible way to provide the exact functionality of the historical egrep and fgrep commands as well. It was the clear intention of the standard developers to consolidate the three greps into a single command.</p>
</blockquote>
<p>man grep for GNU says:</p>
<blockquote>
<p>Direct invocation as either egrep or fgrep is deprecated</p>
</blockquote>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck will fail to recognize when functions override <code>egrep</code>. Consider giving it a different name or [[ignore]] this error. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2226">Improper 'ln' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-ln-has-no-destination-check-the-arguments-or-specify-explicitly">This ln has no destination. Check the arguments, or specify '.' explicitly.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-ln-has-no-destination-check-the-arguments-or-specify-explicitly">This ln has no destination. Check the arguments, or specify '.' explicitly.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ln <span class="s2">"</span><span class="nv">$file</span><span class="s2"> </span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ln /foo/bar/baz
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ln <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ln /foo/bar/baz .
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a <code>ln</code> command with a single parameter. This may be because the source and destination was accidentally merged into a single argument, because the line was broken in an invalid way, or because you're using a non-standard invocation of <code>ln</code> that defaults to linking the argument into the current directory.</p>
<p>If you wanted to specify both source and destination, fix the <code>ln</code> statement.</p>
<p>If you wanted to link a file into the current directory, prefer using the more explicit and POSIX standard invocation <code>ln /your/file .</code> </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2194">Missing `$` on a variable</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-word-is-constant-did-you-forget-the-on-a-variable">This word is constant. Did you forget the $ on a variable?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-word-is-constant-did-you-forget-the-on-a-variable">This word is constant. Did you forget the $ on a variable?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> foo in
  bar<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Match"</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nv">$foo</span> in
  bar<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Match"</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using a <code>case</code> statement to compare a literal word.</p>
<p>You most likely wanted to treat this word as a <code>$variable</code> or <code>$(command)</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2056">Improper logic</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-probably-wanted-here">You probably wanted &amp;&amp; here</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-probably-wanted-here">You probably wanted &amp;&amp; here</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span>  <span class="o">((</span> <span class="nv">$1</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">||</span> <span class="nv">$1</span> !<span class="o">=</span> <span class="m">3</span> <span class="o">))</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not 0 or 3"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span>  <span class="o">((</span> <span class="nv">$1</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$1</span> !<span class="o">=</span> <span class="m">3</span> <span class="o">))</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2"> is not 0 or 3"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is not a bash issue, but a simple, common logical mistake applicable to all languages.</p>
<p><code>(( $1 != 0 || $1 != 3 ))</code> is always true:</p>
<ul>
<li>If <code>$1 = 0</code> then <code>$1 != 3</code> is true, so the statement is true.</li>
<li>If <code>$1 = 3</code> then <code>$1 != 0</code> is true, so the statement is true.</li>
<li>If <code>$1 = 42</code> then <code>$1 != 0</code> is true, so the statement is true.</li>
</ul>
<p><code>(( $1 != 0 &amp;&amp; $1 != 3 ))</code> is true only when <code>$1</code> is not <code>0</code> and not <code>3</code>:</p>
<ul>
<li>If <code>$1 = 0</code>, then <code>$1 != 3</code> is false, so the statement is false.</li>
<li>If <code>$1 = 3</code>, then <code>$1 != 0</code> is false, so the statement is false.</li>
<li>If <code>$1 = 42</code>, then both <code>$1 != 0</code> and <code>$1  != 3</code> is true, so the statement is true.</li>
</ul>
<p>This statement is identical to <code>! (( $1 == 0 || $1 == 3 ))</code>, which also works correctly.</p>
<h3 id="exceptions">Exceptions</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2143">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-grep-q-instead-of-comparing-output-with-n">Use grep -q instead of comparing output with [ -n .. ].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-grep-q-instead-of-comparing-output-with-n">Use grep -q instead of comparing output with [ -n .. ].</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">$(</span>find . <span class="p">|</span> grep <span class="s1">'IMG[0-9]'</span><span class="k">)</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Images found"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> find . <span class="p">|</span> grep -q <span class="s1">'IMG[0-9]'</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Images found"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The problematic code has to iterate the entire directory and read all matching lines into memory before making a decision.</p>
<p>The correct code is cleaner and stops at the first matching line, avoiding both iterating the rest of the directory and reading data into memory.</p>
<h3 id="exceptions">Exceptions</h3>
<p>The <code>pipefail</code> bash option may interfere with this rewrite, since the <code>if</code> will now in effect be evaluating the statuses of all commands instead of just the last one. Be careful using them together.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1136">Unexpected characters after`]`</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unexpected-characters-after-terminating-missing-semicolonlinefeed">Unexpected characters after terminating ]. Missing semicolon/linefeed?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="unexpected-characters-after-terminating-missing-semicolonlinefeed">Unexpected characters after terminating <code>]</code>. Missing semicolon/linefeed?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e <span class="s2">"foo.txt"</span> <span class="o">]</span>: <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Exists"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -e <span class="s2">"foo.txt"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Exists"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found unexpected characters after the <code>]</code> or <code>]]</code> in a <code>test</code> expression. In the example, a colon was accidentally used instead of a semicolon.</p>
<p>Similarly, a missing space before a comment (<code>[ -e foo ]#comment</code>), an additional square bracket (<code>[[ -e foo ]]]</code>), or a missing semicolon before a <code>then</code> on the same line (<code>if [ foo ]then</code>) can cause this warning.</p>
<p>Make sure the <code>]</code> or <code>]]</code> is not immediately followed by another shell word character. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2179">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-arrayitem-to-append-items-to-an-array">Use array+=("item") to append items to an array.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-arrayitem-to-append-items-to-an-array">Use array+=("item") to append items to an array.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=(</span>one two<span class="o">)</span>
<span class="nv">var</span><span class="o">+=</span>three
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=(</span>one two<span class="o">)</span>
<span class="nv">var</span><span class="o">+=(</span> three <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>It looks like you are trying to append a string to an array with <code>var+=string</code>. This instead appends to the first element of the array (equivalent to <code>var[0]+=three</code>).</p>
<p>In the problematic code, the array will therefore contain <code>onethree</code> <code>two</code>.</p>
<p>Instead, append an array to the array with <code>var+=( elements )</code>. This will append the new items to the array.</p>
<p>In the correct code, it will contain <code>one</code> <code>two</code> <code>three</code> as expected.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If ShellCheck mistakenly thinks the variable is an array when it's not (e.g. because the same name was used in a different context), you can ignore this error.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2028">Improper using of 'echo'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#echo-wont-expand-escape-sequences-consider-printf">echo won't expand escape sequences. Consider printf.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="echo-wont-expand-escape-sequences-consider-printf">echo won't expand escape sequences. Consider printf.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Name:\t</span><span class="nv">$value</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'Name:\t%s\n'</span> <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Backslash escapes like <code>\t</code> and <code>\n</code> are not expanded by echo, and become literal backslash-t, backslash-n.</p>
<p><code>printf</code> does expand these sequences, and should be used instead.</p>
<p>Other, non-portable methods include <code>echo -e '\t'</code> and <code>echo $'\t'</code>. ShellCheck will warn if this is used in a script with shebang <code>#!/bin/sh</code>.</p>
<p>If you actually wanted a literal backslash-t, use</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"\\t"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2161">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#instead-of-1-use-true">Instead of '[ 1 ]', use 'true'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="instead-of-1-use-true">Instead of '[ 1 ]', use 'true'.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="o">[</span> <span class="m">1</span> <span class="o">]</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"infinite loop"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">true</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"infinite loop"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This is a stylistic suggestion to use <code>true</code> instead of <code>[ 1 ]</code>.</p>
<p><code>[ 1 ]</code> seems to suggest that the value "1" is somehow relevant to the statement. This is not the case: it doesn't matter. You can replace it with <code>[ 0 ]</code> or <code>[ wombat ]</code>, and it will still always be true.</p>
<p>If you instead use <code>true</code>, the value is actually considered and can be inverted by replacing with <code>false</code>.</p>
<p>On bash, you can also use <code>(( 1 ))</code>, which evaluates to true much like in C. <code>(( 0 ))</code> is similarly false.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2053">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-the-rhs-of-in-to-prevent-glob-matching">Quote the rhs of = in [[ ]] to prevent glob matching.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-the-rhs-of-in-to-prevent-glob-matching">Quote the rhs of = in [[ ]] to prevent glob matching.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$a</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$b</span><span class="s2">"</span> <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When the right-hand side of <code>=</code>, <code>==</code> or <code>!=</code> is unquoted in <code>[[ .. ]]</code>, it will be treated like a glob.</p>
<p>This has some unexpected consequences like <code>[[ $var = $var ]]</code> being false (for <code>var='[a]'</code>), or <code>[[ $foo = $bar ]]</code> giving a different result from <code>[[ $bar = $foo ]]</code>.</p>
<p>The most common intention is to compare one variable to another as strings, in which case the right-hand side must be quoted.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you explicitly want to match against a pattern, you can [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2217">Bad piping</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#redirecting-to-echo-a-command-that-doesnt-read-stdin-bad-quoting-or-missing-xargs">Redirecting to 'echo', a command that doesn't read stdin. Bad quoting or missing xargs?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="redirecting-to-echo-a-command-that-doesnt-read-stdin-bad-quoting-or-missing-xargs">Redirecting to 'echo', a command that doesn't read stdin. Bad quoting or missing xargs?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s">&lt;&lt; eof</span>
<span class="s">  Hello World</span>
<span class="s">eof</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; eof</span>
<span class="s">  Hello World</span>
<span class="s">eof</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are redirecting to one of several commands that don't read from stdin.</p>
<p>This may happen when:</p>
<ul>
<li>Confusing one command for another, e.g. using <code>echo</code> where <code>cat</code> was intended.</li>
<li>Incorrectly quoting angle brackets, e.g. using <code>echo &lt;p&gt;Hello</code> which tries to read from a file <code>p</code>.</li>
<li>Missing <code>xargs</code>, e.g. <code>mv -t dir &lt; files</code> instead of <code>xargs mv -t dir &lt; files</code> (or more safely, <code>tr '\n' '\0' &lt; files | xargs -0 mv -t dir</code>), because stdin should be passed as parameters.</li>
</ul>
<p>Check your logic, and rewrite the command so data is passed correctly.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you've overridden a command to return output, you can either rename it to make this obvious, or [[ignore]] this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1026">Problematic expression grouping</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#if-grouping-expressions-inside-use">If grouping expressions inside [[..]], use ( .. ).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="if-grouping-expressions-inside-use">If grouping expressions inside [[..]], use ( .. ).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="o">[</span> a <span class="o">||</span> b <span class="o">]</span> <span class="o">&amp;&amp;</span> c <span class="o">]]</span>
<span class="o">[</span> <span class="o">[</span> a -o b <span class="o">]</span> -a c <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="o">(</span> a <span class="o">||</span> b <span class="o">)</span> <span class="o">&amp;&amp;</span> c <span class="o">]]</span>
<span class="o">[</span> <span class="se">\(</span> a -o b <span class="se">\)</span> -a c <span class="o">]]</span>  <span class="c1"># or  { [ a ] || [ b ]; } &amp;&amp; [ c ]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>[ .. ]</code> should not be used to group subexpressions inside <code>[[ .. ]]</code> or <code>[ .. ]</code> statements.</p>
<p>For <code>[[ .. ]]</code>, use regular parentheses.</p>
<p>For <code>[ .. ]</code>, either use escaped parentheses, or preferably rewrite the expression into multiple <code>[ .. ]</code> joined with <code>&amp;&amp;</code>, <code>||</code> and <code>{ ..; }</code> groups. The latter is preferred because <code>[ .. ]</code> is undefined for more than 4 arguments in POSIX.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://mywiki.wooledge.org/BashPitfalls#pf11">Bash Pitfalls: <code>if [ [ a = b ] &amp;&amp; [ c = d ] ]; then ...</code></a></li>
<li><a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html">POSIX <code>test</code></a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1011">Invalid quote mark</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-apostrophe-terminated-the-single-quoted-string">This apostrophe terminated the single quoted string!</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-apostrophe-terminated-the-single-quoted-string">This apostrophe terminated the single quoted string!</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'Nothing so needs reforming as other people'</span>s habits.<span class="err">'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'Nothing so needs reforming as other people'</span><span class="se">\'</span><span class="s1">'s habits.'</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"Nothing so needs reforming as other people's habits."</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When writing a string in single quotes, you have to make sure that any apostrophes in the text don't accidentally terminate the single quoted string prematurely.</p>
<p>Escape them properly (see the correct code) or switch quotes to avoid the problem.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2024">Ineffective sudo</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sudo-doesnt-affect-redirects-use-sudo-tee-file">sudo doesn't affect redirects. Use ..| sudo tee file</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sudo-doesnt-affect-redirects-use-sudo-tee-file"><code>sudo</code> doesn't affect redirects. Use <code>..| sudo tee file</code></h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo echo 'export FOO=bar' &gt;&gt; /etc/profile
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo 'export FOO=bar' | sudo tee -a /etc/profile &gt; /dev/null
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Redirections are performed by the current shell before <code>sudo</code> is started. This means that it will use the current shell's user and permissions to open and write to the file.</p>
<p><code>tee</code> is a simple command that opens and writes to files without help from the shell, which means that it will use the permissions that <code>sudo</code> grants it.</p>
<p>There is nothing special about <code>tee</code>. It's just the simplest command that can both truncate and append to files without help from the shell. Here are equivalent alternatives:</p>
<p>Truncating:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo 'data' | sudo dd of=file
echo 'data' | sudo sed 'w file'
</pre></div>
</td></tr></table>
<p>Appending: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>echo 'data' | sudo awk '{ print $0 &gt;&gt; "file" }'
echo 'data' | sudo sh -c 'cat &gt;&gt; file'
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to run a command as root but redirect as the normal user, you can ignore this message.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2224">Improper 'mv' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-mv-has-no-destination-check-the-arguments">This mv has no destination. Check the arguments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-mv-has-no-destination-check-the-arguments">This mv has no destination. Check the arguments.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mv <span class="s2">"</span><span class="nv">$file</span><span class="s2"> </span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mv <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found an <code>mv</code> command with a single parameter. This may be because the source and destination was accidentally merged into a single argument, or because the line was broken in an invalid way.</p>
<p>Fix the <code>mv</code> statement by correctly specifying both source and destination.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2255">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#does-not-apply-arithmetic-evaluation-evaluate-with-for-numbers-or-use-string-comparator-for-strings">[ ] does not apply arithmetic evaluation. Evaluate with $((..)) for numbers, or use string comparator for strings.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="does-not-apply-arithmetic-evaluation-evaluate-with-for-numbers-or-use-string-comparator-for-strings"><code>[ ]</code> does not apply arithmetic evaluation. Evaluate with <code>$((..))</code> for numbers, or use string comparator for strings.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="m">2</span>*3 -eq array<span class="o">[</span>i<span class="o">]</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="k">$((</span><span class="m">2</span><span class="o">*</span><span class="m">3</span><span class="k">))</span> -eq <span class="k">$((</span>array<span class="o">[</span>i<span class="o">]</span><span class="k">))</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When using <code>[[ .. ]]</code> with numerical comparators (<code>-eq</code>, <code>-lt</code>, etc), the value on either side will be evaluated as an arithmetic expression. This means that <code>2*3</code> will be evaluated to <code>6</code>, and <code>x</code> will be evaluated to the contents of the variable <code>$x</code>.</p>
<p>When using <code>[ .. ]</code>, this does not happen. <code>2*3</code> and <code>x</code> will both be considered invalid numbers. Instead, use e.g. <code>$((2*3))</code> to evaluate the expression before passing it to <code>[ .. ]</code>.</p>
<p>Alternatively, if the expression should be considered a string, quote the expression and use a string comparison operator like <code>=</code> and <code>!=</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2173">Improper signal handling</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sigkillsigstop-can-not-be-trapped">SIGKILL/SIGSTOP can not be trapped.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sigkillsigstop-can-not-be-trapped">SIGKILL/SIGSTOP can not be trapped.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">trap</span> <span class="s1">'echo "unkillable"'</span> KILL
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Not applicable. This is not possible.</p>
<h3 id="rationale">Rationale:</h3>
<p>SIGKILL and SIGSTOP can not be caught/ignored (according to POSIX and as implemented on platforms including Linux and FreeBSD). Trying to trap this signal has undefined results.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you come across one, please file an issue about it.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2237">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-n-instead-of-z">Use [ -n .. ] instead of ! [ -z .. ].</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-n-instead-of-z">Use <code>[ -n .. ]</code> instead of <code>! [ -z .. ]</code>.</h2>
<p>(or "Use <code>[ -z .. ]</code> instead of <code>! [ -n .. ]</code>.)</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> ! <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"JAVA_HOME not specified"</span><span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> ! <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$STY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>       <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"You are already running screen"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"JAVA_HOME not specified"</span><span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$STY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span>       <span class="k">then</span> <span class="nb">echo</span> <span class="s2">"You are already running screen"</span><span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have negated <code>test -z</code> or <code>test -n</code>, resulting in a needless double-negative. You can just use the other operator instead:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Identical tests to verify that a value is assigned
! [ -z foo ] # Not has no value
[ -n foo ]   # Has value

# Identical tests to verify that a value is empty
! [ -n foo ] # Not is non-empty
[ -z foo ]   # Is empty
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>This is a stylistic issue that does not affect correctness. If you prefer the original expression, you can't not [[Ignore]] it with a directive or flag.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://google.github.io/styleguide/shell.xml?showone=Testing_Strings#Testing_Strings">Google Bash Style Guide</a> on Testing Strings</li>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2156">Relative path traversal</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#injecting-filenames-is-fragile-and-insecure-use-parameters">Injecting filenames is fragile and insecure. Use parameters.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="injecting-filenames-is-fragile-and-insecure-use-parameters">Injecting filenames is fragile and insecure. Use parameters.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.mp3'</span> -exec sh -c <span class="s1">'i="{}"; sox "$i" "${i%.mp3}.wav"'</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.mp3'</span> -exec sh -c <span class="s1">'i="$1"; sox "$i" "${i%.mp3}.wav"'</span> _ <span class="o">{}</span> <span class="se">\;</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>In the problematic example, the filename is passed by injecting it into a shell string. Any shell metacharacters in the filename will be interpreted as part of the script, and not as part of the filename. This can break the script and allow arbitrary code execution exploits.</p>
<p>In the correct example, the filename is passed as a parameter. It will be safely treated as literal text. The <code>_</code> is a dummy string that becomes <code>$0</code> in the script.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2191">Suspicious '='</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-here-is-literal-to-assign-by-index-use-indexvalue-with-no-spaces-to-keep-as-literal-quote-it">The = here is literal. To assign by index, use ( [index]=value ) with no spaces. To keep as literal, quote it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-here-is-literal-to-assign-by-index-use-indexvalue-with-no-spaces-to-keep-as-literal-quote-it">The = here is literal. To assign by index, use ( [index]=value ) with no spaces. To keep as literal, quote it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="o">[</span>index<span class="o">]</span> <span class="o">=</span> value <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span> <span class="o">[</span>index<span class="o">]=</span>value <span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The shell doesn't care about the <code>=</code> sign in your array assignment because it's not part of a recognized index assignment. Instead, it's considered a literal character and becomes part of an array element's value.</p>
<p>In the example problematic code, this is because the <code>=</code> was intended to set the index, but the shell will not recognize it when it is surrounded by spaces.</p>
<p>Make sure to remove any spaces around the <code>=</code> when assigning by index, such as in the correct code.</p>
<p>If you wanted the <code>=</code> to be a literal part of the array element, add quotes around it, such as <code>env=( "LC_CTYPE=C" )</code> or <code>specialChars=( "=" "%" ";" )</code> .</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1044">Missing 'EOF'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#couldnt-find-end-token-eof-in-the-here-document">Couldn't find end token `EOF' in the here document.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="couldnt-find-end-token-eof-in-the-here-document">Couldn't find end token `EOF' in the here document.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF
  Hello World
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF</span>
<span class="s">  Hello World</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The <code>&lt;&lt;</code> here document (aka heredoc) was not properly terminated. The terminating token needs to be on a separate line without indenting (or indented with tabs only when using <code>&lt;&lt;-</code>).</p>
<p>Note that you can not put here documents in one liners. For such use cases, use a <code>&lt;&lt;&lt;</code> here string:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF  hello world  EOF   # Wrong: data and terminator can not be on the same line
cat &lt;&lt;&lt; "hello world"          # Correct
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1123">Improper ShellCheck directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shellcheck-directives-are-only-valid-in-front-of-complete-compound-commands-like-if-not-eg-individual-elif-branches">ShellCheck directives are only valid in front of complete compound commands, like if, not e.g. individual elif branches.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="shellcheck-directives-are-only-valid-in-front-of-complete-compound-commands-like-if-not-eg-individual-elif-branches">ShellCheck directives are only valid in front of complete compound commands, like <code>if</code>, not e.g. individual <code>elif</code> branches.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$prod</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Prod mode"</span>
<span class="c1"># shellcheck disable=2154</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$debug</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Debug mode"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Applies to entire `if...fi` command</span>
<span class="c1"># shellcheck disable=2154</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$prod</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Prod mode"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$debug</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Debug mode"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$prod</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Prod mode"</span>
<span class="k">elif</span>  <span class="c1"># Applies only to this [ .. ] command</span>
      <span class="c1"># shellcheck disable=2154</span>
      <span class="o">[</span> <span class="s2">"</span><span class="nv">$debug</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Debug mode"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to have put a directive before a non-command keyword, such as <code>elif</code>, <code>else</code>, <code>do</code>, <code>;;</code> or similar. </p>
<p>Unlike many other linters, ShellCheck comment directives apply to the next shell command, rather than to the next line of text.</p>
<p>This means that you can put a directive in front of a <code>while</code> loop, <code>if</code> statement or function definition, and it will apply to that entire structure.</p>
<p>However, it also means that you can not apply the directive to non-commands like an individual <code>elif</code> or <code>else</code> block since these are not commands by themselves, and rather just parts of an <code>if</code> compound command.</p>
<p>Please move the directive in front of the nearest applicable command that contains the code you want to apply it to, such as before the <code>if</code>. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2030">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#modification-of-var-is-local-to-subshell-caused-by-pipeline">Modification of var is local (to subshell caused by pipeline).</a></li>
</ul>
</div>

            <div>
                
<h1 id="modification-of-var-is-local-to-subshell-caused-by-pipeline">Modification of var is local (to subshell caused by pipeline).</h1>
<p>See companion warning [[SC2031]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2084">Ambiguous arithmetic to execution</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-or-use-_expr-to-avoid-executing-output">Remove '$' or use '_=$((expr))' to avoid executing output.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="remove-or-use-_expr-to-avoid-executing-output">Remove '$' or use '_=$((expr))' to avoid executing output.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>
<span class="k">$((</span> i++ <span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Bash, Ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>
<span class="o">((</span> i++ <span class="o">))</span>
</pre></div>
</td></tr></table>
<p>POSIX (assuming <code>++</code> is supported):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="m">4</span>
<span class="nv">_</span><span class="o">=</span><span class="k">$((</span> i++ <span class="k">))</span>
</pre></div>
</td></tr></table>
<p>Alternative POSIX version that does not preserve the exit code:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>: <span class="k">$((</span> i++ <span class="k">))</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>$((..))</code> expands to a number. If it's the only word on the line, the shell will try to execute this number as a command name:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">i</span><span class="o">=</span><span class="m">4</span>
$ <span class="k">$((</span> i++ <span class="k">))</span>
<span class="m">4</span>: <span class="nb">command</span> not found
$ <span class="nb">echo</span> <span class="nv">$i</span>
<span class="m">5</span>
</pre></div>
</td></tr></table>
<p>To avoid trying to execute the number as a command name, use one of the methods mentioned:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">i</span><span class="o">=</span><span class="m">4</span>
$ <span class="nv">_</span><span class="o">=</span><span class="k">$((</span> i++ <span class="k">))</span>
$ <span class="nb">echo</span> <span class="nv">$i</span>
<span class="m">5</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1130">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-before-the">You need a space before the :.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-before-the">You need a space before the :.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">until</span> make
<span class="k">do</span>:<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">until</span> make
<span class="k">do</span> :<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a keyword immediately followed by a <code>:</code>. <code>:</code> is a synonym for <code>true</code>, the command that "does nothing, successfully", and as a command name it needs a space. </p>
<p><code>do:</code> is as invalid as <code>dotrue</code>. Use <code>do :</code>, or preferably, <code>do true</code> for readability.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2202">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#globs-dont-work-as-operands-in-use-a-loop">Globs don't work as operands in [ ]. Use a loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="globs-dont-work-as-operands-in-use-a-loop">Globs don't work as operands in [ ]. Use a loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> current.log -nt backup/*.log <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the latest file"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">newerThanAll</span><span class="o">=</span><span class="nb">true</span>
<span class="k">for</span> log in backup/*.log
<span class="k">do</span>
  <span class="o">[</span> current.log -nt <span class="s2">"</span><span class="nv">$log</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="nv">newerThanAll</span><span class="o">=</span><span class="nb">false</span>
<span class="k">done</span>
<span class="o">[</span> <span class="s2">"</span><span class="nv">$newerThanAll</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the latest file"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Globs in <code>[ ]</code> will expand to a sequence of words, one per matching filename. Meanwhile, operators work on single words.</p>
<p>The problematic code is equivalent to <code>[ current.log -nt backup/file1.log backup/file2.log backup/file3.log ]</code>, which is invalid syntax. A typical error message is <code>bash: [: too many arguments</code> or <code>dash: somefile: unexpected operator</code>. </p>
<p>Instead, use a <code>for</code> loop to iterate over matching filenames, and apply your condition to each.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you know your glob will only ever match one file, you can check this explicitly and use the first file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>set -- backup/*.log
[ $# -eq 1 ] || { echo "There are too many matches."; exit 1; }
[ file.log -nt "$1" ] &amp;&amp; echo "This is the latest file"
</pre></div>
</td></tr></table>
<p>Alternatively, [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2243">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#prefer-explicit-n-to-check-for-output-or-run-command-without-to-check-for-success">Prefer explicit -n to check for output (or run command without [/[[ to check for success)</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="prefer-explicit-n-to-check-for-output-or-run-command-without-to-check-for-success">Prefer explicit -n to check for output (or run command without [/[[ to check for success)</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">$(</span>mycommand --myflags<span class="k">)</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"True"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Check that the command outputs something on stdout</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="k">$(</span>mycommand --myflags<span class="k">)</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"The command had output on stdout"</span>
<span class="k">fi</span>

<span class="c1"># Check instead that the command succeeded (exit code = 0)</span>
<span class="k">if</span> mycommand --myflags
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"The command reported success"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>(if the command instead outputs "0" or "false", see [[SC2244]] for integer and "boolean" comparisons)</p>
<h3 id="rationale">Rationale:</h3>
<p><code>[ "$(mycommand)" ]</code> is equivalent to <code>[ -n "$(mycommand)" ]</code> and checks whether the command's output on stdout was non-empty.</p>
<p>Users more familiar with other languages are often surprised to learn that it is nothing like e.g. <code>if (myfunction())</code>, since it does not care about what the command/function <code>return</code>s.</p>
<p>Using an explicit <code>-n</code> helps clarify that this is purely a string operation. And of course, if the intention was to check whether the command ran successfully, now would be a good time to fix it as in the alternate example.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you are familiar with the semantics of <code>[</code>, you can [[ignore]] this suggestion with no ill effects.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2041">Improper literal string</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-literal-string-to-run-as-a-command-use-instead-of">This is a literal string. To run as a command, use $(..) instead of '..' .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-literal-string-to-run-as-a-command-use-instead-of">This is a literal string. To run as a command, use $(..) instead of '..' .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in <span class="s1">'seq 1 10'</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> <span class="m">10</span><span class="k">)</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The intent was to run the code in the single quotes. This would have worked with slanted backticks, <code>`..`</code>, but here the very similar looking single quotes <code>'..'</code> were used, resulting in a string literal instead of command output.</p>
<p>This is one of the many problems with backticks, so it's better to use <code>$(..)</code> to expand commands.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2050">Missing `$` on a variable</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-expression-is-constant-did-you-forget-the-on-a-variable">This expression is constant. Did you forget the $ on a variable?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-expression-is-constant-did-you-forget-the-on-a-variable">This expression is constant. Did you forget the <code>$</code> on a variable?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="nv">myvar</span> <span class="o">=</span> <span class="s2">"test"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Test mode"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$myvar</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Test mode"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a <code>[ .. ]</code> or <code>[[ .. ]]</code> comparison that only involves literal strings. The intention was probably to check a variable or command output instead.</p>
<p>This is usually due to missing <code>$</code> or bad quoting:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>if [[ "myvar" = "test" ]]             # always false because myvar is a literal string
if [[ "$myvar" = "test" ]]            # correctly compares a variable

if [ 'grep -c foo bar' -ge 10 ]       # always false because grep doesn't run
if [ "$(grep -c foo bar)" -ge 10 ]    # correctly checks grep output
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2230">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#which-is-non-standard-use-builtin-command-v-instead">which is non-standard. Use builtin 'command -v' instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#caveats">Caveats:</a><ul>
<li><a href="#command-v-does-not-check-all-parameters">command -v does not check ALL parameters</a></li>
</ul>
</li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="which-is-non-standard-use-builtin-command-v-instead">which is non-standard. Use builtin 'command -v' instead.</h2>
<p>Note: This check is opt-in only in ShellCheck 0.7.1+ (<code>shellcheck -o deprecate-which</code>).</p>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>which grep
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For the path of a single, unaliased, external command,</span>
<span class="c1"># or to check whether this will just "run" in this shell:</span>
<span class="nb">command</span> -v grep
<span class="c1"># To check whether commands exist, without obtaining a reusable path:</span>
<span class="nb">hash</span> grep
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>which</code> is a non-standard, external tool that locates an executable in PATH. <code>command -v</code> is a POSIX standard builtin, which uses the same lookup mechanism that the shell itself would.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>This check is opt-in only in 0.7.1+, and you may choose to [[ignore]] it in earlier versions. <code>which</code> is very common, and some prefer its executable-or-nothing behavior over <code>command -v</code>'s handling of builtins, functions and aliases.</p>
<h3 id="caveats">Caveats:</h3>
<h4 id="command-v-does-not-check-all-parameters"><code>command -v</code> does not check ALL parameters</h4>
<p><code>command -v</code> succeeds (with exit code 0) if <em>any</em> command exists:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span># grep is in /usr/bin/grep
# foobar is not in path
#
$ command -v -- grep foobar; echo $?
0
</pre></div>
</td></tr></table>
<p>In the above example, it should have failed and exited with 1 unless <em>all</em> commands
exist, if it were to be a replacement for <code>which</code>. Other problems associated with
<code>command</code> include its inclusion of builtins, aliases, and functions.</p>
<p>An alternative is:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nb">hash</span> &lt;file1&gt; &lt;file2&gt;
</pre></div>
</td></tr></table>
<p>Which observes the standard behaviour of failures.</p>
<p>To obtain a path, <code>type -p</code> can be used instead. Like <code>command -v</code>, it has a similarly
quirky behavior with builtins, aliases, and functions, although this is
arguably milder since it would print nothing for these cases. The failure condition is
similar to <code>hash</code>.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="https://stackoverflow.com/a/677212/1899640">Check if a program exists from a Bash script</a> on StackOverflow.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1127">Improper comment mark</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#was-this-intended-as-a-comment-use-in-sh">Was this intended as a comment? Use # in sh.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="was-this-intended-as-a-comment-use-in-sh">Was this intended as a comment? Use <code>#</code> in sh.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// This is a comment.</span>
<span class="cm">/* This too. */</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># This is a comment.</span>
<span class="c1"># This too.</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found what appears to be a C-style comment, a line starting with <code>//</code> or <code>/*</code>.</p>
<p>In Bourne based shell scripts, the comment character is <code>#</code></p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1112">Using unicode quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-is-a-unicode-quote-delete-and-retype-it-or-ignoredoublequote-for-literal">This is a unicode quote. Delete and retype it (or ignore/doublequote for literal).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-is-a-unicode-quote-delete-and-retype-it-or-ignoredoublequote-for-literal">This is a unicode quote. Delete and retype it (or ignore/doublequote for literal).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="err">'</span>hello world’
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'hello world'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Some software, like OS X, Word and WordPress, may automatically replace your regular quotes with slanted Unicode quotes. The shell does not recognize these quotes and will not respect them.</p>
<p>In this case, you have slanted single quotes in a single quoted string. Try deleting and retyping them, and/or disable “smart quotes” in your editor or OS.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you want to use literal slanted single quotes for typographic reasons, you can put them in double quotes to make ShellCheck ignore them:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s2">"Warning: ‘wakeonlan’ is not installed.\\n"</span>
</pre></div>
</td></tr></table>
<p>You can also just [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2231">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-expansions-in-this-for-loop-glob-to-prevent-wordsplitting-eg-dirtxt">Quote expansions in this for loop glob to prevent wordsplitting, e.g. "$dir"/*.txt .</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-expansions-in-this-for-loop-glob-to-prevent-wordsplitting-eg-dirtxt">Quote expansions in this for loop glob to prevent wordsplitting, e.g. "$dir"/*.txt .</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in <span class="nv">$dir</span>/*.txt
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Found </span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> file in <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>/*.txt
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"Found </span><span class="nv">$file</span><span class="s2">"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When iterating over globs containing expansions, you can still quote all expansions in the path to better handle whitespace and special characters.</p>
<p>Just make sure glob characters are outside quotes. <code>"$dir/*.txt"</code> will not glob expand, but <code>"$dir"/*.txt</code> or <code>"$dir"/*."$ext"</code> will. </p>
<h3 id="exceptions">Exceptions:</h3>
<p>Exceptions similar to [[SC2086]] apply. If the variable is expected to contain globs, such as if <code>dir="tmp/**"</code> in the example, you can ignore this message.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2140">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#word-is-on-the-form-abc-b-indicated-did-you-mean-abc-or-a92b92c">Word is on the form "A"B"C" (B indicated). Did you mean "ABC" or "A\"B\"C"?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="word-is-on-the-form-abc-b-indicated-did-you-mean-abc-or-a92b92c">Word is on the form "A"B"C" (B indicated). Did you mean "ABC" or "A\"B\"C"?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"&lt;img src="</span>foo.png<span class="s2">" /&gt;"</span> &gt; file.html
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="s2">"var"</span><span class="o">=</span><span class="s2">"42"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"&lt;img src=\"foo.png\" /&gt;"</span> &gt; file.html
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="s2">"var=42"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>This warning triggers when an unquoted literal string is found suspiciously sandwiched between two double quoted strings.</p>
<p>This usually indicates one of:</p>
<ul>
<li>quotes that were supposed to be nested, and therefore need to be escaped (like the <code>&lt;img&gt;</code> example)</li>
<li>quotes that are just plain unnecessary (like the <code>export</code> example).</li>
</ul>
<p>Without escaping, the inner two quotes of the sandwich (the end quote of the first section and the start quote of the second section) are no-ops. The following two statements are identical, so the quotes that were intended to be part of the html output are instead removed:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"&lt;img src="</span>foo.png<span class="s2">" /&gt;"</span> &gt; file.html
<span class="nb">echo</span> <span class="s2">"&lt;img src=foo.png /&gt;"</span> &gt; file.html
</pre></div>
</td></tr></table>
<p>Similarly, these statements are identical, but work as intended:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="s2">"var"</span><span class="o">=</span><span class="s2">"42"</span>
<span class="nb">export</span> <span class="s2">"var=42"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>If you know that the quotes are ineffectual but you prefer it stylistically, you can ignore this message.</p>
<p>It's common not to realize that double quotes can span multiple elements, or to stylistically prefer to quote individual variables. For example, these statements are identical, but the first is laboriously and redundantly quoted:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://<span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span>:<span class="s2">"</span><span class="nv">$password</span><span class="s2">"</span>@<span class="s2">"</span><span class="nv">$host</span><span class="s2">"</span>/<span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span>
<span class="s2">"http://</span><span class="nv">$user</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">@</span><span class="nv">$host</span><span class="s2">/</span><span class="nv">$path</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>When ShellCheck detects the first style (i.e. the double quotes include only a single element each), it will suppress the warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2189">Improper output redirection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-cant-have-between-this-redirection-and-the-command-it-should-apply-to">You can't have | between this redirection and the command it should apply to.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-cant-have-between-this-redirection-and-the-command-it-should-apply-to">You can't have | between this redirection and the command it should apply to.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt; file.txt <span class="p">|</span> grep foo
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt; file.txt grep foo   <span class="c1"># or more canonically: grep foo &lt; file.txt</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck has found a stage in a pipeline that consists of a redirection but no command. This doesn't make sense because a redirection without a command will not read or write any data.</p>
<p>This is most likely to occur when deleting a command that had a redirection, but leaving a <code>|</code> behind instead of moving the redirection to a different command:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Match lines with line numbers
nl &lt; foo.txt | grep bar

# Incorrect attempt at removing line numbers. grep now has no input:
&lt; foo.txt | grep bar

# Line numbers correctly removed. grep now reads foo.txt as intended.
grep bar &lt; foo.txt
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>It's technically valid to do e.g. <code>echo foo | &gt; "$(cat)"</code> to truncate a file called "foo", but please consider rewriting such code.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1004">Incorrect line switch</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-backslashlinefeed-is-literal-break-outside-single-quotes-if-you-just-want-to-break-the-line">This backslash+linefeed is literal. Break outside single quotes if you just want to break the line.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="this-backslashlinefeed-is-literal-break-outside-single-quotes-if-you-just-want-to-break-the-line">This backslash+linefeed is literal. Break outside single quotes if you just want to break the line.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s1">'This is long \</span>
<span class="s1">piece of text'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="s1">'This is a long '</span><span class="se">\</span>
<span class="s1">'piece of text'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have a single quoted string containing a backslash followed by a linefeed (newline). Unlike double quotes or unquoted strings, this has no special meaning. The string will contain a literal backslash and a linefeed.</p>
<p>If you wanted to break the line but not add a linefeed to the string, stop the single quote, break the line, and reopen it. This is demonstrated in the correct code.</p>
<p>If you wanted to break the line and also include the linefeed as a literal, you don't need a backslash:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>var='This is a multi-line string
with an embedded linefeed'
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want a string containing a literal backslash+linefeed combo, such as with <code>sed</code>, you can [[ignore]] this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2068">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#double-quote-array-expansions-to-avoid-re-splitting-elements">Double quote array expansions to avoid re-splitting elements.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="double-quote-array-expansions-to-avoid-re-splitting-elements">Double quote array expansions to avoid re-splitting elements.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="nv">$@</span> ~/dir
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cp <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> ~/dir
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Double quotes around <code>$@</code> (and similarly, <code>${array[@]}</code>) prevents globbing and word splitting of individual elements, while still expanding to multiple separate arguments.</p>
<p>Let's say you have three arguments: <code>baz</code>, <code>foo bar</code> and <code>*</code></p>
<p><code>"$@"</code> will expand into exactly that: <code>baz</code>, <code>foo bar</code> and <code>*</code></p>
<p><code>$@</code> will expand into multiple other arguments: <code>baz</code>, <code>foo</code>, <code>bar</code>, <code>file.txt</code> and <code>otherfile.jpg</code></p>
<p>Since the latter is rarely expected or desired, ShellCheck warns about it.</p>
<h3 id="exceptions">Exceptions</h3>
<p>When you want globbing of individual elements.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2012">Better directive choice exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-find-instead-of-ls-to-better-handle-non-alphanumeric-filenames">Use find instead of ls to better handle non-alphanumeric filenames.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#tips-for-replacing-ls-with-find">Tips for replacing ls with find:</a><ul>
<li><a href="#just-the-filenames-maam">Just the filenames, ma'am</a></li>
<li><a href="#all-the-other-info">All the other info</a></li>
</ul>
</li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-find-instead-of-ls-to-better-handle-non-alphanumeric-filenames">Use <code>find</code> instead of <code>ls</code> to better handle non-alphanumeric filenames.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ls -l <span class="p">|</span> grep <span class="s2">" </span><span class="nv">$USER</span><span class="s2"> "</span> <span class="p">|</span> grep <span class="s1">'\.txt$'</span>
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">NUMGZ</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>ls -l *.gz <span class="p">|</span> wc -l<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -maxdepth <span class="m">1</span> -name <span class="s1">'*.txt'</span> -user <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span>  <span class="c1"># Using the names of the files</span>
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">gz_files</span><span class="o">=(</span>*.gz<span class="o">)</span>
<span class="nv">numgz</span><span class="o">=</span><span class="si">${#</span><span class="nv">gz_files</span><span class="p">[@]</span><span class="si">}</span> <span class="c1"># Sometimes, you just need a count</span>
<span class="sb">````</span>
<span class="c1">### Rationale:</span>

<span class="sb">`</span>ls<span class="sb">`</span> is only intended <span class="k">for</span> human consumption: it has a loose, non-standard format and may <span class="s2">"clean up"</span> filenames to make output easier to read.

Here<span class="err">'</span>s an example:

<span class="sb">```</span>sh
$ ls -l
total <span class="m">0</span>
-rw-r----- <span class="m">1</span> me me <span class="m">0</span> Feb  <span class="m">5</span> <span class="m">20</span>:11 foo?bar
-rw-r----- <span class="m">1</span> me me <span class="m">0</span> Feb  <span class="m">5</span>  <span class="m">2011</span> foo?bar
-rw-r----- <span class="m">1</span> me me <span class="m">0</span> Feb  <span class="m">5</span> <span class="m">20</span>:11 foo?bar
</pre></div>
</td></tr></table>
<p>It shows three seemingly identical filenames, and did you spot the time format change? How it formats and what it redacts can differ between locale settings, <code>ls</code> version, and whether output is a tty.</p>
<h3 id="tips-for-replacing-ls-with-find">Tips for replacing <code>ls</code> with <code>find</code>:</h3>
<h4 id="just-the-filenames-maam">Just the filenames, ma'am</h4>
<p><code>ls</code> can usually be replaced by <code>find</code> if it's just the filenames, or a count of them, that you're after. Note that if you are using <code>ls</code> to get at the contents of a directory, a straight substitution of <code>find</code> may not yield the same results as <code>ls</code>. Here is an example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ls -c1 .snapshot
rnapdev1-svm_4_05am_6every4hours.2019-04-01_1605
rnapdev1-svm_4_05am_6every4hours.2019-04-01_2005
rnapdev1-svm_4_05am_6every4hours.2019-04-02_0005
rnapdev1-svm_4_05am_6every4hours.2019-04-02_0405
rnapdev1-svm_4_05am_6every4hours.2019-04-02_0805
rnapdev1-svm_4_05am_6every4hours.2019-04-02_1205
snapmirror.1501b4aa-3f82-11e8-9c31-00a098cef13d_2147868328.2019-04-01_190000
</pre></div>
</td></tr></table>
<p>versus</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ find .snapshot -maxdepth <span class="m">1</span>
.snapshot
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0005
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0405
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0805
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_1605
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_2005
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_1205
.snapshot/snapmirror.1501b4aa-3f82-11e8-9c31-00a098cef13d_2147868328.2019-04-01_190000
</pre></div>
</td></tr></table>
<p>You can see two differences here. The first is that the <code>find</code> output has the full paths to the found files, relative to the current working directory from which <code>find</code> was run whereas <code>ls</code> only has the filenames. You may have to adjust your code to not add the directory to the filenames as you process them when moving from <code>ls</code> to <code>find</code>, or (with GNU find) use <code>-printf '%P\n'</code> to print just the filename.</p>
<p>The second difference in the two outputs is that the <code>find</code> command includes the searched directory as an entry. This can be eliminated by also using <code>-mindepth 1</code> to skip printing the root path, or using a negative name option for the searched directory:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ find .snapshot -maxdepth <span class="m">1</span> ! -name .snapshot
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0005
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0405
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0805
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_1605
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_2005
.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_1205
.snapshot/snapmirror.1501b4aa-3f82-11e8-9c31-00a098cef13d_2147868328.2019-04-01_190000
</pre></div>
</td></tr></table>
<p><strong>Note:</strong> If the directory argument to <code>find</code> is a fully expressed path (<code>/home/somedir/.snapshot</code>), then you should use <code>basename</code> on the <code>-name</code> filter:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ <span class="nv">theDir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.snapshot"</span>
$ find <span class="s2">"</span><span class="nv">$theDir</span><span class="s2">"</span> -maxdepth <span class="m">1</span> ! -name <span class="s2">"</span><span class="k">$(</span>basename <span class="nv">$theDir</span><span class="k">)</span><span class="s2">"</span>
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0005
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0405
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_0805
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_1605
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-01_2005
/home/matt/.snapshot/rnapdev1-svm_4_05am_6every4hours.2019-04-02_1205
/home/matt/.snapshot/snapmirror.1501b4aa-3f82-11e8-9c31-00a098cef13d_2147868328.2019-04-01_190000
</pre></div>
</td></tr></table>
<h4 id="all-the-other-info">All the other info</h4>
<p>If trying to parse out any other fields, first see whether <code>stat</code> (GNU, OS X, FreeBSD) or <code>find -printf</code> (GNU) can give you the data you want directly.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If the information is intended for the user and not for processing (<code>ls -l ~/dir | nl; echo "Ok to delete these files?"</code>) you can ignore this error with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2045">Looping on 'ls' directive results</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#iterating-over-ls-output-is-fragile-use-globs">Iterating over ls output is fragile. Use globs.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="iterating-over-ls-output-is-fragile-use-globs">Iterating over ls output is fragile. Use globs.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>for f in $(ls *.wav)
do
  echo "$f"
done
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>for f in *.wav
do
  [[ -e "$f" ]] || break  # handle the case of no *.wav files
  echo "$f"
done
</pre></div>
</td></tr></table>
<p>Also note that in Bash, <code>shopt -s nullglob</code> will allow the loop to run 0 times instead of 1 if there are no matches. There are also <a href="http://mywiki.wooledge.org/BashPitfalls#for_i_in_.24.28ls_.2A.mp3.29">several other conditions</a> to be aware of.</p>
<h3 id="rationale">Rationale:</h3>
<p>When looping over a set of files, it's always better to use globs when possible. Using command expansion causes word splitting and glob expansion, which will cause problems for certain filenames (typically first seen when trying to process a file with spaces in the name).</p>
<p>The following files can or will break the first loop:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>touch 'filename with spaces.wav'
touch 'filename with * globs.wav'
touch 'More_Globs[2003].wav'
touch 'files_with_fønny_chæracters_in_certain_locales.wav'
</pre></div>
</td></tr></table>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="http://mywiki.wooledge.org/BashPitfalls#pf1">Bash Pitfalls: for i in $(ls *.mp3)</a></li>
<li><a href="https://stackoverflow.com/questions/2107945/how-to-loop-over-directories-in-linux">How to loop over directories in Linux?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2197">Portability issue</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#fgrep-is-non-standard-and-deprecated-use-grep-f-instead">fgrep is non-standard and deprecated. Use grep -F instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="fgrep-is-non-standard-and-deprecated-use-grep-f-instead">fgrep is non-standard and deprecated. Use grep -F instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>fgrep <span class="s1">'*.*'</span> file
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>grep -F <span class="s1">'*.*'</span> file
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>fgrep</code> is a non-standard command. Its functionality is provided in POSIX by <code>grep -F</code>. <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html">POSIX grep</a> says:</p>
<blockquote>
<p>This grep has been enhanced in an upwards-compatible way to provide the exact functionality of the historical egrep and fgrep commands as well. It was the clear intention of the standard developers to consolidate the three greps into a single command.</p>
</blockquote>
<p>man grep for GNU says:</p>
<blockquote>
<p>Direct invocation as either egrep or fgrep is deprecated</p>
</blockquote>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck will fail to recognize when functions override <code>fgrep</code>. Consider giving it a different name or [[ignore]] this error. </p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1095">Missing space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#you-need-a-space-or-linefeed-between-the-function-name-and-body">You need a space or linefeed between the function name and body.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="you-need-a-space-or-linefeed-between-the-function-name-and-body">You need a space or linefeed between the function name and body.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span> foo<span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"hello world"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Prefer POSIX syntax:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"hello world"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Alternatively, add the missing space between function name and opening <code>{</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#           v-- Here</span>
<span class="k">function</span> foo <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"hello world"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>When using <code>function</code> keyword function definitions without <code>()</code>, a space is required between the function name and the opening <code>{</code>.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2201">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#brace-expansion-doesnt-happen-in-use-a-loop">Brace expansion doesn't happen in [[ ]]. Use a loop.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="brace-expansion-doesnt-happen-in-use-a-loop">Brace expansion doesn't happen in <code>[[ ]]</code>. Use a loop.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">=</span> index.<span class="o">{</span>htm,html,php<span class="o">}</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the main file"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> main in index.<span class="o">{</span>htm,html,php<span class="o">}</span>
<span class="k">do</span>
  <span class="o">[[</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$main</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"This is the main file"</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Brace expansions doesn't happen in <code>[[ ]]</code>. They will just be interpreted literally.</p>
<p>Instead, use a <code>for</code> loop to iterate over values, and apply your condition to each.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1090">Not following directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#cant-follow-non-constant-source-use-a-directive-to-specify-location">Can't follow non-constant source. Use a directive to specify location.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a><ul>
<li><a href="#shellcheck-p-sourcepath-source-pathsourcepath">shellcheck -P SOURCEPATH, --source-path=SOURCEPATH</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="cant-follow-non-constant-source-use-a-directive-to-specify-location">Can't follow non-constant source. Use a directive to specify location.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>. <span class="s2">"</span><span class="k">$(</span>find_install_dir<span class="k">)</span><span class="s2">/lib.sh"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># shellcheck source=src/lib.sh</span>
. <span class="s2">"</span><span class="k">$(</span>find_install_dir<span class="k">)</span><span class="s2">/lib.sh"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck is not able to include sourced files from paths that are determined at runtime. The file will not be read, potentially resulting in warnings about unassigned variables and similar.</p>
<p>Use a [[Directive]] to point shellcheck to a fixed location it can read instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you don't care that ShellCheck is unable to account for the file, specify <code># shellcheck source=/dev/null</code>.</p>
<h4 id="shellcheck-p-sourcepath-source-pathsourcepath">shellcheck -P <em>SOURCEPATH</em>, --source-path=<em>SOURCEPATH</em></h4>
<p><code>shellcheck -P dir1:dir2/libs</code></p>
<p>Specify paths to search for sourced files, separated by <code>:</code> on Unix and <code>;</code> on Windows. Absolute paths will also be rooted in these. </p>
<p>The special path <strong><em><code>SCRIPTDIR</code></em></strong> can be used to specify searching the currently checked script's directory, as in <strong><code>-P SCRIPTDIR</code></strong> or <strong><code>-P SCRIPTDIR/../libs</code></strong>. Subsequent <code>-P</code> flags accumulate and take precedence.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2121">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#to-assign-a-variable-use-just-varvalue-no-set">To assign a variable, use just 'var=value', no 'set ..'.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="to-assign-a-variable-use-just-varvalue-no-set">To assign a variable, use just 'var=value', no 'set ..'.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="nv">var</span><span class="o">=</span><span class="m">42</span>
<span class="nb">set</span> var <span class="m">42</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">var</span><span class="o">=</span><span class="m">42</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>set</code> is not used to set or assign variables in Bourne shells. It's used to set shell options and positional parameters.</p>
<p>To assign variables, use <code>var=value</code> with no <code>set</code> or other qualifiers.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you actually do want to set positional parameters, simply quoting them or using <code>--</code> will make shellcheck stop warning, e.g. <code>set -- var1 var2</code> or <code>set "foo=bar"</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2008">Using pipe for 'echo'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#echo-doesnt-read-from-stdin-are-you-sure-you-should-be-piping-to-it">echo doesn't read from stdin, are you sure you should be piping to it?</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="echo-doesnt-read-from-stdin-are-you-sure-you-should-be-piping-to-it">echo doesn't read from stdin, are you sure you should be piping to it?</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . <span class="p">|</span> <span class="nb">echo</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find .
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are piping command output to <code>echo</code>, but <code>echo</code> ignores all piped input.</p>
<p>In particular, <code>echo</code> is not responsible for putting output on screen. Commands already output data, and with no further actions that will end up on screen.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2061">Missing quote</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quote-the-parameter-to-name-so-the-shell-wont-interpret-it">Quote the parameter to -name so the shell won't interpret it.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="quote-the-parameter-to-name-so-the-shell-wont-interpret-it">Quote the parameter to -name so the shell won't interpret it.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name *.txt
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>find . -name <span class="s1">'*.txt'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Several find options take patterns to match against, including <code>-ilname</code>, <code>-iname</code>, <code>-ipath</code>, <code>-iregex</code>, <code>-iwholename</code>, <code>-lname</code>, <code>-name</code>, <code>-path</code>, <code>-regex</code> and <code>-wholename</code>.</p>
<p>These compete with the shell's pattern expansion, and must therefore be quoted so that they are passed literally to <code>find</code>.</p>
<p>The example command may end up executing as <code>find . -name README.txt</code> after the shell has replaced the <code>*.txt</code> with a matching file <code>README.txt</code> from the current directory. </p>
<p>This may happen today or suddenly in the future.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2049">Ambiguous wildcard character</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#is-for-regex-but-this-looks-like-a-glob-use-instead">=~ is for regex, but this looks like a glob. Use = instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="is-for-regex-but-this-looks-like-a-glob-use-instead">=~ is for regex, but this looks like a glob. Use = instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$file</span> <span class="o">=</span>~ *.txt <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="nv">$file</span> <span class="o">=</span> *.txt <span class="o">]]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using <code>=~</code> to match against a regex -- specifically a Extended Regular Expression (ERE) -- but the right-hand side looks more like a glob:</p>
<ul>
<li>
<p>It may have a leading <code>*</code>, like in <code>*.txt</code></p>
<ul>
<li>In a glob, this matches strings ending in <code>.txt</code>, like <code>readme.txt</code> but not <code>foo.sh</code></li>
<li>In an ERE, this matches a literal asterisk, followed by any character, and then <code>txt</code>, such as <code>*itxt</code> but not <code>test.txt</code></li>
</ul>
</li>
<li>
<p>It may be a single letter followed by a <code>*</code>, like in <code>s*</code>. </p>
<ul>
<li>In a glob, this matches strings starting with <code>s</code>, such as <code>shell</code> and <code>set</code>.</li>
<li>In an ERE, this matches zero or more <code>s</code>s, such as <code>dog</code> (because it does in fact contain zero or more <code>s</code>'s)</li>
</ul>
</li>
</ul>
<p>Please ensure that the pattern is correct as an ERE, or switch to glob matching if that's what you intended.</p>
<p>This is similar to [[SC2063]], where <code>grep "*foo*"</code> produces an equivalent warning.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you are aware of the difference, you can [[ignore]] this message, but this warning is not emitted for the more probable EREs <code>\*.txt</code>, <code>\.txt$</code>, <code>^s</code> or <code>s+</code>, so it should rarely be necessary.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2171">Found trailing ] outside test</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#found-trailing-outside-test-add-missing-or-quote-if-intentional">Found trailing ] outside test. Add missing [ or quote if intentional.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="found-trailing-outside-test-add-missing-or-quote-if-intentional">Found trailing ] outside test. Add missing [ or quote if intentional.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> foo -eq bar <span class="o">]</span><span class="p">;</span> <span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -d <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> foo -eq bar <span class="o">]</span><span class="p">;</span> <span class="k">then</span> true<span class="p">;</span> <span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -d <span class="s1">']'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck found a non-test command that ends with <code>]</code> or <code>]]</code>.</p>
<p>If this was intended to be a test expression like in the first example, add the missing <code>[</code> or <code>[[</code>. </p>
<p>If the <code>]</code> was intended to be literal, like in <code>tr -d ]</code>, you can quote to make this obvious.</p>
<h3 id="exceptions">Exceptions:</h3>
<p><code>tr -d ]</code> is valid and not different from <code>tr -d ']'</code>, so in these cases you can ignore the error instead.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2104">Using 'break' outside loops</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#in-functions-use-return-instead-of-break">In functions, use return instead of break.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="in-functions-use-return-instead-of-break">In functions, use return instead of break.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$1</span> <span class="o">]]</span>
  <span class="k">then</span>
    <span class="nb">break</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>foo<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$1</span> <span class="o">]]</span>
  <span class="k">then</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">"Hello </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>break</code> or <code>continue</code> are used to abort or continue a loop, and are not the right way to exit a function. Use <code>return</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>The <code>break</code> or <code>continue</code> may be intended for a loop that calls the function:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span># Rarely valid
foo() { break; echo $?; }
while true; do foo; done
</pre></div>
</td></tr></table>
<p>This is undefined behavior in POSIX sh. Different shells do different things.</p>
<p>When the function is called from a loop:</p>
<ul>
<li><code>ksh</code> keeps going and <code>$?</code> is 0.</li>
<li><code>bash</code> version 4.4+ prints an error "break: only meaningful in a `for', `while', or `until' loop", the function keeps going, and <code>$?</code> is 0. </li>
<li><code>bash</code> versions before 4.4, will return from the function, break the loop calling the function, or exit a subshell if there's one in between.</li>
<li><code>dash</code>, BusyBox <code>ash</code>: like above.</li>
</ul>
<p>When the function is not called from a loop:</p>
<ul>
<li>All <code>bash</code> versions print an error "break: only meaningful in a `for', `while', or `until' loop", the function keeps going, and <code>$?</code> is 0. </li>
<li><code>ksh</code>, <code>dash</code> and <code>ash</code> silently keep going and <code>$?</code> is 0.</li>
</ul>
<p>Due to the many different implementations, many of which are not helpful, it's recommended to use proper flow control. A typical solution is making sure the function <code>return</code>s success/failure, and calling <code>myfunction || break</code> in the loop.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1122">End token with followers</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#nothing-allowed-after-end-token-to-continue-a-command-put-it-on-the-line-with-the">Nothing allowed after end token. To continue a command, put it on the line with the &lt;&lt;.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="nothing-allowed-after-end-token-to-continue-a-command-put-it-on-the-line-with-the">Nothing allowed after end token. To continue a command, put it on the line with the <code>&lt;&lt;</code>.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF</span>
<span class="s">Hello</span>
<span class="s">EOF</span> <span class="p">|</span> nl
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF | nl</span>
<span class="s">Hello</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You have a here document, and appear to have added text after the terminating token.</p>
<p>This is not allowed. If it was meant to continue the command, put it on the line with the <code>&lt;&lt;</code>.</p>
<p>If it helps, look at &lt;&lt; "END" as if it was &lt; file, and make sure the resulting command is valid. This is what the shell does. You can then append here document data after the command.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2005">Redundant 'echo'</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>


            <div>
                <p>[TOC]
Useless <code>echo</code>? Instead of <code>echo $(cmd)</code>, just use <code>cmd</code></p>
<hr>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="k">$(</span>cat <span class="m">1</span>.txt<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="sb">`</span>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 <span class="p">|</span> head -c6<span class="sb">`</span>
</pre></div>
</td></tr></table>

<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat <span class="m">1</span>.txt <span class="c1"># In bash, but faster and still sticks exactly one newline: printf &#39;%s\n&#39; &quot;$(&lt;1.txt)&quot;</span>
<span class="c1"># The original `echo` sticks a newline; we want it too.</span>
&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 <span class="p">|</span> head -c6<span class="p">;</span> <span class="nb">echo</span>
</pre></div>
</td></tr></table>

<h3 id="rationale">Rationale</h3>
<p>The command substitution <code>$(foo)</code> yields the result of command <code>foo</code> with trailing newlines erased, and when it is passed to <code>echo</code> it generally just gives the same result as <code>foo</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>One may want to use command substitutions plus <code>echo</code> to make sure there is exactly one trailing newline. The special command substitution <code>$(&lt;file)</code> in <code>bash</code> is also un-outline-able.</p>
<p>Anyway, echo is still not that reliable (see [[SC2039#echo-flags]]) and <code>printf</code> should be used instead.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2001">Simplification possibility exists</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#sc2001-see-if-you-can-use-variablesearchreplace-instead">SC2001: See if you can use ${variable//search/replace} instead.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="sc2001-see-if-you-can-use-variablesearchreplace-instead">SC2001: See if you can use ${variable//search/replace} instead.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">string</span><span class="o">=</span><span class="s2">"stirng"</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$string</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s2">"s/ir/ri/"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">string</span><span class="o">=</span><span class="s2">"stirng"</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">string</span><span class="p">//ir/ri</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Let's assume somewhere earlier in your code you have put data into a variable (Ex: $string). Now you want to do a search and replace inside the contents of $string and echo the contents out. You could pass this to sed as done in the example above, but for simple substitutions, parameter expansion can do it with less overhead.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Occasionally a more complex sed substitution is required. For example, getting the last character of a string.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">string</span><span class="o">=</span><span class="s2">"stirng"</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$string</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s2">"s/^.*\(.\)</span>$<span class="s2">/\1/"</span>
</pre></div>
</td></tr></table>
<p>This is a bit simple for the example and there are alternative ways of doing this in the shell, but this SC2001 flags on several of my crazy complex sed commands which are beyond the scope of this example. Utilizing some of the more complex capabilities of sed is required occasionally and it is safe to ignore SC2001.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Bash Manual: <a href="https://www.gnu.org/software/bash/manual/bashref.html#Shell-Parameter-Expansion">Shell Parameter Expansion</a></li>
<li>Wooledge BashGuide: <a href="https://mywiki.wooledge.org/BashGuide/Parameters#Parameter_Expansion">Parameter Expansion</a>.</li>
<li>Bash Hacker Wiki: <a href="http://wiki.bash-hackers.org/syntax/pe">Parameter Expansion</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1104">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-not-just-for-the-shebang">Use #!, not just !, for the shebang.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-not-just-for-the-shebang">Use #!, not just !, for the shebang.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>!/bin/sh
<span class="nb">echo</span> <span class="s2">"Hello"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">"Hello"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to be specifying an interpreter in a shebang, but it's missing the hash part. The shebang must always start with <code>#!</code>. </p>
<p>Even the name "shebang" itself comes from "hash" (<code>#</code>) + "bang" (<code>!</code>). </p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2089">Improper use of Quotes/backslashes</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#quotesbackslashes-will-be-treated-literally-use-an-array">Quotes/backslashes will be treated literally. Use an array.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#additional-resources">Additional resources</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="quotesbackslashes-will-be-treated-literally-use-an-array">Quotes/backslashes will be treated literally. Use an array.</h1>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">args</span><span class="o">=</span><span class="s1">'-lh "My File.txt"'</span>
ls <span class="nv">$args</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>In Bash/Ksh with arrays:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">args</span><span class="o">=(</span>-lh <span class="s2">"My File.txt"</span><span class="o">)</span>
ls <span class="s2">"</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or in POSIX overwriting <code>"$@"</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">set</span> -- -lh <span class="s2">"My File.txt"</span>
ls <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<p>or in POSIX via functions:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>myls<span class="o">()</span> <span class="o">{</span> ls <span class="s2">"-lh"</span> <span class="s2">"My File.txt"</span><span class="p">;</span> <span class="o">}</span>
myls
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Bash does not interpret data as code. Consider almost any other languages, such as Python:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span>   <span class="c1"># prints 2</span>
<span class="n">a</span><span class="o">=</span><span class="s2">"1+1"</span>
<span class="k">print</span> <span class="n">a</span>     <span class="c1"># prints 1+1, not 2</span>
</pre></div>
</td></tr></table>
<p>Here, <code>1+1</code> is Python syntax for adding numbers. However, passing a literal string containing this expression does not cause Python to interpret it, see the <code>+</code> and produce the calculated result.</p>
<p>Similarly, <code>"My File.txt"</code> is Bash syntax for a single word with a space in it. However, passing a literal string containing this expression does not cause Bash to interpret it, see the quotes and produce the tokenized result.</p>
<p>The solution is to use an array instead, whenever possible.</p>
<p>If due to <code>sh</code> compatibility you can't use arrays, you can sometimes use functions instead. Instead of trying to create a set of arguments that has to be passed to a command, create a function that calls the function with arguments plus some more:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ffmpeg_with_args<span class="o">()</span> <span class="o">{</span>
  ffmpeg -filter_complex <span class="s1">'[#0x2ef] setpts=PTS+1/TB [sub] ; [#0x2d0] [sub] overlay'</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>
ffmpeg_with_args -i <span class="s2">"My File.avi"</span> <span class="s2">"Output.avi"</span>
</pre></div>
</td></tr></table>
<p>In other cases, you may have to use <code>eval</code> instead, though this is often fragile and insecure. If you get it wrong, it'll appear to work great in all test cases, and may still lead to various forms of security vulnerabilities and breakage:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>quote<span class="o">()</span> <span class="o">{</span> <span class="nb">local</span> <span class="nv">q</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="p">//</span><span class="se">\'</span><span class="p">/</span><span class="se">\'\\\'\'</span><span class="si">}</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"'</span><span class="nv">$q</span><span class="s2">'"</span><span class="p">;</span> <span class="o">}</span>
<span class="nv">args</span><span class="o">=</span><span class="s2">"-lh </span><span class="k">$(</span>quote <span class="s2">"My File.txt"</span><span class="k">)</span><span class="s2">"</span>
<span class="nb">eval</span> ls <span class="s2">"</span><span class="nv">$args</span><span class="s2">"</span> <span class="c1"># Do not use unless you understand implications</span>
</pre></div>
</td></tr></table>
<p>If you ever accidentally forget to use proper quotes, such as with:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> f in *.txt<span class="p">;</span> <span class="k">do</span>
  <span class="nv">args</span><span class="o">=</span><span class="s2">"-lh '</span><span class="nv">$1</span><span class="s2">'"</span> <span class="c1"># Example security exploit</span>
  <span class="nb">eval</span> ls <span class="s2">"</span><span class="nv">$args</span><span class="s2">"</span> <span class="c1"># Do not copy and use</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
<p>Then you can use <code>touch "'; rm -rf \$'\x2F'; '.txt"</code>  (or someone can trick you into downloading a file with this name, or create a zip file or git repo containing it, or changing their nick and have your chat client create the file for a chat log, or...), and running the script to list your files will run the command <code>rm -rf /</code>.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Few and far between.</p>
<h3 id="additional-resources">Additional resources</h3>
<ul>
<li><a href="http://mywiki.wooledge.org/BashFAQ/050">Wooledge BashFAQ #50</a>: I'm trying to put a command in a variable, but the complex cases always fail!</li>
<li><a href="https://stackoverflow.com/questions/12136948/in-bash-why-do-shell-commands-ignore-quotes-in-arguments-when-the-arguments-are">StackOverflow: In bash, why do shell commands ignore quotes in arguments when the arguments are passed to them as a variable?</a></li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2257">Ineffective arithmetic modifications</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#arithmetic-modifications-in-command-redirections-may-be-discarded-do-them-separately">Arithmetic modifications in command redirections may be discarded. Do them separately.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="arithmetic-modifications-in-command-redirections-may-be-discarded-do-them-separately">Arithmetic modifications in command redirections may be discarded. Do them separately.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>curl <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span> &gt; <span class="s2">"image</span><span class="k">$((</span>i++<span class="k">))</span><span class="s2">.jpg"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
curl <span class="s2">"</span><span class="nv">$URL</span><span class="s2">"</span> &gt; <span class="s2">"image</span><span class="nv">$i</span><span class="s2">.jpg"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using an arithmetic expression that modifies a variable, e.g. <code>$((x+=1))</code> or <code>$((x++))</code>, in the name of a file to redirect from/to, in a here document, or in a here string.</p>
<p>The scope of these modifications depends on whether the command itself will fork:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> foo &gt; <span class="k">$((</span>var++<span class="k">))</span>.txt  <span class="c1"># Updates in BusyBox and Bash</span>
cat  foo &gt; <span class="k">$((</span>var++<span class="k">))</span>.txt  <span class="c1"># Updates in Busybox, not in Bash</span>
gcc  foo &gt; <span class="k">$((</span>var++<span class="k">))</span>.txt  <span class="c1"># Does not update in either</span>

gcc<span class="o">()</span> <span class="o">{</span> /opt/usr/bin/gcc <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
gcc  foo &gt; <span class="k">$((</span>var++<span class="k">))</span>.txt  <span class="c1"># Now suddenly updates in both</span>
</pre></div>
</td></tr></table>
<p>Rather than rely on knowing which commands do and don't fork, or are and aren't overridden, simply do the updates in a separate command as in the correct code.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you know your variable is scoped the way you want it, you can ignore this warning.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2164">Missing checking of failure of 'cd' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-cd-exit-in-case-cd-fails">Use cd ... || exit in case cd fails.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-cd-exit-in-case-cd-fails">Use cd ... || exit in case cd fails.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> generated_files
rm -r *.c
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>func<span class="o">(){</span>
  <span class="nb">cd</span> foo
  do_something
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> generated_files <span class="o">||</span> <span class="nb">exit</span>
rm -r *.c
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># For functions, you may want to use return:</span>
func<span class="o">(){</span>
  <span class="nb">cd</span> foo <span class="o">||</span> <span class="k">return</span>
  do_something
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>cd</code> can fail for a variety of reasons: misspelled paths, missing directories, missing permissions, broken symlinks and more.</p>
<p>If/when it does, the script will keep going and do all its operations in the wrong directory. This can be messy, especially if the operations involve creating or deleting a lot of files.</p>
<p>To avoid this, make sure you handle the cases when <code>cd</code> fails. Ways to do this include</p>
<ul>
<li><code>cd foo || exit</code> as suggested to abort immediately, reusing exit code from failed <code>cd</code> command</li>
<li><code>cd foo || { echo "Failure"; exit 1; }</code> abort with custom message</li>
<li><code>if cd foo; then echo "Ok"; else echo "Fail"; fi</code> for custom handling</li>
<li><code>&lt;(cd foo &amp;&amp; cmd)</code> as an alternative to <code>&lt;(cd foo || exit; cmd)</code> in <code>&lt;(..)</code>, <code>$(..)</code> or <code>( )</code></li>
</ul>
<h3 id="exceptions">Exceptions:</h3>
<p>ShellCheck does not give this warning when <code>cd</code> is on the left of a <code>||</code> or <code>&amp;&amp;</code>, or the condition of a <code>if</code>, <code>while</code> or <code>until</code> loop. Having a <code>set -e</code> command anywhere in the script will disable this message, even though it won't necessarily prevent the issue.</p>
<p>If you are accounting for <code>cd</code> failures in a way shellcheck doesn't realize, you can disable this message with a [[directive]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1118">Redundant space</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#delete-whitespace-after-the-here-doc-end-token">Delete whitespace after the here-doc end token.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="delete-whitespace-after-the-here-doc-end-token">Delete whitespace after the here-doc end token.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<p>"▭" below indicates an otherwise invisible space:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat &lt;&lt; <span class="s2">"eof"</span>
Hello
eof▭   
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cat &lt;&lt; <span class="s2">"eof"</span>
Hello
eof
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>The end token of your here document has trailing whitespace. This is invisible to the naked eye, but shells do not accept it.</p>
<p>Remove the trailing whitespace.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2222">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#this-pattern-never-matches-because-of-a-previous-pattern">This pattern never matches because of a previous pattern.</a></li>
</ul>
</div>

            <div>
                
<h2 id="this-pattern-never-matches-because-of-a-previous-pattern">This pattern never matches because of a previous pattern.</h2>
<p>See companion warning [[SC2221]].</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2123">Improper variable update</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#path-is-the-shell-search-path-use-another-name">PATH is the shell search path. Use another name.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="path-is-the-shell-search-path-use-another-name">PATH is the shell search path. Use another name.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">PATH</span><span class="o">=</span>/my/dir
cat <span class="s2">"</span><span class="nv">$PATH</span><span class="s2">/myfile"</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<p>Good practice: always use lowercase for unexported variables.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">path</span><span class="o">=</span>/my/dir
cat <span class="s2">"</span><span class="nv">$path</span><span class="s2">/myfile"</span>
</pre></div>
</td></tr></table>
<p>Bad practice: use another uppercase name.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">MYPATH</span><span class="o">=</span>/my/dir
cat <span class="s2">"</span><span class="nv">$MYPATH</span><span class="s2">/myfile"</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p><code>PATH</code> is where the shell looks for the commands it executes. By inadvertently overwriting it, the shell will be unable to find commands (like <code>cat</code> in this case).</p>
<p>You get this warning when ShellCheck suspects that you didn't meant to overwrite it (because it's a single path with no path separators).</p>
<p>Best shell scripting practice is to always use lowercase variable names to avoid accidentally overwriting exported and internal variables.</p>
<h3 id="exceptions">Exceptions</h3>
<p>If you're aware of the above and really do want to set your shell search path to <code>/my/dir</code>, you can ignore this warning.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1124">Improper ShellCheck directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#shellcheck-directives-are-only-valid-in-front-of-complete-commands-like-case-statements-not-individual-case-branches">ShellCheck directives are only valid in front of complete commands like 'case' statements, not individual case branches.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="shellcheck-directives-are-only-valid-in-front-of-complete-commands-like-case-statements-not-individual-case-branches">ShellCheck directives are only valid in front of complete commands like 'case' statements, not individual case branches.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nv">$?</span> in
  <span class="m">0</span><span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Success"</span> <span class="p">;;</span>
  <span class="c1"># shellcheck disable=2154</span>
  *<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$cmd</span><span class="s2"> </span><span class="nv">$flag</span><span class="s2"> returned failure"</span> <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Applies to everything in the `case` statement</span>
<span class="c1"># shellcheck disable=2154</span>
<span class="k">case</span> <span class="nv">$?</span> in
  <span class="m">0</span><span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Success"</span> <span class="p">;;</span>
  *<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$cmd</span><span class="s2"> </span><span class="nv">$flag</span><span class="s2"> returned failure"</span> <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<p>or </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nv">$?</span> in
  <span class="m">0</span><span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Success"</span> <span class="p">;;</span>
  *<span class="o">)</span>
     <span class="c1"># Applies to a single command within the `case`</span>
     <span class="c1"># shellcheck disable=2154</span>
     <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$cmd</span><span class="s2"> </span><span class="nv">$flag</span><span class="s2"> returned failure"</span>
     <span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You appear to have put a directive before a branch in a case statement.</p>
<p>ShellCheck directives can not be scoped to individual branches of <code>case</code> statements, only to the entire <code>case</code>, or to individual commands within it. Please move the directive as appropriate.</p>
<p>(It is possible to apply directives to all commands within a <code>{ ..: }</code> command group, if you truly wish to apply a directive to multiple commands but not the full <code>case</code> statement.)</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2021">Improper 'tr' directive</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#dont-use-around-ranges-in-tr-it-replaces-literal-square-brackets">Don't use [] around ranges in tr, it replaces literal square brackets.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="dont-use-around-ranges-in-tr-it-replaces-literal-square-brackets">Don't use [] around ranges in tr, it replaces literal square brackets.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -cd <span class="s1">'[a-z]'</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tr -cd <span class="s1">'a-z'</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>Ancient System V <code>tr</code> required brackets around operands, but modern implementations including POSIX, GNU, OS X and *BSD instead treat them as literals.</p>
<p>Unless you want to operate on literal square brackets, don't include them.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you do want to replace literal square brackets, reorder the expression (e.g. <code>a-z[]</code> to make it clear that the brackets are not special).</p>
<p>ShellCheck does not warn about correct usage of <code>[..]</code> in character and equivalence classes like <code>[:lower:]</code> and <code>[=e=]</code>.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1128">Incorrect shebang</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#the-shebang-must-be-on-the-first-line-delete-blanks-and-move-comments">The shebang must be on the first line. Delete blanks and move comments.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="the-shebang-must-be-on-the-first-line-delete-blanks-and-move-comments">The shebang must be on the first line. Delete blanks and move comments.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2018 Foobar, All rights reserved</span>
<span class="c1">#!/bin/bash</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Copyright 2018 Foobar, All rights reserved</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>A shebang only has an effect when it appears as the first line in a script. Specifically, the first two bytes of the file must be <code>#!</code>.</p>
<p>Adding comments, copyright notices or simply an accidental blank line before it will turn a shebang into an ineffectual comment. This means that the script is no longer in charge of its own interpreter, and may fail to run or produce different results depending on the context it's run (e.g. it may work from <code>bash</code> but not from <code>zsh</code> or via <code>sudo</code>).</p>
<p>Delete any leading blank lines, and move all comments after the shebang.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2073">Suspicious condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#escape-to-prevent-it-redirecting-or-switch-to">Escape \&lt; to prevent it redirecting (or switch to [[ .. ]]).</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="escape-to-prevent-it-redirecting-or-switch-to">Escape <code>\&lt;</code> to prevent it redirecting (or switch to <code>[[ .. ]]</code>).</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"aardvark"</span> &lt; <span class="s2">"zebra"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Alphabetical!"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">"aardvark"</span> <span class="se">\&lt;</span> <span class="s2">"zebra"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Alphabetical!"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<p>or optionally in Bash/Ksh:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="s2">"aardvark"</span> &lt; <span class="s2">"zebra"</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Alphabetical!"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using the operator <code>&lt;</code> or <code>&gt;</code> in a <code>[</code> test expression.</p>
<p>In this context, it will be considered a file redirection operator instead, so <code>[ "aardvark" &lt; "zebra" ]</code> is equivalent to <code>[ "aardvark" ] &lt; ./zebra</code>, which is true if there exists a readable file <code>zebra</code> in the current directory.</p>
<p>If you wanted to compare two strings lexicographically (alphabetically), escape the <code>&lt;</code> or <code>&gt;</code> with a backslash as in the correct example. </p>
<p>If you want to compare two numbers numerically, use <code>-lt</code> or <code>-ge</code> instead.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>None.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2092">Improper executing output</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#remove-backticks-to-avoid-executing-output">Remove backticks to avoid executing output.</a></li>
</ul>
</div>

            <div>
                
<h2 id="remove-backticks-to-avoid-executing-output">Remove backticks to avoid executing output.</h2>
<p>Backticks does the same thing as <code>$(..)</code>. See [[SC2091]] for a description of the same problem with this syntax.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC2058">Unknown unary operator.</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#unknown-unaryoperator">Unknown unaryoperator.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="unknown-unaryoperator">Unknown unaryoperator.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -E <span class="m">42</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">[</span> -e <span class="m">42</span> <span class="o">]</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>You are using an unknown unary operator in a <code>test</code> expression. Perhaps it's a typo?</p>
<p>In bash, you can use <code>help test</code> to see a list of supported operators:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  -a FILE        True if file exists.
  -b FILE        True if file is block special.
  -c FILE        True if file is character special.
  -d FILE        True if file is a directory.
  -e FILE        True if file exists.
  -f FILE        True if file exists and is a regular file.
  -g FILE        True if file is set-group-id.
  -h FILE        True if file is a symbolic link.
  -L FILE        True if file is a symbolic link.
  -k FILE        True if file has its `sticky' bit set.
  -p FILE        True if file is a named pipe.
  -r FILE        True if file is readable by you.
  -s FILE        True if file exists and is not empty.
  -S FILE        True if file is a socket.
  -t FD          True if FD is opened on a terminal.
  -u FILE        True if the file is set-user-id.
  -w FILE        True if the file is writable by you.
  -x FILE        True if the file is executable by you.
  -O FILE        True if the file is effectively owned by you.
  -G FILE        True if the file is effectively owned by your group.
  -N FILE        True if the file has been modified since it was last read.
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions:</h3>
<p>None. If you've tested and verified that the operator works but the latest version of ShellCheck says it's unknown, please <a href="https://github.com/koalaman/shellcheck/issues">submit a bug report</a>.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li><a href="http://wiki.bash-hackers.org/commands/classictest">The classic test command</a> on the Bash Hackers wiki.</li>
<li><a href="http://wiki.bash-hackers.org/syntax/ccmd/conditional_expression">The conditional expression</a> on the Bash Hackers wiki.</li>
<li><a href="https://mywiki.wooledge.org/BashGuide/TestsAndConditionals">Tests and conditionals</a> on the Wooledge BashGuide.</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/shell.html">shell</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues.html">Style issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/shell/style issues/code style and efficiency.html">Code style and efficiency</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="SC1131">Not using `elif` to start another branch</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/code-style-and-efficiency.html">Code style and efficiency</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#use-elif-to-start-another-branch">Use elif to start another branch.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale:</a></li>
<li><a href="#exceptions">Exceptions:</a></li>
<li><a href="#related-resources">Related resources:</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h2 id="use-elif-to-start-another-branch">Use <code>elif</code> to start another branch.</h2>
<h3 id="problematic-code">Problematic code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">false</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"hi"</span>
elseif <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"ho"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="correct-code">Correct code:</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">false</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"hi"</span>
<span class="k">elif</span> <span class="nb">true</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"ho"</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table>
<h3 id="rationale">Rationale:</h3>
<p>ShellCheck noticed that you appear to be using <code>elseif</code> or <code>elsif</code> as a keyword. This is not valid.</p>
<p><code>sh</code> instead uses <code>elif</code> as its alternative branch keyword.</p>
<h3 id="exceptions">Exceptions:</h3>
<p>If you have made your own function called <code>elseif</code> and intend to call it, you can ignore this message.</p>
<h3 id="related-resources">Related resources:</h3>
<ul>
<li>Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/shell.html">Shell</a>
                </p>
            </div>
        </article>

    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Rights reserve
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : "../../..",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>