
<!DOCTYPE html>
<html lang="zh">

<head>
    <link href='./theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="./theme/stylesheet/normalize.min.css">
    <script src="./theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="./tipuesearch_content.js"></script>
    <link rel="stylesheet" href="./theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="./theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="./theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="./theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">  <meta name="author" content="Shellcheck" />
<meta name="description" content="Double quote to prevent globbing and word splitting." />
<meta name="keywords" content="Shell">

<meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:title" content="Missing quote"/>
<meta property="og:description" content="Double quote to prevent globbing and word splitting."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./SC2086-en.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-09-28 09:33:05.956829+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/shellcheck.html">
<meta property="article:section" content="Checkers/Shell"/>
<meta property="article:tag" content="Shell"/>
<meta property="og:image" content="">

    <title>Pinpoint Document &ndash; Missing quote</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href=".">
                <img src="./theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href=".">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="./search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="输入以搜索">
            </form>
        </div>


        <ul class="global_lang">
                    <li><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="./standard/language-independent.html">Language Independent 缺陷文档</a>
                        (3)
                    </li>
                    <li>
                        <a href="./standard/c.html">c/c++ 缺陷文档</a>
                        (316)
                    </li>
                    <li>
                        <a href="./standard/csharp.html">csharp 缺陷文档</a>
                        (39)
                    </li>
                    <li>
                        <a href="./standard/golang.html">golang 缺陷文档</a>
                        (34)
                    </li>
                    <li>
                        <a href="./standard/java.html">java 缺陷文档</a>
                        (555)
                    </li>
                    <li>
                        <a href="./standard/javascript.html">javascript 缺陷文档</a>
                        (295)
                    </li>
                    <li>
                        <a href="./standard/objective-c.html">objective-c 缺陷文档</a>
                        (124)
                    </li>
                    <li>
                        <a href="./standard/php.html">php 缺陷文档</a>
                        (58)
                    </li>
                    <li>
                        <a href="./standard/python.html">python 缺陷文档</a>
                        (618)
                    </li>
                    <li>
                        <a href="./standard/swift.html">swift 缺陷文档</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
  <article class="single">
  <header>
    <div class="breadcrumb">
      <ol>
        <li>
              <a href="./standard/shell.html">shell</a>
        </li>
        <li>
            <a href="./standard/style-issues.html">风格问题</a>
        </li>
        <li>
            <a href="./category/code-style-and-efficiency.html">代码风格和效率</a>
        </li>
        
    </ol>
    
    </div>

    <h1 id="SC2086">Missing quote</h1>
    <p>
        在 九月 28, 2024 发布于 <a href="./category/code-style-and-efficiency.html">代码风格和效率</a> 分类

        &#8226; 3 min read
    </p>
  </header>

    <div class="toc">
<ul>
<li><a href="#double-quote-to-prevent-globbing-and-word-splitting">Double quote to prevent globbing and word splitting.</a><ul>
<li><a href="#problematic-code">Problematic code:</a></li>
<li><a href="#correct-code">Correct code:</a></li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

  <div>
    
<h1 id="double-quote-to-prevent-globbing-and-word-splitting">Double quote to prevent globbing and word splitting.</h1>
<h2 id="problematic-code">Problematic code:</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="nv">$1</span>
<span class="k">for</span> i in <span class="nv">$*</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span> <span class="c1"># this one and the next one also apply to expanding arrays.</span>
<span class="k">for</span> i in <span class="nv">$@</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span>
</pre></div>
</td></tr></table>
<h2 id="correct-code">Correct code:</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="k">for</span> i in <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span> :<span class="p">;</span> <span class="k">done</span> <span class="c1"># or, 'for i; do'</span>
</pre></div>
</td></tr></table>
<h2 id="rationale">Rationale</h2>
<p>The first code looks like "print the first argument". It's actually "Split the first argument by IFS (spaces, tabs and line feeds). Expand each of them as if it was a glob. Join all the resulting strings and filenames with spaces. Print the result."</p>
<p>The second one looks like "iterate through all arguments". It's actually "join all the arguments by the first character of IFS (space), split them by IFS and expand each of them as globs, and iterate on the resulting list". The third one skips the joining part.</p>
<p>Quoting variables prevents word splitting and glob expansion, and prevents the script from breaking when input contains spaces, line feeds, glob characters and such.</p>
<p>Strictly speaking, only expansions themselves need to be quoted, but for stylistic reasons, entire arguments with multiple variable and literal parts are often quoted as one:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/<span class="nv">$dir</span>/dist/bin/<span class="nv">$file</span>        <span class="c1"># Unquoted (bad)</span>
<span class="s2">"</span><span class="nv">$HOME</span><span class="s2">"</span>/<span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>/dist/bin/<span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>  <span class="c1"># Minimal quoting (good)</span>
<span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/</span><span class="nv">$dir</span><span class="s2">/dist/bin/</span><span class="nv">$file</span><span class="s2">"</span>      <span class="c1"># Canonical quoting (good)</span>
</pre></div>
</td></tr></table>
<p>When quoting composite arguments, make sure to exclude globs and brace expansions, which lose their special meaning in double quotes: <code>"$HOME/$dir/src/*.c"</code> will not expand, but <code>"$HOME/$dir/src"/*.c</code> will.</p>
<p>Note that <code>$( )</code> starts a new context, and variables in it have to be quoted independently:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">"This </span><span class="nv">$variable</span><span class="s2"> is quoted </span><span class="k">$(</span>but this <span class="nv">$variable</span> is not<span class="k">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"This </span><span class="nv">$variable</span><span class="s2"> is quoted </span><span class="k">$(</span>and now this <span class="s2">"</span><span class="nv">$variable</span><span class="s2">"</span> is too<span class="k">)</span><span class="s2">"</span>
</pre></div>
</td></tr></table>
<h3 id="exceptions">Exceptions</h3>
<p>Sometimes you want to split on spaces, like when building a command line:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">options</span><span class="o">=</span><span class="s2">"-j 5 -B"</span>
make <span class="nv">$options</span> file
</pre></div>
</td></tr></table>
<p>Just quoting this doesn't work. Instead, you should have used an array (bash, ksh, zsh):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">options</span><span class="o">=(</span>-j <span class="m">5</span> -B<span class="o">)</span> <span class="c1"># ksh: set -A options -- -j 5 -B</span>
make <span class="s2">"</span><span class="si">${</span><span class="nv">options</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> file
</pre></div>
</td></tr></table>
<p>or a function (POSIX):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make_with_flags<span class="o">()</span> <span class="o">{</span> make -j <span class="m">5</span> -B <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
make_with_flags file
</pre></div>
</td></tr></table>
<p>To split on spaces but not perform glob expansion, Posix has a <code>set -f</code> to disable globbing.  You can disable word splitting by setting <code>IFS=''</code>.</p>
<p>Similarly, you might want an optional argument:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">debug</span><span class="o">=</span><span class="s2">""</span>
<span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"--trace-commands"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">"-x"</span>
bash <span class="nv">$debug</span> script
</pre></div>
</td></tr></table>
<p>Quoting this doesn't work, since in the default case, <code>"$debug"</code> would expand to one empty argument while <code>$debug</code> would expand into zero arguments. In this case, you can use an array with zero or one elements as outlined above, or you can use an unquoted expansion with an alternate value:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">debug</span><span class="o">=</span><span class="s2">""</span>
<span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"--trace-commands"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">"yes"</span>
bash <span class="si">${</span><span class="nv">debug</span><span class="p">:+</span><span class="s2">"-x"</span><span class="si">}</span> script
</pre></div>
</td></tr></table>
<p>This is better than an unquoted value because the alternative value can be properly quoted, e.g. <code>wget ${output:+ -o "$output"}</code>.</p>
<hr/>
<p>Here are two common cases where this warning seems unnecessary but may still be beneficial:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>cmd <span class="o">&lt;&lt;&lt;</span> <span class="nv">$var</span>         <span class="c1"># Requires quoting on Bash 3 (but not 4+)</span>
: <span class="si">${</span><span class="nv">var</span><span class="p">=default</span><span class="si">}</span>     <span class="c1"># Should be quoted to avoid DoS when var='*/*/*/*/*/*'</span>
</pre></div>
</td></tr></table>
<hr/>
<p>As always, this warning can be [[ignored|ignore]] on a case-by-case basis.</p>
<p>This is especially relevant when BASH may not be available for the array work around.
For example, use in eval or in command options where script has total control of the variables...</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">FLAGS</span><span class="o">=</span><span class="s2">"-av -e 'ssh -x' --delete --delete-excluded"</span>
...
<span class="c1"># shellcheck disable=SC2086</span>
<span class="nb">eval</span> rsync <span class="nv">$FLAGS</span> ~/dir remote_host:dir
</pre></div>
</td></tr></table>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/shell.html">Shell</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


</article>
    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Pinpoint 源代码静态缺陷分析系统, 源伞科技有限公司 - 保留所有权利
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : ".",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>