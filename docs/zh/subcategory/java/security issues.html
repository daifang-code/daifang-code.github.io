
<!DOCTYPE html>
<html lang="zh">

<head>
    <link href='../../theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="../../theme/stylesheet/normalize.min.css">
    <script src="../../theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="../../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../../theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="../../theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="../../theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="../../theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">      <meta name="author" content="Pinpoint Team"/>
    <meta name="description" content="Manual and documents for Sourcebrella Pinpoint"/> <meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Pinpoint Document"/>
<meta property="og:description" content="Manual and documents for Sourcebrella Pinpoint"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../.."/>
 
    <title>Pinpoint Document &ndash; Category</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href="../..">
                <img src="../../theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href="../..">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="输入以搜索">
            </form>
        </div>


        <ul class="global_lang">
                    <li><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="../../standard/language-independent.html">Language Independent 缺陷文档</a>
                        (3)
                    </li>
                    <li>
                        <a href="../../standard/c.html">c/c++ 缺陷文档</a>
                        (316)
                    </li>
                    <li>
                        <a href="../../standard/csharp.html">csharp 缺陷文档</a>
                        (39)
                    </li>
                    <li>
                        <a href="../../standard/golang.html">golang 缺陷文档</a>
                        (34)
                    </li>
                    <li>
                        <a href="../../standard/java.html">java 缺陷文档</a>
                        (555)
                    </li>
                    <li>
                        <a href="../../standard/javascript.html">javascript 缺陷文档</a>
                        (295)
                    </li>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c 缺陷文档</a>
                        (124)
                    </li>
                    <li>
                        <a href="../../standard/php.html">php 缺陷文档</a>
                        (58)
                    </li>
                    <li>
                        <a href="../../standard/python.html">python 缺陷文档</a>
                        (618)
                    </li>
                    <li>
                        <a href="../../standard/swift.html">swift 缺陷文档</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
          <article>
            <h1>
            安全问题 (150)
            </h1>
        </article>
        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0145">蚂蚁军规9：编程式事务中catch全部异常的接口没有设置回滚标示</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>蚂蚁军规9：编程式事务中catch全部异常的接口没有设置回滚标示</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0146">声明式事务中没有设置回滚异常类型</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>声明式事务中没有设置回滚异常类型</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0147">危险类型的金额变量</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>危险类型的金额变量</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0148">金额变量进行一次危险的类型转换</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>金额变量进行一次危险的类型转换</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0149">大数除法明确精度参数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>大数除法明确精度参数</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0139">弱哈希函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>弱哈希函数</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>建议改进</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0140">不安全的cookie</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不安全的cookie</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>建议改进</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0141">使用异常抛出结果码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用异常抛出结果码</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>建议改进</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0142">服务端方法返回boolean类型结果码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>服务端方法返回boolean类型结果码</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0143">服务端方法返回的对象中不包含结果码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>服务端方法返回的对象中不包含结果码</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0144">事务中包含远程调用</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>事务中包含远程调用</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>建议改进</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0138">弱加密函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>弱加密函数</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>建议改进</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0099">敏感数据传入潜在的不安全API</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Black Hole Vulnerability</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>高危</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">c</a>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0109">使用弱随机算法生成固定密钥</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用弱随机算法生成固定密钥</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>严重</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">c</a>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0127">敏感数据存入数据库</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>敏感数据存入数据库</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>一般</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="BE0128">敏感数据存入缓存</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>敏感数据存入缓存</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>一般</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7539">未加密的套接字</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>未加密的套接字</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
使用的通信信道未加密。拦截网络流量的攻击者可以读取流量。
</p>
<p>
<b>易受攻击的代码：</b><br/>
普通套接字（Cleartext通信）：
<pre>Socket soc = new Socket("www.google.com",80);</pre>
</p>
<p>
<b>解决方案：</b><br/>
SSL套接字（安全通信）：
<pre>Socket soc = SSLSocketFactory.getDefault().createSocket("www.google.com", 443);</pre>
</p>
<p>除了使用SSL套接字之外，您还需要确保使用SSLSocketFactory执行所有相应的证书验证检查，以确保您不会受到中间人攻击。请阅读OWASP传输层保护cheat sheet，了解有关如何正确执行此操作的详细信息。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.owasp.org/index.php/Top_10_2010-A9">OWASP: Top 10 2010-A9-Insufficient Transport Layer Protection</a><br/>
<a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">OWASP: Top 10 2013-A6-Sensitive Data Exposure</a><br/>
<a href="https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet">OWASP: Transport Layer Protection Cheat Sheet</a><br/>
<a href="http://projects.webappsec.org/w/page/13246945/Insufficient%20Transport%20Layer%20Protection">WASC-04: Insufficient Transport Layer Protection</a><br/>
<a href="http://cwe.mitre.org/data/definitions/319.html">CWE-319: Cleartext Transmission of Sensitive Information</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7537">Hazelcast对称加密</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Hazelcast对称加密</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>Hazelcast的网络通信配置使用对称加密算法（可能是DES或blowfish）。</p>
<p>仅这些加密算法不提供完整性或安全身份验证。 使用非对称加密更佳。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://projects.webappsec.org/w/page/13246945/Insufficient%20Transport%20Layer%20Protection">WASC-04: Insufficient Transport Layer Protection</a><br/>
<a href="http://docs.hazelcast.org/docs/3.5/manual/html/encryption.html">Hazelcast Documentation: Encryption</a><br/>
<a href="http://cwe.mitre.org/data/definitions/326.html">CWE-326: Inadequate Encryption Strength</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0080">跨站脚本攻击</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">描述</a><ul>
<li><a href="#_2">反射型</a></li>
<li><a href="#_3">持久化</a></li>
<li><a href="#dom">DOM</a></li>
</ul>
</li>
<li><a href="#_4">风险评估</a></li>
<li><a href="#_5">漏洞利用威胁</a></li>
<li><a href="#_6">示例</a><ul>
<li><a href="#1">例子1</a></li>
<li><a href="#2">例子2</a></li>
</ul>
</li>
<li><a href="#_7">潜在的缓解措施</a><ul>
<li><a href="#1_1">框架或者库1</a></li>
<li><a href="#_8">根据上下文转义输出</a></li>
<li><a href="#html">对不可信的HTML输入进行安全验证</a></li>
<li><a href="#1_2">分离数据和代码1</a></li>
<li><a href="#cookiehttponly16">将会话cookie设置为HttpOnly16</a></li>
<li><a href="#2_1">禁止脚本2</a></li>
<li><a href="#cookie2">Cookie保护2</a></li>
<li><a href="#_9">使用静态代码分析器</a></li>
</ul>
</li>
<li><a href="#_10">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">描述</h1>
<p>在将用户可控输入输出到网页前，软件不会清洗或者正确清洗用户输入，此时可能会触发XSS。XSS主要分为3类: 反射XSS、持久化XSS和基于DOM的XSS。</p>
<h3 id="_2">反射型</h3>
<p>服务器直接从http请求读取数据，并将请求中的数据填入http回包中。对反射型XSS的利用，通常是攻击者引诱受害者提供了危险数据给被攻击的网络应用，该网络应用将危险数据反射给了受害者，并被受害者的浏览器执行。
传递恶意内容的最常见方法是将恶意内容作为参数包含在URL中，通过公开发布或者电子邮件发送给受害者。以这种方式构造的URL是许多网络钓鱼方案的核心，攻击者借此诱使受害者访问指向易受攻击站点的URL。该站点将攻击者的内容反射回受害者后，由受害者的浏览器执行。</p>
<h3 id="_3">持久化</h3>
<p>网络应用在数据库、消息论坛、访问者日志或其他可信数据存储区中存储危险数据。稍后, 危险数据随后被读回网络应用中, 并包含在网页内容中。从攻击者的角度来看，注入有害数据的最佳位置在那些曝光度非常高的网页上。一旦有用户执行了有害数据，攻击者就有可能能够拿到用户的权限，用户的敏感数据也将暴露给攻击者。
例如，攻击者可能将XSS注入日志消息，而当管理员查看日志时，可能无法正确处理。</p>
<h3 id="dom">DOM</h3>
<p>在基于DOM的XSS中，客户端是将XSS注入到页面中的实施者，其他类型的XSS中，服务器是实施者。基于DOM的XSS通常涉及发送给客户端的由服务器控制的可信脚本，例如在用户提交之前对表单执行完整性检查的javascript脚本。如果服务器提供的脚本处理用户提供的数据，然后将其注入到网页中（例如使用动态HTML），则可以使用基于DOM的XSS。</p>
<h1 id="_4">风险评估</h1>
<p>下表指定了单个薄弱环节被攻击后可能造成的后果。</p>
<table>
<thead>
<tr>
<th>范围</th>
<th>影响</th>
<th>可能性</th>
</tr>
</thead>
<tbody>
<tr>
<td>访问控制、保密缺失</td>
<td>使用跨站点脚本执行的最常见攻击涉及暴露存储在用户cookie中的信息。通常，恶意用户制作的客户端脚本被浏览器解析的时候，进行一些操作（比如将所有网站cookie发送到给定的电子邮件地址）。该脚本将被访问该网站的每个用户加载和运行，由于请求运行脚本的站点可以访问所有相关的cookie，所以恶意脚本也可以。</td>
<td></td>
</tr>
<tr>
<td>完整性、保密、可用性缺失</td>
<td>在某些情况下，当跨站点脚本与其他缺陷结合使用时，可能会在受害者的计算机上运行任意代码。</td>
<td></td>
</tr>
<tr>
<td>保密性、完整性、访问控制缺失</td>
<td>无论是持久化还是反射型，XSS攻击的后果都是相同的。不同之处在于有效负载如何到达服务器。XSS可能会给最终用户带来各种问题，严重程度可从轻微的骚扰到整个帐号信息的崩溃。某些跨站点脚本漏洞可用于操纵或窃取cookie，创建可能被误认为有效用户的请求，破坏机密信息或在最终用户系统上执行恶意代码以实现各种恶意目的。其他破坏性攻击包括暴露终端用户文件，安装特洛伊木马程序，将用户重定向到其他页面或站点，在用户认为可靠的站点上运行“Active X”控件（在Microsoft Internet Explorer下），以及修改页面显示。</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="_5">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_6">示例</h1>
<h3 id="1">例子1</h3>
<p>这段代码会通过http<code>GET</code>方法，根据url的<code>msg</code>参数来获取一个欢迎页面，展示了反射型XSS。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Copyright (C), 2016-2018, Sourcebrella, Inc Ltd - All rights reserved.</span>
<span class="c1">// Unauthorized copying, using, modifying of this file, via any medium is</span>
<span class="c1">// strictly prohibited.</span>
<span class="c1">// Proprietary and confidential.</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VunerableController</span> <span class="o">{</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/echo"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">echo</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"msg"</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>因为参数可以是任意的，所以页面的URL可以被修改，让<code>msg</code>包含脚本语法，比如</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://trusted.sbrella.in/echo?msg=<span class="p">&lt;</span><span class="nt">script</span> <span class="na">language</span><span class="o">=</span><span class="s">"javascript"</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">"You've been attacked!"</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>这段代码会弹出一个还算无害的对话框。 这似乎不是一个很大的漏洞。 毕竟，为什么有人会输入一个导致恶意代码在自己的计算机上运行的URL？ 真正的危险是攻击者会创建恶意URL，然后使用电子邮件或社会工程技巧诱骗受害者访问URL的链接。 当受害者点击链接时，他们无意中通过易受攻击的Web应用程序将恶意内容反射回自己的计算机。</p>
<p>更贴合实际的是，攻击者可以在页面上嵌入一个虚假的登录框，欺骗用户将用户的密码发送给攻击者。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://trusted.sbrella.in/echo?msg=<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"stealpassword"</span><span class="p">&gt;</span>Please Login:<span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">"input"</span> <span class="na">action</span><span class="o">=</span><span class="s">"http://attack.sbrella.in/stealpassword"</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>Username: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"username"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>Password: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"password"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Login"</span> <span class="p">/&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>如果用户点击这个链接，<code>echo</code>处理程序将生成以下HTML并将其发送到用户的浏览器</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"stealpassword"</span><span class="p">&gt;</span>
  Please Login:
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">"input"</span> <span class="na">action</span><span class="o">=</span><span class="s">"http://attack.sbrella.in/stealpassword"</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span><span class="p">&gt;</span>
    Username:
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"username"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>Password: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"password"</span> <span class="na">name</span><span class="o">=</span><span class="s">"password"</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Login"</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>如果用户提交此表单，攻击者可以轻松获取用户的密码。</p>
<h3 id="2">例子2</h3>
<p>以下示例由Web应用程序中的两个单独页面组成，一个用于创建用户帐户，另一个用于列出用户。 它展示一个持久化XSS攻击的场景。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Copyright (C), 2016-2018, Sourcebrella, Inc Ltd - All rights reserved.</span>
<span class="c1">// Unauthorized copying, using, modifying of this file, via any medium is</span>
<span class="c1">// strictly prohibited.</span>
<span class="c1">// Proprietary and confidential.</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kd">interface</span> <span class="nc">Row</span> <span class="o">{</span>
  <span class="n">Object</span> <span class="nf">getColumnByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">QueryResult</span> <span class="o">{</span>
  <span class="n">Row</span> <span class="nf">fetchOne</span><span class="o">();</span>

  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">fetchAll</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">SQLConnection</span> <span class="o">{</span>
  <span class="n">QueryResult</span> <span class="nf">execute</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">);</span>
  <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">sanitize</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoController</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> 
                       <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">DemoController</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">SQLConnection</span> <span class="n">connection</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">DemoController</span><span class="o">(</span><span class="n">SQLConnection</span> <span class="n">connection</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">connection</span> <span class="o">=</span> <span class="n">connection</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/createuser"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createUser</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"username"</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">s</span> <span class="o">=</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">sanitize</span><span class="o">(</span>
            <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"insert into users (username) values (\"%s\")"</span><span class="o">,</span> <span class="n">username</span><span class="o">));</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">s</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">connection</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/listusers"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">listUsers</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">QueryResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"select * from users"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="s">"&lt;div id=userlist&gt;Users:"</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">fetchAll</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">getColumnByName</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
      <span class="n">content</span> <span class="o">+=</span> <span class="s">"&lt;div class=\"username\"&gt;"</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"&lt;/div&gt;"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">content</span> <span class="o">+=</span> <span class="s">"&lt;/div&gt;"</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>攻击者可以将其用户名设置为任意HTML，然后将显示给用户页面的所有访问者。</p>
<h1 id="_7">潜在的缓解措施</h1>
<h3 id="1_1">框架或者库<sup id="fnref-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h3>
<p>使用经过审查的库或框架，例如<a href="https://www.microsoft.com/en-us/download/details.aspx?id=43126">Microsoft's Anti-XSS library</a>，<a href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/2.1.0.1">OWASP ESAPI</a>，和<a href="https://wicket.apache.org/">Apache Wicket</a>.</p>
<h3 id="_8">根据上下文转义输出</h3>
<p>根据上下文转义输出可以作为防范XSS攻击的主要措施。根据不受信任的字符串需要放置在HTML文档中的位置，可以使用多种转义方案，包括HTML实体编码，JavaScript转义，CSS转义和URL转义。大多数不需要接受大量数据的Web应用程序都可以使用转义来直接消除大部分XSS攻击的风险。广泛被采用的只对XML中5个显著特征进行html实体编码的方法并不总是能防范很多XSS攻击。</p>
<h3 id="html">对不可信的HTML输入进行安全验证</h3>
<p>很多网站的管理员允许用户在输入中填入html代码。当接受来自用户的html输入（比如<code>&lt;b&gt;very&lt;/b&gt; large</code>），对输出进行编码（比如<code>&amp;lt;b&amp;gt;very&amp;lt;/b&amp;gt; large</code>）还不足以防范XSS攻击，因为用户输入还需要被浏览器渲染为html页面（上下文的例子中，页面会显示<code>very large</code>，而不是<code>&lt;b&gt;very&lt;/b&gt; large</code>）。防范这种来自用户输入的html的XSS攻击相较更加复杂。不可信的HTML输入必须通过HTML清洗引擎处理，以确保它不包含XSS代码。还应该注意的是，许多验证依赖于解析特定的“有风险”的html标签，如以下</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="err"> &lt;link&gt; &lt;iframe&gt;</span>
</pre></div>
</td></tr></table>
<p>这种方法有几个问题，例如有时看起来无害的标签被忽略，当正确使用时仍然可以导致XSS。例如</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"javascript:alert(1)"</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>
<p>另一个流行的方法是剥离用户输入的<code>"</code>和<code>'</code>，但这也可以被绕过，因为载荷数据可以通过混淆来隐藏。</p>
<h3 id="1_2">分离数据和代码<sup id="fnref2-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h3>
<p>如果条件允许的话，可以使用有层次的机制自动化地强制分离数据和代码。这些机制能提供自动化的转义，编码和验证，而不是依赖开发者在每个输出点手动转义，编码和验证。</p>
<h3 id="cookiehttponly16">将会话cookie设置为HttpOnly<sup id="fnref3-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup><sup id="fnref-http-only"><a class="footnote-ref" href="#fn-http-only">6</a></sup></h3>
<p>为了帮助减轻针对用户会话cookie的XSS攻击，可以将会话cookie设置为HttpOnly。在支持HttpOnly功能的浏览器（例如更新版本的Internet Explorer和Firefox）中，该属性可以防止用户的会话cookie被使用<code>document.cookie</code>的恶意客户端脚本访问。但这不是一个完整的解决方案，因为并不是所有浏览器都支持HttpOnly。</p>
<h3 id="2_1">禁止脚本<sup id="fnref-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>尽管现代Web开发对javascript的依赖非常重度，还是有一些Web应用程序是可以在不需要javascript脚本的状态下运行的。这种情况下，用户可以选择在使用Web应用程序之前在其浏览器中禁用脚本。通过这种方式，即使潜在恶意的客户端脚本也可以在页面上插入有害代码，用户也可以不受XSS影响。</p>
<h3 id="cookie2">Cookie保护<sup id="fnref2-wikipedia"><a class="footnote-ref" href="#fn-wikipedia">2</a></sup></h3>
<p>除了内容过滤之外，还常用其他不完美的跨站脚本缓解方法。一个例子是在处理基于cookie的用户认证时使用额外的安全控制。许多Web应用程序依赖于会话cookie在各个HTTP请求之间进行身份验证，并且因为客户端脚本通常可以访问这些cookie，所以简单的XSS漏洞可以窃取这些cookie。为了缓解这种特殊威胁（尽管通常不是XSS问题），许多Web应用程序将会话cookie与最初登录的用户的IP地址绑定，然后只允许该IP使用该cookie。这在大多数情况下是有效的，除非攻击者与受害者位于同一个NAT地址或Web代理之后或受害者正在更改他动态IP。</p>
<h3 id="_9">使用静态代码分析器</h3>
<p>例如<a href="https://www.sourcebrella.com/">Sourcebrella Pinpoint</a></p>
<h1 id="_10">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/79.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref2-cwe" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref3-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/Cross-site_scripting <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 2 in the text">↩</a><a class="footnote-backref" href="#fnref2-wikipedia" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn-htbridge">
<p>https://www.htbridge.com/vulnerability/cross-site-scripting.html <a class="footnote-backref" href="#fnref-htbridge" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn-white-hat-web">
<p>https://www.amazon.cn/dp/B00LADBDG6/ref=sr_1_1?ie=UTF8&amp;qid=1525694060&amp;sr=8-1&amp;keywords=%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2web%E5%AE%89%E5%85%A8 <a class="footnote-backref" href="#fnref-white-hat-web" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Cross-site_Scripting_(XSS) <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn-http-only">
<p>https://www.owasp.org/index.php/HttpOnly#What_is_HttpOnly.3F <a class="footnote-backref" href="#fnref-http-only" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/web.html">Web</a>
                <a href="../../tag/java.html">Java</a>
                <a href="../../tag/injection.html">Injection</a>
                <a href="../../tag/cwe-79.html">CWE-79</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7538">NullCipher不安全</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>NullCipher不安全</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
NullCipher很少在正式的应用程序中使用。它通过返回与提供的明文相同的密文来实现Cipher接口。在一些情况下，例如测试，可以使用NullCipher。
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>Cipher doNothingCihper = new NullCipher();
[...]
//产生的密文与明文相同。
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>解决方案：</b><br/>
    避免使用NullCipher。 其意外使用可能会带来严重的安全风险。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/327.html">CWE-327: Use of a Broken or Risky Cryptographic Algorithm</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7065">没有设置数据库密码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>没有设置数据库密码</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>此代码使用空密码创建数据库连接。这表示数据库不受密码保护。如果设计私密数据，请设置密码以保证安全。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1085">公式注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当网站在CSV文件中嵌入了不受信的输入时，有可能发生公式注入（也叫CSV注入）。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当使用像<code>Microsoft Excel</code>或<code>LibreOffice Calc</code>这样的软件来打开一个CSV文件时，CSV中所有以<code>'='</code>开头的单元格都会被解释为公式。恶意构造的公式可以用作以下三种攻击：
- 通过利用制表软件的漏洞，攻击者可以劫持用户的电脑，可见CVE-2014-3524。
- 通过利用用户不会在意自己网站上下载的表格文件这一惯性思维来劫持用户的电脑。
- 从当前或别的打开的表格文件中窃取数据。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>这种攻击难以防范，为了防御这样的攻击，请确保没有单元格会以以下字符起首：
- 等号'='
- 加号 '+'
- 减号 '-'
- 地址符 '@'</p>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/CSV_Injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1102">操纵Hadoop作业</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件可能会使得攻击者能够操纵客户端应用所在的Hadoop集群中的核心组件。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在一个存在缺陷的环境中，提交到Hadoop集群中的作业可能会被攻击者恶意篡改。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的缺陷代码展示了非受信用户输入是如何在Hadoop作业提交过程中操作作业的：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">JobConf</span> <span class="nf">bad</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kt">int</span> <span class="n">reducers</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="o">...</span>
    <span class="n">JobConf</span> <span class="n">job</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JobConf</span><span class="o">(</span><span class="k">new</span> <span class="n">COnfiguration</span><span class="o">(),</span> 
                              <span class="n">OptimizedDataJoinJob</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">...</span>
    <span class="c1">// reducers may exceed the acceptable range.</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setNumReduceTasks</span><span class="o">(</span><span class="n">reducers</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">job</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1086">NoSQL注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>相比于传统的SQL数据库，NoSQL的一致性要求相对宽松。通过削弱关系上的限制以及减少一致性检查，NoSQL拥有更好的性能以及在拓展时更易受益。尽管NoSQL不使用传统的SQL语法，他们同样存在受到注入攻击的风险。</p>
<h1 id="_2">漏洞与风险</h1>
<p>相比发生在声明式SQL语言中，因为NoSQL注入攻击可能发生在过程式语言里，NoSQL注入攻击可能会造成比传统的SQL注入攻击更严重的后果。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>尽可能用最低的运行权限来完成需要完成的任务。</li>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>下面的缺陷代码没有对用户输入进行清洗，直接将用户输入传到了MongoDB的查询语句中：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">active</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">$where</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">debits</span> <span class="o">&lt;</span> <span class="nx">$userInput</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);;</span>
</pre></div>
</td></tr></table>
<p>尽管查询语句中没有任何有关用户数据的依赖，攻击者还是能够利用MongoDB的缺陷，用恶意数据替换掉操作符：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">$where</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">credits</span> <span class="o">-</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">debits</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Testing_for_NoSQL_injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1096">XPath注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可拓展的标识语言（Extensible Markup Language，XML）可以像关系型数据库般用作数据存储。开发者会频繁地通过使用XPath来从这样的一个XML文档中检索数据。当提供给XPath检索例程的数据没有经过合理的清洗时，将有可能发生XPath注入攻击。</p>
<h1 id="_2">漏洞与风险</h1>
<p>此攻击与SQL注入或XML注入类似，攻击者能够在正在使用的查询语句的数据字段中插入有效的SQL或XML结构。在典型的攻击事件中，查询语句中的条件字段会解析成重复的语义，或者给攻击者提供需要额外权限才能访问的信息的访问权。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>将所有的用户输入视作不受信的，并进行合理的清洗。</li>
<li>在清洗用户输入的过程中，要对数据类型、长度、格式以及数据内容的正确性进行验证。</li>
<li>在典型的客户端-服务器端的应用程序中，客户端以及服务器端两者都需要对数据进行验证。</li>
<li>彻底地对会提供、传播或接收用户输入的程序进行测试。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的缺陷代码从用户输入的数据中获取用户名以及密码信息，并将它们用作查询语句的构造：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">doLogin</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XPathExpressionException</span> <span class="o">{</span>

  <span class="n">DocumentBuilderFactory</span> <span class="n">domFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
  <span class="n">domFactory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">domFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
  <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"users.xml"</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span> <span class="n">password</span><span class="o">);</span>
 <span class="n">gouzao</span>
 <span class="n">gouzaoy</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">XPathFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
 <span class="n">gouzao</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newXPath</span><span class="o">();</span>
 <span class="n">gouzaosion</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">xpath</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"//users/user[username/text()='"</span> <span class="o">+</span>
 <span class="n">gouzaome</span> <span class="o">+</span> <span class="s">"' and password/text()='"</span> <span class="o">+</span> <span class="n">pwd</span> <span class="o">+</span> <span class="s">"' ]"</span><span class="o">);</span>
 <span class="n">gouzaolt</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">doc</span><span class="o">,</span> <span class="n">XPathConstants</span><span class="o">.</span><span class="na">NODESET</span><span class="o">);</span>
 <span class="n">gouzaodes</span> <span class="o">=</span> <span class="o">(</span><span class="n">NodeList</span><span class="o">)</span> <span class="n">result</span><span class="o">;</span>

  <span class="c1">// Print first names to the console</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">"Authenticated: "</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="na">getNodeValue</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>下面的合规解决方案通过读取要求格式的文件而从中获取查询语句，并在一个<code>Map</code>中插入查询所需要的用户名、密码信息。而后XQuery库从这些输入中构造XML查询语句：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">doLogin</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="n">String</span> <span class="n">pwd</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XPathExpressionException</span> <span class="o">{</span>

  <span class="n">DocumentBuilderFactory</span> <span class="n">domFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
  <span class="n">domFactory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">domFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
  <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"users.xml"</span><span class="o">);</span>

  <span class="n">XQuery</span> <span class="n">xquery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XQueryFactory</span><span class="o">().</span><span class="na">createXQuery</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"login.xq"</span><span class="o">));</span>
  <span class="n">Map</span> <span class="n">queryVars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
  <span class="n">queryVars</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"userName"</span><span class="o">,</span> <span class="n">userName</span><span class="o">);</span>
  <span class="n">queryVars</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="n">pwd</span><span class="o">);</span>
  <span class="n">NodeList</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">xquery</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">doc</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">queryVars</span><span class="o">).</span><span class="na">toNodes</span><span class="o">();</span>

  <span class="c1">// Print first names to the console</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">getChildNodes</span><span class="o">().</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getNodeValue</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS53-J.+Prevent+XPath+Injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7578">启用地理位置的WebView（Android）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>启用地理位置的WebView（Android）</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
   建议用户确认是否允许获得其地理定位。
</p>
<p>
<b>有风险的代码：</b><br/>
<pre>
webView.setWebChromeClient(new WebChromeClient() {
    @Override
    public void onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback) {
        callback.invoke(origin, true, false);
    }
});
</pre>
</p>
<p>
<b>建议的代码：</b><br/>
    限制地理定位的采样，并要求用户确认。
<pre>
webView.setWebChromeClient(new WebChromeClient() {
    @Override
    public void onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback) {
        callback.invoke(origin, true, false);
        //Ask the user for confirmation
    }
});
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.securecoding.cert.org/confluence/display/java/DRD15-J.+Consider+privacy+concerns+when+using+Geolocation+API">CERT: DRD15-J. Consider privacy concerns when using Geolocation API</a><br/>
<a href="http://en.wikipedia.org/wiki/W3C_Geolocation_API">Wikipedia: W3C Geolocation API</a><br/>
<a href="http://dev.w3.org/geo/api/spec-source.html">W3C: Geolocation Specification</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1100">表达式语言注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件使用从上游设备中获取到的可受外界影响的输入数据来构造JSP（Java Server Page）页面上的部分或所有表达式语言（Expression Language, EL），但却没有或不正确地对中立化可能会在EL语句执行前就对EL语句进行篡改的特殊元素。</p>
<h1 id="_2">漏洞与风险</h1>
<p>2.2版本前，表达式语言的实现细节使得攻击者能够从隐含的对象中恢复得到服务器上的敏感信息，包括模型对象、bean、会话范围、程序范围等等。表达式语言2.2标准允许其中包含方法调用，这可能会使得攻击者在当前应用的上下文中执行任意代码，进而使得攻击者能够操纵程序的功能组件、暴露敏感数据，或对系统的代码进行访问。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>Spring的消息标签会两次解析表达式语言，给消息标签传入URL参数的常见模式是：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">)</span>
   <span class="n">String</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span> <span class="n">hasErrors</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"redirect:/error?msg=error.generic"</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"index"</span><span class="o">;</span>
    <span class="o">}</span>

   <span class="o">}</span>
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;spring:message</span> <span class="na">code=</span><span class="s">"${param.msg}"</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>
<p>有这样一种请求上述代码的URL：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>?msg=<span class="cp">${</span><span class="n">param</span><span class="o">.</span><span class="n">test</span><span class="cp">}</span><span class="err">&amp;</span>test=INJECTION
</pre></div>
</td></tr></table>
<p>这将会使得字符串字面值“INJECTION”被传入到消息标签中，而程序将会产生这样的异常作为回复：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>No message found under code 'INJECTION' for locale 'en_US'
</pre></div>
</td></tr></table>
<p>从以上的信息来看，攻击者可以在表达式语言中提交方法，如：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>?msg=<span class="cp">${</span><span class="n">pageContext</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">getSession</span><span class="p">()</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"admin"</span><span class="p">,</span><span class="n">true</span><span class="p">)</span><span class="cp">}</span>
</pre></div>
</td></tr></table>
<p>如果提供表达式语言接舍弃的容器不支持静态类方法（<code>java.lang.Runtime.getCurrentRuntime().exec()</code>），那么攻击者还能够通过<code>URLClassLoader</code>来加载远程代码。</p>
<h1 id="_7">参考资料</h1>
<p>[^owasp] https://www.owasp.org/index.php/Expression_Language_Injection</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/917.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1097">LDAP操纵</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>轻量级目录访问协议（Lightweight Directory Access Protocol, LDAP）使得程序能够远程地进行像查找或修改目录中的记录的操作。</p>
<h1 id="_2">漏洞与风险</h1>
<p>LDAP注入源于不充分的用户输入清洗、验证，进而允许恶意用户使用目录服务来窃取限制性的信息。不足以防御LDAP注入的认证过程使得未经认证用户能够登录到系统。同样的，攻击者可以通过查找例程来发掘目录中的部分或全部信息。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的缺陷代码允许<code>searchRecord()</code>方法的调用者使用LDAP协议来搜索目录中的某个记录：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "S*"; // Invalid</span>
<span class="c1">// String userPassword = "*"; // Invalid</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LDAPInjection</span> <span class="o">{</span>       
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">searchRecord</span><span class="o">(</span><span class="n">String</span> <span class="n">userSN</span><span class="o">,</span> <span class="n">String</span> <span class="n">userPassword</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NamingException</span> <span class="o">{</span>        
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>  <span class="n">env</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">env</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">INITIAL_CONTEXT_FACTORY</span><span class="o">,</span> <span class="s">"com.sun.jndi.ldap.LdapCtxFactory"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">DirContext</span> <span class="n">dctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialDirContext</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

      <span class="n">SearchControls</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchControls</span><span class="o">();</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">attributeFilter</span> <span class="o">=</span> <span class="o">{</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"mail"</span><span class="o">};</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setReturningAttributes</span><span class="o">(</span><span class="n">attributeFilter</span><span class="o">);</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

      <span class="c1">// The following resolves to (&amp;(sn=S*)(userPassword=*))     </span>
      <span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn="</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

      <span class="n">NamingEnumeration</span><span class="o">&lt;?&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">dctx</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="n">filter</span><span class="o">,</span> <span class="n">sc</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">hasMore</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">SearchResult</span> <span class="n">sr</span> <span class="o">=</span> <span class="o">(</span><span class="n">SearchResult</span><span class="o">)</span> <span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">Attributes</span> <span class="n">attrs</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attributes</span><span class="o">)</span> <span class="n">sr</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
        <span class="n">Attribute</span> <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"cn"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"mail"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
      <span class="o">}</span>    
      <span class="n">dctx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>以下合规的解决方案使用了白名单来清洗用户输入，清洗后得出的字符串中只包含有效的字符。在这段代码中，<code>userSN</code>可能只包含字母或空格字符，而<code>password</code>则只可能包含有效的字母数字字符：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "Sherlock Holmes"; // Valid</span>
<span class="c1">// String userPassword = "secret2";   // Valid</span>

<span class="c1">// ... beginning of LDAPInjection.searchRecord()...</span>
<span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
<span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">userSN</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w\\s]*"</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">userPassword</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"Invalid input"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn = "</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

<span class="c1">// ... remainder of LDAPInjection.searchRecord()...    </span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS54-J.+Prevent+LDAP+injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7484">不可信的查询字符串</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的查询字符串</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>查询字符串是GET参数名称和值的连接。
除了那些预期之外的参数可以被传递进来。</p></p>
<p><p>对于URL请求<code>/app/servlet.htm?a=1&amp;b=2</code>，查询字符串提取将是<code>a=1&amp;b=2</code></p></p>
<p><p>正如类似于<code>HttpServletRequest.getParameter()</code>方法所检索到的单个参数值一样，
从<code>HttpServletRequest.getQueryString()</code>获得的值应该被认为是不安全的。在将查询字符串传递给敏感api之前，您可能需要对从查询字符串中提取的任何东西进行验证或净化。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/20.html">CWE-20: Improper Input Validation</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7584">信任边界违规</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>信任边界违规</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
    "一个信任边界可以被看作是通过一个程序绘制的分界线。在线的一边，数据是不可信的。
在这条线的另一边，数据则是可信的。
验证逻辑的目的是允许数据安全地跨越信任边界——从不可信到可信。
当一个程序模糊了受信任的和不可信的之间的界限时，就会发生信任边界违规。
通过将可信的和不受信任的数据组合在相同的数据结构中，程序员就更容易错误地信任未经验证的数据。" <sup>[1]</sup>
</p>
<p>
<b>有风险的代码</b><br/>
<pre>
public void doSomething(HttpServletRequest req, String activateProperty) {
    //..
    req.getSession().setAttribute(activateProperty,"true");
}
</pre>
<pre>
public void loginEvent(HttpServletRequest req, String userSubmitted) {
    //..
    req.getSession().setAttribute("user",userSubmitted);
}
</pre>
</p>
<p>
<b>解决方案：</b><br/>
<p>
解决方案是在设定新的会话属性之前添加验证。在可能的情况下，更喜欢来自安全位置的数据，而不是直接使用用户输入的数据。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p>[1] <a href="https://cwe.mitre.org/data/definitions/501.html">CWE-501: Trust Boundary Violation</a><br/>
<a href="https://www.owasp.org/index.php/Trust_Boundary_Violation">OWASP : Trust Boundary Violation</a>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7550">Blowfish使用短密钥</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Blowfish使用短密钥</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
Blowfish密码支持32位到448位的密钥。 短密钥使密文易受暴力攻击。
如果需要使用Blowfish，则在生成密钥时应使用至少128位熵。
</p>
<p>
如果可以更改算法，则应使用AES块密码。
</p>
<p><b>易受攻击的代码：</b><br/>
<pre>KeyGenerator keyGen = KeyGenerator.getInstance("Blowfish");
keyGen.init(64);</pre>
</p>
<p><b>解决方案：</b><br/>
<pre>KeyGenerator keyGen = KeyGenerator.getInstance("Blowfish");
keyGen.init(128);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="http://en.wikipedia.org/wiki/Blowfish_(cipher)">Blowfish (cipher)</a><br/>
<a href="http://cwe.mitre.org/data/definitions/326.html">CWE-326: Inadequate Encryption Strength</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7470">Struts文件泄露</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Struts文件泄露</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
用用户输入构造一个服务器端重定向路径可以让攻击者下载应用程序二进制文件（包括应用程序类或jar文件），或者在受保护的目录中查看任意文件。<br/>
攻击者可以伪造一个请求参数来匹配敏感的文件位置。
例如，请求 "http://example.com/?returnURL=WEB-INF/applicationContext.xml" 将显示应用程序的applicationContext.xml文件。
攻击者将能够定位和下载在其它配置文件中引用的applicationContext.xml，甚至是类文件或jar文件，获取敏感信息并启动其它类型的攻击。
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>...
String returnURL = request.getParameter("returnURL");
Return new ActionForward(returnURL);
...</pre>
</p>
<p>
<b>解决方案：</b><br/>
避免使用用户控制的输入构建服务器端重定向。
</p>
<br/></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="https://cwe.mitre.org/data/definitions/552.html">CWE-552: Files or Directories Accessible to External Parties</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7547">Struts表单没有输入验证</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Struts表单没有输入验证</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
表单输入应该具有基本的输入验证。 预防性验证有助于针对各种风险提供深度防御。
</p>
<p>
可以通过实现<code>validate</code>方法来引入验证。
<pre>
public class RegistrationForm extends ValidatorForm {
    private String name;
    private String email;
    [...]
    public ActionErrors validate(ActionMapping mapping, HttpServletRequest request) {
        //Validation code for name and email parameters passed in via the HttpRequest goes here
    }
}
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/20.html">CWE-20: Improper Input Validation</a><br/>
<a href="http://cwe.mitre.org/data/definitions/106.html">CWE-106: Struts: Plug-in Framework not in Use</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1107">脆弱的哈希加密算法</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件对密码进行了哈希加密，但该哈希加密算法使用到的计算性力度达不到使破解攻击无法进行或需要耗资才能达到的程度。</p>
<h1 id="_2">漏洞与风险</h1>
<p>很多哈希算法都以执行迅速、开销小为目标，其中甚至包含加密用的哈希算法。但这样设计出来的高效哈希算法会给存储密码带来问题，因为它们在高效的同时也给攻击者的蛮力破解算法加了把劲。如果攻击者能过通过某些途径（如对存储哈希加密后的密码的数据库进行SQL注入）获取到这些哈希值，他们就能够将这些哈希值离线保存，然后再用各种方法来高效地计算这些哈希值，最终将密码破解。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>使用可调整计算性力度的哈希函数。</li>
<li>在使用工业界认可的技术时，请正确地使用它们。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/916.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1115">使用的不安全Jackson反序列化配置</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a><ul>
<li><a href="#_5">官方修复方式</a></li>
<li><a href="#_6">修复建议</a></li>
</ul>
</li>
<li><a href="#_7">演示示例</a><ul>
<li><a href="#_8">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_9">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该漏洞存在于Jackson框架下的enableDefaultTyping方法，通过该漏洞，攻击者可以远程在服务器主机上越权执行任意代码，从而取得该网站服务器的控制权。</p>
<h1 id="_2">漏洞与风险</h1>
<p>Jackson是一个开源的Java序列化与反序列化工具，可以将java对象序列化为xml或json格式的字符串，或者反序列化回对应的对象，由于其使用简单，速度较快，且不依靠除JDK外的其他库，被众多用户所使用。但是其组件Jackson-databind可以指定特定的反序列化类，这样就存在代码执行的风险。</p>
<p>通过java生态中的第三方库存在的序列化方法构造序列化恶意攻击代码，并将恶意代码base64编码后拼接到一个精心构造的json数据包中，代码层如果在使用ObjectMapper对象实例时（ObjectMapper mapper = new ObjectMapper();）开启了enableDefaultType特性（例如mapper.enableDefaultTyping();），会在readValue时对传入的JSON自动调用第三方库的反序列化方法，被攻击者利用即可越权执行代码。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">缓解与预防</h1>
<h3 id="_5">官方修复方式</h3>
<p>官方在漏洞产生后，通过黑名单的方式禁止黑名单中的第三方库因为反序列化问题而产生的代码执行漏洞。 </p>
<h3 id="_6">修复建议</h3>
<p>1.升级到最新版本jackson-databind 2.7.9.2，2.8.11，2.9.3.1及后续版本;</p>
<p>2.禁用enableDefaultTyping()方法；</p>
<p>3.对客户端传入的JSON数据，进行过滤或者类型检查。</p>
<h1 id="_7">演示示例</h1>
<h3 id="_8">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ABean</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AnotherBean</span> <span class="o">{</span>
        <span class="nd">@JsonTypeInfo</span><span class="o">(</span><span class="n">use</span> <span class="o">=</span> <span class="n">JsonTypeInfo</span><span class="o">.</span><span class="na">Id</span><span class="o">.</span><span class="na">CLASS</span><span class="o">)</span> <span class="c1">// or JsonTypeInfo.Id.MINIMAL_CLASS</span>
        <span class="kd">public</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">example</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JsonMappingException</span> <span class="o">{</span>
         <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
         <span class="n">mapper</span><span class="o">.</span><span class="na">enableDefaultTyping</span><span class="o">();</span> <span class="c1">//using enableDefaultTyping() method</span>
         <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">ABean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exampleTwo</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JsonMappingException</span> <span class="o">{</span>
         <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
         <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">AnotherBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_9">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-github1">
<p>https://github.com/FasterXML/jackson-databind/issues/1599 <a class="footnote-backref" href="#fnref-github1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-github2">
<p>https://github.com/mbechler/marshalsec <a class="footnote-backref" href="#fnref-github2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1101">文件揭露</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在当前环境下，文件或目录应该处于不可访问状态，但实际上是能够被外界访问到的。</p>
<h1 id="_2">漏洞与风险</h1>
<p>如果攻击者能够访问到一些包含敏感信息的文件，那么他们可能会一路跟踪下去，以伺机寻找更多的攻击机会。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
<li>了解不受信的用户输入会从什么地方侵入到程序中。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的代码没有对不受信的用户输入进行验证，直接将其用来构造转发路径：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%</span> <span class="n">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"retUrl"</span><span class="o">);</span> <span class="k">%&gt;</span>
<span class="k">&lt;jsp:include page="&lt;%ret%&gt;</span>;" /&gt;
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/552.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1073">代码的正确性</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
<li><a href="#2">漏洞代码示例2</a></li>
<li><a href="#2_1">漏洞代码修复示例2</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在JVM中，两个类是一个相同的类（也就是相同的类型）当且仅当他们是被相同的类加载器加载且拥有相同的完全拓展名<a href="https://wiki.sei.cmu.edu/confluence/display/java/Rule+AA.+References#RuleAA.References-JVMSpec99">JVMSpec 1999</a>。类名相同但包名不同的两个类归为不同的类，类型的，有用相同的完全拓展名但以不同的类加载器加载的两个类归为不同的类。</p>
<h1 id="_2">漏洞与风险</h1>
<p>有时候，检查一个对象是否属于某个特定的类，或两个对象是否属于相同的类是有必要的，例如，当实现<code>equals()</code>方法时。如果这样的比较没有处理正确，那么将有可能出现实际上不相同的两个类被判为相同的类的情况。因此，你不应该使用类名来判断两个类是否属于同一个类。</p>
<p>依据不安全代码的行为，这样的缺陷可能会引发混合匹配（mix-and-match）攻击。</p>
<p>相反地，源自于同一个codebase的类必然是相同的——这种假设充满疑点，是不可靠的。尽管在众多的桌面应用中，上述假设都被视作成立，但若涉及到J2EE的servlet容器，那么情况就不是这样了。servlet容器可以再运行时不重启JVM来实现通过不同的类加载器来部署和重复调用应用。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>通过类之间的等价关系来决定类型（通过使用<code>getClass()</code>方法以及<code>==</code>操作符），而不是通过类名。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这段缺陷代码通过比较类名来判断<code>auth</code>对象是否属于<code>com.application.auth.DefaulAuthenticationHandler</code>类，并以结果来选择分支：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Determine whether object auth has required/expected class object</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">auth</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span>
      <span class="s">"com.application.auth.DefaultAuthenticationHandler"</span><span class="o">))</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>因为不同的类加载器能加载本该相同的类（如果同一个类两次加载都是使用相同的类加载器的话）到一个JVM中，只与完全拓展类名进行比较还是不足够的。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<p>这段合规代码通过将<code>auth</code>对象的类对象（<code>class object</code>）与标准的验证<code>handler</code>的类对象进行比较：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Determine whether object auth has required/expected class name</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">auth</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">com</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">DefaultAuthenticationHandler</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p><code>==</code>操作符的右部直接展示了标准的验证<code>handler</code>的类名，在这种标准的验证<code>handler</code>类还没有被类加载器加载的情况下，Java Runtime会对该类的加载进行管理，最终，这两个类对象的比较正确地进行。</p>
<h3 id="2">漏洞代码示例2</h3>
<p>这段不合规的代码通过使用<code>equals()</code>方法来比较对象<code>x</code>和<code>y</code>的类对象名。存在这样的情况，虽然<code>x</code>和<code>y</code>拥有相同的名字，但他们是被不同的类加载器加载的，那么他们是两个不同的类。</p>
<h3 id="2_1">漏洞代码修复示例2</h3>
<p>这段合规的代码正确地比较了两个对象的类：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Determine whether objects x and y have the same class</span>
<span class="k">if</span> <span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="o">{</span>
  <span class="c1">// Objects have the same class</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/OBJ09-J.+Compare+classes+and+not+class+names <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/486.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7503">MD2，MD4和MD5是弱散列函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>MD2，MD4和MD5是弱散列函数</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>MD2、MD4和MD5算法不是推荐的MessageDigest。例如，应该使用<b>PBKDF2</b>来对密码进行散列。</p>
<blockquote>
    "MD5哈希函数的安全性受到了严重的损害。在一台拥有2.6 GHz奔腾4处理器的电脑（复杂度为2<sup>24.1</sup>）中，碰撞攻击可以在几秒钟内找到碰撞。[1] 此外，还有一个chosen-prefix碰撞攻击，可以使用现成的计算硬件（复杂度为2<sup>39</sup>）在几个小时内产生两个具有特定前缀的输入冲突。[2]"<br/>
    - 
<a href="https://en.wikipedia.org/wiki/MD5#Security">Wikipedia: MD5 - Security</a>
</blockquote>
<blockquote>
    "<b>SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, 和SHA-512/256</b>:<br/>
    所有哈希函数应用程序都可以使用这些哈希函数。"<br/>
    - 
<a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Transitions: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths p.15</a>
</blockquote>
<blockquote>
    "PBKDF的主要思想是通过增加时间来减慢字典或暴力攻击密码的速度。一个带有可能密码列表的攻击者可以使用已知的迭代计数器和salt来评估PBKDF。由于攻击者每次尝试都要花费大量的计算时间，所以应用字典或蛮力攻击变得更加困难。"<br/>
- 
<a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST: Recommendation for Password-Based Key Derivation  p.12</a>
</blockquote>
<br/>
<p>
<b>易受攻击的代码：</b><br/>
<pre>MessageDigest md5Digest = MessageDigest.getInstance("MD5");
    md5Digest.update(password.getBytes());
    byte[] hashValue = md5Digest.digest();</pre></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;pre&gt;</span>byte[] hashValue = DigestUtils.getMd5Digest().digest(password.getBytes());<span class="nt">&lt;/pre&gt;</span>
</pre></div>
</td></tr></table>
</p>
<p>
<b>解决方案(使用bouncy castle):</b>
<pre>public static byte[] getEncryptedPassword(String password, byte[] salt) throws NoSuchAlgorithmException, InvalidKeySpecException {
    PKCS5S2ParametersGenerator gen = new PKCS5S2ParametersGenerator(new SHA256Digest());
    gen.init(password.getBytes("UTF-8"), salt.getBytes(), 4096);
    return ((KeyParameter) gen.generateDerivedParameters(256)).getKey();
}</pre>
<b>解决方案(java 8 或以上版本):</b><br/>
<pre>public static byte[] getEncryptedPassword(String password, byte[] salt) throws NoSuchAlgorithmException, InvalidKeySpecException {
    KeySpec spec = new PBEKeySpec(password.toCharArray(), salt, 4096, 256 * 8);
    SecretKeyFactory f = SecretKeyFactory.getInstance(""PBKDF2WithHmacSHA256"");
    return f.generateSecret(spec).getEncoded();
}</pre>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<p><br/>
<p>
<b>引用</b><br/>
[1]<a href="http://www.win.tue.nl/hashclash/On%20Collisions%20for%20MD5%20-%20M.M.J.%20Stevens.pdf">On Collisions for MD5</a>: Master Thesis by M.M.J. Stevens<br/>
[2] 
<a href="http://homepages.cwi.nl/~stevens/papers/stJOC%20-%20Chosen-Prefix%20Collisions%20for%20MD5%20and%20Applications.pdf">Chosen-prefix collisions for MD5 and applications</a>: Paper written by Marc Stevens<br/>
[3]<a href="https://en.wikipedia.org/wiki/MD5">Wikipedia: MD5</a><br/>
[4]<a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Transitions: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</a><br/>
[5]<a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST: Recommendation for Password-Based Key Derivation</a><br/>
[6]<a href="http://stackoverflow.com/questions/22580853/reliable-implementation-of-pbkdf2-hmac-sha256-for-java">Stackoverflow: Reliable implementation of PBKDF2-HMAC-SHA256 for Java</a><br/>
[7]<a href="http://cwe.mitre.org/data/definitions/327.html">CWE-327: Use of a Broken or Risky Cryptographic Algorithm</a>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7498">接受任何签名证书的HostnameVerifier</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>接受任何签名证书的HostnameVerifier</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>接受任何主机的<code>HostnameVerifier</code>经常被使用，因为在许多主机上都有证书重用。因此，这很容易受到
<a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">Man-in-the-middle attacks</a>
的攻击，因为客户端会信任任何证书。</p>
<p>
应该建立一个允许特定证书（例如基于truststore）的TrustManager。
应该创建通配符证书，以便在多重子域上重用。
关于适当执行的详细信息可参考：
<a href="http://stackoverflow.com/a/6378872/89769">[1]</a>
<a href="http://stackoverflow.com/a/5493452/89769">[2]</a>
</p>
<br/>
<p>
<b>易受攻击的代码：</b><br/>
<pre>public class AllHosts implements HostnameVerifier {
    public boolean verify(final String hostname, final SSLSession session) {
        return true;
    }
}</pre>
</p>
<br/>
<p>
<b>解决方法 (基于密钥存储库的TrustMangager)：</b><br/>
<pre>KeyStore ks = //Load keystore containing the certificates trusted
SSLContext sc = SSLContext.getInstance("TLS");
TrustManagerFactory tmf = TrustManagerFactory.getInstance("SunX509");
tmf.init(ks);
sc.init(kmf.getKeyManagers(), tmf.getTrustManagers(),null);
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://projects.webappsec.org/w/page/13246945/Insufficient%20Transport%20Layer%20Protection">WASC-04: Insufficient Transport Layer Protection</a><br/>
<a href="http://cwe.mitre.org/data/definitions/295.html">CWE-295: Improper Certificate Validation</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7563">ECB模式不安全</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>ECB模式不安全</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
Electronic Codebook（ECB）不能为加密数据提供良好机密性，应该使用一种提供更好机密性的认证加密模式。
具体来说，ECB模式每次都为相同的输入产生相同的输出。
因此，例如，如果用户发送密码，每次加密的值都是相同的。
这允许攻击者拦截和重放数据。</p>
<p>
要解决这个问题，应该使用Galois/Counter模式（GCM）。
</p>
<p>
<b>有风险的代码：</b>
<pre>Cipher c = Cipher.getInstance("AES/ECB/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>解决方案：</b>
<pre>Cipher c = Cipher.getInstance("AES/GCM/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://en.wikipedia.org/wiki/Authenticated_encryption">Wikipedia: Authenticated encryption</a><br/>
<a href="http://csrc.nist.gov/groups/ST/toolkit/BCM/modes_development.html#01">NIST: Authenticated Encryption Modes</a><br/>
<a href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Electronic_codebook_.28ECB.29">Wikipedia: Block cipher modes of operation</a><br/>
<a href="http://csrc.nist.gov/publications/nistpubs/800-38a/sp800-38a.pdf">NIST: Recommendation for Block Cipher Modes of Operation</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1110">意图操纵</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件没有或不妥当地限制从上游设备中接收到的输入数据，并将该数据用作某个资源的修饰符，这可能会使得该资源处于预料的控制范围之外。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者能够利用Intent参数中的漏洞，进而控制程序往后的行为。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>下面的缺陷代码对HTTP请求中的参数不加验证，直接使用：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">String</span> <span class="n">cName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"className"</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
<span class="o">...</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="n">cName</span><span class="o">);</span>
<span class="n">someContext</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/99.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1104">HTTP参数污染</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>攻击者通过在查询字符串中注入定界符，重写或增加了HTTP GET/POST参数。</p>
<h1 id="_2">漏洞与风险</h1>
<p>通过HTTP参数污染（HTTP Parameter Pollution, HPP），攻击者能够重写硬编码的HTTP参数、修改程序的行为、访问甚至利用无法控制的变量，以及越过输入数据检查点和WAF（Web Application Firewall）规则。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>如果正在使用Web应用防火墙，那么请确保过滤器配置正确，能够探测到异常的HTTP请求。</li>
<li>对URL进行编码。</li>
<li>在URL重写中使用严格的正则表达式。</li>
<li>警惕一条查询语句中反复出现的参数。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>假设有如下的代码：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="kd">private</span> <span class="nf">executeBackendRequest</span><span class="o">(</span><span class="n">HTTPRequest</span> <span class="n">request</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">amount</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">beneficiary</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"recipient"</span><span class="o">);</span>
    <span class="n">HttpRequest</span><span class="o">(</span><span class="s">"http://backendServer.com/servlet/actions"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span>
                <span class="s">"action=transfer&amp;amount="</span><span class="o">+</span><span class="n">amount</span><span class="o">+</span><span class="s">"&amp;recipient="</span><span class="o">+</span><span class="n">beneficiary</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>恶意的用户可能会发起一个这样的请求：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>http://frontendHost.com/page?amount=1000&amp;recipient=Mat%26action%3dwithdraw
</pre></div>
</td></tr></table>
<p>前端会为后端构造出这样的请求：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">HttpRequest</span><span class="o">(</span><span class="s">"http://backendServer.com/servlet/actions"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span>
            <span class="s">"action=transfer&amp;amount="</span><span class="o">+</span><span class="n">amount</span><span class="o">+</span><span class="s">"&amp;recipient="</span><span class="o">+</span><span class="n">beneficiary</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>也就是：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>action=transfer&amp;amount=1000&amp;recipient=Mat&amp;action=withdraw
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-capec">
<p>http://capec.mitre.org/data/definitions/460.html <a class="footnote-backref" href="#fnref-capec" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/images/b/ba/AppsecEU09_CarettoniDiPaola_v0.8.pdf <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1114">应慎用或禁用的标准库函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">修复代码示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>以往设计的一些标准库函数存在缺陷，应该慎用或禁用存在缺陷的标准库函数。</p>
<p>存在缺陷的标准库函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>危险性</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>gets</td>
<td>最高</td>
<td>禁用gets(buf)，改用fgets(buf, size, stdin)</td>
</tr>
<tr>
<td>strcpy</td>
<td>高</td>
<td>检查目标缓冲区大小，或改用strncpy，或动态分配目标缓冲区</td>
</tr>
<tr>
<td>strcat</td>
<td>高</td>
<td>改用strncat</td>
</tr>
<tr>
<td>sprintf</td>
<td>高</td>
<td>改用snprintf，或使用精度说明符</td>
</tr>
<tr>
<td>scanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>sscanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>fscanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>vfscanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>vsprintf</td>
<td>高</td>
<td>改为使用vsnprintf，或使用精度说明符</td>
</tr>
<tr>
<td>vscanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>vsscanf</td>
<td>高</td>
<td>使用精度说明符，或自己进行解析</td>
</tr>
<tr>
<td>streadd</td>
<td>高</td>
<td>确保分配的目标参数缓冲区大小是源参数大小的四倍</td>
</tr>
<tr>
<td>strecpy</td>
<td>高</td>
<td>确保分配的目标参数缓冲区大小是源参数大小的四倍</td>
</tr>
<tr>
<td>strtrns</td>
<td>高</td>
<td>手工检查目标缓冲区大小是否至少与源字符串相等</td>
</tr>
<tr>
<td>getenv</td>
<td>高</td>
<td>不可假定特殊环境变量的长度</td>
</tr>
<tr>
<td>realpath</td>
<td>高(或稍低，实现依赖)</td>
<td>分配缓冲区大小为PATH_MAX字节，并手工检查参数以确保输入参数和输出参数均不超过PATH_MAX</td>
</tr>
<tr>
<td>syslog</td>
<td>高(或稍低，实现依赖)</td>
<td>将字符串输入传递给该函数之前，将所有字符串输入截成合理大小</td>
</tr>
<tr>
<td>getopt</td>
<td>高(或稍低，实现依赖)</td>
<td>将字符串输入传递给该函数之前，将所有字符串输入截成合理大小</td>
</tr>
<tr>
<td>getopt_long</td>
<td>高(或稍低，实现依赖)</td>
<td>将字符串输入传递给该函数之前，将所有字符串输入截成合理大小</td>
</tr>
<tr>
<td>getpass</td>
<td>高(或稍低，实现依赖)</td>
<td>将字符串输入传递给该函数之前，将所有字符串输入截成合理大小</td>
</tr>
<tr>
<td>getchar</td>
<td>中</td>
<td>若在循环中使用该函数，确保检查缓冲区边界</td>
</tr>
<tr>
<td>fgetc</td>
<td>中</td>
<td>若在循环中使用该函数，确保检查缓冲区边界</td>
</tr>
<tr>
<td>getc</td>
<td>中</td>
<td>若在循环中使用该函数，确保检查缓冲区边界</td>
</tr>
<tr>
<td>read</td>
<td>中</td>
<td>若在循环中使用该函数，确保检查缓冲区边界</td>
</tr>
<tr>
<td>bcopy</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>fgets</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>memcpy</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>snprintf</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>strccpy</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>strcadd</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>strncpy</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
<tr>
<td>vsnprintf</td>
<td>低</td>
<td>确保目标缓冲区不小于指定长度</td>
</tr>
</tbody>
</table>
<h1 id="_2">漏洞与风险</h1>
<p>引起缓冲区溢出问题</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">缓解与预防</h1>
<p>慎用或禁用列表中的标准库函数</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void BadFunc(char *src)
{
    char *dst = new char[5];
    strcpy(dst, src);
    ...
}
</pre></div>
</td></tr></table>
<h3 id="_7">修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void GoodFunc(char *src, size_t srcLen)
{
    char *dst = new char[5];
    if(srcLen &lt; 5)
    {
        strcpy(dst, src);
    }
    ...
}
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7543">没有填充的RSA是不安全的</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>没有填充的RSA是不安全的</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
该软件使用RSA算法，但未包含最佳非对称加密填充（OAEP），这可能会削弱加密。
</p>
<p>
<b>缺陷代码：</b><br/>
<pre>Cipher.getInstance("RSA/NONE/NoPadding")</pre>
</p>
<p>
<b>解决方案：</b><br/>
代码应替换为：<br/>
<pre>Cipher.getInstance("RSA/ECB/OAEPWithMD5AndMGF1Padding")</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/780.html">CWE-780: Use of RSA Algorithm without OAEP</a><br/>
<a href="http://rdist.root.org/2009/10/06/why-rsa-encryption-padding-is-critical/">Root Labs: Why RSA encryption padding is critical</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7485">HTTP头不可信</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>HTTP头不可信</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>请求头可以很容易地由请求用户修改。一般来说，不应该假设请求来自于没有被攻击者修改过的常规浏览器。因此，建议您不要在任何关于请求的安全决策中相信这个值。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/807.html">CWE-807: Untrusted Inputs in a Security Decision</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0079">系统命令注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#1">漏洞代码示例1</a></li>
<li><a href="#1_1">漏洞代码修复示例1</a></li>
<li><a href="#2">漏洞代码示例2</a></li>
<li><a href="#2_1">漏洞代码修复示例2</a><ul>
<li><a href="#1_2">修复1 : 检查输入数据安全性</a></li>
<li><a href="#2_2">修复2 : 修改不受信任的数据并使其安全</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>程序使用受外部影响的输入来构造全部或部分系统命令，但是没有对生成的命令进行有效保护，这可能会让攻击者直接在操作系统上执行意外的危险命令。</p>
<p>这种缺陷在攻击者没有直接访问被攻击系统的权限，例如在Web应用程序中，有很高的危险性。或者，如果缺陷发生在特权程序中，它可能允许攻击者指定通常无法访问的命令，或者以攻击者没有的权限调用的命令。如果受影响的进程有较高的特权，则问题会加剧，因为攻击者控制的命令可能会以特殊的系统特权运行，从而增加损害的数量。</p>
<p>系统命令注入至少有以下两个子类型：</p>
<ol>
<li>应用程序打算执行一个由其自己控制的单个固定程序。它打算使用外部提供的输入作为该程序的参数。例如，程序可能使用system（“nslookup [HOSTNAME]”）运行nslookup并允许用户提供一个用作参数的HOSTNAME。攻击者无法阻止nslookup执行。但是，如果程序没有从HOSTNAME参数中删除命令分隔符，攻击者可以将分隔符放入参数中，这样在nslookup执行完成后，它们可以执行自己的程序。</li>
<li>应用程序接受外部数据用于完全选择要运行哪个程序的输入，以及要使用的命令。应用程序只是将整个命令重定向到操作系统。例如，程序可能使用“exec（[COMMAND]）”来执行用户提供的[COMMAND]。如果COMMAND受攻击者控制，攻击者可以执行任意命令或程序。如果使用exec（）和CreateProcess（）等函数执行命令，则攻击者可能无法将多个命令组合在同一行中。</li>
</ol>
<h1 id="_2">漏洞与风险</h1>
<p>安全问题，数据泄露等。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">缓解与预防</h1>
<p>在存储到内存之前，请务必检查用户输入数据的安全性。</p>
<h1 id="_5">演示实例</h1>
<h3 id="1">漏洞代码示例1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">command_injection</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> <span class="c1">// @@bad@@</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在这段代码代码中，通过调用system()函数执行系统命令。攻击者可以控制scanf()函数接收的外部输入，比如传入"rm -rf *"从而导致严重的安全问题。</p>
<h3 id="1_1">漏洞代码修复示例1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">command_injection</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"rm -rf *"</span><span class="p">)){</span> <span class="c1">// @@good@@</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">system</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在这段代码代码中，通过调用system()函数执行系统命令。开发人员对scanf()函数接收的外部输入做了简单的验证，可以预防部分系统命令注入问题。</p>
<h3 id="2">漏洞代码示例2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>
<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">untrusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">)</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>在这段代码代码中，攻击者可以控制myaction.exe的命令行参数，甚至可以在未经授权的情况下在服务器上执行其他代码，比如传入untrusted = “&amp;&amp;attack.exe”从而导致严重的安全问题。</p>
<h3 id="2_1">漏洞代码修复示例2</h3>
<h4 id="1_2">修复1 : 检查输入数据安全性</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>

<span class="c1">// Using a sanitizing check, for example, a checking of whether the string </span>
<span class="c1">// untrusted has a substring "&amp;&amp;" </span>
<span class="k">if</span> <span class="o">(!</span><span class="n">isSafe</span><span class="o">(</span><span class="n">untrusted</span><span class="o">))</span> <span class="k">return</span><span class="o">;</span>

<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">untrusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h4 id="2_2">修复2 : 修改不受信任的数据并使其安全</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">untrusted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attacker_input"</span><span class="o">);</span>

<span class="c1">// Revise the untrusted data and make it safe</span>
<span class="n">String</span> <span class="n">trusted</span> <span class="o">=</span> <span class="n">makeSafe</span><span class="o">(</span><span class="n">untrusted</span><span class="o">);</span>

<span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"myaction.exe "</span> <span class="o">+</span> <span class="n">trusted</span> <span class="o">+</span> <span class="s">"&amp;&amp;myaction2.exe"</span><span class="o">)</span>

<span class="n">System</span><span class="o">.</span><span class="na">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE78">
<p>http://cwe.mitre.org/data/definitions/78.html
[^CERT-STR02-C]https://wiki.sei.cmu.edu/confluence/display/c/STR02-C.+Sanitize+data+passed+to+complex+subsystems
[^CERT-IDS07-J]https://wiki.sei.cmu.edu/confluence/display/java/IDS07-J.+Sanitize+untrusted+data+passed+to+the+Runtime.exec%28%29+method <a class="footnote-backref" href="#fnref-CWE78" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7488">Cookie中潜在的敏感数据</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Cookie中潜在的敏感数据</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>存储在自定义cookie中的信息不应该是敏感的或与会话相关的。
在大多数情况下，敏感数据应该只存储在会话中，并由用户的会话cookie引用。
参考HttpSession(HttpServletRequest.getSession())
定制cookie可以用于需要比特定会话独立的信息。</p>
<p>定制cookie可以被用于需要比特定会话存在时间长的并且独立于一个特定会话的信息中。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/315.html">CWE-315: Cleartext Storage of Sensitive Information in a Cookie</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0135">不安全的反序列化</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>序列化对象以进行通信或将其保存以供以后使用通常很方便。 但是，序列化的数据可能被攻击者修改，当开发人员在反序列化过程中（即在将对象返回给调用者之前）自行执行的一系列实例和方法调用没有限制时，攻击者有时可能利用它们来执行未授权的行为，如生成一个shell。</p>
<h1 id="_2">漏洞与风险</h1>
<p>这可能导致两种主要类型的攻击：
1 如果应用中存在可以在反序列化过程中或者之后被改变行为的类，则攻击者可以通过改变应用逻辑或者实现远程代码执行攻击。我们将其称为对象和数据结构攻击。
2 典型的数据篡改攻击，如访问控制相关的攻击，其中使用了现有的数据结构，但内容发生了变化。</p>
<h1 id="_3">缓解与预防</h1>
<p>唯一安全的架构模式是不接受来自不受信源的序列化对象，或使用只允许原始数据类型的序列化媒体。</p>
<p>1 执行完整性检查，如：任何序列化对象的数字签名，以防止恶意对象创建或数据篡改。
2 在创建对象之前强制执行严格的类型约束，因为代码通常被期望成一组可定义的类。绕过这种技术的方法已经被证明，所以完全依赖于它是不可取的。
3 如果可能，隔离运行那些在低特权环境中反序列化的代码。
4 记录反序列化的例外情况和失败信息，如：传入的类型不是预期的类型，或者反序列处理引发的例外情况。
5 限制或监视来自于容器或服务器传入和传出的反序列化网络连接。
6 监控反序列化，当用户持续进行反序列化时，对用户进行警告。</p>
<ol>
<li>
<p>避免从不可信任的数据来源进行反序列化，或者只序列化基本数据类型。</p>
</li>
<li>
<p>如果有的话，使用程序语言提供的签名特性来保证反序列化的数据没有污染。比如基于哈希的消息认证码（HMAC）可以被用来检查是否被修改。</p>
</li>
<li>
<p>当反序列化数据时，创建一个新的对象而不是仅反序列化。</p>
</li>
<li>
<p>显式地定义final的对象防止其被反序列化。</p>
</li>
<li>
<p>标记类的域为transient以防止其被反序列化。序列化和反序列化包含transient域的类时，transient域会变成空引用。这是很好的一种方式防止时间相关、环境相关或是敏感的变量被不当地传递的方式。</p>
</li>
</ol>
<h1 id="_4">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"object.obj"</span><span class="o">);</span>
  <span class="n">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="n">javax</span><span class="o">.</span><span class="na">swing</span><span class="o">.</span><span class="na">JButton</span> <span class="n">button</span> <span class="o">=</span> <span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">swing</span><span class="o">.</span><span class="na">JButton</span><span class="o">)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
  <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>此代码在反序列化之前不会尝试验证文件的来源或内容。 攻击者可能能够用包含任意恶意代码的文件替换目标文件，该文件将在按下按钮时执行。</p>
<h3 id="_7">修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="n">ObjectInputStream</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">IOException</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">IOException</span><span class="o">(</span><span class="s">"Cannot be deserialized"</span><span class="o">);</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>这里明确定义了最终的readObject()以防止反序列化。</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE502">
<p>http://cwe.mitre.org/data/definitions/502.html <a class="footnote-backref" href="#fnref-CWE502" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-502.html">CWE-502</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1070">不安全的SSL</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当软件通过被盗用的CA签发的证书来与站点建立连接，攻击者可以通过中间人攻击盗取敏感数据。
为了确保数据完整性，证书必须有效并且必须与正在访问的站点有关。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者将能够拦截信任这些被盗CA的SSL/TLS</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>仅使用受信任的证书</li>
<li>使用有效并且与站点相关的证书</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">InputStream</span> <span class="nf">connect</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">URLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">...</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>使用默认的CA建立SSL连接</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">InputStream</span> <span class="nf">safeConnect</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">TrustManager</span><span class="o">[]</span> <span class="n">tm</span> <span class="o">=</span> <span class="o">{</span> <span class="k">new</span> <span class="n">X509TrustManager</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkClientTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="o">{</span>
                    <span class="o">...</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkServerTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="o">{</span>
                    <span class="o">...</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="n">X509Certificate</span><span class="o">[]</span> <span class="nf">getAcceptedIssuers</span><span class="o">()</span> <span class="o">{</span>
                    <span class="o">...</span>
                <span class="o">}</span>
            <span class="o">}};</span>
            <span class="n">SSLContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"SSL"</span><span class="o">);</span>
            <span class="n">context</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">tm</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="n">HttpsURLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpsURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">setSSLSocketFactory</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">());</span>
            <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>使用自定义的信任的证书建立了SSL/TLS连接</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE310">
<p>https://cwe.mitre.org/data/definitions/310.html <a class="footnote-backref" href="#fnref-CWE310" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A3">
<p>https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure <a class="footnote-backref" href="#fnref-OWASP-A3" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1094">XSLT注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>XSLT（Extensible Stylesheet Language Transformations）是用作转换XML文件的语言，它能将XML文件转换成另外一种形式的XML文件，也能转换成HTML文件、明文文件或XSL格式化的对象，进而再转换成别的例如PDF、PostScreipt、PNG等格式的文件。现代浏览器基本都支持XSLT 1.0。</p>
<h1 id="_2">漏洞与风险</h1>
<p>XSLT注入可能会引起信息暴露、任意代码执行、恶意的文件读写和注入等问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/XSLT <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/images/a/ae/OWASP_Switzerland_Meeting_2015-06-17_XSLT_SSRF_ENG.pdf <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7390">类扩展Servlet类并使用实例变量</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>类扩展Servlet类并使用实例变量</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>此类从Servlet类扩展，并使用实例成员变量。由于J2EE框架只创建了一个Servlet类实例，并以多线程方式使用，因此很可能存在问题，非常不鼓励这种方式。仅考虑使用方法局部变量。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1093">包含危险文件</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">包含远程文件</a></li>
<li><a href="#_4">包含本地文件</a></li>
</ul>
</li>
<li><a href="#_5">漏洞利用威胁</a></li>
<li><a href="#_6">缓解与预防</a></li>
<li><a href="#_7">演示实例</a><ul>
<li><a href="#_8">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_9">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>包含危险文件漏洞允许攻击者包含一个文件，通常是利用目标程序中实现的”动态包含文件“机制来实现的。该漏洞主要出现在不会对用户提供的输入进行合理验证的系统中。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">包含远程文件</h4>
<p>当一个Web应用下载并运行一个远程文件时，可能会出现包含远程文件（Remote File Inclusion, RFI）问题。这些远程文件通常是从用户提供给本Web应用的HTTP或FTP的URI参数中获取的。</p>
<h4 id="_4">包含本地文件</h4>
<p>包含本地文件（Local File Inclusion, LFI）问题与包含远程文件问题类似，不同之处在于只有Web应用所在的服务器下的本地文件才能被包含。但因为攻击者可能会包含一个受攻击者控制的数据文件，如Web服务器的访问日志，因此还是会存在远程代码执行的风险。</p>
<h1 id="_5">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_6">缓解与预防</h1>
<ul>
<li>避免将用户提交的输入数据传递给文件系统或Web框架的API。</li>
<li>维护一个文件白名单列表，声明哪些文件能被页面包含，并通过使用标识符（如序号）来访问指定的那个的文件。</li>
</ul>
<h1 id="_7">演示实例</h1>
<h3 id="_8">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%</span>
   <span class="n">String</span> <span class="n">p</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"p"</span><span class="o">);</span>
   <span class="nd">@include</span> <span class="n">file</span><span class="o">=</span><span class="s">"&lt;%="</span><span class="n">includes</span><span class="o">/</span><span class="s">" + p +"</span><span class="o">.</span><span class="na">jsp</span><span class="err">"</span><span class="k">%&gt;</span>"
%&gt;
</pre></div>
</td></tr></table>
<h1 id="_9">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Testing_for_Local_File_Inclusion <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-wikipedia">
<p>https://en.wikipedia.org/wiki/File_inclusion_vulnerability <a class="footnote-backref" href="#fnref-wikipedia" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7477">过分宽松的CORS政策</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>过分宽松的CORS政策</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
在HTML5之前，Web浏览器强制执行Same Origin Policy，以确保JavaScript能够访问Web页面的内容，JavaScript和Web页面都必须来自同一个域。
如果没有Same Origin Policy，恶意网站就可以使用客户凭证使JavaScript从其它网站加载敏感信息，并通过它进行筛选，并将其反馈给攻击者。
如果一个名为Access-Control-Allow-Origin的新HTTP头被定义，那么HTML5就有可能使JavaScript访问跨域的数据。
有了这个头，一个Web服务器就定义了哪些其它域可以使用跨源请求访问它的域。
然而，在定义头时应该谨慎，因为过于宽松的CORS策略将允许恶意应用程序以不恰当的方式与受害者应用程序通信，从而导致欺骗、数据窃取、中继和其它攻击。
</p>
<p>
<b>易受攻击的代码：</b>
<pre>response.addHeader("Access-Control-Allow-Origin", "*");</pre>
</p>
<p>
<b>解决方案：</b>
<br/>
避免使用Access-Control-Allow-Origin header的值，这表明任何域上运行的JavaScript可以对应用程序的数据进行访问。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="references">References</h1>
<p><a href="https://www.w3.org/TR/cors/">W3C Cross-Origin Resource Sharing</a><br/>
<a href="http://enable-cors.org/">Enable Cross-Origin Resource Sharing</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7589">使用Velocity进行潜在模板注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用Velocity进行潜在模板注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
Velocity模板引擎十分强大。
它可以添加逻辑，包括条件语句、循环和外部调用。
但它不是设计成模板操作的沙盒。
控制模板的恶意用户可以在服务器端运行恶意代码。
Velocity模板应该被看作是脚本。
</p>
<p>
<b>易受攻击的代码：</b>
<pre>[...]
Velocity.evaluate(context, swOut, "test", userInput);</pre>
</p>
<p>
<b>解决方案：</b>
<br/>
避免让终端用户用Velocity模板。
如果您需要向您的用户公开模板编辑，则更倾向于使用无逻辑的模板引擎，比如Handlebars或者Moustache （参见参考资料）。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="references">References</h1>
<p><a href="http://blog.portswigger.net/2015/08/server-side-template-injection.html">PortSwigger: Server-Side Template Injection </a><br/>
<a href="https://jknack.github.io/handlebars.java/">Handlebars.java</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1109">不安全的存储</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件没有在存储或传输前对敏感或关键数据进行加密。</p>
<h1 id="_2">漏洞与风险</h1>
<p>没有对HTTPS session中敏感的cookie值的<code>Secure</code>属性进行设置，使得用户代理可能会在一个HTTPS session中以明文形式传递coockie。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>明确设计指明哪些重要的数据或资源需要进行加密保护。</li>
<li>确保系统设计中妥善处理好加密这一环。</li>
<li>区分不同场景下对加密的需求。</li>
<li>在使用工业界认可的方法时，请正确使用它们。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的缺陷代码片段来自一个servlet doPost()方法，它会设置cookie中accountID这一敏感者，但中途缺少了对<code>setSecure(true)</code>的调用：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Cookie</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="n">ACCOUNT_ID</span><span class="o">,</span> <span class="n">acctID</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe1">
<p>https://cwe.mitre.org/data/definitions/614.html <a class="footnote-backref" href="#fnref-cwe1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-cwe2">
<p>https://cwe.mitre.org/data/definitions/311.html <a class="footnote-backref" href="#fnref-cwe2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1108">Spring Bean注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>开发者能通过文件、URL等资源来加载Spring Bean的定义。</p>
<h1 id="_2">漏洞与风险</h1>
<p>如果没有合理地对不受信的用户输入进行验证，那么攻击者就能过通过控制Bean资源的内容来实现任意代码执行攻击。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7574">潜在的外部配置控制</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>潜在的外部配置控制</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
允许外部控制系统设置可能会中断服务或导致应用程序以恶意方式运行。
攻击者可能通过提供不存在的目录名称或连接到数据库的未授权部分，导致程序出错。
</p>
<br/>
<p>
<b>风险代码：</b><br/>
<pre>conn.setCatalog(request.getParameter("catalog"));</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/15.html">CWE-15: External Control of System or Configuration Setting</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7490">没有HttpOnly标志的Cookie</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>没有HttpOnly标志的Cookie</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
一个新的cookie是在没有<code>HttpOnly</code>标记集的情况下创建的。
<code>HttpOnly</code>标志是对浏览器的一个指令，以确保cookie不能被恶意脚本所使用。
当用户是“跨站点脚本”的目标时，攻击者将从获得会话id方面获得很大的好处。 </p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<p><pre>
 Cookie cookie = new Cookie("email",userName);
 response.addCookie(cookie);
 </pre></p>
</p>
<p>
<p><b>解决方案(特定的配置)：</b><br/></p>
<p><pre>
 Cookie cookie = new Cookie("email",userName);
 cookie.setSecure(true);
 cookie.setHttpOnly(true); //HttpOnly flag
 </pre></p>
</p>
<p>
<p><b>解决方案(Servlet 3.0 配置):</b><br/></p>
<p><pre>
 &lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" version="3.0"&gt;
 [...]
 &lt;session-config&gt;
  &lt;cookie-config&gt;
  &lt;http-only&gt;true&lt;/http-only&gt;
  &lt;secure&gt;true&lt;/secure&gt;
  &lt;/cookie-config&gt;
 &lt;/session-config&gt;
 &lt;/web-app&gt;
 </pre></p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://blog.codinghorror.com/protecting-your-cookies-httponly/">Coding Horror blog: Protecting Your Cookies: HttpOnly</a><br/>
<a href="https://www.owasp.org/index.php/HttpOnly">OWASP: HttpOnly</a><br/>
<a href="https://www.rapid7.com/db/vulnerabilities/http-cookie-http-only-flag">Rapid7: Missing HttpOnly Flag From Cookie</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7577">MODE_WORLD_READABLE模式文件（Android）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>MODE_WORLD_READABLE模式文件（Android）</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>在此上下文中所写的文件使用了<code>MODE_WORLD_READABLE</code>的创建模式。
公开所写内容可能程序员的本意。</p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<p><pre>
 fos = openFileOutput(filename, MODE_WORLD_READABLE);
 fos.write(userInfo.getBytes());
 </pre></p>
</p>
<p><br/></p>
<p>
<p><b>解决方案(使用MODE_PRIVATE):</b><br/></p>
<p><pre>
 fos = openFileOutput(filename, MODE_PRIVATE);
 </pre></p>
</p>
<p>
<p><b>解决方案(使用本地SQLite数据库):</b><br/></p>
<p>使用本地SQLite数据库可能是存储结构化数据的最佳解决方案。
确保数据库文件不是在外部存储器上创建的。
请参阅下面的参考资料了解如何实现。</p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.securecoding.cert.org/confluence/display/java/DRD11-J.+Ensure+that+sensitive+data+is+kept+secure">CERT: DRD11-J. Ensure that sensitive data is kept secure</a><br/>
<a href="http://developer.android.com/training/articles/security-tips.html#InternalStorage">Android Official Doc: Security Tips</a><br/>
<a href="http://developer.android.com/reference/android/content/Context.html#MODE_PRIVATE">Android Official Doc: Context.MODE_PRIVATE</a><br/>
<a href="http://www.vogella.com/tutorials/AndroidSQLite/article.html#databasetutorial_database">vogella.com: Android SQLite database and content provider - Tutorial</a><br/>
<a href="https://www.owasp.org/index.php/Mobile_Top_10_2014-M2">OWASP Mobile Top 10 2014-M2: Insecure Data Storage</a><br/>
<a href="https://cwe.mitre.org/data/definitions/312.html">CWE-312: Cleartext Storage of Sensitive Information</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7469">Spring文件泄露</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Spring文件泄露</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
用用户输入构造一个服务器端重定向路径可以让攻击者下载应用程序二进制文件（包括应用程序类或jar文件），或者在受保护的目录中查看任意文件。<br/></p>
<p>攻击者可以伪造一个请求参数来匹配敏感的文件位置。
例如，请求 "http://example.com/?returnURL=WEB-INF/applicationContext.xml"将显示应用程序的applicationContext.xml文件。
攻击者将能够定位和下载在其它配置文件中引用的applicationContext.xml，甚至是类文件或jar文件，获取敏感信息并启动其它类型的攻击。
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>...
String returnURL = request.getParameter("returnURL");
return new ModelAndView(returnURL);
...</pre>
</p>
<p>
<b>解决方案：</b><br/>
避免使用用户控制的输入构建服务器端重定向。
</p>
<br/>
<p>
<b>引用</b><br/>
<a href="https://cwe.mitre.org/data/definitions/552.html">CWE-552: Files or Directories Accessible to External Parties</a><br/>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1081">隐私侵犯</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件没有合理地阻止用户访问私有信息（例如信用卡号）。这类用户可能没有经过明确的授权，或没有获得私有信息所有人的同意。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当没有正确处理好私有信息（例如消费者的密码或社保卡号）时，程序将有可能置用户的隐私于危险之中，很多时候这是法律所不允许的。尽管私有信息的暴露不会对程序运行的正确性有必然的影响，甚至开发者因为某些原因特地这么做，但这对私有信息所有人来说，他们是不想看到这类事情的发生的（当然，法律也明文禁止这样的行为）。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>下面的代码利用用户的位置信息来确定用户当前所在的州：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_FINE_LOCATION"</span><span class="nt">/&gt;</span>
</pre></div>
</td></tr></table>
<p>首先，程序必须<code>manifest.xml</code>文件中明确声明运行该程序需要<code>ACCESS_FINE_LOCATION</code>权限。</p>
<p>在程序运行过程中，<code>getLastLocation()</code>会基于程序的位置权限来返回一个位置信息。在这种情况下，程序拥有获取用户最精准的位置的权限：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">locationClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocationClient</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
<span class="n">locationClient</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
<span class="n">Location</span> <span class="n">userCurrLocation</span><span class="o">;</span>
<span class="n">userCurrLocation</span> <span class="o">=</span> <span class="n">locationClient</span><span class="o">.</span><span class="na">getLastLocation</span><span class="o">();</span>
<span class="n">deriveStateFromCoords</span><span class="o">(</span><span class="n">userCurrLocation</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>尽管程序需要用户的位置信息，但它大可不必为此取得<code>ACCESS_FINE_LOCATION</code>的权限，因为<code>ACCESS_COARSE_LOCATION</code>权限足以让程序知道当前用户所处的州。</p>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/359.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7497">接受任何证书的TrustManager</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>接受任何证书的TrustManager</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>空的TrustManager实现通常被用来轻松地连接到一个没有root的主机<a href="http://en.wikipedia.org/wiki/Certificate_authority">certificate authority</a>. 因此，这很容易受到<a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">Man-in-the-middle attacks</a>的影响，因为客户端会信任任何证书。
</p>
<p>
应该建立一个允许特定证书（例如基于truststore）的TrustManager。关于适当执行的详细信息可参考：
<a href="http://stackoverflow.com/a/6378872/89769">[1]</a>
<a href="http://stackoverflow.com/a/5493452/89769">[2]</a>
</p>
<br/>
<p>
<b>易受攻击的代码：</b><br/>
<pre>class TrustAllManager implements X509TrustManager {
    @Override
    public void checkClientTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        //Trust any client connecting (no certificate validation)
    }
    @Override
    public void checkServerTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        //Trust any remote server (no certificate validation)
    }
    @Override
    public X509Certificate[] getAcceptedIssuers() {
        return null;
    }
}</pre>
</p>
<br/>
<p>
<b>解决方案(基于密钥库的TrustMangager)：</b><br/>
<pre>KeyStore ks = //Load keystore containing the certificates trusted
SSLContext sc = SSLContext.getInstance("TLS");
TrustManagerFactory tmf = TrustManagerFactory.getInstance("SunX509");
tmf.init(ks);
sc.init(kmf.getKeyManagers(), tmf.getTrustManagers(),null);
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://projects.webappsec.org/w/page/13246945/Insufficient%20Transport%20Layer%20Protection">WASC-04: Insufficient Transport Layer Protection</a><br/>
<a href="http://cwe.mitre.org/data/definitions/295.html">CWE-295: Improper Certificate Validation</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0091">URL重定向到不受信任的站点</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#1">漏洞代码示例 1</a><ul>
<li><a href="#1_1">修复代码示例 1</a></li>
</ul>
</li>
<li><a href="#2">漏洞代码示例 2</a><ul>
<li><a href="#2_1">修复代码示例 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Web应用程序接受用户控制的输入，该输入指定到外部站点的链接，并在重定向中使用该链接。</p>
<h1 id="_2">漏洞与风险</h1>
<p>通过修改不可信URL输入到一个恶意网站，攻击者可能会成功启动钓鱼诈骗并窃取用户凭据。 未经验证的重定向和转发攻击也可用于恶意制作一个URL，该URL将通过应用程序的访问控制检查，使得攻击者可以访问一些未经授权的函数。</p>
<h1 id="_3">缓解与预防</h1>
<p>可以通过多种方式安全使用重定向和转发：</p>
<ol>
<li>避免使用重定向和转发。  </li>
<li>如果使用重定向和转发，请不要将url作为目标的用户输入。在这种情况下，你应该有一个方法来验证URL的合法性。  </li>
<li>如果无法避免用户输入，请确保提供的URL是有效的，并且已获得用户授权。  </li>
<li>建议将任何此类目标输入映射到值，而不是实际的URL或URL的一部分，并且该服务器端代码将此值转换为目标URL。  </li>
<li>通过创建可信URL列表（主机列表或正则表达式）来过滤输入。  </li>
<li>强制所有重定向首先通过一个页面通知用户他们将离开您的网站，并让他们点击一个链接进行确认。  </li>
</ol>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示示例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<p>以下Java代码从'url' GET参数接收URL并重定向到该URL。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"url"</span><span class="o">));</span>
</pre></div>
</td></tr></table>
<p>如果未验证URL的合法性，则代码易受攻击。 通过将用户重定向到恶意网站，此漏洞可能会被用作钓鱼诈骗的一部分。 如果未应用验证，恶意用户可以创建超链接将用户重定向到未经过验证的恶意网站，例如：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> http://example.com/example.php?url=http://malicious.example.com
</pre></div>
</td></tr></table>
<p>用户将看到指向原始受信任站点（example.com）的链接，并且没有意识到可能发生的重定向</p>
<h4 id="1_1">修复代码示例 1</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="n">string</span> <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"url"</span><span class="o">);</span>

  <span class="c1">// 事先检查URL合法性</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">is_safe</span><span class="o">(</span><span class="n">redirect_url</span><span class="o">))</span> <span class="o">{</span>  
    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">redirect_url</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>当应用程序允许用户输入在站点的不同部分之间转发请求时，应用程序必须检查用户是否有权访问url，执行它提供的功能，并且这是一个合适的url请求。 如果应用程序未能执行这些检查，则攻击者制作的URL可能会通过应用程序的访问控制检查，然后将攻击者转发到通常不允许的管理功能。</p>
<p>以下代码是一个Java servlet，它将在请求中接收到带有url参数的GET请求，以转发到url参数中指定的地址。 该servlet将从请求中检索url参数值，并在响应浏览器之前完成服务器端正向处理。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForwardServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> 
<span class="o">{</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">))</span> 
    <span class="o">{</span>
      <span class="n">String</span> <span class="n">fwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">);</span>
      <span class="k">try</span> 
      <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">fwd</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
      <span class="o">}</span> 
      <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> 
      <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h4 id="2_1">修复代码示例 2</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForwardServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> 
<span class="o">{</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">))</span> 
    <span class="o">{</span>
      <span class="n">String</span> <span class="n">fwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"fwd"</span><span class="o">);</span>
      <span class="k">try</span> 
      <span class="o">{</span>
     <span class="c1">// 事先检查权限和跳转的合法性</span>
     <span class="k">if</span><span class="o">(</span><span class="n">isAutherized</span> <span class="n">and</span> <span class="nf">isSafe</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">fwd</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
  <span class="o">}</span>
      <span class="o">}</span> 
      <span class="k">catch</span> <span class="o">(</span><span class="n">ServletException</span> <span class="n">e</span><span class="o">)</span> 
      <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/601.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-601.html">CWE-601</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7483">不可信的会话cookie值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的会话cookie值</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>方法<a href="http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getRequestedSessionId()"><code>HttpServletRequest.getRequestedSessionId()</code></a>通常返回cookie <code>JSESSIONID</code>的值。这个值通常只被会话管理逻辑访问，而不是普通的开发人员代码。</p>
<p>传递给客户端的值通常是一个字母数字值(例如，<code>JSESSIONID=jp6q31lq2myn</code>)。然而，该值可以由客户端更改。下面的HTTP请求说明了可能的修改。
<pre>
GET /somePage HTTP/1.1
Host: yourwebsite.com
User-Agent: Mozilla/5.0
Cookie: JSESSIONID=Any value of the user's choice!!??'''"&gt;</pre>
</p>
<p>因此，只能使用JSESSIONID来查看它的值是否与现有会话ID相匹配。
如果不匹配，用户应该被认为是未经身份验证的用户。
此外，会话ID值不应该被记录。
如果被记录的话，那么日志文件可以包含有效的活动会话id，
允许内部人员劫持任何已被记录并且仍然处于活动状态的会话id。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.owasp.org/index.php/Session_Management_Cheat_Sheet">OWASP: Session Management Cheat Sheet</a><br/>
<a href="http://cwe.mitre.org/data/definitions/20.html">CWE-20: Improper Input Validation</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7044">类加载器只应在doPrivileged块内创建</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>类加载器只应在doPrivileged块内创建</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>这段代码创建一个类加载器。如果系统安装了安全管理，则这段代码运行需要权限。如果此代码由没有安全权限的代码调用，则类加载器的创建需要在doPrivileged块中进行。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0132">下载代码时没有进行完整性检查</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>程序从远程下载源代码或可执行文件并执行代码，但未充分验证代码的来源和完整性。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者可以通过入侵主机服务器，执行DNS欺骗或修改传输中的代码来执行恶意代码。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>使用工具或框架对传输的代码执行完整性检查。</p>
<h1 id="_4">缓解与预防</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>此示例从本地子目录加载外部类：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">URL</span><span class="o">[]</span> <span class="n">classURLs</span><span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">[]{</span>
<span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"file:subdir/"</span><span class="o">)</span>
<span class="o">};</span>
<span class="n">URLClassLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URLClassLoader</span><span class="o">(</span><span class="n">classURLs</span><span class="o">);</span>
<span class="n">Class</span> <span class="n">loadedClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">loader</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>此代码不能确保加载的类是预期的类，例如通过验证类的校验和。攻击者可能会修改该类文件以执行恶意代码。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">URL</span><span class="o">[]</span> <span class="n">classURLs</span><span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">[]{</span>
<span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"file:subdir/"</span><span class="o">)</span>
<span class="o">};</span>
<span class="n">URLClassLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URLClassLoader</span><span class="o">(</span><span class="n">classURLs</span><span class="o">);</span>
<span class="n">loader</span><span class="o">.</span><span class="na">findResource</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">);</span>  <span class="c1">// Check Class</span>
<span class="n">Class</span> <span class="n">loadedClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"loadMe"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">loader</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/494.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-494.html">CWE-494</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7479">可预测的伪随机数发生器（Scala）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可预测的伪随机数发生器（Scala）</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>在某些安全非常重要的环境中使用可预测的随机值会导致漏洞。
例如，当值被用作：</p>
<ul>
<li>CSRF令牌：可预测的令牌可以导致CSRF攻击，攻击者将知道令牌的值。</li>
<li>密码重置令牌（通过电子邮件发送）：可预测的密码令牌可以导致帐户接管，因为攻击者会猜测更改密码表单的URL
  </li>
<li>任何其它密钥值
</li>
</ul>
<p>一个快速的解决方案可能是用更强的随机值替换使用<b>java.util.Random</b>，比如<b>java.security.SecureRandom</b>.
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>import scala.util.Random
def generateSecretToken() {
    val result = Seq.fill(16)(Random.nextInt)
    return result.map("%02x" format <em>).mkString
}</em></pre>
</p>
<p>
<b>解决方法：</b>
<pre>import java.security.SecureRandom
def generateSecretToken() {
    val rand = new SecureRandom()
    val value = Array.ofDim<a href="16">Byte</a>
    rand.nextBytes(value)
    return value.map("%02x" format </pre></p></p>).mkString
}

<p>
<b>
解决方法：</b>
<pre>import java.security.SecureRandom
import scala.util.Random.<em>
def generateSecretToken() {
    val secRandom = javaRandomToRandom(new SecureRandom())
    val result = Seq.fill(16)(secRandom.nextInt)
    return result.map("%02x" format </em>).mkString
}</pre>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://jazzy.id.au/default/2010/09/20/cracking_random_number_generators_part_1.html">Cracking Random Number Generators - Part 1 (http://jazzy.id.au)</a><br/>
<a href="https://www.securecoding.cert.org/confluence/display/java/MSC02-J.+Generate+strong+random+numbers">CERT: MSC02-J. Generate strong random numbers</a><br/>
<a href="http://cwe.mitre.org/data/definitions/330.html">CWE-330: Use of Insufficiently Random Values</a><br/>
<a href="http://blog.h3xstream.com/2014/12/predicting-struts-csrf-token-cve-2014.html">Predicting Struts CSRF Token (Example of real-life vulnerability and exploitation)</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0093">跨站点请求伪造</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>跨站点请求伪造（CSRF）是一种攻击，它迫使最终用户在当前通过身份验证的Web应用程序上执行恶意的操作。 CSRF攻击专门针对状态改变的请求，而不是数据窃取，因为攻击者无法查看对伪造请求的响应。 借助社交工程的一些帮助（例如通过电子邮件或聊天发送链接），攻击者可能会欺骗Web应用程序的用户执行攻击者选择的操作。 如果受害者是普通用户，则成功的CSRF攻击可以强制用户执行状态更改请求，如转移资金，更改其电子邮件地址等等。 如果受害者是管理帐户，CSRF可能会危害整个Web应用程序。</p>
<h1 id="_2">漏洞与风险</h1>
<p>跨站点请求伪造后果将根据易受CSRF影响的功能性质而有所不同。攻击者可以有效地执行任何恶意的操作。 如果受害者是管理员或特权用户，则其后果可能包括完全控制Web应用程序，从而删除数据，卸载产品或使用它对所有产品的用户发动其他攻击。 </p>
<h1 id="_3">缓解与预防</h1>
<ol>
<li>使用经过审查的库或框架，不允许发生这种缺陷或提供使这种缺陷更容易避免的构造。例如，使用防御CSRF的库，例如OWASP CSRFGuard。</li>
<li>确保应用程序没有跨站脚本问题，因为大多数CSRF防御措施可以使用攻击者控制的脚本绕过。</li>
<li>为每个表单生成唯一的随机数，将随机数放入表单中，并在收到表单时验证随机数。</li>
<li>识别特别危险的操作。当用户执行危险操作时，请发送单独的确认请求以确保用户打算执行该操作。</li>
<li>不要将GET方法用于触发状态更改的任何请求。</li>
<li>检查HTTP Referer头以查看请求是否来自期望的页面。这可能会破坏合法的功能，因为用户或代理可能因为隐私原因而禁止发送Referer。</li>
</ol>
<h1 id="_4">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>假设您银行的网站提供了一个表格，允许从当前登录用户转账到另一个银行账户。例如，HTTP请求可能如下所示：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/transfer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bank.example.com</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">JSESSIONID=randomid; Domain=bank.example.com; Secure; HttpOnly</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

amount=100.00&amp;routingNumber=1234&amp;account=9876
</pre></div>
</td></tr></table>
<p>现在假设你已经认证了该银行网站，然后在没有注销的情况下访问一个恶意网站。恶意的网站包含一个HTML页面，其格式如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"https://bank.example.com/transfer"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"amount"</span>
    <span class="na">value=</span><span class="s">"100.00"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"routingNumber"</span>
    <span class="na">value=</span><span class="s">"evilsRoutingNumber"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span>
    <span class="na">name=</span><span class="s">"account"</span>
    <span class="na">value=</span><span class="s">"evilsAccountNumber"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span>
    <span class="na">value=</span><span class="s">"Win Money!"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</td></tr></table>
<p>你点击提交按钮。在这个过程中，你无意间将100美元转让给恶意用户。 发生这种情况的原因是，虽然恶意网站无法看到您的Cookie，但与您的银行相关的Cookie仍会与请求一起发送。</p>
<p>修复建议：参考“缓解与预防”
引用
================</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE352">
<p>https://cwe.mitre.org/data/definitions/352.html <a class="footnote-backref" href="#fnref-CWE352" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF).html <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-352.html">CWE-352</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0085">格式化字符串漏洞</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">拒绝服务、信息泄漏</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#1">漏洞演示实例 1: 泄漏内存数据</a></li>
<li><a href="#2">漏洞演示实例 2：程序崩溃和拒绝服务</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
<li><a href="#3">漏洞演示实例 3</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>例如 C 语言的 <code>printf</code> 函数，Java 语言的 <code>String.format</code> 方法可以接受可变参数。其中一个参数指定了其他参数的数据解析方法，如果该参数可被外部随意控制，恶意构造的格式化字符串可以引起程序异常和崩溃、数据泄漏、甚至是代码执行。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">拒绝服务、信息泄漏</h4>
<p>格式化字符串可以包含任意数量的数值指定符，程序会根据指定符不断处理和输出程序栈上的内容，最后可能泄漏关键的程序信息  <br/>
攻击者更加可以包含字符串指定符，程序会把内存数据当作一个合法指针，进而解析指针指向的字符串内容。程序并不会检查指针的合法性，一旦解析到非法指针，程序就会崩溃。  </p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_5">缓解与预防</h1>
<ul>
<li>不要使用外部可控的格式化字符串参数</li>
<li>增加过滤和净化逻辑阻止恶意利用</li>
</ul>
<h1 id="_6">演示实例</h1>
<h3 id="1">漏洞演示实例 1: 泄漏内存数据</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0xAABBCCDD</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mh">0xFFEE4242</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>程序执行输出: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ./a.out <span class="s2">"%p %p %p %p %p %p %p %p %p  "</span>
0x7ffeccbb42f8 0x7ffeccbb4310 <span class="o">(</span>nil<span class="o">)</span> 0x4005e0 0x7f287164bab0 <span class="se">\</span>
0x7ffeccbb42f8 0x200400430 0x7ffeccbb42f0 0xffee4242aabbccdd  
</pre></div>
</td></tr></table>
<p>在程序输出中最后一个数值 (0xffee4242aabbccdd) 其实就是变量 <code>a</code> 和 <code>b</code> 的值。这个例子展示了格式化字符串漏洞泄漏内存信息的能力。</p>
<h3 id="2">漏洞演示实例 2：程序崩溃和拒绝服务</h3>
<p>使用和实例 1 同样的代码，换上字符串指定符可以令程序崩溃</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ./a.out <span class="s2">"%s %s %s %s %s %s %s %s %s  "</span>
Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</pre></div>
</td></tr></table>
<p>程序根据 <code>%s</code> 字符串指定符把数据解析成字符串指针，并会读取指针指向的内容。一旦遇上非法指针，程序将会崩溃。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0xAABBCCDD</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mh">0xFFEE4242</span><span class="p">;</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>格式串一般来说应当是固定的字符串。当外部来源的字符串需要输出时，应当在格式串中用 <code>%s</code> 来输出，而不是把字符串本身当作格式串。 </p>
<h3 id="3">漏洞演示实例 3</h3>
<p>上面的例子对Java也适用：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.</span><span class="o">*</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>应该被修复为</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.</span><span class="o">*</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">"</span><span class="si">%s%d%d</span><span class="s2">"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE">
<p>http://cwe.mitre.org/data/definitions/134.html <a class="footnote-backref" href="#fnref-CWE" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">Java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7509">正则表达式DOS（ReDOS）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>正则表达式DOS（ReDOS）</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
正则表达式（regexs）经常被Denial of Service（DOS）攻击（称为ReDOS）。
这是因为regex引擎在分析某些字符串时可能会花费大量的时间，时间取决于正则表达式的定义。<p>
例如，对于正则表达式<b>^(a+)+$</b>, 输入"<code>aaaaaaaaaaaaaaaaX</code>" 将导致正则引擎分析65536条不同的路径。<sup>[1] 来自OWASP引用的例子</sup></p>
<p></p></p></p>
<p>因此，单个请求可能会在服务器端造成大量的计算。
这个正则表达式以及其它类似的问题，是由于括号内的+（或a<em>）和括号之外的+（或a</em>）这两种不同的方式都可以被正则表达式接受。
这样写的方式，每一个+可以使用“a”这个字符。为了解决这个问题，应该重写正则表达式来消除歧义。
例如，这可以简单地重写为：<b>^a+$</b>，这大概是作者的意思（任意数量的a）。
假设这就是最初的正则表达式的含义，那么这个新的正则表达式可以快速地进行评估，并且不受ReDOS的影响。</p>
<br/>
<p>推荐使用ReScue进行攻击测试：<a href="https://2bdenny.github.io/ReScue/">ReScue</a></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="http://www.jroller.com/sebastianKuebeck/entry/detecting_and_preventing_redos_vulnerabilities">Sebastian Kubeck's Weblog: Detecting and Preventing ReDoS Vulnerabilities</a><br/>
<a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP: Regular expression Denial of Service</a><br/>
<a href="http://cwe.mitre.org/data/definitions/400.htm">CWE-400: Uncontrolled Resource Consumption ('Resource Exhaustion')</a><br/>
<a href="https://2bdenny.github.io/ReScue/">ReScue</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1074">访问控制</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>调用安全敏感型方法的应用代码必须对传入该类方法的参数进行验证。</p>
<h1 id="_2">漏洞与风险</h1>
<p>特别地，某些安全敏感型方法会将null值解释为无害的值，但它们可能会重写默认的设置。尽管安全敏感型方法应该保守性编码，但用户端代码仍要对方法的参数进行验证，否则，未经验证的参数可能会被视作有效值被接收。没做到这点，那么将有可能出现权限放大及任意代码执行问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>透彻地理解安全敏感型方法并对它们的参数进行验证，以避免因意外参数值导致的边界情况。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这段存在缺陷的代码展示了接收两个参数且以第二个参数作为访问控制上下文的<code>doPrivileged()</code>方法，它从先前保存的上下文中恢复访问权限：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">PrivilegedAction</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>
  <span class="o">},</span> <span class="n">accessControlContext</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>当传入的访问控制上下文为null时，<code>doPrivileged()</code>方法无法将当前的访问控制权限降至先前保存的上下文的访问控制权限。因此，当<code>accessCibtrikCibtext</code>参数为<code>null</code>时，这段代码将给当前访问控制上下文赋予过高的权限。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<p>这个合规的解决方案通过确保<code>accessControlContext</code>不为<code>null</code>来避免赋予过高的权限：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">accessControlContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">SecurityException</span><span class="o">(</span><span class="s">"Missing AccessControlContext"</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">PrivilegedAction</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>
  <span class="o">},</span> <span class="n">accessControlContext</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/SEC55-J.+Ensure+that+security-sensitive+methods+are+called+with+validated+arguments <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0082">LDAP 注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>轻量级目录访问协议（LDAP）允许应用程序远程执行操作，例如搜索和修改目录中的记录。 LDAP注入源自输入清理和验证不足，并允许恶意用户使用目录服务收集受限信息。</p>
<p>白名单可用于将输入限制为有效字符列表。下表中列出了必须从白名单中排除的字符和字符序列（包括Java命名和目录接口（JNDI）元字符和LDAP特殊字符）。</p>
<p>从白名单中排除的字符和序列：</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>字符序列</th>
</tr>
</thead>
<tbody>
<tr>
<td>#</td>
<td>Hash character at the beginning of the string</td>
</tr>
<tr>
<td>' and "</td>
<td>Single and double quote</td>
</tr>
<tr>
<td>( and )</td>
<td>Round braces</td>
</tr>
<tr>
<td>+ and *</td>
<td>Addition and multiplication operators</td>
</tr>
<tr>
<td>, and ;</td>
<td>Comma and semicolon</td>
</tr>
<tr>
<td>/ and \</td>
<td>Forward slash and backslash</td>
</tr>
<tr>
<td>&lt; and &gt;</td>
<td>Angle brackets</td>
</tr>
<tr>
<td>\\</td>
<td>Double slashes*</td>
</tr>
<tr>
<td>\u0000</td>
<td>Unicode NULL character</td>
</tr>
<tr>
<td>space</td>
<td>Space character at beginning or end of string</td>
</tr>
<tr>
<td>这是一个字符序列。</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="_2">漏洞与风险</h1>
<p>下表列出了与缺陷相关的不同后果。'范围'标识了被违反的应用程序安全区域，而'影响'则描述了如果攻击者成功利用此漏洞所产生的负面技术影响。   </p>
<table>
<thead>
<tr>
<th>范围</th>
<th>影响</th>
</tr>
</thead>
<tbody>
<tr>
<td>机密性</td>
<td>执行未经授权的代码或命令; 阅读应用数据; 修改应用数据</td>
</tr>
<tr>
<td>完整可用性</td>
<td>攻击者可能包含更改LDAP查询的输入，该查询允许执行意外的命令或代码，允许读取或修改敏感数据或导致其他意外行为</td>
</tr>
</tbody>
</table>
<h1 id="_3">缓解与预防</h1>
<p>1 使用正确的LDAP编码函数
2 使用自动从LDAP注入进行保护的框架
3 额外防御</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这个漏洞代码示例允许方法searchRecord()的调用者使用LDAP协议在目录中搜索记录。字符串过滤器用于过滤与调用者提供的用户名和密码匹配的条目的结果集。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "S*"; // Invalid</span>
<span class="c1">// String userPassword = "*"; // Invalid</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LDAPInjection</span> <span class="o">{</span>       
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">searchRecord</span><span class="o">(</span><span class="n">String</span> <span class="n">userSN</span><span class="o">,</span> <span class="n">String</span> <span class="n">userPassword</span><span class="o">)</span>  
  <span class="kd">throws</span> <span class="n">NamingException</span> <span class="o">{</span>        
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>  <span class="n">env</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
    <span class="n">env</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">INITIAL_CONTEXT_FACTORY</span><span class="o">,</span> <span class="s">"com.sun.jndi.ldap.LdapCtxFactory"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">DirContext</span> <span class="n">dctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialDirContext</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

      <span class="n">SearchControls</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SearchControls</span><span class="o">();</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">attributeFilter</span> <span class="o">=</span> <span class="o">{</span><span class="s">"cn"</span><span class="o">,</span> <span class="s">"mail"</span><span class="o">};</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setReturningAttributes</span><span class="o">(</span><span class="n">attributeFilter</span><span class="o">);</span>
      <span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

      <span class="c1">// The following resolves to (&amp;(sn=S*)(userPassword=*))     </span>
      <span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn="</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

      <span class="n">NamingEnumeration</span><span class="o">&lt;?&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">dctx</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="n">filter</span><span class="o">,</span> <span class="n">sc</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">hasMore</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">SearchResult</span> <span class="n">sr</span> <span class="o">=</span> <span class="o">(</span><span class="n">SearchResult</span><span class="o">)</span> <span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">Attributes</span> <span class="n">attrs</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attributes</span><span class="o">)</span> <span class="n">sr</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
        <span class="n">Attribute</span> <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"cn"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="o">(</span><span class="n">Attribute</span><span class="o">)</span> <span class="n">attrs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"mail"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attr</span><span class="o">);</span>
      <span class="o">}</span>    
      <span class="n">dctx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NamingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>如上所述，当恶意用户输入特制输入时，此基本身份验证方案无法将搜索查询的输出限制为用户具有访问权限的信息。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<p>此漏洞代码修复示例使用白名单来清理用户输入，以便过滤器字符串仅包含有效字符。在此代码中，userSN可能只包含字母和空格，而密码可能只包含字母数字字符。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// String userSN = "Sherlock Holmes"; // Valid</span>
<span class="c1">// String userPassword = "secret2";   // Valid</span>

<span class="c1">// ... beginning of LDAPInjection.searchRecord()...</span>
<span class="n">sc</span><span class="o">.</span><span class="na">setSearchScope</span><span class="o">(</span><span class="n">SearchControls</span><span class="o">.</span><span class="na">SUBTREE_SCOPE</span><span class="o">);</span>
<span class="n">String</span> <span class="n">base</span> <span class="o">=</span> <span class="s">"dc=example,dc=com"</span><span class="o">;</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">userSN</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w\\s]*"</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">userPassword</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"Invalid input"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">String</span> <span class="n">filter</span> <span class="o">=</span> <span class="s">"(&amp;(sn = "</span> <span class="o">+</span> <span class="n">userSN</span> <span class="o">+</span> <span class="s">")(userPassword="</span> <span class="o">+</span> <span class="n">userPassword</span> <span class="o">+</span> <span class="s">"))"</span><span class="o">;</span>

<span class="c1">// ... remainder of LDAPInjection.searchRecord()...    </span>
</pre></div>
</td></tr></table>
<p>当数据库字段（例如密码）必须包含特殊字符时，确保将真实数据以过滤后的形式存储在数据库中以及在进行验证或比较之前对任何用户输入进行规范化至关重要。 不建议在没有全面的标准化和基于白名单的例程的情况下使用在JNDI和LDAP中具有特殊含义的字符。 在将特殊字符添加到白名单表达式之前，必须将其转换为已过滤后的安全值，然后才能对输入进行验证。同样，用户输入的标准化应该在验证步骤之前进行。</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CEW">
<p>http://cwe.mitre.org/data/definitions/116.html <a class="footnote-backref" href="#fnref-CEW" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/web.html">Web</a>
                <a href="../../tag/java.html">Java</a>
                <a href="../../tag/injection.html">Injection</a>
                <a href="../../tag/cwe-116.html">CWE-116</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0081">SQL 注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>SQL注入漏洞在SQL查询的元素源自不可信源的应用程序中出现。如果没有预防措施，不可信数据可能会恶意更改查询，导致信息泄漏或数据修改。</p>
<p>假设系统通过向SQL数据库发出以下查询来对用户进行身份验证。 如果查询返回任何结果，则认证成功; 否则，认证失败。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'&lt;USERNAME&gt;'</span> <span class="k">AND</span>  <span class="n">password</span><span class="o">=</span><span class="s1">'&lt;PASSWORD&gt;'</span>
</pre></div>
</td></tr></table>
<p>假设攻击者可以用<username>和<password>替换任意字符串。 在这种情况下，可以通过向以下<username>提供任意密码来绕过认证机制：</username></password></username></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">validuser</span><span class="s1">' OR '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
</pre></div>
</td></tr></table>
<p>身份验证例程动态构建以下查询：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'validuser'</span> <span class="k">OR</span> <span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span> <span class="k">AND</span> <span class="n">password</span><span class="o">=</span><span class="s1">'&lt;PASSWORD&gt;'</span>
</pre></div>
</td></tr></table>
<p>如果validuser是有效的用户名，则此SELECT语句会在表中生成有效用户记录。从而不再检查密码是否正确，因为<code>username='validuser'</code>为true; 因此，OR之后的语句就不会被验证。只要OR之后的组件生成语法上正确的SQL表达式，攻击者就被授予validuser的访问权限。</p>
<p>同样，攻击者可以用任意用户名为<password>提供以下字符串：</password></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s1">' OR '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
</pre></div>
</td></tr></table>
<p>产生下面的查询语句：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">db_user</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'&lt;USERNAME&gt;'</span> <span class="k">AND</span> <span class="n">password</span><span class="o">=</span><span class="s1">''</span> <span class="k">OR</span> <span class="s1">'1'</span><span class="o">=</span><span class="s1">'1'</span>
</pre></div>
</td></tr></table>
<p><code>'1'='1'</code>总是计算为真，导致查询产生数据库中的每一行。在这种情况下，攻击者将被认证而不需要有效的用户名或密码。</p>
<h1 id="_2">漏洞与风险</h1>
<p>SQL注入是一种代码注入技术，用于攻击数据驱动的应用程序，其中恶意的SQL语句被插入到输入字段中从而被恶意执行。（例如将数据库内容转储给攻击者）。SQL注入必须利用应用程序软件中的安全漏洞，例如，当用户输入不正确地过滤嵌入SQL语句中的字符串文字转义字符或者用户输入未被强类型化和意外执行时。 SQL注入通常被称为网站的攻击媒介，但可以用来攻击任何类型的SQL数据库。</p>
<p>SQL注入攻击允许攻击者欺骗身份，篡改现有数据，引起拒绝问题（如排除交易或更改余额），允许完整披露系统上的所有数据，销毁数据或使其不可用，并成为 数据库服务器管理员。</p>
<h1 id="_3">缓解与预防</h1>
<p>防止SQL注入的主要手段是清理和验证，通常将其实施为参数化查询和存储过程。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>JDBC库提供了一个用于构建清理不可信数据的SQL命令的API。java.sql.PreparedStatement类正确地转义输入字符串，正确使用时可以防止SQL注入。 此代码示例修改doPrivilegedAction（）方法以使用PreparedStatement而不是java.sql.Statement。 但是，准备好的语句仍然允许SQL注入攻击，通过将unsanitized输入参数用户名插入预准备语句中。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Statement</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Login</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">Connection</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
    <span class="n">DriverManager</span><span class="o">.</span><span class="na">registerDriver</span><span class="o">(</span><span class="k">new</span>
            <span class="n">com</span><span class="o">.</span><span class="na">microsoft</span><span class="o">.</span><span class="na">sqlserver</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">SQLServerDriver</span><span class="o">());</span>
    <span class="n">String</span> <span class="n">dbConnection</span> <span class="o">=</span>
      <span class="n">PropertyManager</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"db.connection"</span><span class="o">);</span>
    <span class="c1">// Can hold some value like</span>
    <span class="c1">// "jdbc:microsoft:sqlserver://&lt;HOST&gt;:1433,&lt;UID&gt;,&lt;PWD&gt;"</span>
    <span class="k">return</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">dbConnection</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="n">String</span> <span class="nf">hashPassword</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create hash of password</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPrivilegedAction</span><span class="o">(</span>
    <span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span>
  <span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
    <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">sqlString</span> <span class="o">=</span> <span class="s">"select * from db_user where username="</span> <span class="o">+</span>
        <span class="n">username</span> <span class="o">+</span> <span class="s">" and password ="</span> <span class="o">+</span> <span class="n">pwd</span><span class="o">;</span>     
      <span class="n">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sqlString</span><span class="o">);</span>

      <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">SecurityException</span><span class="o">(</span><span class="s">"User name or password incorrect"</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// Authenticated; proceed</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Forward to handler</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>该修复示例使用参数查询，字符作为参数的占位符。还会验证用户名参数的长度，防止攻击者提交任意长的用户名。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPrivilegedAction</span><span class="o">(</span>
  <span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">password</span>
<span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
  <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getConnection</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">hashPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>

    <span class="c1">// Validate username length</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">username</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>

    <span class="n">String</span> <span class="n">sqlString</span> <span class="o">=</span>
      <span class="s">"select * from db_user where username=? and password=?"</span><span class="o">;</span>
    <span class="n">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sqlString</span><span class="o">);</span>
    <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
    <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">pwd</span><span class="o">);</span>
    <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">SecurityException</span><span class="o">(</span><span class="s">"User name or password incorrect"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Authenticated; proceed</span>
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Forward to handler</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>使用PreparedStatement类的<code>set*()</code>方法来执行强类型检查。此技术可缓解SQL注入漏洞，因为输入可通过双引号内的自动陷入正确转义。 请注意，即使在将数据插入数据库的查询中也必须使用准备好的语句。</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/89.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/web.html">Web</a>
                <a href="../../tag/java.html">Java</a>
                <a href="../../tag/injection.html">Injection</a>
                <a href="../../tag/cwe-89.html">CWE-89</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1106">邮件命令注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>攻击者利用IMAP/SMTP服务器验证输入过程中的弱点，在服务器上执行命令。</p>
<h1 id="_2">漏洞与风险</h1>
<p>Web邮件服务器处于Internet和IMAP/SMTP邮件服务器之间。当Web邮件服务器接收到用户请求后，Web邮件服务器通过询问后端的邮件服务器以获取用户请求的信息，并将获得的信息返回给用户。在IMAP/SMTP命令注入攻击场景中，攻击者会将邮件服务器上相应的命令嵌入到发送给Web邮件服务器的请求中。如果Web邮件服务器没有合理地对用户的请求进行清洗，那么当请求内容发送到后端邮件服务器后，后端服务器就会执行这些命令。管理人员通常认为后端邮件服务器因为只跟Web邮件服务器通讯而避免了直接与Internet接触，因此就放松了后端邮件服务器上的安全警惕，进而给恶意代码的执行带来了可能。正因如此，邮件命令注入攻击可以说是非常危险的。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>对用户可控制的输入进行验证、过滤，以排除潜在的危险字符。</li>
<li>在将输入用作命令前先对输入进行编码，以保证命令相关的字符不会被当成待使用命令的一部分。</li>
<li>应该对输入进行参数化，或限制只能将输入用在命令的数据部分，以排除误将输入当成部分命令的可能。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-OWASP-A1">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP-A1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7566">使用ESAPI加密器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用ESAPI加密器</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>ESAPI在密码学组件中有一个漏洞历史。
下面是一个快速验证列表，以确保经过验证的加密工作按预期工作。</p>
</p>
<p><p><b>1.库版本</b></p></p>
<p>
<p>这个问题在ESAPI2.1.0版本中得到了纠正。version&lt;=2.0.1很容易受到MAC旁路（c2013-5679）的影响。<br/></p>
</p>
<p>
<p>对于Maven用户，插件<a href="http://mojo.codehaus.org/versions-maven-plugin/">versions</a> 可以使用下面的命令来调用。ESAPI的有效版本将在输出中可用。<br/></p>
<p><pre>$ mvn versions:display-dependency-updates</pre>
<br/>Output:<br/>
<pre>
 [...]
 [INFO] The following dependencies in Dependencies have newer versions:
 [INFO] org.slf4j:slf4j-api ................................... 1.6.4 -&gt; 1.7.7
 [INFO] org.owasp.esapi:esapi ................................. 2.0.1 -&gt; 2.1.0
 [...]
  </pre></p>
</p>
<p>
<p>或者直接看一下配置。<br/></p>
<p><pre>
 &lt;dependency&gt;
  &lt;groupId&gt;org.owasp.esapi&lt;/groupId&gt;
  &lt;artifactId&gt;esapi&lt;/artifactId&gt;
  &lt;version&gt;2.1.0&lt;/version&gt;
 &lt;/dependency&gt;</pre></p>
</p>
<p>
<p>对于ant用户，使用的jar包应该是 <a href="http://repo1.maven.org/maven2/org/owasp/esapi/esapi/2.1.0/esapi-2.1.0.jar">esapi-2.1.0.jar</a>.</p>
</p>
<p><p><b>2.配置：</b></p></p>
<p>
<p>版本2.1.0仍然很容易受到密文定义（c2013-5960）的密钥大小的影响。需要采取一些预防措施。<br/></p>
<p><br/></p>
<p><div><b>如果有任何这些元素存在，那么ESAPI的加密配置也会很容易受到攻击：</b><br/></div></p>
<p><b>不安全配置:</b><br/></p>
<p><pre>
 Encryptor.CipherText.useMAC=false
 Encryptor.EncryptionAlgorithm=AES
 Encryptor.CipherTransformation=AES/CBC/PKCS5Padding
 Encryptor.cipher_modes.additional_allowed=CBC</pre></p>
</p>

<p>
<div>
<p><b>安全配置：</b><br/></p>
<p><pre>
 #Needed
 Encryptor.CipherText.useMAC=true
 #Needed to have a solid auth. encryption
 Encryptor.EncryptionAlgorithm=AES
 Encryptor.CipherTransformation=AES/GCM/NoPadding
 #CBC mode should be removed to avoid padding oracle
 Encryptor.cipher_modes.additional_allowed=</pre></p>
</div>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://owasp-esapi-java.googlecode.com/svn/trunk/documentation/ESAPI-security-bulletin1.pdf">ESAPI Security bulletin 1 (CVE-2013-5679)</a><br/>
<a href="http://nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-5679">Vulnerability Summary for CVE-2013-5679</a><br/>
<a href="http://www.synacktiv.com/ressources/synacktiv_owasp_esapi_hmac_bypass.pdf">Synactiv: Bypassing HMAC validation in OWASP ESAPI symmetric encryption</a><br/>
<a href="http://cwe.mitre.org/data/definitions/310.html">CWE-310: Cryptographic Issues</a><br/>
<a href="http://lists.owasp.org/pipermail/esapi-dev/2015-March/002533.html">ESAPI-dev mailing list: Status of CVE-2013-5960</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7575">外部文件访问（Android）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>外部文件访问（Android）</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>应用程序将数据写入外部存储器（如SD卡）。
这具有多重安全问题。
首先，SD卡上的文件存储将被应用程序访问，它有</p>
<p><a href="http://developer.android.com/reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE"><code>READ_EXTERNAL_STORAGE</code></a> 的允许。</p>
<p>另外，如果数据中存在关于用户的机密信息，则需要进行加密。</p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<p><pre>
 file file = new File(getExternalFilesDir(TARGET_TYPE), filename);
 fos = new FileOutputStream(file);
 fos.write(confidentialData.getBytes());
 fos.flush();
 </pre></p>
</p>
<p>
<p><b>修复示例:</b><br/></p>
<p><pre>
 fos = openFileOutput(filename, Context.MODE_PRIVATE);
 fos.write(string.getBytes());
 </pre></p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://developer.android.com/training/articles/security-tips.html#ExternalStorage">Android Official Doc: Security Tips</a><br/>
<a href="https://www.securecoding.cert.org/confluence/display/java/DRD00-J.+Do+not+store+sensitive+information+on+external+storage+%28SD+card%29+unless+encrypted+first">CERT: DRD00-J: Do not store sensitive information on external storage [...]</a><br/>
<a href="http://developer.android.com/guide/topics/data/data-storage.html#filesExternal">Android Official Doc: Using the External Storage</a><br/>
<a href="https://www.owasp.org/index.php/Mobile_Top_10_2014-M2">OWASP Mobile Top 10 2014-M2: Insecure Data Storage</a><br/>
<a href="https://cwe.mitre.org/data/definitions/312.html">CWE-312: Cleartext Storage of Sensitive Information</a></p>

            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0090">XML 外部实体攻击</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#1">漏洞代码修复示例1 : 限制外部实体路径</a></li>
<li><a href="#2">漏洞代码修复示例2 : 禁止使用外部实体</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>XML文档可选地包含文档类型定义（DTD），其中除了其他功能外，还允许定义XML实体。可以通过以URI的形式提供替换字符串来定义实体。 XML解析器可以访问这个URI的内容并将这些内容嵌入到XML文档中以供进一步处理。</p>
<p>通过使用file:// URI提交定义外部实体的XML文件，攻击者可以使处理应用程序读取本地文件的内容。例如，诸如"file:///c:/winnt/win.ini"之类的URI指定（在Windows中）文件C:\Winnt\win.ini，或file:///etc/passwd 指定密码文件在基于Unix的系统中。使用URI与其他方案（如http://），攻击者可强制应用程序向服务器发出传出请求，攻击者无法直接到达服务器，这可用于绕过防火墙限制或隐藏诸如端口扫描等攻击来源。</p>
<p>一旦读取了URI的内容，它就会反馈到正在处理XML的应用程序中。此应用程序可能会回显数据（例如，在错误消息中），从而暴露文件内容。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当包含对外部实体的引用的XML输入由不正确配置的XML解析器处理时，会发生XML外部实体（XXE）攻击。</p>
<p>XML外部实体（XXE）攻击可能引起数据泄露、恶意攻击等诸多问题
 攻击者可能通过操纵实体的URI来引用包含敏感数据如密码和私人用户数据（例如/etc/passwd）的本地文件系统上的文件，从而使用XXE攻击来访问敏感信息。 攻击者可能会发起拒绝服务攻击，例如，通过指定/dev/random或/dev/tty作为输入URI，这些输入URI可能会崩溃或无限制地阻止程序。</p>
<h1 id="_3">缓解与预防</h1>
<p>许多XML解析器和验证器都可以配置为禁用外部实体扩展。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这个漏洞代码示例尝试解析文件evil.xml，报告任何错误并退出。但是，由于XML文件中可能包含恶意的实体，导致整个系统受到攻击</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">XXE</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveXMLStream</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">inStream</span><span class="o">,</span>
                                       <span class="n">DefaultHandler</span> <span class="n">defaultHandler</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
    <span class="n">saxParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">inStream</span><span class="o">,</span> <span class="n">defaultHandler</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">receiveXMLStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"evil.xml"</span><span class="o">),</span> 
      <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">MalformedURLException</span> <span class="n">mue</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Malformed URL Exception: "</span> <span class="o">+</span> <span class="n">mue</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>如果evil.xml文件包含以下内容，该程序将受到远程XXE攻击：</p>
<p>（1）SAX（简单API for XML）或DOM（文档对象模型）解析器将尝试访问由SYSTEM属性指定的URI，这意味着它将尝试读取本地/dev/tty文件的内容。 在POSIX系统上，读取此文件会导致程序阻塞，直到输入数据提供给机器的控制台。因此，攻击者可以使用此恶意XML文件导致程序挂起。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;!DOCTYPE foo SYSTEM "file:/dev/tty"&gt;</span>
<span class="nt">&lt;foo&gt;</span>bar<span class="nt">&lt;/foo&gt;</span>
</pre></div>
</td></tr></table>
<p>（2）SAX（简单API for XML）或DOM（文档对象模型）解析器将尝试访问系统密码文件（/etc/passwd），导致数据泄露</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">&lt;</span>?xml version="1.0" encoiding="utf-8"&gt;
<span class="cp">&lt;!DOCTYPE hack [</span>
<span class="cp">    &lt;!ENTITY % name SYSTEM "file:///etc/passwd"&gt;</span>
   %name; 
]&gt;
</pre></div>
</td></tr></table>
<h3 id="1">漏洞代码修复示例1 : 限制外部实体路径</h3>
<p>该漏洞代码修复示例定义了一个实现了org.xml.sax.EntityResolver接口的CustomResolver类。该接口使SAX应用程序能够自定义外部实体的处理。 自定义处理程序为外部实体使用一个自定义的安全判定函数，如果访问的实体路径是安全的则可以继续解析。当输入无法解析为任何指定的安全实体源路径时，resolveEntity()方法将返回一个空的InputSource。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.EntityResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">CustomResolver</span> <span class="kd">implements</span> <span class="n">EntityResolver</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">InputSource</span> <span class="nf">resolveEntity</span><span class="o">(</span><span class="n">String</span> <span class="n">publicId</span><span class="o">,</span> <span class="n">String</span> <span class="n">systemId</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="c1">// Check for known good entities</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isSafe</span><span class="o">(</span><span class="n">publicId</span><span class="o">,</span> <span class="n">systemId</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Resolving entity: "</span> <span class="o">+</span> <span class="n">publicId</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">systemId</span><span class="o">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="n">entityPath</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// Disallow unknown entities by returning a blank path</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>setEntityResolver()方法用相应的SAX驱动程序注册实例。解析恶意输入时，自定义解析器返回的空InputSource会导致引发java.net.MalformedURLException。 请注意，您必须创建一个XMLReader对象来设置自定义实体解析器。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.XMLReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">XXE</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">receiveXMLStream</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">inStream</span><span class="o">,</span> 
      <span class="n">DefaultHandler</span> <span class="n">defaultHandler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> 
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>

    <span class="c1">// Create an XML reader to set the entity resolver.</span>
    <span class="n">XMLReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">saxParser</span><span class="o">.</span><span class="na">getXMLReader</span><span class="o">();</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">setEntityResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResolver</span><span class="o">());</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">setContentHandler</span><span class="o">(</span><span class="n">defaultHandler</span><span class="o">);</span>

    <span class="n">InputSource</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="n">inStream</span><span class="o">);</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">receiveXMLStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"evil.xml"</span><span class="o">),</span> 
      <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">MalformedURLException</span> <span class="n">mue</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Malformed URL Exception: "</span> <span class="o">+</span> <span class="n">mue</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码修复示例2 : 禁止使用外部实体</h3>
<p>class XXE {
  private static void receiveXMLStream(InputStream inStream, 
      DefaultHandler defaultHandler) throws ParserConfigurationException, 
      SAXException, IOException {
    SAXParserFactory factory = SAXParserFactory.newInstance();
    SAXParser saxParser = factory.newSAXParser();</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="nt">Create</span> <span class="nt">an</span> <span class="nt">XML</span> <span class="nt">reader</span> <span class="nt">to</span> <span class="nt">set</span> <span class="nt">the</span> <span class="nt">parameters</span><span class="o">.</span>
<span class="nt">XMLReader</span> <span class="nt">reader</span> <span class="o">=</span> <span class="nt">saxParser</span><span class="p">.</span><span class="nc">getXMLReader</span><span class="o">();</span>

<span class="o">//</span> <span class="nt">Disable</span> <span class="nt">external</span> <span class="nt">entity</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">setFeature</span><span class="o">(</span><span class="nt">http</span><span class="o">://</span><span class="nt">xml</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">sax</span><span class="o">/</span><span class="nt">features</span><span class="o">/</span><span class="nt">external-general-entities</span><span class="err">"</span><span class="o">,</span> <span class="nt">false</span><span class="o">);</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">setContentHandler</span><span class="o">(</span><span class="nt">defaultHandler</span><span class="o">);</span>

<span class="nt">InputSource</span> <span class="nt">is</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">InputSource</span><span class="o">(</span><span class="nt">inStream</span><span class="o">);</span>
<span class="nt">reader</span><span class="p">.</span><span class="nc">parse</span><span class="o">(</span><span class="nt">is</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>}</p>
<p>public static void main(String[] args) throws ParserConfigurationException,
      SAXException, IOException {
    try {
      receiveXMLStream(new FileInputStream("evil.xml"), 
      new DefaultHandler());
    } catch (java.net.MalformedURLException mue) {
      System.err.println("Malformed URL Exception: " + mue);
    }
  }
}
```</p>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/611.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS17-J.+Prevent+XML+External+Entity+Attacks.html <a class="footnote-backref" href="#fnref-CERT" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-611.html">CWE-611</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7570">Seam日志调用中的潜在代码注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Seam日志调用中的潜在代码注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
Seam Logging API支持一种表达式语言，用于将bean属性引入日志消息。表达式语言也可以是不需要的代码执行的源。
</p>
<p>
在此上下文中，表达式使用动态值构建。应验证值的来源，如果数据来源于外部用户输入，请确保检查内部没有恶意代码。
</p>
<p><b>风险代码：</b></p>
<p>
<pre>public void logUser(User user) {
    log.info("Current logged in user : " + user.getUsername());
    //...
}</pre>
</p>
<p><b>解决方案：</b></p>
<p>
<pre>public void logUser(User user) {
    log.info("Current logged in user : #0", user.getUsername());
    //...
}</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://issues.jboss.org/browse/JBSEAM-5130">JBSEAM-5130: Issue documenting the risk</a><br/>
<a href="https://docs.jboss.org/seam/2.3.1.Final/reference/html_single/#d0e4185">JBoss Seam: Logging (Official documentation)</a><br/>
<a href="https://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">The Java EE 6 Tutorial: Expression Language</a><br/>
<a href="http://cwe.mitre.org/data/definitions/94.html">CWE-94: Improper Control of Generation of Code ('Code Injection')</a><br/>
<a href="http://cwe.mitre.org/data/definitions/95.html">CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1088">头部操纵</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>攻击者可以在HTTP标头中包含未经验证的数据，从而指定浏览器提供的整个HTTP响应。 当HTTP请求包含意外的CR（回车，也由％0d或\ r给出）和LF（换行，也由％0a或\n给出）字符时，服务器可能会通过被解释为两个不同的HTTP响应（而不是一个）的输出流响应请求。 攻击者可以控制第二响应并发起攻击，例如跨站点脚本和缓存投毒攻击。</p>
<p>HTTP响应拆分漏洞可能在以下情况下存在：</p>
<p><em>数据通过不受信任的来源（最常见的是HTTP请求）进入Web应用程序。
</em>数据包含在发送给Web用户的HTTP响应标头中，未经验证是否包含恶意字符。</p>
<h1 id="_2">漏洞与风险</h1>
<p>HTTP标头中的CR和LF字符可能使攻击者控制其余应用程序打算发送的响应正文，还可以使攻击者创建完全在其控制下的其他响应。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
<li>使用并指明读取上游输出的下游设备能够处理的输出编码。</li>
<li>确保应用不会重复解码同一段输入。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>下面的代码片段从HTTP请求中读取<code>author</code>这一<code>weblog</code>项的作者名，并将它设置到HTTP回复中Cookie的头部里：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">AUTHOR_PARAM</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">"author"</span><span class="o">,</span> <span class="n">author</span><span class="o">);</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="n">cookieExpiration</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>假设上述HTTP回复中Coockie头部被设置成一串包含标准字符数字的字符串，如“Jane Smith”，那么将会有像这样的HTTP回复：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
...
Set-Cookie: author=Jane Smith
...
</pre></div>
</td></tr></table>
<p>然而，如果该段Cookie的值没有经过任何验证，那么只有当<code>AUTHOR_PARAM</code>中不包含CR或LF字符时，回复才会如上面般的和谐。攻击者往往会给出像这样的恶意字符串：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Wiley Hacker\r\nHTTP/1.1 200 OK\r\n
</pre></div>
</td></tr></table>
<p>紧接着，HTTP回复将会被分割成如下形式的两段回复：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
...
Set-Cookie: author=Wiley Hacker HTTP/1.1 200 OK
...
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE113">
<p>https://cwe.mitre.org/data/definitions/113.html <a class="footnote-backref" href="#fnref-CWE113" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7508">污染的文件名读取</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>污染的文件名读取</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>FileUpload API提供的文件名可以被客户机篡改，以引用未经授权的文件。</p>
<p>
例如：</p>
<ul>
<li><code>"../../../config/overide_file"</code></li>
<li><code>"shell.jsp\u0000expected.gif"</code></li>
</ul>
<p>因此，这些值不应该直接传递给文件系统API。如果可以接受，应用程序应该生成它自己的文件名并使用它们。否则，所提供的文件名应该经过适当的验证以确保它的结构正确，其中不应包含未经授权的路径字符（例如，/ \），并引用一个授权文件。</p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://blogs.securiteam.com/index.php/archives/1268">Securiteam: File upload security recommendations</a><br/>
<a href="http://cwe.mitre.org/data/definitions/22.html">CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')</a><br/>
<a href="http://projects.webappsec.org/w/page/13246952/Path%20Traversal">WASC-33: Path Traversal</a><br/>
<a href="https://www.owasp.org/index.php/Path_Traversal">OWASP: Path Traversal</a><br/>
<a href="http://capec.mitre.org/data/definitions/126.html">CAPEC-126: Path Traversal</a><br/>
<a href="http://cwe.mitre.org/data/definitions/22.html">CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7008">使用不可信的输入数据构建HTTP cookie</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用不可信的输入数据构建HTTP cookie</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>此代码使用不受信任的HTTP参数构造HTTP Cookie。 如果将此cookie添加到HTTP响应中，则可能出现HTTP响应拆分漏洞。 需要在构造HTTP cookie前先检查HTTP参数中是否有恶意注入代码。查看 <a href="http://en.wikipedia.org/wiki/HTTP_response_splitting">http://en.wikipedia.org/wiki/HTTP_response_splitting</a>
获取更多信息。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1099">XML注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 2 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可拓展性标记语言（Extensible Markup Language, XML）是为了存储、结构化以及传输数据而设计的。因为其平台无关性、灵活性以及相对简单性，众多程序都用到了XML。XML拥有很高的通用性，正也因此，XML易遭受众多攻击，其中就包含了XML注入攻击。</p>
<h1 id="_2">漏洞与风险</h1>
<p>只要用户能够提供用于组成XML文档的数据，那么他就能够在数据中注入XML标签。XML的解析器会对这些标签进行解析，进而可能会对XML文档进行重写。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
<li>在进行输入数据验证的过程中，要把所有可能牵涉到的属性都考虑到，如长度、输入数据的类型、可接受的输入值的范围、输入信息不足或累赘、语法、字段间的一致性以及对商业规则的服从性。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>在这段缺陷代码中，客户端使用简单的字符串拼接操作来构造XML查询语句，并将结果发送到服务器。因为程序没有对输入数据进行任何的验证，这段代码存在遭受XML注入攻击的风险：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStreamBad</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">quantity</span>
        <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>取决于特定的数据以及对数据进行处理的命令解释器（或解析器），必须要使用恰当的方法来清洗用户提供的输入数据。这段合规代码验证接收的数量是否是无符号的整型值：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStream</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
    <span class="c1">// Write XML string only if quantity is an unsigned integer (count).</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseUnsignedInt</span><span class="o">(</span><span class="n">quantity</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>用于检查XML是否存在注入风险的一个更常见的方法是使用文档类型定义（Document Type Definition, DTD）或模式来进行验证。为了避免把注入当作有效的XML数据，这个模式必须要严谨地进行定义。以下是一个适合用于验证XML文档的模式片段：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
<span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"item"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">type=</span><span class="s">"xs:string"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">type=</span><span class="s">"xs:decimal"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"quantity"</span> <span class="na">type=</span><span class="s">"xs:nonNegativeInteger"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</pre></div>
</td></tr></table>
<p>当接收的XML文档可能存在被不受信输入篡改的可能性时，使用模式或DTD来验证XML将会极其的方便。如果XML字符串还没有被创建，那么在构造XML文档前先对输入数据进行清洗往往会有更好的效果：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.BufferedOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.StringReader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.XMLConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.stream.StreamSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.validation.Schema</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.validation.SchemaFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXParseException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.XMLReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineStore</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">createXMLStream</span><span class="o">(</span><span class="kd">final</span> <span class="n">BufferedOutputStream</span> <span class="n">outStream</span><span class="o">,</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">xmlString</span><span class="o">;</span>
    <span class="n">xmlString</span> <span class="o">=</span> <span class="s">"&lt;item&gt;\n&lt;description&gt;Widget&lt;/description&gt;\n"</span>
        <span class="o">+</span> <span class="s">"&lt;price&gt;500.0&lt;/price&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;quantity&gt;"</span> <span class="o">+</span> <span class="n">quantity</span>
        <span class="o">+</span> <span class="s">"&lt;/quantity&gt;&lt;/item&gt;"</span><span class="o">;</span>
    <span class="n">InputSource</span> <span class="n">xmlStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">xmlString</span><span class="o">));</span>
    <span class="c1">// Build a validating SAX parser using our schema</span>
    <span class="n">SchemaFactory</span> <span class="n">sf</span> <span class="o">=</span> <span class="n">SchemaFactory</span>
        <span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">XMLConstants</span><span class="o">.</span><span class="na">W3C_XML_SCHEMA_NS_URI</span><span class="o">);</span>
    <span class="n">DefaultHandler</span> <span class="n">defHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHandler</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warning</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fatalError</span><span class="o">(</span><span class="n">SAXParseException</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SAXParseException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">StreamSource</span> <span class="n">ss</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StreamSource</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"schema.xsd"</span><span class="o">));</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="na">newSchema</span><span class="o">(</span><span class="n">ss</span><span class="o">);</span>
      <span class="n">SAXParserFactory</span> <span class="n">spf</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
      <span class="n">spf</span><span class="o">.</span><span class="na">setSchema</span><span class="o">(</span><span class="n">schema</span><span class="o">);</span>
      <span class="n">SAXParser</span> <span class="n">saxParser</span> <span class="o">=</span> <span class="n">spf</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
      <span class="c1">// To set the custom entity resolver,</span>
      <span class="c1">// an XML reader needs to be created</span>
      <span class="n">XMLReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">saxParser</span><span class="o">.</span><span class="na">getXMLReader</span><span class="o">();</span>
      <span class="n">reader</span><span class="o">.</span><span class="na">setEntityResolver</span><span class="o">(</span><span class="k">new</span> <span class="n">CustomResolver</span><span class="o">());</span>
      <span class="n">saxParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">xmlStream</span><span class="o">,</span> <span class="n">defHandler</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParserConfigurationException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">"Unable to validate XML"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SAXException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">"Invalid quantity"</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Our XML is valid, proceed</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">xmlString</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS16-J.+Prevent+XML+Injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7571">使用OGNL表达式时可能的代码注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用OGNL表达式时可能的代码注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
表达式使用动态值构建。应验证值的来源，如果数据来源于外部用户输入，请确保检查内部没有恶意代码。
</p>
<p><b>风险代码：</b></p>
<p>
<pre>
public void getUserProperty(String property) {
  [...]
  //第一个参数是动态表达式。
  return ognlUtil.getValue("user."+property, ctx, root, String.class);
}
</pre>
</p>
<p><b>解决方案：</b></p>
<p>
通常，评估OGNL表达式的方法不应该接收用户输入。它旨在用于静态配置和JSP。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://community.saas.hpe.com/t5/Security-Research/Struts-2-OGNL-Expression-Injections/ba-p/288881">HP Enterprise: Struts 2 OGNL Expression Injections by Alvaro MuÃ±oz</a><br/>
<a href="https://blog.gdssecurity.com/labs/2017/3/27/an-analysis-of-cve-2017-5638.html">Gotham Digital Science: An Analysis Of CVE-2017-5638</a><br/>
<a href="http://struts.apache.org/docs/s2-016.html">Apache Struts2: Vulnerability S2-016</a><br/>
<a href="https://struts.apache.org/docs/ognl.html">Apache Struts 2 Documentation: OGNL</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7474">不安全的SMTP SSL连接</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不安全的SMTP SSL连接</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
在进行SSL连接时，服务器身份验证是禁用的。
一些启用SSL连接的电子邮件库在默认情况下不会验证服务器证书。
这相当于信任所有的证书。当试图连接到服务器时，这个应用程序将很容易地接受给“hacserver.com”的证书。
该应用程序现在可能会在断开的SSL连接上泄漏敏感的用户信息。
</p>
<p>
<b>
易受攻击的代码：</b><br/>
<pre>...
Email email = new SimpleEmail();
email.setHostName("smtp.servermail.com");
email.setSmtpPort(465);
email.setAuthenticator(new DefaultAuthenticator(username, password));
email.setSSLOnConnect(true);
email.setFrom("user@gmail.com");
email.setSubject("TestMail");
email.setMsg("This is a test mail ... :-)");
email.addTo("foo@bar.com");
email.send();
...</pre>
</p>
<p>
<b>解决方案：</b><br/>
请添加以下检查，以验证服务器的证书：
<pre>email.setSSLCheckServerIdentity(true);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://cwe.mitre.org/data/definitions/297.html">CWE-297: Improper Validation of Certificate with Host Mismatch</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1111">劫持Android类加载</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>从非受信的资源中或在非受信的环境下执行命令或加载库都可能会使得程序以攻击者的名义执行任意的恶意代码。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者能够通过改变命令的执行环境，进而使程序从非受信的资源中加载库。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>要清楚了解待加载的库，并从可信源进行加载。</p>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/114.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7496">FilenameUtils不过滤空字节</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>FilenameUtils不过滤空字节</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>一些FilenameUtils的方法不过滤NULL字节 （<code>0x00</code>）。</p>
<p>如果一个空字节被注入到一个文件名中，如果这个文件名被传递给底层操作系统，
检索的文件将是在NULL字节之前指定的文件的名称，
因为在操作系统级别，所有字符串都被null字节终止，尽管Java本身并不关心null字节或对其进行特殊处理。
这个操作系统的行为可以用来绕过在文件名末尾的文件名验证（例如，以“.log”结尾），以确保它是一个安全的文件。</p>
<p>为了解决这个问题，下面两件事是推荐的：
<ul>
<li>升级到Java 7更新40或更高版本，或者Java 8+，因为
<a href="http://bugs.java.com/bugdatabase/view_bug.do?bug_id=8014846">NULL byte injection in filenames is fixed in those versions</a>.</li>
<li>强烈验证不可信用户提供的任何文件名以确保它们是有效的（例如不包含null，不包括路径字符，等等。）</li>
</ul>
<p>如果您知道您正在使用一个对NULL字节注入免疫的最新版本的Java，您也可以会禁用这个规则。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://projects.webappsec.org/w/page/13246949/Null%20Byte%20Injection">WASC-28: Null Byte Injection</a><br/>
<a href="http://cwe.mitre.org/data/definitions/158.html">CWE-158: Improper Neutralization of Null Byte or NUL Character</a>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1095">XQuery注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件没有或不恰当地中立化外部输入，并将输入用来动态构造用于从XML数据库中获取数据的XQuery表达式，这将使得攻击者能够控制查询语句的结构。</p>
<h1 id="_2">漏洞与风险</h1>
<p>该漏洞的最终效果是攻击者能过获得从XML数据库中取得的数据的控制权，并通过使用这一点来控制程序的执行流、修改程序逻辑、获取没有授权的数据或越过重要的安全检查（如认证）。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>使用参数化的查询语句。</li>
<li>合理地验证用户输入。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的例子展现了攻击者试图访问<code>accounts.xml</code>并请求服务提供者将所有的用户名返回：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>doc(accounts.xml)//user[Name='*']
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<p>[^capec]： https://capec.mitre.org/data/definitions/84.html</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7029">如果扩展了类，GetResource的使用可能不安全</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>如果扩展了类，GetResource的使用可能不安全</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>如果此类被另一个包中的类所扩展，那么调用this.getClass().getResource(...)可能给出除预期外的结果。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0088">不受控制的内存分配</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#1">漏洞代码示例 1</a></li>
<li><a href="#1_1">修复代码示例1</a></li>
<li><a href="#2">漏洞代码示例 2</a></li>
<li><a href="#2_1">修复代码示例2</a></li>
<li><a href="#3">漏洞代码示例3</a></li>
<li><a href="#3_1">修复代码示例3</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>程序基于不可信的数值分配内存，但不验证或错误验证数值大小，导致允许分配任意数量的内存。</p>
<h1 id="_2">漏洞与风险</h1>
<p>不控制内存分配的大小可能导致请求太多的系统内存，从而导致应用程序由于内存不足而崩溃或消耗大量内存。</p>
<h1 id="_3">缓解与预防</h1>
<p>针对影响内存分配大小的任何数值要执行重复的输入验证。为处理超出限制的请求定义适当的策略，并考虑支持配置选项，以便管理员可以根据需要扩展要使用的内存量。</p>
<p>使用系统提供的内存资源限制运行程序。这可能仍会导致程序崩溃或退出，但对系统其余部分的影响将最小化。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高危</p>
<h1 id="_5">演示实例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<p>考虑下面的代码，它接受一个不可信的大小值并分配一个缓冲区来包含给定大小的字符串。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">totBytes</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">totBytes</span><span class="p">);</span>
<span class="n">InitializeString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>假设攻击者提供的大小值为 12345678, 这将导致为字符串分配305,419,896字节（超过291兆字节）。</p>
<h3 id="1_1">修复代码示例1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">totBytes</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>

<span class="c1">// 确保输入的内存大小是合理的</span>
<span class="k">if</span> <span class="p">(</span><span class="n">totBytes</span> <span class="o">&gt;</span> <span class="mi">100000000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Out of memory!!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="n">error_handler</span><span class="p">();</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">totBytes</span><span class="p">);</span>
<span class="n">InitializeString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>考虑下面的代码，该代码接受不可信的大小值并将大小作为HashMap的初始容量。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>
<span class="n">HashMap</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<p>HashMap构造函数将验证初始容量不是负数，但是没有检查来验证是否存在足够的内存。如果攻击者提供足够大的值，则应用程序将运行到OutOfMemoryError。</p>
<h3 id="2_1">修复代码示例2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetUntrustedInt</span><span class="p">();</span>

<span class="c1">// 确保输入的内存大小是合理的</span>
<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">10000000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Out of memory!!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="n">error_handler</span><span class="p">();</span>
 <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">HashMap</span> <span class="n">list</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h3 id="3">漏洞代码示例3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">)</span>  <span class="c1">//length为用户的输入数据</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">length</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">//没有验证length是否超出内存分配的上限</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="n">length</span><span class="p">);</span>
    <span class="p">...</span>
    <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="3_1">修复代码示例3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>  <span class="c1">//指定内存分配的上限或动态判断剩余内存大小自动分配</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">)</span>  <span class="c1">//length为用户的输入数据</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">length</span><span class="o">&gt;</span><span class="n">MAX_LENGTH</span> <span class="o">||</span> <span class="n">length</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">//对length进行验证</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="n">length</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">buffer</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/400.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-789.html">CWE-789</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7478">可预测的伪随机数发生器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可预测的伪随机数发生器</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>在某些安全很重要的环境中使用可预测的随机值会导致漏洞。
例如，当值被用作：
</p>
<ul>
<li>CSRF令牌：可预测的令牌可以导致CSRF攻击，攻击者将知道令牌的值。</li>
<li>密码重置令牌（通过电子邮件发送）：可预测的密码令牌可以导致帐户接管，因为攻击者会猜测更改密码表单的URL
 </li>
<li>任何其它密钥值</li>
</ul>
<p>一个快速的解决方案可能是用更强的随机值替换使用<b>java.util.Random</b>，比如<b>java.security.SecureRandom</b>。</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>String generateSecretToken() {
    Random r = new Random();
    return Long.toHexString(r.nextLong());
}</pre>
</p>
<p>
<b></b></p>
<p>解决方法：</p></p>
<pre>import org.apache.commons.codec.binary.Hex;
String generateSecretToken() {
    SecureRandom secRandom = new SecureRandom();
    byte[] result = new byte[32];
    secRandom.nextBytes(result);
    return Hex.encodeHexString(result);
}</pre>

<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://jazzy.id.au/default/2010/09/20/cracking_random_number_generators_part_1.html">Cracking Random Number Generators - Part 1 (http://jazzy.id.au)</a><br/>
<a href="https://www.securecoding.cert.org/confluence/display/java/MSC02-J.+Generate+strong+random+numbers">CERT: MSC02-J. Generate strong random numbers</a><br/>
<a href="http://cwe.mitre.org/data/definitions/330.html">CWE-330: Use of Insufficiently Random Values</a><br/>
<a href="http://blog.h3xstream.com/2014/12/predicting-struts-csrf-token-cve-2014.html">Predicting Struts CSRF Token (Example of real-life vulnerability and exploitation)</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7043">调用的方法应该只在doPrivileged块内被调用</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>调用的方法应该只在doPrivileged块内被调用</p>
<h1 id="_2">漏洞与风险</h1>
<p><p> 此代码调用了一个需要安全权限检查的方法。如果这段代码将被授予了安全权限，但被没有授予安全权限的代码调用，则调用需要在doPrivileged块中进行。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1083">不安全的随机性</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>伪随机数生成器（Pseudorandom number generators，即PRNGs）使用决定性的数学算法来产生具有良好统计属性的数字序列，但这样产生的数字序列并没有真正的随机性。PRNGs通常需要一个起始的种子，实现算法将使用这个种子来产生一个数字以及一个新的种子，并再借由新产生的种子来往复循环相同的过程。</p>
<h1 id="_2">漏洞与风险</h1>
<p>Java API中<code>java.util.Random</code>包提供了一种PRNG实现。这个PRGN具有便携性和可重复性，因此，在所有Java版本的实现中，使用同一个种子创建的两个<code>java.util.Random</code>类的实例会生成相同的随机数序列。随机数种子的值通常会在应用初始化时被重用，除非重启了机器。排除掉重启机器的情况时，随机数种子值由来自系统时钟的现时时间决定。攻击者会通过监测缺陷目标中的随机数种子值，然后创建一张查找表来预测未来的随机数种子值。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>使用安全性更好的随机数生成器，如<code>java.security.SecureRandom</code>类。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这段缺陷代码使用了不安全的<code>java.util.Random</code>类，因为这个类对相同的种子值能产生同样的伪随机数序列，也就是说这个序列是可预测的：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="c1">// ...</span>

<span class="n">Random</span> <span class="n">number</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="mi">123L</span><span class="o">);</span>
<span class="c1">//...</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="c1">// Generate another random integer in the range [0, 20]</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">21</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>这段合规代码使用<code>java.security.SecureRandom</code>类来产生可靠的随机数序列：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.security.SecureRandom</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span>
<span class="c1">// ...</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
  <span class="n">SecureRandom</span> <span class="n">number</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="o">();</span>
  <span class="c1">// Generate 20 integers 0..20</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">number</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">21</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/MSC02-J.+Generate+strong+random+numbers <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1087">OGNL表达式注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当对标签属性中原始的用户输入进行运算时，强制的两次OGNL（Object-Graph Navigation Language）运算将可能引发远程代码执行攻击。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当外界强制Apache Struts框架对特定标签中的属性值进行两次运算时，Apache Struts只能照做，因此攻击者可能会传入一个特殊的值，使得在该渲染某个标签的值时候再对标签属性值进行多一次计算。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>确保在再次将传入参数值赋给Struts的某些标签属性前，先对这些参数进行验证。</li>
<li>除非你有必要的使用场景，请不要在标签属性中使用除了值之外的%{...}语法。</li>
<li>可以选择升级到Struts 2.3.20.3、Struts 2.3.24.3或Struts2.3.28。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-apache">
<p>https://cwiki.apache.org/confluence/display/WW/S2-036 <a class="footnote-backref" href="#fnref-apache" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7481">不可信的内容类型头</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的内容类型头</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
HTTP头内容类型可以由客户端控制。因此，它的价值不应该被用于任何安全的关键决策。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/807.html">CWE-807: Untrusted Inputs in a Security Decision</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0133">成功登录后不会更新会话ID</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对用户进行身份验证或以其他方式建立新用户会话，而不会使任何现有会话标识符失效，这使攻击者有机会窃取经过身份验证的会话。</p>
<p>这种情况通常在以下情况下观察到：
1 Web应用程序在不先使现有会话无效的情况下对用户进行身份验证，从而继续使用已与用户关联的会话。
2 攻击者能够强制用户已知的会话标识符，以便一旦用户认证，攻击者就可以访问已认证的会话。
3 应用程序或容器使用可预测的会话标识符。 在会话固定漏洞的通用漏洞攻击中，攻击者在Web应用程序上创建一个新会话并记录关联的会话标识符。 攻击者然后使受害者使用该会话标识符与服务器相关联，并可能进行身份验证，从而使攻击者能够通过活动会话访问用户的帐户。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者能够强制用户已知的会话标识符，以便一旦用户认证，攻击者就可以访问已认证的会话。</p>
<h1 id="_3">缓解与预防</h1>
<p>在授权新用户会话之前使任何现有的会话标识符失效。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>  
<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="s">"DD"</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>  
<span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span>  
<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="s">"DD"</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>使用invalidate()把现有的会话标识符失效。</p>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/384.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-384.html">CWE-384</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7473">AWS查询注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>AWS查询注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
构建包含用户输入的SimpleDB查询可以让攻击者查看未授权的记录。<br/>
下面的例子动态地构造和执行SimpleDB select()查询，允许用户指定productCategory。
攻击者可以修改查询，绕过customerID所需的身份验证，并查看匹配任何客户的视图记录。
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>...
String customerID = getAuthenticatedCustomerID(customerName, customerCredentials);
String productCategory = request.getParameter("productCategory");
...
AmazonSimpleDBClient sdbc = new AmazonSimpleDBClient(appAWSCredentials);
String query = "select * from invoices where productCategory = '"
            + productCategory + "' and customerID = '"
            + customerID + "' order by '"
            + sortColumn + "' asc";
SelectResult sdbResult = sdbc.select(new SelectRequest(query));
</pre>
</p>
<p>
<b>解决方案：</b><br/>
这个问题类似于SQL注入。在SimpleDB查询中使用它之前，先对用户输入进行验证。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://cwe.mitre.org/data/definitions/943.html">CWE-943: Improper Neutralization of Special Elements in Data Query Logic</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7468">格式字符串操作</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>格式字符串操作</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
允许用户输入控制格式参数可以使攻击者产生抛出或泄漏信息的异常。<br/>
攻击者可能能够修改格式字符串参数，这样就会抛出异常。如果这个异常没有被捕获，它可能会使应用程序崩溃。另外，如果在未使用的参数中使用敏感信息，攻击者可能会更改格式字符串以显示此信息。<br/>
下面的示例代码允许用户指定它显示余额的小数点。用户实际上可以指定任何导致抛出异常的东西，这可能导致应用程序失败。
在这个例子中，更重要的是，如果攻击者可以指定用户输入“2 f%3$s%4$.2“, 格式字符串是”The customer: %s %s has the balance %4$.2f %3$s %4$.2”。
这将导致在产生的字符串中包含敏感的accountNo。</p>
<p></p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>Formatter formatter = new Formatter(Locale.US);
String format = "The customer: %s %s has the balance %4$." + userInput + "f";
formatter.format(format, firstName, lastName, accountNo, balance);</pre>
</p>
<p>
<b>解决方案：</b><br/>
避免在格式字符串参数中使用用户控制的值。
</p>
<br/>
<p>
<b>引用</b><br/>
<a href="http://cwe.mitre.org/data/definitions/134.html">CWE-134: Use of Externally-Controlled Format String</a><br/>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7471">RequestDispatcher文件泄露</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>RequestDispatcher文件泄露</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
用用户输入构造一个服务器端重定向路径可以让攻击者下载应用程序二进制文件（包括应用程序类或jar文件），或者在受保护的目录中查看任意文件。<br/>
攻击者可以伪造一个请求参数来匹配敏感的文件位置。
例如，请求"http://example.com/?jspFile=../applicationContext.xml%3F" 将显示应用程序的applicationContext.xml文件。
攻击者将能够定位和下载在其它配置文件中引用的applicationContext.xml，甚至是类文件或jar文件，获取敏感信息并启动其它类型的攻击。
</p>
<p>
<b>易受攻击的代码：</b><br/>
<pre>...
String jspFile = request.getParameter("jspFile");
request.getRequestDispatcher("/WEB-INF/jsps/" + jspFile + ".jsp").include(request, response);
...</pre>
</p>
<p>
<b>解决方案：</b><br/>
避免使用用户控制的输入构建服务器端重定向。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="https://cwe.mitre.org/data/definitions/552.html">CWE-552: Files or Directories Accessible to External Parties</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7149">公共静态方法可能由于返回数组来暴露内部表示</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>公共静态方法可能由于返回数组来暴露内部表示</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>公共静态方法返回对数组的引用，该数组是类的静态状态的一部分。</p>
<p>调用此方法的任何代码都可以自由地修改基础数组。</p>
<p>一种解决方法是返回数组的副本。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7590">使用Freemarker进行潜在模板注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用Freemarker进行潜在模板注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
Freemarker模板引擎十分强大。
可以添加逻辑，包括条件语句、循环和外部调用。
它不是设计成模板操作的沙盒。
控制模板的恶意用户可以在服务器端运行恶意代码。
Freemarker模板应该被看作是脚本。
</p>
<p>
<b>易受攻击的代码：</b>
<pre>Template template = cfg.getTemplate(inputTemplate);
[...]
template.process(data, swOut);</pre>
</p>
<p>
<b>解决方案：</b>
<br/>
避免让终端用户使用Freemarker操作模板。
如果您需要向您的用户公开模板编辑，则更倾向于使用无逻辑的模板引擎，比如Handlebars或者Moustache（参见参考资料）。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://blog.portswigger.net/2015/08/server-side-template-injection.html">PortSwigger: Server-Side Template Injection </a><br/>
<a href="https://jknack.github.io/handlebars.java/">Handlebars.java</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1091">违反信任边界</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可以把信任边界想象成划分一个程序的一条界线，在线的一边，这不是的数据是不受信的；而在线的另外一边，数据都是受信的。程序的验证逻辑都是围绕这条线开展的——通过验证不受信一边的数据，把验证通过的数据移动到受信数据的一边。当程序模糊了信任边界时，我们称程序违反了信任边界原则。当在同一个数据结构中混杂了受信与不受信的数据时，程序员会更轻易地把不受信的数据当成受信数据。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当没有明确定义或久不维护信任边界时，程序员不可避免地会对哪些数据经过了认证而哪些没有经过验证的问题摸不着头脑。放任这种情况不管，最终会使得程序员直接使用没有经过验证的不受信数据。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>明确定义并尊重信任边界。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的代码展现了程序不对HTTP请求中的用户名信息验证，判断用户是否经过了认证，直接就把用户名参数存在了HTTP会话对象中：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">usrname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"usrname"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">ATTR_USR</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">ATTR_USR</span><span class="o">,</span> <span class="n">usrname</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/501.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7565">此加密算法不提供数据完整性保证</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>此加密算法不提供数据完整性保证</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
所产生的密文很容易被其他人修改。
这意味着该加密算法无法检测数据是否被篡改过。
如果密文可以由攻击者控制，那么它可以被修改而不被发现。</p>
<p></p>
<p>
 解决方案是使用一个包含Hash based Message Authentication Code（HMAC）的加密算法来签署数据。
将一个HMAC函数与现有加密结合起来很容易出错<sup><a href="http://www.thoughtcrime.org/blog/the-cryptographic-doom-principle/">[1]</a></sup>. 具体地说，它总是建议您首先验证HMAC，并且只有当数据未被修改时，您才可以对数据执行任何加密功能。
</p>
<p>下面的模式是易受攻击的，因为它们不提供HMAC：<br/>
    - CBC<br/>
    - OFB<br/>
    - CTR<br/>
    - ECB<br/><br/>
    下面的代码片段是一些易受攻击的代码例子。<br/><br/>
<b>有风险的代码：</b><br/>
<i>CBC模式中的AES</i><br/>
<pre>Cipher c = Cipher.getInstance("AES/CBC/PKCS5Padding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
<br/>
<i>ECB模式中的三倍DES</i><br/>
<pre>Cipher c = Cipher.getInstance("DESede/ECB/PKCS5Padding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>解决方案：</b>
<pre>Cipher c = Cipher.getInstance("AES/GCM/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
在上面的例子解决方案中，GCM模式将一个HMAC引入到最终的加密数据中，从而提供了结果的完整性。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://en.wikipedia.org/wiki/Authenticated_encryption">Wikipedia: Authenticated encryption</a><br/>
<a href="http://csrc.nist.gov/groups/ST/toolkit/BCM/modes_development.html#01">NIST: Authenticated Encryption Modes</a><br/>
<a href="http://www.thoughtcrime.org/blog/the-cryptographic-doom-principle/">Moxie Marlinspike's blog: The Cryptographic Doom Principle</a><br/>
<a href="http://cwe.mitre.org/data/definitions/353.html">CWE-353: Missing Support for Integrity Check</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7562">加密时使用了固定的初始化向量IV</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>加密时使用了固定的初始化向量IV</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>必须重新生成初始化向量，以便对每条消息进行加密。</p>
</p>
<p><p><b>易受攻击的代码：</b></p></p>
<p>
<p><pre>
 private static byte[] IV = new byte[16] {(byte)0,(byte)1,(byte)2,[...]};
 public void encrypt(String message) throws Exception {
  IvParameterSpec ivSpec = new IvParameterSpec(IV);
 [...]
 </pre></p>
<p><p><b>解决方案：</b></p></p>
<p>
<p><pre>
 public void encrypt(String message) throws Exception {
  byte[] iv = new byte[16];
  new SecureRandom().nextBytes(iv);
  IvParameterSpec ivSpec = new IvParameterSpec(iv);
 [...]
 </pre></p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="http://en.wikipedia.org/wiki/Initialization_vector">Wikipedia: Initialization vector</a><br/>
<a href="http://cwe.mitre.org/data/definitions/329.html">CWE-329: Not Using a Random IV with CBC Mode</a><br/>
<a href="https://defuse.ca/cbcmodeiv.htm">Encryption - CBC Mode IV: Secret or Not?</a>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7576">广播（Android）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>广播（Android）</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
任何具有权限的应用程序都可以侦听广播。
建议尽量避免在广播中传输敏感信息。
</p>
<p>
<b>有风险的代码：</b><br/>
<pre>
 Intent i = new Intent();
 i.setAction("com.insecure.action.UserConnected");
 i.putExtra("username", user);
 i.putExtra("email", email);
 i.putExtra("session", newSessionId);
 this.sendBroadcast(v1);
 </pre></p>
</p>
<p><br/>
<p>
<b>解决方案(如果有可能)：</b><br/>
<pre>
Intent i = new Intent();
i.setAction("com.secure.action.UserConnected");
sendBroadcast(v1);
</pre>
</p>
<br/>
<p>
<b>配置(接收端)<sup>[1] Source: StackOverflow</sup>:</b><br/></p>
<p><pre>
 &lt;manifest ...&gt;
  &lt;!-- Permission declaration --&gt;
  &lt;permission android:name="my.app.PERMISSION" /&gt;
  &lt;receiver
  android:name="my.app.BroadcastReceiver"
  android:permission="my.app.PERMISSION"&gt; &lt;!-- Permission enforcement --&gt;
  &lt;intent-filter&gt;
  &lt;action android:name="com.secure.action.UserConnected" /&gt;
  &lt;/intent-filter&gt;
  &lt;/receiver&gt;
  ...
 &lt;/manifest&gt;
 </pre>
</p>
<p>
<b>Configuration (sender)<sup>[1] Source: StackOverflow</sup>:</b><br/>
<pre>
 &lt;manifest&gt;
  &lt;!-- We declare we own the permission to send broadcast to the above receiver --&gt;
  &lt;uses-permission android:name="my.app.PERMISSION"/&gt;
  &lt;!-- With the following configuration, both the sender and the receiver apps need to be signed by the same developer certificate. --&gt;
  &lt;permission android:name="my.app.PERMISSION" android:protectionLevel="signature"/&gt;
 &lt;/manifest&gt;
 </pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.securecoding.cert.org/confluence/display/java/DRD03-J.+Do+not+broadcast+sensitive+information+using+an+implicit+intent">CERT: DRD03-J. Do not broadcast sensitive information using an implicit intent</a><br/>
<a href="http://developer.android.com/reference/android/content/BroadcastReceiver.html#Security">Android Official Doc: BroadcastReceiver (Security)</a><br/>
<a href="http://developer.android.com/guide/topics/manifest/receiver-element.html">Android Official Doc: Receiver configuration (see <code>android:permission</code>)</a><br/>
<sup>[1]</sup> <a href="http://stackoverflow.com/a/21513368/89769">StackOverflow: How to set permissions in broadcast sender and receiver in android</a><br/>
<a href="https://cwe.mitre.org/data/definitions/925.html">CWE-925: Improper Verification of Intent by Broadcast Receiver</a><br/>
<a href="https://cwe.mitre.org/data/definitions/927.html">CWE-927: Use of Implicit Intent for Sensitive Communication</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7482">不可信的主机名头</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的主机名头</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>主机名头可以由客户端控制。因此，它的价值不应该被用于任何安全的关键决策。<code>ServletRequest.getServerName()</code>和<code>HttpServletRequest.getHeader("Host")</code>都是相同的
用来提取<code>Host</code>头的行为。</p>
<pre>
GET /testpage HTTP/1.1
Host: www.example.com
[...]</pre>
<p>
服务您应用程序的web容器可能在默认情况下向您的应用重新定向请求。
这将允许恶意用户在主机头中放置任何值。
建议您在对请求的任何安全性决策中都不相信这个值。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/807.html">CWE-807: Untrusted Inputs in a Security Decision</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7545">不安全的哈希匹配</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不安全的哈希匹配</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
攻击者可能根据比较时间的长短检测加密哈希的值。 当调用函数<code>Arrays.equals()</code> 或<code>String.equals()</code>时，一旦字节不匹配，它们就会立刻退出。
</p>
<p>
<p><b>易受攻击的代码：</b><br/>
<pre>
String actualHash = ...
if(userInput.equals(actualHash)) {
    ...
}</pre>
</p>
<p><b>解决方案：</b><br/>
<pre>
String actualHash = ...
if(MessageDigest.isEqual(userInput.getBytes(),actualHash.getBytes())) {
    ...
}</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://cwe.mitre.org/data/definitions/203.html">CWE-203: Information Exposure Through DiscrepancyKey</a><br/>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1076">资源注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>攻击者通过操纵资源标识符来利用验证输入信息过程中的缺陷，从而意想不到地实现某个资源的修改或说明（modification or specification）。</p>
<h1 id="_2">漏洞与风险</h1>
<p>某个资源有个能遭受无意的修改或说明。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>确保所有发送给客户端的输入内容都经过了一个可接受的内容说明的清洗。</li>
<li>对所有的内容进行输入验证。</li>
<li>强制对软件定期打补丁。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>下面的例子展示了一个程序未经任何验证过程，从HTTP请求中获取端口号并以该端口号创建了一条socket管道。别有用心的用户可以通过使用代理来更改该端口号，从而获取到一条与服务器直接进行通讯的连接：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">rPort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"remotePort"</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">ServerSocket</span> <span class="n">srvr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="n">rPort</span><span class="o">);</span>
<span class="n">Socket</span> <span class="n">skt</span> <span class="o">=</span> <span class="n">srvr</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span> 
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-owasp">
<p>https://www.owasp.org/index.php/Resource_Injection <a class="footnote-backref" href="#fnref-owasp" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-capec">
<p>https://capec.mitre.org/data/definitions/240.html <a class="footnote-backref" href="#fnref-capec" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7585">Scala Play中潜在的信息泄露</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Scala Play中潜在的信息泄露</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>应用程序可能会无意中泄露关于它们的配置、内部工作或通过各种应用程序问题侵犯隐私的信息。<sup>[1]</sup>根据数据的有效性提供不同响应的页面会导致信息泄漏;特别是当被认为是机密的数据被作为web应用程序设计的结果而泄露的时候。<sup>[2]</sup></p>
</p>
<p>
<p>敏感数据的例子包括（但不限于）：API密钥、密码、产品版本或环境配置。</p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<pre>def doGet(value:String) = Action {
  val configElement = configuration.underlying.getString(value)

  Ok("Hello "+ configElement +" !")
}</pre>
</p>
<p>
<p>应用程序配置元素不应该在响应内容中发送，用户不应该被允许控制代码将使用哪些配置元素。</p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">OWASP: Top 10 2013-A6-Sensitive Data Exposure</a><br/>
[1] <a href="https://www.owasp.org/index.php/Top_10_2007-Information_Leakage_and_Improper_Error_Handling">OWASP: Top 10 2007-Information Leakage and Improper Error Handling</a><br/>
[2] <a href="http://projects.webappsec.org/w/page/13246936/Information%20Leakage">WASC-13: Information Leakage</a><br/>
<a href="https://cwe.mitre.org/data/definitions/200.html">CWE-200: Information Exposure</a><br/></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7572">潜在的HTTP响应拆分</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>潜在的HTTP响应拆分</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
当HTTP请求包含意外的CR和LF字符时，服务器可能会响应输出流，该输出流被解释为两个不同的HTTP响应（而不是一个）。
攻击者可以控制第二个响应并加载攻击，例如跨站点脚本和缓存污染攻击。
根据OWASP，所有现代Java EE应用程序服务器中基本都修复了该问题，但验证输入仍然更好。
如果您担心此风险，则应在所关注的平台上进行测试，以确定底层平台是否允许将CR或LF字符注入头。
报告此弱点的优先级低于SQL注入等，如果您使用的是易受攻击的平台，请检查低优先级警告。
</p>
<br/>
<p>
<b>风险代码：</b><br/>
<pre>String author = request.getParameter(AUTHOR_PARAMETER);
// ...
Cookie cookie = new Cookie("author", author);
response.addCookie(cookie);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://www.owasp.org/index.php/HTTP_Response_Splitting">OWASP: HTTP Response Splitting</a><br/>
<a href="http://cwe.mitre.org/data/definitions/113.html">CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')</a>
<a href="http://cwe.mitre.org/data/definitions/93.html">CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7580">带JavaScript接口（Android）的WebView</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>带JavaScript接口（Android）的WebView</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
使用JavaScript接口会将WebView暴露给高风险的API。
如果在WebView中触发了XSS，那么这个类就可以被恶意JavaScript代码调用。</p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<pre>
WebView myWebView = (WebView) findViewById(R.id.webView);

myWebView.addJavascriptInterface(new FileWriteUtil(this), "fileWriteUtil");

WebSettings webSettings = myWebView.getSettings();
webSettings.setJavaScriptEnabled(true);

[...]
class FileWriteUtil {
    Context mContext;

    FileOpenUtil(Context c) {
        mContext = c;
    }

    public void writeToFile(String data, String filename, String tag) {
        [...]
    }
}</pre>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface%28java.lang.Object,%20java.lang.String%29">Android Official Doc: WebView.addJavascriptInterface()</a><br/>
<a href="https://cwe.mitre.org/data/definitions/749.html">CWE-749: Exposed Dangerous Method or Function</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7486">不可信的Referer头</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的Referer头</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
行为：<ul>
<li>如果请求来自恶意用户，则任何值都可以分配给这个头。</li>
<li>如果请求是从另一个安全（https）发起的，那么“Referer”将不会出现。</li>
</ul>
</p>
<p>
建议：
<ul>
<li>访问控制都不应该基于这个头的值。
</li>
<li>
CSRF保护不应该只基于这个值(<a href="http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z14">因为它是可选的</a>)。</li>
</ul>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/807.html">CWE-807: Untrusted Inputs in a Security Decision</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1089">不安全的清洗规则</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件没有或不恰当地中立化由上游设备接收到的输入信息中的特殊字符，如"&lt;"、"&gt;"和"&amp;"，当它们被送往处理网页内容的下游设备时，将会被错误地解释成Web脚本元素。</p>
<h1 id="_2">漏洞与风险</h1>
<p>这将会使类似的字符被当做控制字符，当在特定的用户会话（Session）下时会被客户端执行。尽管这样的问题可以分到注入类下，但更相关的问题是在展现给用户之前已经对这些特殊字符做了与各个上下文不相符的转换。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>仔细对照白名单中允许的字符和格式，对输入进行检查。</li>
<li>使用并指明读取上游输出的下游设备能够处理的输出编码。</li>
<li>在Struts下，直接写入来自将filter属性设置为true的表单bean的数据。</li>
<li>为了缓解针对用户会话Cookie的XSS攻击，请将会话Cookie设置为HttpOnly。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>在下面的例子中，在展示给客户端浏览器前，访客留言簿没有合理地被加密、过滤，即没有合理地对脚本相关的标签进行中立化：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%</span> <span class="k">for</span> <span class="o">(</span><span class="n">Iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">guestbook</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span> <span class="o">)</span> <span class="o">{</span>
<span class="n">Entry</span> <span class="n">e</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">)</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> <span class="k">%&gt;</span>
<span class="nt">&lt;p&gt;</span>Entry #<span class="k">&lt;%=</span> <span class="n">e</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span><span class="k">&lt;%=</span> <span class="n">e</span><span class="o">.</span><span class="na">getText</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="k">&lt;%</span>
<span class="o">}</span> <span class="k">%&gt;</span>
</pre></div>
</td></tr></table>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/80.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1072">不安全的反射</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#api">需要谨慎使用的API</a></li>
</ul>
</li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>反射使得程序分析和修改自身成为可能。特别地，一个程序可以了解到自身的成员变量的值，并且可以修改他们<a href="https://wiki.sei.cmu.edu/confluence/display/java/Rule+AA.+References#RuleAA.References-Forman05">Forman 2005</a>, <a href="https://wiki.sei.cmu.edu/confluence/display/java/Rule+AA.+References#RuleAA.References-Sun02">Sun 2002</a>。Java的<code>reflection API</code>提供了一种通过反射来访问正常情况下无法访问的字段的方法。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="api">需要谨慎使用的API</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span><span class="o">.</span><span class="na">get</span><span class="o">*()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span><span class="o">.</span><span class="na">set</span><span class="o">*()</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">invoke</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicIntegerFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicLongFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">atomic</span><span class="o">.</span><span class="na">AtomicReferenceFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">()</span>
</pre></div>
</td></tr></table>
<p>反射的使用使得程序的安全分析变得复杂，同时还引入了安全漏洞。能够不通过使用来完成任务时，开发者应该尽可能地避免使用反射API。在必须使用反射的情况下，请保持十分地小心。</p>
<p>特别地，除非类、方法或字段本身是能够被访问的，开发者不能使用反射来访问上述的信息。例如，除非字段本来就是可访问、可修改的，如<code>getter</code>和<code>setter</code>方法，通过使用反射来访问这些不可访问的字段、修改不可修改的字段是不被允许的。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>确保安全管理者（security manager）会阻断那些试图访问类的私有字段的行为，永远给<code>ReflectPermission</code>许可以<code>suppressAccessChecks</code>动作。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>在这个存在漏洞的示例中，一个<code>Filed</code>对象可以通过反射来修改私有字段<code>i</code>和<code>j</code>：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"FieldExample: i="</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">", j="</span> <span class="o">+</span> <span class="n">j</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroI</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Field</span> <span class="n">f</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">fieldName</span><span class="o">);</span>
      <span class="c1">// Subsequent access to field f passes language access checks</span>
      <span class="c1">// because zeroField() could have accessed the field via</span>
      <span class="c1">// ordinary field references</span>
      <span class="n">f</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
      <span class="c1">// Log appropriately or throw sanitized exception; see EXC06-J</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Report to handler</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Report to handler</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FieldExample</span> <span class="n">fe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FieldExample</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fe</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">fe</span><span class="o">.</span><span class="na">zeroField</span><span class="o">(</span><span class="n">arg</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fe</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>如在这个合规的解决方案中，请确保通过声明<code>private</code>或<code>final</code>的方式，将直接调用者（或直接调用方法）与恶意代码隔离开：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="c1">// ...</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>当一个类必须使用反射来向外界提供字段的访问方法时，它必须同时提供可利用非反射接口来访问这些字段的方法：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">FieldExample</span> <span class="o">{</span>
  <span class="c1">// ...</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroField</span><span class="o">(</span><span class="n">String</span> <span class="n">fieldName</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroI</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">zeroJ</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/SEC05-J.+Do+not+use+reflection+to+increase+accessibility+of+classes%2C+methods%2C+or+fields <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7507">消息摘要是自定义的</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>消息摘要是自定义的</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>实现自定义MessageDigest是容易出错的。</p></p>
<p><a href="http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html">NIST</a> 推荐使用 SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, or SHA-512/256.

</p>
<blockquote>
<p>"<b>数字签名生成的SHA-1：</b><br/>SHA-1只能用于NIST协议特定指导的数字签名生成。对于所有其它应用，<u>“SHA-1”不能用于数字签名生成</u>。<br/></p>
<p><b>用于数字签名验证的SHA-1：</b><br/>对于数字签名验证，<u>SHA-1是允许合法使用的</u>。<br/></p>
<p>[...]<br/></p>
<p><b>SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224，和 SHA-512/256</b>:<br/></p>
<p>所有哈希函数应用程序都可以使用这些哈希函数。"<br/></p>
<ul>
<li><a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Transitions: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths p.15</a></li>
</ul>
</blockquote>
<p>
<p><b>易受攻击的代码：</b><br/></p>
<p><pre>MyProprietaryMessageDigest extends MessageDigest {
  @Override
  protected byte[] engineDigest() {
  [...]
  //创造力是个坏主意
  return [...];
  }
 }</pre></p>
</p>
<p>
<p><p>升级您的安装使用以使用已批准的一个算法。使用一种足够强大的算法来满足您的特定安全需求。</p></p>
<p>
<p><b></b></p>
<p>解决方案示例：</p></p></p><br/>
<p><pre>MessageDigest sha256Digest = MessageDigest.getInstance(""SHA256"");
sha256Digest.update(password.getBytes());</pre></p>

<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html">NIST Approved Hashing Algorithms</a><br/>
<a href="http://cwe.mitre.org/data/definitions/327.html">CWE-327: Use of a Broken or Risky Cryptographic Algorithm</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7151">可以因为引用可变对象而暴露内部的字段表示</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可以因为引用可变对象而暴露内部的字段表示</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>该代码将一个外部可变对象的引用存储到对象的内部表示中。</p>
<p>如果实例是由不受信任的代码访问的，并且对可变对象的未检查的更改将危及安全性或其它重要属性，那么你将需要做一些不同的事情。</p>
<p>在许多情况下，存储对象的副本是更好的方法。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0086">路径遍历</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#1">漏洞代码示例 1</a></li>
<li><a href="#1_1">漏洞代码修复示例 1</a></li>
<li><a href="#2">漏洞代码示例 2</a></li>
<li><a href="#2_1">漏洞代码修复示例 2</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>许多文件操作旨在在受限制的目录中进行。通过使用诸如".."和"/"分隔符等特殊元素，攻击者可以逃离受限位置以访问系统中其他位置的文件或目录。最常见的特殊元素之一是"../"序列，它在大多数现代操作系统中被解释为当前位置的父目录。这被称为相对路径遍历。路径遍历还包括绝对路径名的使用，例如"/usr/local/bin"，这在访问意外文件时也很有用。这被称为绝对路径遍历。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在许多编程语言中，注入空字节（0或NUL）可能允许攻击者截断生成的文件名以扩大攻击范围。例如，该软件可能会将".txt"添加到任何路径名，从而将攻击者限制为文本文件，但空注入可能会有效地消除此限制。</p>
<h1 id="_3">缓解与预防</h1>
<p>假设所有输入都是恶意的。使用"接受已知良好"输入验证策略，例如使用严格符合规范的可接受输入的白名单。拒绝任何不严格符合规范的输入。</p>
<p>执行输入验证时，请考虑所有可能相关的属性，包括长度，输入类型，可接受值的全部范围，缺失或额外输入，语法，相关字段的一致性以及对业务规则的一致性。 </p>
<p>不要完全依靠寻找恶意或畸形输入（即不要依赖黑名单）。黑名单可能会遗漏至少一个不良的输入，特别是如果代码的环境发生变化。 这可能给攻击者足够的空间来绕过预期的验证。</p>
<p>验证文件名时，请使用严格的白名单来限制要使用的字符集。 如果可行，只允许一个"." 字符以避免诸如CWE-23之类的弱点，并且排除诸如"/"之类的目录分隔符以避免CWE-36。使用允许的文件扩展名的白名单，这将有助于避免CWE-434。</p>
<p>不要完全依赖去除潜在危险字符的过滤机制。 这相当于黑名单，可能不完整（CWE-184）。 例如，如果文件系统也支持使用"\"作为目录分隔符，则过滤"/"的保护不足。 如果以仍会产生危险数据的方式应用筛选（CWE-182），则可能会发生另一个可能的错误。 例如，如果以顺序的方式从 ".../...//" 字符串中删除"../"序列，则将从原始字符串中移除两个"../"实例，但其余的字符仍然会形成"../"字符串。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">path_traversal</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">file_path</span><span class="p">);</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span> <span class="c1">// @@bad@@</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>该漏洞代码示例没有对外部输入的file_path进行有效的验证，可以能会触发路径遍历漏洞。</p>
<h3 id="1_1">漏洞代码修复示例 1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">bool</span> <span class="nf">verify_file_path</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file_path</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">path_traversal</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">file_path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">file_path</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">verify_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)){</span> <span class="c1">// @@good@@</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>该漏洞代码修复示例中，通过调用verify_file_path()函数，有效的验证了路径，可以预防路径遍历漏洞。</p>
<h3 id="2">漏洞代码示例 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testbad</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">InputStream</span> <span class="n">is1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">InputStream</span> <span class="n">is2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">128</span><span class="o">];</span>
            <span class="n">is1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"filepath"</span><span class="o">);</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">file_path</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">128</span><span class="o">);</span>
      <span class="n">is2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">));</span>  <span class="c1">// @@bad@@</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">E</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">is2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>该漏洞代码示例没有对外部输入的file_path进行有效的验证，可以能会触发路径遍历漏洞。</p>
<h3 id="2_1">漏洞代码修复示例 2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testgood</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">verify_file_path</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span><span class="o">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">".."</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">InputStream</span> <span class="n">is1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">InputStream</span> <span class="n">is2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">file_path</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">128</span><span class="o">];</span>
            <span class="n">is1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"filepath"</span><span class="o">);</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">file_path</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">128</span><span class="o">);</span>
      <span class="k">if</span><span class="o">(!</span><span class="n">verify_file_path</span><span class="o">(</span><span class="n">file_path</span><span class="o">)){</span>  <span class="c1">// @@good@@</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">is2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">file_path</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">E</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">is1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
      <span class="n">is2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>该漏洞代码修复示例中，通过调用verify_file_path()函数，有效的验证了路径，可以预防路径遍历漏洞。</p>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE23">
<p>http://cwe.mitre.org/data/definitions/23.html <a class="footnote-backref" href="#fnref-CWE23" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT-FIO16-J">
<p>https://wiki.sei.cmu.edu/confluence/display/java/FIO16-J.+Canonicalize+path+names+before+validating+them <a class="footnote-backref" href="#fnref-CERT-FIO16-J" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn-CERT-FIO02-C">
<p>https://wiki.sei.cmu.edu/confluence/display/c/FIO02-C.+Canonicalize+path+names+originating+from+tainted+sources <a class="footnote-backref" href="#fnref-CERT-FIO02-C" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">Java</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7150">可能因为返回对可变对象的引用暴露内部的字段表示</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可能因为返回对可变对象的引用暴露内部的字段表示</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>返回对存储在对象的一个​​字段中的可变对象值的引用会公开对象的内部表示。
   如果不受信任的代码访问实例，并且对可变对象的未经检查的更改会危及安全性或其它重要属性，则需要执行不同的操作。
  在许多情况下，返回对象的新副本是更好的方法。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1105">JSON注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>JSON是用作序列化对象、数组、数字、字符串、布尔值以及null值的一种语法，常被各类程序用来存储数据或发送消息。
例如，下面一段示例是JSON最简单的Key→Value示例（名称 / 值对，键值对）：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s">"UserName"</span><span class="o">:</span> <span class="s">"xxser"</span><span class="p">,</span> <span class="s">"PassWord"</span><span class="o">:</span><span class="s">"nike"</span><span class="p">,</span> <span class="s">"email"</span><span class="o">:</span> <span class="s">"root@secbug.org"</span> <span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在了解了基础的JSON知识后，下面来看JSON中的注入。
在JSON的基础知识中，我们了解到JSON是根据引号（"）、冒号(:)、逗号（,）和花括号（{}）区分各字符的意义的。如果有恶意用户向JSON中注入恶意字符，那么JSON将解析失败。例如，输入的PassWord值为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">admin</span><span class="s">"888</span>
</pre></div>
</td></tr></table>
<p>那么组装成的JSON数据位如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s">"PassWord"</span><span class="o">:</span><span class="s">" admin"</span><span class="mi">888</span><span class="s">"</span>
</pre></div>
</td></tr></table>
<p>在PassWord中的引号将会破坏整个JSON的结构，导致JSON解析失败。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当程序使用不受信的用户输入来构建JSON文件时，攻击者可能会往其中注入任意的元素，注入的内容可能会引起解析器错误，甚至改变原JSON文件的结构。此外，JSON注入还可能引起代码执行、跨站脚本攻击等问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>1 对其关键字符进行转义。如：将</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s">"admin"</span><span class="mi">888</span><span class="s">"</span>
</pre></div>
</td></tr></table>
<p>转换为
<code>c
"admin\"888"</code>c
这样JSON的值就可以解析了。如果字符串中出现"\"，同样需要将其转义为"\"。
2 使用一些第三方组件。以Java为例，使用了JSON-lib.jar组建JSON数据，可以有效地避免JSON注入。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1078">设置操纵</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>一项或多项系统设置、配置元素存在被用户控制的危险。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当系统设置能够被外部控制时，服务将面临停机的风险，程序也可能会表现出异常的行为，且很可能是恶意的异常行为。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>将系统分区，划清界限，明确划分出安全区域。</li>
<li>正常情况下，不要允许用户输入或其他不可信的数据去控制敏感的数据值。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的Java代码片段展示了从<code>HttpServletRequest</code>中读取一字符串并将它设置为一个数据库连接的活动目录：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="na">setCatalog</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"catalog"</span><span class="o">));</span>
</pre></div>
</td></tr></table>
<p>在以上的例子中，攻击者可以提供一个不存在的活动目录以造成错误，或连接到一个没有访问授权的数据库区域。</p>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/15.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1080">动态代码执行</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>代码注入是形容某类攻击的术语，这种攻击类型包含注入能够被应用程序解释、运行的代码。通常情况下，这样的攻击类型都是利用程序对不受信数据处理极差这一点来实现的。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当不受信的输入被用作动态构建代码时，将有可能出现代码注入攻击。一个显而易见的漏洞之源是从Java代码中使用JavaScript。<code>javax.script</code>包含有定义Java脚本引擎的接口和类，以及一个支持这些接口和类的使用的框架。因此，如果不小心误用了这个包的API，攻击者将能在目标系统上执行任意的代码。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>在解释不受信的代码时，你应该格外小心。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>这段缺陷代码展示了将不受信的用户输入用于构造一条打印相应输入信息的JavaScript语句：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">evalScript</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ScriptException</span> <span class="o">{</span>
  <span class="n">ScriptEngineManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptEngineManager</span><span class="o">();</span>
  <span class="n">ScriptEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getEngineByName</span><span class="o">(</span><span class="s">"javascript"</span><span class="o">);</span>
  <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">"print('"</span><span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">"')"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<p>防御代码注入的最好办法是在代码中避免包含用户输入中的可执行内容。例如，用于动态构造代码的用户输入应该先进行清洗，以保证清洗后的数据中只包含有效的、白名单中允许的字符：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">evalScript</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ScriptException</span> <span class="o">{</span>
  <span class="c1">// Allow only alphanumeric and underscore chars in firstName</span>
  <span class="c1">// (modify if firstName may also include special characters)</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">firstName</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"[\\w]*"</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// String does not match whitelisted characters</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="n">ScriptEngineManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptEngineManager</span><span class="o">();</span>
  <span class="n">ScriptEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getEngineByName</span><span class="o">(</span><span class="s">"javascript"</span><span class="o">);</span>
  <span class="n">engine</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="s">"print('"</span><span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">"')"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/IDS52-J.+Prevent+code+injection <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1092">Bean操纵</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当软件没有恰当地验证用户输入时，攻击者能在表单中构造出程序预料之外的输入数据。</p>
<h1 id="_2">漏洞与风险</h1>
<p>Bean操纵将会使得系统的某些部分接收到预料之外的输入数据，进而引起篡改控制流、随意控制资源或任意代码执行等诸多问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</li>
</ul>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0087">泄漏敏感数据</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#1">漏洞代码示例 1</a></li>
<li><a href="#1_1">漏洞代码修复示例 1</a></li>
<li><a href="#2">漏洞代码示例 2</a></li>
<li><a href="#2_1">漏洞代码修复示例 2</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>记录对于调试，事件响应和收集数据至关重要。 尽管如此，记录敏感数据引发了许多担忧，包括利益相关方的隐私权，法律对个人信息收集的限制，以及内部人员暴露数据的可能性。 敏感信息包括但不限于IP地址，用户名和密码，电子邮件地址，信用卡号以及任何个人身份信息，如社会安全号码。 许多国家禁止或限制收集个人资料; 其他人仅允许以匿名形式保留个人数据。 例如，将未加密的信用卡号码泄漏到日志文件中可能违反了PCI DSS（支付卡行业数据安全标准）规定[PCI 2010]。 因此，日志不得包含敏感数据，特别是在法律禁止的情况下。</p>
<h1 id="_2">漏洞与风险</h1>
<p>不幸的是，违反这一规则是很常见的。例如，在版本0.8.1之前，LineControl Java客户端记录了敏感信息，包括本地用户的密码，如CVE-2005-2990所述。</p>
<p>java.util.logging类为JDK 1.4及更高版本提供了基本的日志框架。其他日志框架存在，但基本原则适用于所选的特定日志框架。</p>
<p>程序通常支持不同级别的保护。某些信息（如访问时间）可以安全记录。一些信息可以被记录下来，但是日志文件必须受限于每个人，但特定的管理员。其他信息（如信用卡号）只能以加密形式包含在日志中。密码等信息不应该被记录。</p>
<p>对于下面的代码示例，日志位于正在记录的信息的信任边界之外。此外，正常的日志消息应该包含其他参数，例如日期，时间，源事件等等。为简洁起见，下面的代码示例中省略了这些信息。</p>
<h1 id="_3">缓解与预防</h1>
<p>在传输之前使用可靠的加密方案加密数据。</p>
<p>在使用带有SSL的Web应用程序时，请将SSL用于整个会话，从登录到登出，而不仅仅是初始登录页面。</p>
<p>使用需要手动（人工）分析的工具和技术，例如渗透测试，威胁建模和交互式工具，以便测试人员记录和修改活动会话。 这些可能比严格的自动化技术更有效。 尤其是与设计和业务规则相关的弱点。</p>
<p>配置服务器以使用加密通道进行通信，其中可能包括SSL或其他安全协议。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<p>在这个漏洞代码示例中，服务器在出现安全异常时记录远程客户端的IP地址。例如，这些数据可能会被误用来构建用户浏览习惯的配置文件。 这种日志记录可能会违反许多国家的法律限制。</p>
<p>当日志不能包含IP地址时，它不应该包含有关SecurityException的任何信息，因为它可能会泄漏IP地址。 当异常包含敏感信息时，自定义的MyExceptionReporter类应该在将控制权返回给catch块中的下一条语句之前提取或清除它。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">logRemoteIPAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">"com.organization.Log"</span><span class="o">);</span>
  <span class="n">InetAddress</span> <span class="n">machine</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Exception</span> <span class="n">e</span> <span class="o">=</span> <span class="n">MyExceptionReporter</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SecurityException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Exception</span> <span class="n">e</span> <span class="o">=</span> <span class="n">MyExceptionReporter</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">machine</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span>
                  <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="1_1">漏洞代码修复示例 1</h3>
<p>除了由MyExceptionReporter隐式执行的日志记录外，此漏洞代码修复示例不记录安全性异常：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">SecurityException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Exception</span> <span class="n">e</span> <span class="o">=</span> <span class="n">MyExceptionReporter</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>出于安全原因，包含敏感信息的日志消息不应打印到控制台显示屏上（敏感信息的一个可能示例是乘客年龄）。 java.util.logging.Logger类支持不同的日志记录级别，可用于对这些信息进行分类：FINEST，FINER，FINE，CONFIG，INFO，WARNING和SEVERE。 默认情况下，INFO，WARNING和SEVERE级别将消息打印到控制台，最终用户和系统管理员可以访问该控制台。
如果我们假设乘客年龄可能出现在当前系统的日志文件中，但不在控制台显示屏上，则此代码示例不合规。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Age: "</span> <span class="o">+</span> <span class="n">passengerAge</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h3 id="2_1">漏洞代码修复示例 2</h3>
<p>此漏洞代码修复示例将乘客使用年限记录在FINEST级别，以防止在控制台上显示此信息。如前所述，我们假设年龄可能出现在系统日志文件中，但不在控制台上。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Make sure that all handlers only print log messages rated INFO or higher</span>
<span class="n">Handler</span> <span class="n">handlers</span><span class="o">[]</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="na">getHandlers</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">handlers</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">handlers</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">// ...</span>
<span class="n">logger</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">"Age: "</span> <span class="o">+</span> <span class="n">passengerAge</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/319.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT">
<p>https://wiki.sei.cmu.edu/confluence/display/java/FIO13-J.+Do+not+log+sensitive+information+outside+a+trust+boundary.html <a class="footnote-backref" href="#fnref-CERT" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">Java</a>
                <a href="../../tag/cwe-319.html">CWE-319</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7489">没有安全标志的Cookie</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>没有安全标志的Cookie</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
  一个新的cookie在没有<code>Secure</code>标志的情况下创建。
<code>Secure</code>标志是对浏览器的一个指令，以确保cookie不会被发送到不安全的通信中 (<code>http://</code>)。</p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<pre>
Cookie cookie = new Cookie("userName",userName);
response.addCookie(cookie);
</pre>
</p>
<p>
<p><b>解决方案(特定配置)：</b><br/>
<pre>
Cookie cookie = new Cookie("userName",userName);
cookie.setSecure(true); // Secure flag
cookie.setHttpOnly(true);
</pre></p>
</p>
<p>
<p><b>解决方案(Servlet 3.0配置)：</b><br/></p>
<pre>
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" version="3.0"&gt;
[...]
&lt;session-config&gt;
 &lt;cookie-config&gt;
  &lt;http-only&gt;true&lt;/http-only&gt;
  &lt;secure&gt;true&lt;/secure&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;
&lt;/web-app&gt;
</pre>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="reference">Reference</h1>
<p><a href="https://cwe.mitre.org/data/definitions/614.html">CWE-614: Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a><br/>
<a href="https://cwe.mitre.org/data/definitions/315.html">CWE-315: Cleartext Storage of Sensitive Information in a Cookie</a><br/>
<a href="https://cwe.mitre.org/data/definitions/311.html">CWE-311: Missing Encryption of Sensitive Data</a><br/>
<a href="https://www.owasp.org/index.php/SecureFlag">OWASP: Secure Flag</a><br/>
<a href="https://www.rapid7.com/db/vulnerabilities/http-cookie-secure-flag">Rapid7: Missing Secure Flag From SSL Cookie</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7541">DES是不安全的</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>DES是不安全的</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
DES被认为是现代应用的强加密算法。 目前，NIST建议使用AES分组加密而不是DES。</p>
<p></p>
<p>
<b>缺陷示例代码：</b>
<pre>Cipher c = Cipher.getInstance("DES/ECB/PKCS5Padding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>示例解决方案：</b>
<pre>Cipher c = Cipher.getInstance("AES/GCM/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://www.nist.gov/itl/fips/060205_des.cfm">NIST Withdraws Outdated Data Encryption Standard</a><br/>
<a href="http://cwe.mitre.org/data/definitions/326.html">CWE-326: Inadequate Encryption Strength</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1075">JavaScript劫持</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>也被称作JSON劫持，攻击者瞄准以JSON文件作为服务器与客户端间的传播媒介的系统（在使用到AJAX的Web2.0系统中极其普遍），通过利用浏览器中同源政策（Same Origin Policy）不会禁止来自一个网站的JavaScript被另外一个网站的上下文包含并运行的行为漏洞，从由服务器传向客户端的JSON文件中盗取可能存在的机密信息。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者会迫使受害者访问一个带脚本标签的恶意页面，该脚本标签的源指向存在漏洞的系统并且包含一条请求该服务器以一个可能包含机密信息的JSON文件作为响应的URL。这个恶意页面还包含用作捕获服务器返回的JSON文件的恶意代码，这段代码能在任何别的处理发生之前完成捕获，通常是通过重写用作创建新对象的JavaScript函数来实现。这个钩子将使得恶意代码能访问每个对象的创建过程，进而将捕获到的可能存在机密信息的JSON文件传输到攻击者的服务器上，然而浏览器的安全模型里没有任何办法能够这样的行为。尽管上面提到的同源政策能够保护DOM，但它对瞄准JSON的攻击无能为力。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>确保服务器端的代码能够识别合法与伪造的请求。</li>
<li>想办法使获取JSON对象的URL无法预测且独特于每个用户的session信息。</li>
<li>尽可能确保从服务器端向客户端传输数据的过程中没有机密信息会以JSON作为媒介。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-capec">
<p>https://capec.mitre.org/data/definitions/111.html <a class="footnote-backref" href="#fnref-capec" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1077">服务器端请求伪造</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>Web服务器从上游设备中接收到了一个URL或类似的请求，未验证请求是否确实是发送给本服务器就从中提取出请求内容。</p>
<h1 id="_2">漏洞与风险</h1>
<p>通过给预期之外的主机或端口发送URL，攻击者能使服务器误以为发送请求的是它自己本身，从而越过像防火墙这类阻止攻击值直接访问URL的访问控制。服务器进而能被攻击者当做一个代理，对主机内部网络进行端口扫描；或利用别的URL来访问系统中的文件，如<code>file://</code>；或利用如<code>gopher://</code>或<code>tftp://</code>之类的协议，来获取远高于请求内容之上的控制权。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>实现一个用作远程资源获取的合法的域名、协议白名单。</p>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/918.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7504">SHA-1是一个弱散列函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>SHA-1是一个弱散列函数</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>算法SHA-1并不是用于哈希密码、签名验证和其它用途的推荐算法。
例如，应该使用<b>PBKDF2</b> 来对密码进行散列。</p>
<blockquote>
    “<b>数字签名生成的SHA-1：</b><br/>SHA-1只能用于NIST协议特定指导的数字签名生成。对于所有其它应用程序，<u>SHA-1不能用于数字签名生成</u>。<br/>
<b>用于数字签名验证的SHA-1：</b><br/>对于数字签名验证，<u>SHA-1是允许使用的</u>。<br/>
    [...]<br/>
<b>SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, 和SHA-512/256</b>:<br/>所有哈希函数应用程序都可以使用这些哈希函数。”<br/>
    - 
<a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Transitions: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths p.15</a>
</blockquote>
<blockquote>
“PBKDF的主要思想是通过增加测试每个密码所需的时间来减慢字典或对密码的暴力破解。一个带有可能密码列表的攻击者可以使用已知的迭代计数器和salt来评估PBKDF。由于攻击者每次尝试都要花费大量的计算时间，所以应用字典或蛮力攻击变得更加困难。”<br/>
- 
<a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST: Recommendation for Password-Based Key Derivation  p.12</a>
</blockquote>
<br/>
<p>
<b>易受攻击的代码：</b><br/>
<pre>MessageDigest sha1Digest = MessageDigest.getInstance("SHA1");
    sha1Digest.update(password.getBytes());
    byte[] hashValue = sha1Digest.digest();</pre></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;pre&gt;</span>byte[] hashValue = DigestUtils.getSha1Digest().digest(password.getBytes());<span class="nt">&lt;/pre&gt;</span>
</pre></div>
</td></tr></table>
</p>
<p>
<b>
解决方案（使用bouncy castle）：</b><br/>
<pre>public static byte[] getEncryptedPassword(String password, byte[] salt) throws NoSuchAlgorithmException, InvalidKeySpecException {
    PKCS5S2ParametersGenerator gen = new PKCS5S2ParametersGenerator(new SHA256Digest());
    gen.init(password.getBytes("UTF-8"), salt.getBytes(), 4096);
    return ((KeyParameter) gen.generateDerivedParameters(256)).getKey();
}</pre>
<b>解决方案（java 8或以上版本）：</b><br/>
<pre>public static byte[] getEncryptedPassword(String password, byte[] salt) throws NoSuchAlgorithmException, InvalidKeySpecException {
    KeySpec spec = new PBEKeySpec(password.toCharArray(), salt, 4096, 256 * 8);
    SecretKeyFactory f = SecretKeyFactory.getInstance(""PBKDF2WithHmacSHA256"");
    return f.generateSecret(spec).getEncoded();
}</pre>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="https://community.qualys.com/blogs/securitylabs/2014/09/09/sha1-deprecation-what-you-need-to-know">Qualys blog: SHA1 Deprecation: What You Need to Know</a><br/>
<a href="https://googleonlinesecurity.blogspot.ca/2014/09/gradually-sunsetting-sha-1.html">Google Online Security Blog: Gradually sunsetting SHA-1</a><br/>
<a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Transitions: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</a><br/>
<a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST: Recommendation for Password-Based Key Derivation</a><br/>
<a href="http://stackoverflow.com/questions/22580853/reliable-implementation-of-pbkdf2-hmac-sha256-for-java">Stackoverflow: Reliable implementation of PBKDF2-HMAC-SHA256 for Java</a><br/>
<a href="http://cwe.mitre.org/data/definitions/327.html">CWE-327: Use of a Broken or Risky Cryptographic Algorithm</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0134">暴露URL中的会话ID</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">修复建议</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>如果浏览器不支持Cookie或用户阻止了所有Cookie，可以把会话ID附加在HTML页面中所有的URL上，这些页面作为响应发送给客户。这样，当用户单击URL时，会话ID被自动作为请求行的一部分而不是作为头行发送回服务器。这种方法称为URL重写(URL rewriting)。</p>
<h1 id="_2">漏洞与风险</h1>
<p>使用URL重写，会将URL中的会话ID暴露给攻击者，使得攻击者可以未经身份验证进入系统，获取系统的敏感数据。</p>
<h1 id="_3">缓解与预防</h1>
<p>禁止使用URL重写，或者使用HTTP POST方法请求参数。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">encodeRedirectURL</span><span class="o">(</span><span class="s">"dfddf.jsp?ID=admin"</span><span class="o">));</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，会话ID admin就被泄露。</p>
<h3 id="_7">修复建议</h3>
<p>改用HTTP POST方法请求参数。</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CEW264">
<p>https://cwe.mitre.org/data/definitions/264.html <a class="footnote-backref" href="#fnref-CEW264" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A2">
<p>https://www.owasp.org/index.php/Top_10-2017_A2-Broken_Authentication <a class="footnote-backref" href="#fnref-OWASP-A2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0092">在安全决策中依赖不可信输入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#1">漏洞代码示例 1</a></li>
<li><a href="#2">漏洞代码示例 2</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>开发人员可能会认为cookie，环境变量和隐藏表单字段等输入无法修改。但是，攻击者可以使用自定义客户端或其他攻击来更改这些输入。此更改可能无法被检测到。 当安全机制，比如认证和授权，是基于这些输入时，攻击者可以绕过软件的安全机制。
没有足够的加密，完整性检查或其他机制，来自外部人的任何输入都不可信。</p>
<h1 id="_2">漏洞与风险</h1>
<p>攻击者可以绕过安全机制访问任何受保护的内容。后果将取决于相关的功能，但是它们的威胁范围从不受信任的用户的权限授予到绕过重要的安全检查。最终，这种漏洞可能导致暴露或修改敏感数据，系统崩溃或执行任意代码。</p>
<h1 id="_3">缓解与预防</h1>
<ol>
<li>仅在服务器端存储状态信息和敏感数据。</li>
<li>任何在客户端执行的安全检查，都需要确保在服务器端重新检查。攻击者可以通过修改结果来绕过客户端的安全检查，或者更改客户端完全删除客户端安全检查。然后，这些修改后的结果将被提交给服务器。</li>
<li>了解不可信输入可能进入软件的所有潜在领域：程序参数，cookie，从网络读取的任何内容，环境变量，反向DNS查询，查询结果，请求标头，URL组件，电子邮件，文件，文件名，数据库以及向应用程序提供数据的任何外部系统。请记住，这样的输入可能通过API调用间接获得。</li>
</ol>
<p>严重用于安全决策的所有输入，并确定是否可以修改设计，从而不依赖提交的输入。例如，您可能能够在服务器端保留有关用户会话的关键信息，而不是将其记录在外部数据中。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示示例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<p>从浏览器cookie读取值以确定用户的角色。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">Cookie</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"role"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">userRole</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>从浏览器cookie读取认证标志，从而允许外部控制用户状态数据。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">Cookie</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"authenticated"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> 
  <span class="n">Boolean</span><span class="o">.</span><span class="na">TRUE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">()))</span> <span class="o">{</span>
    <span class="n">authenticated</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>修复建议：参考“缓解与预防”</p>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE807">
<p>http://cwe.mitre.org/data/definitions/807.html <a class="footnote-backref" href="#fnref-CWE807" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A1">
<p>https://www.owasp.org/index.php/Top_10-2017_A1-Injection <a class="footnote-backref" href="#fnref-OWASP-A1" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-807.html">CWE-807</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7389">类扩展了Struts Action类并使用了实例变量</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>类扩展了Struts Action类并使用了实例变量</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>此类从Struts Action类扩展，并使用实例成员变量。由于Struts框架只创建了struts Action类的一个实例，并以多线程方式使用，因此很可能存在问题，非常不鼓励这种方式。仅考虑使用方法局部变量。仅报告在监视器外部写入的实例字段。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7542">DESede不安全</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>DESede不安全</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
三重DES（也称为3DES或DESede）被认为是现代应用的强加密算法。 目前，NIST建议使用AES分组加密而不是3DES。
</p>
<p>
<b>缺陷代码示例：</b>
<pre>Cipher c = Cipher.getInstance("DESede/ECB/PKCS5Padding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>示例解决方案：</b>
<pre>Cipher c = Cipher.getInstance("AES/GCM/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://www.nist.gov/itl/fips/060205_des.cfm">NIST Withdraws Outdated Data Encryption Standard</a><br/>
<a href="http://cwe.mitre.org/data/definitions/326.html">CWE-326: Inadequate Encryption Strength</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7573">log的潜在CRLF注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>log的潜在CRLF注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
来自不可靠源的数据被放入日志中，而且没有失效，导致攻击者可以伪造日志目录。
插入的虚假条目可用于修改统计数据，分散管理员的注意力，可能暗示了第三方的恶意行为。
如果自动处理日志文件，则攻击者可以通过破坏文件格式或注入意外字符来使文件无法使用。
攻击者还可以将代码或其它命令注入日志文件，并利用日志处理实用程序中的漏洞（例如命令注入或XSS）。
</p>
<br/>
<p>
<b>风险代码：</b><br/>
<pre>String val = request.getParameter("user");
String metadata = request.getParameter("metadata");
[...]
if(authenticated) {
    log.info("User " + val + " (" + metadata + ") was authenticated successfully");
}
else {
    log.info("User " + val + " (" + metadata + ") was not authenticated");
}
</pre>
恶意用户可以使用以下值发送元数据参数：<code>"Firefox) was authenticated successfully\r\n[INFO] User bbb (Internet Explorer"</code>.
</p>
<b>解决方案：</b><br/>
<p>
您可以手动清理每个参数。
<pre>
log.info("User " + val.replaceAll("[\r\n]","") + " (" + userAgent.replaceAll("[\r\n]","") + ") was not authenticated");
</pre>
</p>
<p>
您还可以配置日志系统服务以替换所有消息事件的新行。以下是LogBack <a href="https://logback.qos.ch/manual/layouts.html#replace">使用替换功能</a>的示例配置。
<pre>
<pattern>%-5level - %replace(%msg){'[\r\n]', ''}%n</pattern>
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/117.html">CWE-117: Improper Output Neutralization for Logs</a><br/>
<a href="http://cwe.mitre.org/data/definitions/93.html">CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')</a><br/>
<a href="https://logback.qos.ch/manual/layouts.html#replace">CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')</a><br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1103">操纵Hadoop集群</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件可能会使得攻击者能够操纵客户端应用所在的Hadoop集群中的核心组件。</p>
<h1 id="_2">漏洞与风险</h1>
<p>如果没有正确地配置安全设置相关设置，或不经任何验证直接使用非受信的用户输入，那么Hadoop集群的各种数据都有可能会被攻击者恶意篡改。除此之外，攻击者还有可能获得Hadoop集群的控制权。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>视所有的输入为危险的数据，通过使用白名单等的受信输入验证策略来严格清洗输入数据。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">bad</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"a/specific/path"</span><span class="o">;</span>
    <span class="o">...</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="n">userName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">groupName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
    <span class="o">...</span>
    <span class="n">DFSClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DFSClient</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">());</span>
    <span class="n">ClientProtocol</span> <span class="n">nodeName</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getNameNode</span><span class="o">();</span>
    <span class="o">...</span>
    <span class="c1">// Set ownership without validating userName or groupName.</span>
    <span class="n">nodeName</span><span class="o">.</span><span class="na">setOwner</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">userName</span><span class="o">,</span> <span class="n">groupName</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7480">不可信的servlet参数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的servlet参数</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>Servlet可以从各种方法读取GET和POST参数。
所获得的价值应该被认为是不安全的。
在将这些值传递给敏感的API之前，您可能需要验证或清除这些值，例如：</p>
<ul>
<li>SQL查询（可能导致SQL注入）</li>
<li>文件打开（可能导致路径遍历）</li>
<li>命令执行（潜在的命令注入）</li>
<li> HTML结构(潜在的XSS)
 </li>
<li>......</li></ul></p>
<p></p>

<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/20.html">CWE-20: Improper Input Validation</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1082">操纵文件权限</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当文件在比实际所需的更大的用户范围内提供权限设置后，可能导致敏感信息暴露，或对该资源的意外地修改。当文件与程序配置、敏感的用户数据有关时，这尤其危险。</p>
<h1 id="_2">漏洞与风险</h1>
<p>敏感信息泄露或程序配置错误</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>严格控制文件权限</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setPermissionsByInputFile</span><span class="o">(</span><span class="n">Path</span> <span class="n">path</span><span class="o">,</span> <span class="n">File</span> <span class="n">inputFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">inputFile</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">Files</span><span class="o">.</span><span class="na">setPosixFilePermissions</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">PosixFilePermissions</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">()));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>从文件中读取字符串来设置文件权限，可能导致文件权限失控</p>
<h3 id="_7">代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">testgood</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Path</span> <span class="n">path</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">Files</span><span class="o">.</span><span class="na">setPosixFilePermissions</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">parsePermission</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">()));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>通过<code>parsePermission</code>函数来验证来自输入字符串的权限设置</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE732">
<p>https://cwe.mitre.org/data/definitions/732.html <a class="footnote-backref" href="#fnref-CWE732" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A5">
<p>https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control <a class="footnote-backref" href="#fnref-OWASP-A5" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">Java</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1090">权限管理</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>因为应用没有合理地分配权限或者根据未知来源的信息分配权限，导致给用户赋予了危险的权限。</p>
<h1 id="_2">漏洞与风险</h1>
<p>不合理的权限管理可能会导致不受信的、权限不足的代码拥有某些需要额外权限的操作的执行权。然而，把权限管理精细地做到位会增加很多复杂性。因此，安全方面提升带来的收益必须要盖过额外的复杂度以及相应降低可维护性带来的问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>小心地处理好配置、管理以及权限相关的问题，明确管理软件中的可信区域。</li>
<li>用可完成相应任务的最低权限来运行你的代码。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下程序为使接收方程序以备份意图来读取数据文件，在发送的内容中增加了一个标志：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"com.example.BackupUserData"</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">file_uri</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">addFlags</span><span class="o">(</span><span class="n">FLAG_GRANT_READ_URI_PERMISSION</span><span class="o">);</span>
<span class="n">sendBroadcast</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<p>任何恶意程序都能通过预先注册，从而接收到有关备份意图的数据。因为确实附着了<code>FLAG_GRANT_READ_URI_PERMISSION</code>标签，因而恶意的接收者都能读取用户的数据：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallReceiver</span> <span class="kd">extends</span> <span class="n">BroadcastReceiver</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Uri</span> <span class="n">userData</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">stealUserData</span><span class="o">(</span><span class="n">userData</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE264">
<p>https://cwe.mitre.org/data/definitions/264.html <a class="footnote-backref" href="#fnref-CWE264" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A6">
<p>https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration <a class="footnote-backref" href="#fnref-OWASP-A6" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1098">服务器端模板注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>为了在网页或邮件中呈现动态数据，Web应用广泛使用模板引擎。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当没有恰当地对模板中的用户输入数据进行验证时，将有可能出现服务器端模板注入攻击，这是一种严重的缺陷，且很可能会被当做跨站脚本攻击，或者说完完全全就没有被察觉。与跨站脚本攻击不同，模板注入可以直接地攻击服务器的内部结构，且常常能找到远程代码执行的机会，将每个存在缺陷的程序转变成潜在的支点。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>使用一个简单的模板引擎。</li>
<li>将模板引擎沙箱化，限制在相对安全的Docker容器中。</li>
</ul>
<h1 id="_5">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-blackhat">
<p>https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf <a class="footnote-backref" href="#fnref-blackhat" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1071">拒绝服务</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#dos">通过耗尽资源而引起的DoS</a></li>
<li><a href="#dos_1">并发相关的DoS问题</a></li>
</ul>
</li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>DoS攻击试图使得服务器无法提供计算资源或无法提供足够的计算资源给潜在的使用者。分布式的DoS攻击（DDoS）由两个或以上的人或机器展开。相比桌面程序，DoS和DDoS的攻击常以服务器类型的系统为对象。不管怎样，各式各样的应用程序都有可能受DoS之害。</p>
<p>引发DoS的途径有多种：
- 攻击者利用目标机器上已有的弱点，通过给目标机器发送少量精心制作的网络包从而引起DoS。
- 攻击者通过耗尽目标机器的带宽、内存、磁盘空间或处理器运行时间等计算资源从而引起DoS。
- 攻击者利用算法相关的问题（如hash函数），通过注入最坏情况的数据从而引起DoS。
- 攻击者通过耗尽目标机器的所有网络带宽从而引起DoS。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="dos">通过耗尽资源而引起的DoS</h4>
<p>当资源利用远远大于输入数据能造成的资源利用规模时，将有可能出现DoS问题。对那些把资源相关问题交给用户的客户端软件而言，检查输入是否会过度占用资源这种方法好像有点不妥。但不管怎样，这类软件也应该考虑那些会造成持续性的DoS问题（例如将文件系统占满）的输入。</p>
<h4 id="dos_1">并发相关的DoS问题</h4>
<p>一些形式的DoS攻击会从引入一些并发问题这一点入手，如线程死锁、线程饥饿以及竞争等。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>在应用停止前清除掉临时文件。</li>
<li>不要同步会被重用的对象。</li>
<li>禁止那些尝试停掉JVM的不受信代码。</li>
<li>禁止异常暴露敏感信息。</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TempFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
    <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"tempnam.tmp"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"This file already exists"</span><span class="o">);</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">FileOutputStream</span> <span class="n">fop</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">fop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
      <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"Data"</span><span class="o">;</span>
      <span class="n">fop</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">fop</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">fop</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// Handle error</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>这段存在风险的代码没有在程序运行完成前清除掉临时文件。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TempFile</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Path</span> <span class="n">tempFile</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">tempFile</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span><span class="s">"tempnam"</span><span class="o">,</span> <span class="s">".tmp"</span><span class="o">);</span>
      <span class="k">try</span> <span class="o">(</span><span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span>
          <span class="n">Files</span><span class="o">.</span><span class="na">newBufferedWriter</span><span class="o">(</span><span class="n">tempFile</span><span class="o">,</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"UTF8"</span><span class="o">),</span>
                                  <span class="n">StandardOpenOption</span><span class="o">.</span><span class="na">DELETE_ON_CLOSE</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// Write to file</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Temporary file write done, file erased"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileAlreadyExistsException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"File exists: "</span> <span class="o">+</span> <span class="n">tempFile</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Some other sort of failure, such as permissions.</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Error creating temporary file: "</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert1">
<p>https://wiki.sei.cmu.edu/confluence/display/java/Denial+of+Service <a class="footnote-backref" href="#fnref-cert1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-cert2">
<p>https://wiki.sei.cmu.edu/confluence/display/java/FIO03-J.+Remove+temporary+files+before+termination <a class="footnote-backref" href="#fnref-cert2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7487">不可信的User-Agent头</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不可信的User-Agent头</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>头“用户代理”很容易被客户端欺骗。不建议采用基于用户代理(例如爬行器UA)的不同行为。</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">引用</h1>
<p><a href="http://cwe.mitre.org/data/definitions/807.html">CWE-807: Untrusted Inputs in a Security Decision</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7569">使用表达式语言（EL）时可能的代码注入</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">参考</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用表达式语言（EL）时可能的代码注入</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
表达式使用动态值构建。应验证值的来源，如果数据来源于外部用户输入，请确保检查内部没有恶意代码。
</p>
<p><b>风险代码：</b></p>
<p>
<pre>public void evaluateExpression(String expression) {
    FacesContext context = FacesContext.getCurrentInstance();
    ExpressionFactory expressionFactory = context.getApplication().getExpressionFactory();
    ELContext elContext = context.getELContext();
    ValueExpression vex = expressionFactory.createValueExpression(elContext, expression, String.class);
    return (String) vex.getValue(elContext);
}</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">参考</h1>
<p><a href="http://blog.mindedsecurity.com/2015/11/reliable-os-shell-with-el-expression.html">Minded Security: Abusing EL for executing OS commands</a><br/>
<a href="https://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">The Java EE 6 Tutorial: Expression Language</a><br/>
<a href="http://cwe.mitre.org/data/definitions/94.html">CWE-94: Improper Control of Generation of Code ('Code Injection')</a><br/>
<a href="http://cwe.mitre.org/data/definitions/95.html">CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')</a><br/>
<a href="https://www.mindedsecurity.com/fileshare/ExpressionLanguageInjection.pdf">Minded Security: Expression Language Injection</a><br/>
<a href="http://danamodio.com/appsec/research/spring-remote-code-with-expression-language-injection/">Dan Amodio's blog: Remote Code with Expression Language Injection</a><br/>
<a href="http://blog.h3xstream.com/2014/11/remote-code-execution-by-design.html">Remote Code Execution .. by design</a>: Example of malicious payload. The samples given could be used to test sandboxing rules.<br/>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1079">操纵访问标识符</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>反射使Java程序能够分析和修改自身。特别是，程序可以发现正常无法访问的字段的值并对其进行更改。</p>
<h1 id="_2">漏洞与风险</h1>
<p>使用反射会使安全分析复杂化，并且可以轻松引入安全漏洞。因此，程序员应尽可能避免使用反射API。当需要使用反射时，请格外小心。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>不得使用反射来提供对类，方法和字段的访问，除非那些项在不使用反射的情况下已经可以访问。 例如，不允许使用反射来访问或修改字段，除非这些字段已经可以通过其他方式（例如通过getter和setter方法）访问和修改。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setObjectId</span><span class="o">(</span><span class="n">Example</span> <span class="n">example</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
            <span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">field</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="n">example</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setObjectId</span><span class="o">(</span><span class="n">Example</span> <span class="n">example</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE264">
<p>https://cwe.mitre.org/data/definitions/264.html <a class="footnote-backref" href="#fnref-CWE264" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn-CERT-SEC05-JAVA">
<p>https://wiki.sei.cmu.edu/confluence/display/java/SEC05-J.+Do+not+use+reflection+to+increase+accessibility+of+classes%2C+methods%2C+or+fields <a class="footnote-backref" href="#fnref-CERT-SEC05-JAVA" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn-OWASP-A6">
<p>https://www.owasp.org/index.php/Top_10-2017_A6-Security_Misconfiguration <a class="footnote-backref" href="#fnref-OWASP-A6" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1112">硬编码的密码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#2">漏洞代码示例 2</a></li>
<li><a href="#3">漏洞代码示例 3</a></li>
</ul>
</li>
<li><a href="#_7">参考资料</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>该软件在入站认证过程或与外界设备进行的出站交流过程中使用了硬编码的密码。</p>
<h1 id="_2">漏洞与风险</h1>
<p>硬编码密码常常会引起严重的、连系统管理员也难以察觉的认证失败现象。尽管观测到了这一现象，系统管理员往往会因为问题难以修复，而被迫无奈将产品完全禁用。硬编码密码问题存在两种主要的形式：</p>
<ul>
<li>入站：软件的某个认证机制对硬编码密码进行检测。</li>
<li>出站：软件在与别的系统或组件连接的过程中使用了硬编码的密码。</li>
</ul>
<p>在入站问题上，软件中包含一个默认的管理员账户，与该账号相关联的一个简单的密码被硬编码到了产品中。该产品的每次安装使用的都是这个硬编码的密码，系统管理员无法更改或禁用这个密码，除非手动对程序源码进行修改，或者通过打补丁修复。如果这个密码被发现或公开（在Internet上这是很常见的一个现象），那么任何知道这一点的人都能够使用该产品。结果是，因为该产品的所有安装使用的都是同一个硬编码密码（这可能会涉及到不同的组织），像蠕虫之类的大型攻击将会有机可乘。</p>
<p>出站问题可以应用到与后端服务进行认证的前端系统中。后端系统可能会要求使用一个简单就能获取到的固定的密码。程序员可能会将后端用到的私密信息硬编码到前端软件中。任意的软件使用者都可能提取出这个密码信息。因为从二进制中提取出密码通常是轻而易举的，所以使用了硬编码密码的客户端系统往往存在更大的风险。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<ul>
<li>对出站的认证：将密码存储在源码之外的一个有强力的安全保护的、经加密的配置文件或数据库中，隔绝所有外来者对这些关键信息的访问。</li>
<li>对入站认证：在初始登录中，与其使用一个硬编码的默认用户名、密码账户，可以使用一种“初始登录”模式，要求用户输入一个独立的强密码。</li>
<li>对入站的认证：对密码使用单向的哈希加密，并将这些哈希值存储在有合理的访问控制的配置文件或数据库中</li>
</ul>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<p>以下的代码使用一个硬编码的密码来连接数据库：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"scott"</span><span class="o">,</span> <span class="s">"tiger"</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<p>这是一个连接中客户端上存在硬编码密码的例子。虽然这段代码能够正常运行，但任何能够看到这段代码的人都能够清楚知道访问密码。像这样的程序一旦被交付，那么就没人能对密码为“tiger”的账号“scott”怎么样，除非对程序打补丁。狡猾的员工如果得知了这一信息，那么他就能过利用该信息入侵到系统中。更坏的情况是，如果攻击者拥有该应用的字节码，那么他们就能够通过<code>javap -c</code>来访问到反汇编代码，进而获取到各种密码的值。如下面例子所展示：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">javap</span> <span class="nt">-c</span> <span class="nt">ConnMngr</span><span class="p">.</span><span class="nc">class</span>
<span class="nt">22</span><span class="o">:</span> <span class="nt">ldc</span> <span class="p">#</span><span class="nn">36</span><span class="o">;</span> <span class="o">//</span><span class="nt">String</span> <span class="nt">jdbc</span><span class="p">:</span><span class="nd">mysql</span><span class="o">://</span><span class="nt">ixne</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">rxsql</span>
<span class="nt">24</span><span class="o">:</span> <span class="nt">ldc</span> <span class="p">#</span><span class="nn">38</span><span class="o">;</span> <span class="o">//</span><span class="nt">String</span> <span class="nt">scott</span>
<span class="nt">26</span><span class="o">:</span> <span class="nt">ldc</span> <span class="p">#</span><span class="nn">17</span><span class="o">;</span> <span class="o">//</span><span class="nt">String</span> <span class="nt">tiger</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>以下是一个关于后端内部硬编码密码的例子：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">VerifyAdmin</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">password</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"Mew!"</span><span class="o">))</span> <span class="o">{</span>
<span class="k">return</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//Diagnostic Mode</span>
<span class="k">return</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>任何该程序的实体都能够使用相同的密码来进入诊断模式。如果程序是以二进制only（binary-only)的形式发行的话，那么情况会更加严重，因为想要改变该密码或禁用掉该功能都将变得十分困难。</p>
<h3 id="3">漏洞代码示例 3</h3>
<p>这个例子展示了含有明文的username/password对的属性文件：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">#</span> <span class="n">Java</span> <span class="n">Web</span> <span class="n">App</span> <span class="n">ResourceBundle</span> <span class="n">properties</span> <span class="n">file</span> 
<span class="o">...</span>
<span class="n">webapp</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">username</span><span class="o">=</span><span class="n">secretUsername</span>
<span class="n">webapp</span><span class="o">.</span><span class="na">ldap</span><span class="o">.</span><span class="na">password</span><span class="o">=</span><span class="n">secretPassword</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<p>配置文件中不该包含用户名以及密码这样的信息，上述类似的属性文件也不该以明文方式存储这些信息，否则，任何能够访问这些文件的人都能够以此访问相应的资源。如果可能，那么请将这类信息加密，以避免出现<a href="http://cwe.mitre.org/data/definitions/260.html">CWE-260</a>或<a href="http://cwe.mitre.org/data/definitions/13.html">CWE-13</a>中的情况。</p>
<h1 id="_7">参考资料</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/259.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7564">加密算法易受Padding Oracle影响</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>加密算法易受Padding Oracle影响</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
这种带有 PKCS5Padding的CBC模式容易受到padding oracle攻击。
如果系统暴露了明文与无效填充或有效填充之间的差异，则对手可能会对消息进行解密。
有效和无效的填充物之间的区别通常是通过为每个条件返回的不同的错误消息来表现的。
</p>
<p>
<b>有风险的代码：</b>
<pre>Cipher c = Cipher.getInstance("AES/CBC/PKCS5Padding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p>
<p>
<b>解决方案：</b>
<pre>Cipher c = Cipher.getInstance("AES/GCM/NoPadding");
c.init(Cipher.ENCRYPT_MODE, k, iv);
byte[] cipherText = c.doFinal(plainText);</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="http://www.infobytesec.com/down/paddingoracle_openjam.pdf">Padding Oracles for the masses (by Matias Soler)</a><br/>
<a href="http://en.wikipedia.org/wiki/Authenticated_encryption">Wikipedia: Authenticated encryption</a><br/>
<a href="http://csrc.nist.gov/groups/ST/toolkit/BCM/modes_development.html#01">NIST: Authenticated Encryption Modes</a><br/>
<a href="http://capec.mitre.org/data/definitions/463.html">CAPEC: Padding Oracle Crypto Attack</a><br/>
<a href="http://cwe.mitre.org/data/definitions/696.html">CWE-696: Incorrect Behavior Order</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7152">可以通过将可变对象存储到静态字段中来暴露内部静态状态</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>可以通过将可变对象存储到静态字段中来暴露内部静态状态</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>此代码将外部可变对象的引用存储到静态字段中。</p>
<p>如果对可变对象的未检查更改会危及安全性或其它重要属性，则需要做一些不同的操作。</p>
<p>在许多情况下，存储对象的副本是更好的方法。
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7579">启用JavaScript的WebView（Android）</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>启用JavaScript的WebView（Android）</p>
<h1 id="_2">漏洞与风险</h1>
<p>
<p>为WebView启用JavaScript意味着它现在容易受到XSS攻击。
呈现的页面应该检查潜在的反射XSS、存储XSS和DOM XSS。<br/></p>
<p><pre>
 WebView myWebView = (WebView) findViewById(R.id.webView);
 WebSettings webSettings = myWebView.getSettings();
 webSettings.setJavaScriptEnabled(true);
</pre></p>
</p>
<p>
<p><b>有风险的代码：</b><br/></p>
<p>启用JavaScript并不是一种糟糕的做法。这只是意味着后端代码需要对潜在的XSS进行审计。</p>
<p>XSS也可以用DOM XSS引入客户端。</p>
<p><pre>
 function updateDescription(newDescription) {
  $("#userDescription").html("&lt;p&gt;"+newDescription+"&lt;/p&gt;");
 }</pre></p>
</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="http://www.technotalkative.com/issue-using-setjavascriptenabled-can-introduce-xss-vulnerabilities-application-review-carefully/">Issue: Using setJavaScriptEnabled can introduce XSS vulnerabilities</a><br/>
<a href="http://developer.android.com/guide/webapps/webview.html#UsingJavaScript">Android Official Doc: WebView</a><br/>
<a href="http://projects.webappsec.org/w/page/13246920/Cross%20Site%20Scripting">WASC-8: Cross Site Scripting</a><br/>
<a href="https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet">OWASP: XSS Prevention Cheat Sheet</a><br/>
<a href="https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_%28XSS%29">OWASP: Top 10 2013-A3: Cross-Site Scripting (XSS)</a><br/>
<a href="http://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</a></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7505">具有默认构造函数的DefaultHttpClient与TLS 1.2不兼容</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>具有默认构造函数的DefaultHttpClient与TLS 1.2不兼容</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
<b>易受攻击的代码：</b><br/>
<pre>
HttpClient client = new DefaultHttpClient();
</pre>
</p>
<p>
<p><b>解决方案：</b><br/>
升级您的安装启用以使用推荐的结构之一并配置https.protocols JVM选项包括TLSv 1.2：</p>
<p>
<ul>
<li>
使用<a href="http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/SystemDefaultHttpClient.html">SystemDefaultHttpClient</a>代替</li>
<p>
<b>
示例代码：</b><br/>
<pre>
HttpClient client = new SystemDefaultHttpClient();
</pre>
</p></ul></p>
<li>用<a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/conn/ssl/SSLSocketFactory.html#getSystemSocketFactory()">getSystemSocketFactory()</a>创建基于SSLSocketFactory的HttpClient——获得一个SSLScoketFactory实例并使用这个实例进行HttpClient创建。</li>
<li>创建基于SSLConnectionSocketFactory的HttpClient——用<a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/conn/ssl/SSLConnectionSocketFactory.html#getSystemSocketFactory()">getSystemSocketFactory()</a>获取一个实例并使用这个实例进行HttpClient创建。</li>
<li>在调用build()前使用HttpClientBuilder调用<a href="http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/HttpClientBuilder.html#useSystemProperties()">useSystemProperties()</a></li>
<p>
<b>示例代码：
</b><br/>
<pre>
HttpClient client = HttpClientBuilder.create().useSystemProperties().build();
</pre>
</p>
<li>HttpClients调用<a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/HttpClients.html#createSystem()">createSystem()</a>来产生一个实例。</li>
<p>
<b>示例代码：</b><br/>
<pre>
HttpClient client = HttpClients.createSystem();
</pre>
</p>
</p></p>

<h1 id="_3">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_4">引用</h1>
<p><a href="https://blogs.oracle.com/java-platform-group/entry/diagnosing_tls_ssl_and_https">Diagnosing TLS, SSL, and HTTPS</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7549">RSA使用短密钥</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>RSA使用短密钥</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
   NIST建议使用<u>2048位和更高位的</u>密钥进行RSA算法。
</p>
<blockquote>
    "Digital Signature Verification | RSA: 1024 ≤ len(n) &lt; 2048 | Legacy-use"<br/>
    "Digital Signature Verification | RSA: len(n) ≥ 2048 | Acceptable"<br/>
    - <a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths p.7</a>
</blockquote>
<p><b>易受攻击的代码：</b><br/>
<pre>
KeyPairGenerator keyGen = KeyPairGenerator.getInstance("RSA");
keyGen.initialize(512);
</pre>
</p>
<p><b>解决方案：</b><br/>
创建KeyPairGenerator至少应为2048位密钥大小<br/>
<pre>
KeyPairGenerator keyGen = KeyPairGenerator.getInstance("RSA");
keyGen.initialize(2048);
</pre>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_4">引用</h1>
<p><a href="http://csrc.nist.gov/groups/ST/toolkit/key_management.html">NIST: Latest publication on key management</a><br/>
<a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST: Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths p.7</a><br/>
<a href="http://www.emc.com/emc-plus/rsa-labs/standards-initiatives/how-large-a-key-should-be-used.htm">RSA Laboratories: 3.1.5 How large a key should be used in the RSA cryptosystem?</a><br/>
<a href="http://en.wikipedia.org/wiki/Key_size#Asymmetric%5Falgorithm%5Fkey%5Flengths">Wikipedia: Asymmetric algorithm key lengths</a><br/>
<a href="http://cwe.mitre.org/data/definitions/326.html">CWE-326: Inadequate Encryption Strength</a><br/>
<a href="http://www.keylength.com/en/compare/">Keylength.com (BlueKrypt): Aggregate key length recommendations.</a>
</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/input validation and representation.html">输入验证与表示</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0089">执行未经授权的代码或命令</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/input-validation-and-representation.html">输入验证与表示</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#1">漏洞代码示例 1</a><ul>
<li><a href="#1_1">修复代码示例 1</a></li>
</ul>
</li>
<li><a href="#2">漏洞代码示例 2</a><ul>
<li><a href="#2_1">修复代码示例 2</a></li>
</ul>
</li>
<li><a href="#3">漏洞代码示例 3</a></li>
<li><a href="#3_1">修复代码示例3</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>执行未经授权的代码或命令有两种形式：</p>
<ol>
<li>攻击者可以更改程序执行的命令：攻击者明确控制该命令是什么。</li>
<li>攻击者可以改变命令执行的环境：攻击者隐式地控制命令的含义。</li>
</ol>
<p>第一种类型在数据从不可信源进入应用程序，并且数据用作表示由应用程序执行的命令的字符串的一部分时发生。 通过执行该命令，应用程序会给攻击者一个攻击者不会拥有的特权或能力。</p>
<h1 id="_2">漏洞与风险</h1>
<p>执行未经授权的代码或命令</p>
<h1 id="_3">缓解与预防</h1>
<p>加载的动态库应该来自可信来源。应用程序可以执行本地库中包含的代码，这些代码通常包含易受其他安全问题影响的调用，例如缓冲区溢出或命令注入。 应验证所有本机库以确定应用程序是否需要使用该库。确定这些本地库实际执行的内容非常困难，并且存在恶意代码的概率很高。 另外，这些本地库中的存在意想不到的错误的可能性也很高，因为许多错误都是用C或C++编写的，并且可能容易受到缓冲区溢出或竞争条件问题的影响。 为了帮助防止缓冲区溢出攻击，请将所有输入验证为本地调用的内容和长度。如果本机库不是来自可信来源，请查看库的源代码。 在使用它之前，应该使用经过审查的来源构建库。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示示例</h1>
<h3 id="1">漏洞代码示例 1</h3>
<p>以下代码使用System.loadLibrary()从本地库library.dll中加载代码，该库通常位于标准系统目录中。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"library.dll"</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<p>这里的问题是System.loadLibrary()接受一个库名称，而不是一个路径，用于加载库。从Java 1.4.2 API文档中，该函数的行为如下：包含本机代码的文件是从本地文件系统从传统获取库文件的位置加载的。这个过程的细节是依赖于实现的。 从库名到特定文件名的映射是以系统特定的方式完成的。 如果攻击者能够在搜索顺序中将library.dll的恶意副本放在应用程序想要加载的文件中，则应用程序将加载恶意副本而不是预期文件。 由于应用程序的性质，它使用提升的权限运行，这意味着攻击者的library.dll的内容现在将以提升的权限运行，可能会让他们完全控制系统。</p>
<h4 id="1_1">修复代码示例 1</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1">// 用全路径</span>
<span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"C:\\path_to_real_lib\\library.dll"</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h3 id="2">漏洞代码示例 2</h3>
<p>以下特权应用程序中的代码使用注册表项来确定安装它的目录，并根据指定目录中的相对路径加载库文件。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>...
RegQueryValueEx(hkey, "APPHOME", 0, 0, (BYTE*)home, &amp;size);
char* lib=(char*)malloc(strlen(home)+strlen(INITLIB));
if (lib) {
  strcpy(lib,home);
  strcat(lib,INITCMD);
  LoadLibrary(lib);
}
...
</pre></div>
</td></tr></table>
<p>本示例中的代码允许攻击者通过修改注册表项来指定包含恶意版本的INITLIB的不同路径，从而加载任意库，从该库中将应用程序的提升特权执行代码。 由于程序不验证从环境读取的值，如果攻击者可以控制APPHOME的值，他们可以欺骗应用程序运行恶意代码。</p>
<h4 id="2_1">修复代码示例 2</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="c1">// 修改注册表前确保修改数据的安全</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">is_safe_key</span><span class="o">(</span><span class="n">hkey</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">is_safe</span><span class="o">(</span><span class="n">home</span><span class="o">))</span> <span class="o">{</span>
 <span class="n">error_handle</span><span class="o">(</span><span class="s">"Unsafe Reg editing"</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">RegQueryValueEx</span><span class="o">(</span><span class="n">hkey</span><span class="o">,</span> <span class="s">"APPHOME"</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="n">BYTE</span><span class="o">*)</span><span class="n">home</span><span class="o">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="o">);</span>
<span class="kt">char</span><span class="o">*</span> <span class="n">lib</span><span class="o">=(</span><span class="kt">char</span><span class="o">*)</span><span class="n">malloc</span><span class="o">(</span><span class="n">strlen</span><span class="o">(</span><span class="n">home</span><span class="o">)+</span><span class="n">strlen</span><span class="o">(</span><span class="n">INITLIB</span><span class="o">));</span>
<span class="k">if</span> <span class="o">(</span><span class="n">lib</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">strcpy</span><span class="o">(</span><span class="n">lib</span><span class="o">,</span><span class="n">home</span><span class="o">);</span>
  <span class="n">strcat</span><span class="o">(</span><span class="n">lib</span><span class="o">,</span><span class="n">INITCMD</span><span class="o">);</span>
  <span class="n">LoadLibrary</span><span class="o">(</span><span class="n">lib</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">...</span>
</pre></div>
</td></tr></table>
<h3 id="3">漏洞代码示例 3</h3>
<p>以下代码来自基于Web的管理实用程序，该实用程序允许用户访问可通过其更新系统配置文件的界面。 该实用程序使用名为liberty.dll的库，该库通常位于标准系统目录中。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>LoadLibrary("liberty.dll");
</pre></div>
</td></tr></table>
<p>问题是程序没有指定liberty.dll的绝对路径。如果攻击者能够将一个名为liberty.dll的恶意库放在搜索顺序中而不是应用程序打算加载的文件中，那么应用程序将加载恶意副本而不是预期文件。由于应用程序的性质，它使用提升的特权运行，这意味着攻击者的liberty.dll的内容现在将以提升的特权运行，可能会使攻击者完全控制系统。在没有指定绝对路径时，由于LoadLibrary()使用的搜索顺序，在此示例中看到的攻击类型成为可能。如果在系统目录之前搜索当前目录，就像直到最新版本的Windows一样，那么如果攻击者可以在本地执行程序，这种类型的攻击就变得微不足道了。搜索顺序依赖于操作系统版本，并且通过注册表项的值在较新的操作系统上进行控制：HKLM\System\CurrentControlSet\Control\Session Manager\SafeDllSearchMode</p>
<h3 id="3_1">修复代码示例3</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// 使用全路径</span>
<span class="n">LoadLibrary</span><span class="o">(</span><span class="s">"C:\\path_to_real_lib\\liberty.dll"</span><span class="o">);</span>
</pre></div>
</td></tr></table>
<h1 id="references">References</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/114.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/cwe-114.html">CWE-114</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/security policy management.html">安全策略管理</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE7506">弱SSLContext</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/security-policy-management.html">安全策略管理</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>弱SSLContext</p>
<h1 id="_2">漏洞与风险</h1>
<p><p>
<b>易受攻击的代码：</b><br/>
<pre>
    SSLContext.getInstance("SSL");
</pre>
</p>
<p>
<p><b>解决方案：</b><br/></p>
<p>将安装启用升级到以下内容，并配置https.protocols JVM选项以包含TLSv 1.2：</p>
<pre>
    SSLContext.getInstance("TLS");
</pre>
<p>
</p></p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">引用</h1>
<p><a href="https://blogs.oracle.com/java-platform-group/entry/diagnosing_tls_ssl_and_https">Diagnosing TLS, SSL, and HTTPS</a>
</p></p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-sec-bugs.html">FIND-SEC-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/java.html">java</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues.html">安全问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/java/security issues/privacy leakage.html">隐私数据泄露</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0136">泄漏堆栈信息</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/privacy-leakage.html">隐私数据泄露</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>应用服务器配置允许将详细的错误信息（如：堆栈跟踪信息）返回给用户，这可能会暴露敏感信息或潜在的漏洞，如：已知含有漏洞的组件的版本信息。</p>
<h1 id="_2">漏洞与风险</h1>
<p>错误的日志处理机制向用户披露堆栈跟踪或其他大量错误信息。使攻击者能经常访问一些未授权的系统数据或功能。</p>
<h1 id="_3">缓解与预防</h1>
<p>禁止将堆栈信息输出到日志信息。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
  <span class="k">try</span><span class="o">{</span>
    <span class="o">...</span>
    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">"lavasoft"</span><span class="o">);</span>  
      <span class="n">log</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">"dfsf"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">finally</span><span class="o">{</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>异常信息e被输出。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
  <span class="k">try</span><span class="o">{</span>
    <span class="o">...</span>
    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">"lavasoft"</span><span class="o">);</span>  
      <span class="n">log</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">"dfsf"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">finally</span><span class="o">{</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>在日志信息中去掉异常信息。</p>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CWE">
<p>https://cwe.mitre.org/data/definitions/200.html <a class="footnote-backref" href="#fnref-CWE" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/java.html">JAVA</a>
                </p>
            </div>
        </article>

    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Pinpoint 源代码静态缺陷分析系统, 源伞科技有限公司 - 保留所有权利
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : "../..",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>