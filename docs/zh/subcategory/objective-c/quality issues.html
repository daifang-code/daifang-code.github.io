
<!DOCTYPE html>
<html lang="zh">

<head>
    <link href='../../theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="../../theme/stylesheet/normalize.min.css">
    <script src="../../theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="../../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../../theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="../../theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="../../theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="../../theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="../../theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="../../theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">      <meta name="author" content="Pinpoint Team"/>
    <meta name="description" content="Manual and documents for Sourcebrella Pinpoint"/> <meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Pinpoint Document"/>
<meta property="og:description" content="Manual and documents for Sourcebrella Pinpoint"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../.."/>
 
    <title>Pinpoint Document &ndash; Category</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href="../..">
                <img src="../../theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href="../..">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="输入以搜索">
            </form>
        </div>


        <ul class="global_lang">
                    <li><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="../../standard/language-independent.html">Language Independent 缺陷文档</a>
                        (3)
                    </li>
                    <li>
                        <a href="../../standard/c.html">c/c++ 缺陷文档</a>
                        (316)
                    </li>
                    <li>
                        <a href="../../standard/csharp.html">csharp 缺陷文档</a>
                        (39)
                    </li>
                    <li>
                        <a href="../../standard/golang.html">golang 缺陷文档</a>
                        (34)
                    </li>
                    <li>
                        <a href="../../standard/java.html">java 缺陷文档</a>
                        (555)
                    </li>
                    <li>
                        <a href="../../standard/javascript.html">javascript 缺陷文档</a>
                        (295)
                    </li>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c 缺陷文档</a>
                        (124)
                    </li>
                    <li>
                        <a href="../../standard/php.html">php 缺陷文档</a>
                        (58)
                    </li>
                    <li>
                        <a href="../../standard/python.html">python 缺陷文档</a>
                        (618)
                    </li>
                    <li>
                        <a href="../../standard/swift.html">swift 缺陷文档</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
          <article>
            <h1>
            质量问题 (84)
            </h1>
        </article>
        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1011">谨防零长度分配内存</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当请求分配内存的大小为0时，内存分配函数malloc()，calloc()和realloc()的行为是不可控的。C标准[ISO/IEC 9899：2011]的条款7.22.3规定：</p>
<ul>
<li>如果请求的空间大小为零，则行为是由编译器实现定义的：或者返回空指针，或者返回的指针不能用于访问。</li>
</ul>
<p>当内存分配函数返回非空指针的情况下，读取或写入分配的内存区域会导致未定义的行为。</p>
<h1 id="_2">漏洞与风险</h1>
<p>读取或写入分配0字节长度的内存可能会导致程序异常终止。</p>
<h1 id="_3">缓解与预防</h1>
<p>谨防零长度分配内存。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// expected-warning {{Use of zero-allocated memory}}</span>
  <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
  <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
  <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/c/MEM04-C.+Beware+of+zero-length+allocations.html <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0106">主机字节顺序与网络字节顺序的错误转换</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>来源于主机边界的多字节的值在发送或者写入到环境之前，未将主机字节顺序转换为网路字节顺序或从外界获取或者读取一个多字节到主机边界时，没有把网络字节顺序转换为主机字节顺序。</p>
<h1 id="_2">漏洞与风险</h1>
<p>程序在系统下运行伴随不同的字节顺序方法，这些方法需相互之间连通。错误地转换字节顺序可能导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应使用htons函数把unsigned short类型从主机序转换到网络序；应使用htonl 函数把unsigned long类型从主机序转换到网络序；应使用ntohs 函数把unsigned short类型从网络序转换到主机序；应使用ntohl 函数把unsigned long类型从网络序转换到主机序。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">send</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>   <span class="c1">// b传递时没有被转换为网络字节顺序</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="n">send</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> 
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.3.16 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0054">将固定地址赋值给指针变量</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">移植性问题</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在代码中将一个固定地址(非NULL和0)赋值给一个指针变量。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">移植性问题</h4>
<p>在代码中将一个固定地址(非NULL和0)赋值给一个指针变量，在不同的平台下同一个地址可能是一个非法地址。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>不要给一个指针变量赋除NULL或0之外的固定地址。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="c1">// expected-warning{{Using a fixed address is not portable because that address</span>
  <span class="c1">// will probably not be valid in all environments or platforms}} </span>
  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span> <span class="mh">0x10000</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将固定地址0x10000赋值给指针变量p。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将变量a的地址赋值给指针变量p。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0115">不一致的case标签</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>指多个枚举类型用于同一个"switch"语句中或在"switch"标签语句中，case标签不一致的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>不一致的case标签通常是由于打字错误导致，可能导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>如switch条件中的变量类型为枚举类型，则case标签应为该枚举类型的枚举成员。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="n">A</span><span class="p">{</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">}</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">B</span><span class="p">{</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">}</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">case</span> <span class="nl">b1</span><span class="p">:</span> <span class="p">...;</span> <span class="k">break</span><span class="p">;</span>  <span class="c1">//不一致的case标签</span>
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="n">A</span><span class="p">{</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">}</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">B</span><span class="p">{</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">}</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">case</span> <span class="nl">a1</span><span class="p">:</span> <span class="p">...;</span> <span class="k">break</span><span class="p">;</span> 
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.13 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0024">Dangling else语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#else">悬挂"else"语句</a></li>
</ul>
</li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>花括号保证代码的一致性和可读性。更重要的是，当向执行体中插入一条语句时仅需要插入这条语句就可以了，同时如果忘记添加花括号的话，因为错误的代码缩进可能导致Dangling else语句，使得难以理解代码的逻辑结构。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="else">悬挂"else"语句</h4>
<p>在下面的例子重，很明显开发者的意图是condition1为false时执行do_something_else()。但是由于if语句的执行体缺少花括号，导致do_something_else()在condition1为true，condition2为false时执行，程序的逻辑并没有按照开发者的意图执行。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition1</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">condition2</span><span class="p">)</span>
    <span class="n">do_something</span><span class="p">();</span>
<span class="k">else</span> <span class="c1">// "dangling"</span>
  <span class="n">do_something_else</span><span class="p">();</span>
</pre></div>
</td></tr></table>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>对if语句始终使用花括号，即使语句执行体只有一条语句。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">cond1</span><span class="p">();</span>
<span class="kt">bool</span> <span class="nf">cond2</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something_else</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cond1</span><span class="p">())</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">cond2</span><span class="p">())</span>
      <span class="n">do_something</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="n">do_something_else</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，if和else语句的执行体缺少花括号。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">cond1</span><span class="p">();</span>
<span class="kt">bool</span> <span class="nf">cond2</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something_else</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cond1</span><span class="p">()){</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">cond2</span><span class="p">()){</span>
      <span class="n">do_something</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">do_something_else</span><span class="p">();</span>
  <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，给每一个if和else语句的执行体都添加花括号。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/concurrency and temporal errors.html">并发和时序错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0076">不正确地使用MPI库函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/concurrency-and-temporal-errors.html">并发和时序错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">死锁</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>MPI提供了六个基本API调用：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">MPI_init</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">***</span><span class="n">argv</span><span class="p">)</span>

<span class="kt">int</span> <span class="n">MPI_Finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="kt">int</span> <span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_Comm</span> <span class="n">comm</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">rank</span><span class="p">)</span>

<span class="kt">int</span> <span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_Comm</span> <span class="n">comm</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>

<span class="kt">int</span> <span class="n">MPI_Send</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">MPI_Datatype</span> <span class="n">datatype</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tag</span><span class="p">,</span> <span class="n">MPI_Comm</span> <span class="n">comm</span><span class="p">)</span>

<span class="kt">int</span> <span class="n">MPI_Recv</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">MPI_Datatype</span> <span class="n">datatype</span><span class="p">,</span> <span class="kt">int</span> <span class="n">source</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tag</span><span class="p">,</span> <span class="n">MPI_Comm</span> <span class="n">comm</span><span class="p">,</span> <span class="n">MPI_Status</span> <span class="o">*</span> <span class="n">status</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<p>不正确地使用这些API，可能会造成死锁等问题。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">死锁</h4>
<p>不正确地使用这些API，可能会造成死锁等问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用MPI库函数</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad1</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Check missing wait for dead region.</span>
  <span class="kt">double</span> <span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MPI_Request</span> <span class="n">sendReq1</span><span class="p">;</span>
  <span class="n">MPI_Ireduce</span><span class="p">(</span><span class="n">MPI_IN_PLACE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> \
  <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq1</span><span class="p">);</span>
<span class="p">}</span> <span class="c1">// expected-warning{{Request 'sendReq1' has no matching wait.}}</span>


<span class="kt">void</span> <span class="nf">bad2</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MPI_Request</span> <span class="n">sendReq</span><span class="p">;</span>
  <span class="n">MPI_Isend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq</span><span class="p">);</span>
  <span class="c1">// expected-warning{{Double nonblocking on request 'sendReq'.}}</span>
  <span class="n">MPI_Irecv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq</span><span class="p">);</span>
  <span class="c1">// expected-warning{{Double nonblocking on request 'sendReq'.}}</span>
  <span class="n">MPI_Isend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq</span><span class="p">);</span>
  <span class="n">MPI_Wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sendReq</span><span class="p">,</span> <span class="n">MPI_STATUS_IGNORE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，不正确地使用MPI库函数。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good1</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Check missing wait for dead region.</span>
  <span class="kt">double</span> <span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MPI_Request</span> <span class="n">sendReq1</span><span class="p">;</span>
  <span class="n">MPI_Ireduce</span><span class="p">(</span><span class="n">MPI_IN_PLACE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="err">\</span>  
  <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq1</span><span class="p">);</span>
    <span class="n">MPI_Wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sendReq1</span><span class="p">,</span> <span class="n">MPI_STATUS_IGNORE</span><span class="p">);</span>
<span class="p">}</span> 


<span class="kt">void</span> <span class="nf">good2</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MPI_Request</span> <span class="n">sendReq</span><span class="p">;</span>
  <span class="n">MPI_Isend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sendReq</span><span class="p">);</span>
  <span class="n">MPI_Wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sendReq</span><span class="p">,</span> <span class="n">MPI_STATUS_IGNORE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地使用MPI库函数。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0053">内存分配大小不是存储类型的整数倍</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">越界访问内存</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用malloc函数申请的内存大小不是存储类型大小的整数倍，可能会导致越界访问内存。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">越界访问内存</h4>
<p>使用malloc函数申请的内存大小不是存储类型大小的整数倍，可能会导致越界访问内存。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用malloc函数申请的内存大小必须为存储类型大小的整数倍。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// expected-warning{{Cast a region whose size is not a multiple of the </span>
  <span class="c1">// destination type size}}</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> 
  <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用malloc函数申请的内存大小不是存储类型大小的整数倍，可能会导致越界访问内存。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span> 
  <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用malloc函数申请的内存大小是存储类型大小的整数倍。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0125">忽略采用typedef定义的抽象类型</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在对采用typedef定义的抽象类型的变量进行赋值、参数传递或运算时，忽略采用typedef定义的抽象类型而直接使用相应的基本类型进行操作。</p>
<h1 id="_2">漏洞与风险</h1>
<p>忽略采用typedef定义的抽象类型而直接使用相应的基本类型进行操作可能存在逻辑错误。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>当采用typedef定义的抽象类型的变量需要与其他类型的变量进行赋值、参数传递或运算时，对类型进行强制转换。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>  <span class="c1">//A类型的变量赋值给B类型的变量</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="n">a</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.27 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0075">构造函数或析构函数中调用虚函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>从构造器或析构器直接或间接的调用虚函数。由于对象的构造顺序从父类开始，然后是派生类，在构造过程中，尝试从父类调用派生类的方法是危险的。这就是为什么从构造器中调用虚函数不会导致在派生类中的函数被调用，在这个过程中，派生类对象尚未被初始化。类似地，对象会以构造的相反顺序被销毁，因此，在析构器中尝试调用派生类中的函数，会导致访问已经被销毁了的对象。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>从构造器或析构器直接或间接的调用虚函数。由于对象的构造顺序从父类开始，然后是派生类，在构造过程中，尝试从父类调用派生类的方法是危险的。这就是为什么从构造器中调用虚函数不会导致在派生类中的函数被调用，在这个过程中，派生类对象尚未被初始化。类似地，对象会以构造的相反顺序被销毁，因此，在析构器中尝试调用派生类中的函数，会导致访问已经被销毁了的对象。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>不在构造函数或析构函数中调用虚函数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">A</span><span class="p">(){</span> <span class="n">f</span><span class="p">();</span> <span class="p">};</span>
  <span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>

  <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{};</span>

  <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// from Sema: expected-note {{'foo' declared here}}</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Call to pure virtual function during construction has undefined behavior</span>
    <span class="n">foo</span><span class="p">();</span> 
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在类A的构造函数中调用虚函数foo()。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">A</span><span class="p">(){};</span>
  <span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>

  <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{};</span>

  <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">foo</span><span class="p">();</span> 
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移除类A的构造函数中对虚函数foo()的调用。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0047">不正确地使用strlen函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>如果你想要通过 <code>strlen(p)+1</code> 来表示指针p所指向的字符串长度加上1个额外的字节来存放'\0'，那么当p指向的字符串长度为0时，<code>strlen(p+1)</code> 或 <code>strlen(p-1)</code> 的结果是未定义的。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>当p指向的字符串长度为0时，<code>strlen(p+1)</code> 或 <code>strlen(p-1)</code> 的结果是未定义的。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用strlen函数来获取字符串长度。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="nf">bad</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">new_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span> <span class="c1">//bad_alloc_strlen</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">new_name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用<code>strlen(name+1)</code>来获取需要分配的内存长度，当指针name指向的字符串长度为0时，<code>strlen(name+1)</code>的结果是未定义的。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="nf">good</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">new_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> 
    <span class="n">strcpy</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">new_name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地使用使用strlen(name)+1来获取需要分配的内存长度。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0127">实参与形参顺序不一致</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>调用函数时，传递的实参与形参顺序不一致。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当调用函数时，传递的实参与形参顺序不一致会导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>调用函数时，传递的实参与形参顺序保持一致。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">authenticate</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">username</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="c1">// 验证用户名和密码的正确性</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">exampleFun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>  <span class="c1">//传递的实参与形参顺序不一致。</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">authenticate</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">username</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="c1">// 验证用户名和密码的正确性</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">exampleFun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.4.5 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0113">过时的implicit int</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在声明函数或变量时，使用了过时的"implicit int"规则。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当一个变量未被指定所属类型时，默认的是"int"型，但现代C++已不再支持此规则，可能导致代码难以移植。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>在声明函数或变量时，应指定变量或函数返回值的类型。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// 未声明常量的类型</span>
<span class="n">example_fun</span><span class="p">()</span>    <span class="c1">// 未声明函数返回值的类型</span>
<span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
<span class="kt">int</span> <span class="nf">example_fun</span><span class="p">()</span>    
<span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.30 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0077">结构体填充导致内存浪费</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">资源浪费</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>结构体成员根据它们在程序文本中的声明顺序排列。结构体中可能会使用填充字符，保证结构在内存中正确对齐。结构体填充是为了在多重的架构上方便成员快速访问。<br/>
如果结构体中的成员定义顺序不当，可能会造成过多的结构体填充的产生，导致系统内存的浪费。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">资源浪费</h4>
<p>如果结构体中的成员定义顺序不当，可能会造成过多的结构体填充的产生，导致系统内存的浪费。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>检查结构体成员的放置顺序，重排结构体成员节省不必要的空间使用。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">bad</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">c1</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，由于结构体的成员分布不当，其中每个字符类型（char）的成员，都要占用一个独立的int位长，造成了过多的结构体填充的产生。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">bad</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">c1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，两个char类型的成员定义相连，共占用一个int位长，减少了过多的结构体填充造成的内存浪费。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0057">内存分配时长度溢出</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在内存分配时，如果不检测分配的长度是否溢出，就会导致实际分配的内存长度与预期不符，导致意料之外的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>在内存分配时长度溢出，会导致实际分配的内存长度与预期不符，导致意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>在内存分配之前，对分配的长度进行检测。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="o">*</span><span class="nf">bad</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// expected-warning {{the computation of the size of the memory allocation </span>
  <span class="c1">// may overflow}} </span>
  <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>  

<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，n的值是从函数外部传入的，<code>n * 4</code> 的结果可能会超出<code>unsigned int</code>的最大值，导致溢出，实际分配的内存大小与预期值不符。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="o">*</span><span class="nf">good</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在使用n之前，对n的值进行了检测，从而防止内存分配时长度溢出的问题。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0019">不正确的移位运算</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>移位操作包含"移位表达式&lt;&lt;加减表达式"形式的左移位操作和"移位表达式&gt;&gt;加减表达式"形式的右移位操作。每个整型的操作数都是执行整型提升。结果的类型是经过提升的左操作数的类型。如果右操作数是负值或大于等于提升后左操作数的位数，其行为是未定义的。</p>
<p>移位的数量不能是负数或大于等于提升后左操作数的位数。一个整型的精度是它表示数值的位数，包含符号位和填充位。对于无符号整型来说，它的宽度和精度是一样的。然而对于有符号整数来说，它的宽度大于它的精度。这条规则使用精度代替宽度来表示，因为几乎在每一种情况下，在移位操作中移位的数量大于或等于操作数的精度时会导致一个错误（逻辑错误）。不同于溢出，逻辑错误是一种表示形式方面的缺陷。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>移位操作包含"移位表达式&lt;&lt;加减表达式"形式的左移位操作和"移位表达式&gt;&gt;加减表达式"形式的右移位操作。每个整型的操作数都是执行整型提升。结果的类型是经过提升的左操作数的类型。如果右操作数是负值或大于等于提升后左操作数的位数，其行为是未定义的。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>保证移位操作的右操作数为正数并且小于左操作数的位数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="kt">long</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shift_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shift_size</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">)</span> 
      <span class="k">return</span> <span class="n">value</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">shift_size</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移位操作 <code>value &lt;&lt; shift_size</code> 的右操作数大于等于64，而左操作数的位数为64，导致函数返回一个未定义的结果。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="kt">long</span>  <span class="nf">good</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shift_size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shift_size</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">)</span> 
      <span class="k">return</span> <span class="n">val</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移位操作 <code>value &lt;&lt; 32</code> 的右操作数为32，小于左操作数的位数64，是一个合法的操作。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0023">缺少break语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>一个switch语句包含好几个case标签和一个default标签。default标签是可选的，但是推荐使用default标签。按照惯例，在case标签后面跟着一系列语句之后会有一个break语句结束。如果省略了break语句，控制流会进入switch语句块中的下一个case标签中。由于break语句不是必需的，省略它不会产生一个编译诊断信息。如果这种省略不是程序员所希望的，这会产生一个出乎意料的控制流。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的行为</h4>
<p>如果在swith语句的标签中省略了break语句，控制流会进入switch语句块中的下一个case标签中，导致连续的执行分支逻辑，产生错误结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>应确保default分支和每个语句不为空的case分支结尾有break语句。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="c1">// Defect: Missing break statement in this case</span>
    <span class="n">foo</span><span class="p">();</span>
  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，case 2标签中缺少break语句，控制流会进入case 3。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在case 2标签中添加合适的break语句。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0114">迭代时使用不正确的容器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>迭代器分配给了一个容器后却在另一个容器中使用该迭代器的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在不适合的容器上使用迭代器会导致未定义的行为发生。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应注意迭代器的使用范围和有效性。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">b</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">b</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.15 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/concurrency and temporal errors.html">并发和时序错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0078">不正确地使用vfork</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/concurrency-and-temporal-errors.html">并发和时序错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>如果vfork()函数创建的进程修改了除了pid_t类型以外的变量，或者从调用vfork()的函数返回，或者在成功调用_exit()函数或exec()一类函数前调用了其他函数，会导致未定义行为的发生。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>如果vfork()函数创建的进程修改了除了pid_t类型以外的变量，或者从调用vfork()的函数返回，或者在成功调用_exit()函数或exec()一类函数前调用了其他函数，会导致未定义行为的发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>避免在在成功调用_exit()函数或exec()一类函数前修改任何程序变量。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">vfork</span><span class="p">();</span>
  <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用了vfork()函数后，对类型为int的变量x进行修改，该行为会导致未定义行为的发生。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">vfork</span><span class="p">();</span>
  <span class="n">pid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用了vfork()函数后，修改的变量pid的类型为pid_t，该行为不会产生未定义行为。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0124">自身相除或比较</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在表达式中变量与自己相除或作比较。</p>
<h1 id="_2">漏洞与风险</h1>
<p>自身相除或比较通常不是程序的本意，程序中可能存在打字错误，自身相除可能导致程序出错或程序功能实现不正确，自身比较可能导致部分代码永远不会被执行。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>修复程序中存在的打字错误。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span>   <span class="c1">//a&lt;a恒为假</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.11 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0119">使用缺乏一致性定义的long long类型</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用在跨编译器上缺乏一致性定义的数据类型，如"long long"类型。</p>
<h1 id="_2">漏洞与风险</h1>
<p>使用在跨编译器上缺乏一致性定义的数据类型可能导致代码难以移植。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应使用编译器内置的或定义的宏来表示实际想要的大小，而不是假设编译器提供的类型有一个合理的大小。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">;</span>  <span class="c1">//使用缺乏一致性定义的long long类型</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">UINT64_t</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.6 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0012">字符串数组初始化中缺少逗号</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在字符串数组初始化中，各个字符串之间缺少逗号分隔符。可能会生成一个串联的字符串，而不是分割的字符串元素，导致意料之外的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>生成一个串联的字符串，而不是分割的字符串元素，导致意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在字符串数组初始化中，使用逗号分隔符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">arr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello "</span> <span class="c1">// bad</span>
               <span class="s">"world"</span><span class="p">};</span>     
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行的字符串数组arr初始化时，缺少逗号分隔符，导致数组arr中只有一个<code>"a string literalanother string literal"</code>元素，而非预期的两个元素。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">arr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello "</span><span class="p">,</span>
               <span class="s">"world"</span><span class="p">};</span>     
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行初始化字符串数组时，使用逗号分隔符。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0003">不兼容的指针类型转换</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">越界访问内存</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>将一种指针类型转换为不兼容的指针类型时，可能会导致越界访问内存隐患。例如将一个指向小数据类型的指针转换为一个指向大数据类型的指针时，通过转换后的指针访问内存对象时，可能会导致越界访问内存。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">越界访问内存</h4>
<p>将一个指向小数据类型的指针转换为一个指向大数据类型的指针时，通过转换后的指针访问内存对象时，可能会导致越界访问内存。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在做指针类型转换时，将指针转换为一种兼容类型。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">init</span><span class="p">((</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第5行时，将uint16_t* 类型转为int* 类型，uint16_t* 类型指向的内存块占16个字节，int* 类型指向的内存块占32个字节，在第1行中以32个字节的大小给该内存块(大小为16字节)赋值，就会造成越界访问内存。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">init</span><span class="p">((</span><span class="kt">uint16_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第5行时，做兼容的指针类型转换。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/csharp.html">CSHARP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0022">类型转换导致精度丢失</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">精度丢失</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不同的数据类型在转换时会造成精度丢失的情况。(MISRA)-C:2004 对类型转换做了如下约束：
MISRA-C 10.1 整型表达式如果存在以下情况，则不应该隐式转换为一个不同的类型:</p>
<ol>
<li>不是转换为一个同符号的宽类型；</li>
<li>整型表达式是一个合成表达式；</li>
<li>整型表达式不是一个常量，而是函数的参数；</li>
<li>整型表达式不是一个常量，而是一个返回值。</li>
</ol>
<p>MISRA-C 10.2. 浮点型表达式如果存在以下情况，则不应该隐式转换为一个不同的类型:</p>
<ol>
<li>不是转换为一个同符号的宽类型；</li>
<li>浮点型表达式是一个合成表达式；</li>
<li>浮点型表达式是函数的参数；</li>
<li>浮点型表达式是一个返回值。</li>
</ol>
<p>MISRA-C 10.3. 整型合成表达式只能转换为同符号同类型并且位数更大的值。</p>
<p>MISRA-C 10.4. 浮点型合成表达式只能转换为同符号同类型并且位数更大的值。</p>
<p>MISRA-C 10.5. 对unsigned char 或 unsigned short类型的变量使用位操作~或&lt;&lt;时，必须立即将结果转换为unsigned char 或 unsigned short类型。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">精度丢失</h4>
<p>不同的数据类型在转换时会造成精度丢失的情况，精度丢失可能导致程序功能不正确。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>检查转换前和转换后的类型，预防精度丢失。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">double</span> <span class="n">float64_t</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int32_t</span> <span class="n">xs32a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xs32b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* Defect: Casting complex expression with</span>
<span class="cm">  integer type to a non-integer</span>
<span class="cm">  type float64_t */</span>
  <span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="n">float64_t</span><span class="p">)(</span><span class="n">xs32a</span> <span class="o">/</span> <span class="n">xs32b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将整型表达式xs32a / xs32b显式转换为float64_t类型，违反了MISRA-C 10.3。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">double</span> <span class="n">float64_t</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int32_t</span> <span class="n">xs32a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xs32b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">(</span><span class="kt">void</span><span class="p">)(</span><span class="kt">int32_t</span><span class="p">)(</span><span class="n">xs32a</span> <span class="o">/</span> <span class="n">xs32b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将整型表达式xs32a / xs32b显式转换为int32_t类型，符合MISRA-C 10.2。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0006">不正确地使用BSTR类型的值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">内存的误用</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>由于COM中的BSTR类型和C风格的字符串类型（指向'\0'结尾的字符数组的指针）是两种结构不同的数据类型，将这两种类型进行相互转换、误用，虽然在某些情况下，能够通过编译，但在实际运行中，会造成未知结果，甚至造成内存的误用。
和C风格的字符串不同，BSTR字符串带有一个4 byte长度的前置，用于记录字符串的长度。同时，BSTR字符串同样可带有空终结符。基于以上原因，在程序设计的时候，应当避免使用BSTR字符串。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">内存的误用</h4>
<p>于COM中的BSTR类型和C风格的字符串类型（指向'\0'结尾的字符数组的指针）是两种结构不同的数据类型，将这两种类型进行相互转换、误用，虽然在某些情况下，能够通过编译，但在实际运行中，会造成未知结果，甚至造成内存的误用。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>只能通过'=='或'!='来比较两个BSTR对象。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">b1</span><span class="p">,</span> <span class="n">BSTR</span> <span class="n">b2</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">b1</span> <span class="o">&gt;</span> <span class="n">b2</span><span class="p">)</span> <span class="p">{</span> 
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第2行代码中，直接使用'&gt;'比较两个BSTR对象。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">b1</span><span class="p">,</span> <span class="n">BSTR</span> <span class="n">b2</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">b1</span> <span class="o">==</span> <span class="n">b2</span><span class="p">)</span> <span class="p">{</span> 
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第2行代码中，使用'=='来比较两个BSTR对象。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0046">未检测函数返回值为负数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">程序崩溃</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。错误的将函数返回值直接用作数组下标，循环变量等情况，而没有验证其是否为负数，可能会导致程序崩溃，死循环，整型溢出等问题。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">程序崩溃</h4>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。错误的将函数返回值直接用作数组下标，循环变量等情况，而没有验证其是否为负数，可能会导致程序崩溃，死循环，整型溢出等问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">some_function</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">();</span> <span class="c1">// some_function() might return -1</span>
  <span class="n">buff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Defect: buffer underrun at buff[-1]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，some_function()可能会返回一个负数，在第5行将返回值用作数组下标时，导致缓冲区溢出问题。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">some_function</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">();</span> <span class="c1">// some_function() might return -1</span>
  <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">buff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在使用some_function()的返回值作为数组下标之前，确保返回值一定为非负数。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0025">使用open函数创建文件时缺少参数mode</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">不安全的文件权限</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>创建一个具有不充分的受限访问权限的文件可能允许未授权用户访问这个文件。尽管文件访问权限极大地依赖于文件系统，许多文件创建函数还是提供了一些用于设置（至少是影响）访问权限的机制。当使用这些函数创建文件时，应该指定适当的访问权限，以防止违背意图的访问。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">不安全的文件权限</h4>
<p>使用POSIX函数open()创建文件，但是未提供这个文件的访问权限可能导致文件创建时具有过度的访问权限。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>当使用O_CREAT创建文件时，在open()函数的第3个参数中指定文件的访问权限。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">file_name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>

    <span class="cm">/* Initialize file_name */</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">O_WRONLY</span><span class="p">);</span>
    <span class="cm">/* Access permissions were missing */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="cm">/* Handle error */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用POSIX函数open()创建文件，但是未提供这个文件的访问权限可能导致文件创建时具有过度的访问权限。这种省略已经知道会产生潜在的风险。例如CVE-2006-1174。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">file_name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">file_access_permissions</span><span class="p">;</span>

    <span class="cm">/* Initialize file_name and file_access_permissions */</span>
    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span>
        <span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">O_WRONLY</span><span class="p">,</span>
        <span class="n">file_access_permissions</span>
    <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="cm">/* Handle error */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，创建文件的访问权限应该在open()函数的第3个参数中指定。同样，权限的值由umask()的值所修改。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0039">死循环</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">拒绝服务攻击</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在循环体中，如果循环变量不改变，则永远无法退出循环，导致程序死循环。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">拒绝服务攻击</h4>
<p>死循环会导致程序挂起或者崩溃，过多的使用CPU或内存资源，可能会导致拒绝服务攻击。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>在循环体中修改循环变量的值，避免死循环。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">global_var</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">global_var</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，循环变量global_var的值在while循环中不会被改变，永远为10，导致死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">global_var</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">global_var</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
        <span class="n">global_var</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，在while循环中修改了global_var的值，从而可以使程序退出while循环。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0123">可能错误的指针缩放</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>指针指向的位置不为数组中的元素的起始位置。</p>
<h1 id="_2">漏洞与风险</h1>
<p>错误的指针缩放可能导致程序功能错误或缓冲区溢出。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>正确地使用指针缩放。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">};</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">;</span>
  <span class="c1">//指针"p+3"指向的位置不为整型数组a的元素起始位置</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">3</span><span class="p">));</span>  
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">};</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">4</span><span class="p">));</span>  
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.7.2 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0055">错误的指针减法操作</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>如果两个指针指向同一个数组，它们就可以相减，其结果为两个指针之间的元素数目。
如果两个指针不是指向同一个数组，它们相减就没有意义了，甚至产生错误的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>如果两个指针不是指向同一个数组，它们相减就没有意义了，甚至产生错误的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>只对指向同一个数组的指针进行减法操作。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
  <span class="c1">// expected-warning{{Subtraction of two pointers that do not point to the same </span>
  <span class="c1">// memory chunk may cause incorrect result}}</span>
  <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">y</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，&amp;y 和 &amp;x 分别指向不同的对象，不能做减法操作。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="p">;</span> <span class="c1">// no-warning</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，q 和 p 都指向同一个数组a，可以进行减法操作。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0016">多余的分号</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">逻辑错误</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当一个if语句被分号提前终止时，then语句将永远被执行，从而改变了if语句的逻辑。在while,for等循环语句被分号提前终止时，可能会导致死循环或者循环体部分只被执行一次。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">逻辑错误</h4>
<p>当一个if语句被分号提前终止时，then语句将永远被执行，从而改变了if语句的逻辑。在while,for等循环语句被分号提前终止时，可能会导致死循环或者循环体部分只被执行一次。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>仔细检查if，for，while语句后面的逗号，移除多余的分号。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">){};</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// detect</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第4行while语句后面存在一个多余的分号，导致死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">){};</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第4行移除while语句后面的分号，使得程序逻辑正常执行。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0009">I/O 库函数返回值错误</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">数据截断</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>库函数fgetc()，getc()，getchar()和istream::get()返回一个int类型的值，而不是char类型的值。将这些函数的返回值赋给一个char类型的值时，可能会造成数据截断。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">数据截断</h4>
<p>在大部分系统中，int类型都比char类型在内存中的字节数要大，将一个int类型转为char类型可能会造成数据截断。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用int类型的变量接收库函数fgetc()，getc()，getchar()和istream::get()的返回值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第3行中将getc()函数的返回值赋给一个char类型的变量可能会造成数据截断。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第3行中将getc()函数的返回值赋给一个int类型的变量。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0014">函数缺少返回值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">出乎意料的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>返回非void类型的函数在某条路径上缺少返回值，会导致出乎意料的程序行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">出乎意料的行为</h4>
<p>返回非void类型的函数在某条路径上缺少返回值，会导致出乎意料的程序行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在返回非void类型的函数的每条路径上都提供返回值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// missing_return</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，当x的值既不等于5，也不等于3时，函数bad缺少返回值。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，在函数的最后提供了返回值0。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/csharp.html">CSHARP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0111">删除有虚方法但无虚析构函数的对象</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>删除有虚方法但无虚析构函数的对象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>如果没有把析构函数声明为virtual，通过基类的指针去删除派生类的对象时，只是调用了基类的析构函数，而没有调用派生类的析构函数，导致派生类的对象没有被回收从而产生资源泄漏问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应把析构函数都声明为virtual。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span>               
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// 没有虚析构函数</span>
  <span class="o">~</span><span class="n">MyClass</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">example_fun</span><span class="p">();</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">MyClass</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">delete</span> <span class="n">m</span><span class="p">;</span>  <span class="c1">//删除有虚方法但无虚析构函数的对象</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span>               
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">//虚析构函数</span>
  <span class="k">virtual</span>  <span class="o">~</span><span class="n">MyClass</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">example_fun</span><span class="p">();</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">MyClass</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">delete</span> <span class="n">m</span><span class="p">;</span>      
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.21 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0026">类型提升前整数溢出</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">整数溢出</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>两个整数在进行算术运算时，字节数小的类型会提升到字节数大的类型，然后进行运算。如果计算的结果超出了字节数大的类型的范围，会导致溢出。
例如，在两个整数的乘法运算中，结果可能会超出整数的表示范围。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">整数溢出</h4>
<p>整数溢出导致结果超出开发人员的预期，导致未知行为的发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>为了避免整数溢出，在算术运算之前将任意操作数提升为字节数大的类型。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2147483648</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// detect</span>
    <span class="c1">// Do something.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，x * y 的结果超出了unsigned int的最大范围(2^32 − 1 即 4,294,967,295)。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2147483648</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span> 
    <span class="c1">// Do something.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，为了避免 x * y 导致的整数溢出，将x提前转换成 unsigned long long 类型。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1007">不正确的whence值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fseek</span> <span class="p">(</span> <span class="kt">FILE</span> <span class="o">*</span> <span class="n">stream</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">origin</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
<p>第三个参数(origin)：用作偏移参考的位置。它由<code>&lt;cstdio&gt;</code>中定义的以下其中一个常量专门用作此函数的参数</p>
<table>
<thead>
<tr>
<th>常量</th>
<th>参考位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>SEEK_SET</td>
<td>文件开头</td>
</tr>
<tr>
<td>SEEK_CUR</td>
<td>当前文件指针</td>
</tr>
<tr>
<td>SEEK_END</td>
<td>文件末尾</td>
</tr>
</tbody>
</table>
<h1 id="_2">漏洞与风险</h1>
<p>如果第三个参数不是SEEK_SET, SEEK_END 或 SEEK_CUR，会导致未定义的行为。</p>
<h1 id="_3">缓解与预防</h1>
<p>fseek()的第三个参数应该是SEEK_SET，SEEK_END或SEEK_CUR。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define N 5</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">student</span><span class="p">{</span>
  <span class="kt">long</span> <span class="n">sno</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">score</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span><span class="n">STU</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="n">STU</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
  <span class="n">fp</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">"rb+"</span><span class="p">);</span>
  <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="o">-</span><span class="mi">1L</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STU</span><span class="p">),</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 4 is not a valid whence argument</span>
  <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STU</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fp</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define N 5</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">student</span><span class="p">{</span>
  <span class="kt">long</span> <span class="n">sno</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">score</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span><span class="n">STU</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="n">STU</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
  <span class="n">fp</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">"rb+"</span><span class="p">);</span>
  <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="o">-</span><span class="mi">1L</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STU</span><span class="p">),</span><span class="n">SEEK_END</span><span class="p">);</span>
  <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">STU</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fp</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1009">在调用字符串操作的函数中使用空指针作为参数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>不要在需要对象的任何实例中使用空指针，包括以下情况：</p>
<ul>
<li>调用空对象的实例方法</li>
<li>访问或修改空对象的字段</li>
<li>将null的长度视为数组</li>
<li>访问或修改null的元素，就像它是一个数组一样</li>
<li>抛出null，就像它是一个Throwable值一样</li>
</ul>
<p>在需要对象的情况下使用null会导致引发NullPointerException，从而中断程序或线程的执行。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在需要对象的情况下使用null会导致引发NullPointerException，从而中断程序或线程的执行。</p>
<h1 id="_3">缓解与预防</h1>
<p>不要在需要对象的任何实例中使用空指针。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">strcpy_null_dst</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// expected-warning{{Null pointer argument in call to string copy function}}</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span> 

  <span class="c1">// expected-warning{{Null pointer argument in call to string length function}}</span>
  <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 

  <span class="kt">char</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="s">"123"</span><span class="p">;</span>
  <span class="c1">// expected-warning{{Null pointer argument in call to string comparison </span>
  <span class="c1">// function}}</span>
  <span class="n">strcmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cert">
<p>https://wiki.sei.cmu.edu/confluence/display/java/EXP01-J.+Do+not+use+a+null+in+a+case+where+an+object+is+required.html <a class="footnote-backref" href="#fnref-cert" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0110">条件判别成立时相应分支无执行语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>条件判别成立时相应分支无任何执行语句。</p>
<h1 id="_2">漏洞与风险</h1>
<p>这通常不是程序的本意，可能是由于疏忽而遗漏掉了语句，可能会导致程序出错或程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>条件判别成立时相应分支不能为空。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">//条件判别成立时相应分支无执行语句</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">a</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.10 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0052">布尔类型变量赋值错误</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">移植性问题</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>布尔类型的数据拥有值1（true）或0（false），但是依赖于ANSI的赋值规则，从而非常灵活的，并且允许布尔类型为一个整型。但在不同程度灵活性的编译器之间移植时可能会产生问题，所以规定最多分配一个字节给布尔类型的变量。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">移植性问题</h4>
<p>给布尔类型的变量所赋的值大于一个字节，在不同程度灵活性的编译器之间移植时可能会产生问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>不应与其他整型数据交换布尔数据。C++标准定义布尔类型关键字"true"和"false"来分别表示整型值1和0。此外，许多编译器定义了TRUE和FALSE的宏或合适的占位符，或者自定义值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">char</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将256赋值给布尔类型变量a。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">char</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将true赋值给布尔类型变量a。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0011">枚举值用作布尔值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在某些情况下，程序员将枚举值误用作布尔值作为条件判断，使得条件恒为真或恒为假，结果可能与程序员的意愿不符，导致未定义的行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>将枚举值误用作布尔值作为条件判断，可能会导致未定义的行为发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>不要将枚举值用作布尔值进行条件判断。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">color</span> <span class="p">{</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">color</span> <span class="n">c</span> <span class="o">=</span> <span class="n">green</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1">// detect</span>
  <span class="p">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">red</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第6行中使用枚举值c作为if的条件判断，结果恒为真。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">color</span> <span class="p">{</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">color</span> <span class="n">c</span> <span class="o">=</span> <span class="n">green</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">green</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">red</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第6行中使用布尔表达式作为if的条件判断。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0116">无限递归函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>方法在没有做任何条件检查的情况下直接或间接调用自身。</p>
<h1 id="_2">漏洞与风险</h1>
<p>无限递归会导致程序栈溢出。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>消除无限递归。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">example_fun</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="c1">//无限递归</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.8.2 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0071">不正确地使用strncat库函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">缓冲区溢出</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>函数原型： <code>extern char *strncat(char *dest,char *src,int n)</code> <br/>
参数说明：src为源字符串，dest为目的字符串，n为指定的src中的前n个字符。<br/>
函数功能：把src所指字符串的前n个字符添加到dest结尾处，覆盖dest结尾处的'\0'，实现字符串连接。  </p>
<p>strncat()的最后一个参数不应该是缓冲区的总长度，而应该是调用strncpy()后缓冲区剩余的长度。这两个函数都要求指定剩余的长度而不是缓冲区的总长度。由于剩余的长度在每次添加或删除数据时都会改变，因此程序员必须跟踪这些改变或重新计算剩余长度。这个过程很容易出错，并且可能会导致缓冲区溢出。<br/>
下面的调用在使用strncat()连接字符串之前正确地计算了剩余的空间：  </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">strncat</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">-</span> <span class="n">strlen</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">缓冲区溢出</h4>
<p>错误地计算n的值可能会导致拼接到dest的字符串超出dest的内存大小，导致缓冲区溢出。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地计算需要拷贝的长度。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">dest</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">};</span>
  <span class="n">strncat</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="s">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// expected-warning {{Potential buffer overflow.</span>
  <span class="c1">// Replace with 'sizeof(dest) - strlen(dest) - 1' or use a safer 'strlcat' API}} </span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用sizeof(dest) - 1计算出的长度超出了dest剩余的长度，导致缓冲区溢出。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">dest</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">};</span>
  <span class="n">strncat</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="s">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span><span class="p">,</span> \
          <span class="k">sizeof</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">-</span> <span class="n">strlen</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地计算需要拷贝的长度。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0030">输出流格式化状态改变后没有恢复</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>标准C++输入输出库函数提供了stream类来实现输入、输出的功能。它包含一个格式化输出数据的能力，不同的数据类型可以转化为一个输出字符串。
例如：
For example:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<p>默认情况下，整数i被转化为一个十进制字符串。
在使用iostream库时，一个常见的错误就是修改了输出流格式化状态，但是忘记恢复了。导致后面格式化数据也是按照前面修改的状态生成字符串，导致意料之外的情况发生。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的行为</h4>
<p>在使用iostream库时，一个常见的错误就是修改了输出流格式化状态，但是忘记恢复了。导致后面格式化数据也是按照前面修改的状态生成字符串，导致意料之外的情况发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>输出流格式化状态改变后恢复原来的状态。 </p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用std::hex修改了输出格式化状态后并没有恢复原来的状态。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">dec</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用std::hex修改了输出格式化状态后使用std::dec恢复原来的状态。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0121">在typedef中使用packed属性</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在用typedef定义structure或union的别名时使用packed属性。</p>
<h1 id="_2">漏洞与风险</h1>
<p>packed属性只能用于structure或union的类型定义。packed属性用于typedef中会被忽略。<br/>
"packed"的作用是使字节对齐，一些平台对某些特定类型的数据只能从某些特定地址开始存取，如一个变量没有进行字节对齐，有些架构的CPU在访问时可能会发生错误；如果不按照适合其平台要求对数据存放进行对齐，会降低存取的效率。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不在用typedef定义structure或union的别名时使用packed属性。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span>    
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">S</span><span class="p">;</span>  <span class="c1">// packed属性将会忽略</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span>    
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span> <span class="n">S</span><span class="p">;</span> 
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.32 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0048">克隆代码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在拷贝粘贴代码块时，某些需要修改的实例，由于程序员的手误，导致这些实例没有被修改，导致程序产生意料之外的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>在拷贝粘贴代码块时，某些需要修改的实例，由于程序员的手误，导致这些实例没有被修改，导致程序产生意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地执行拷贝粘贴代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CopyPasteBad</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">square</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">example</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// "square(a)" should read "square(b)"</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第11行本来应该使用变量b，在拷贝粘贴过程中并没有修改这个实例，导致程序执行结果有误。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CopyPasteGood</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">square</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">example</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地执行拷贝粘贴代码。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0108">char数据类型未指定是否有符号</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>定义char数据类型的变量时未指定是否有符号。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在C语言标准中没有明确定义char数据类型是否有符号，一些编译器允许使用编译器开关切换char类型是否有符号，可能导致代码难以移植。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>注明char数据类型是否有符号，或使用typedef或#define定义的数据类型。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="s">"Hello, welcome!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>  <span class="c1">//char数据类型未指定是否有符号</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">UCHAR</span><span class="p">;</span>
<span class="k">static</span> <span class="n">UCHAR</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="s">"Hello, welcome!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.8 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0013">类中缺少显式的拷贝构造函数或赋值操作符</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">野指针</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在某些状况下，类内成员变量需要动态开辟堆内存，如果实行位拷贝（浅拷贝），也就是把对象里的值完全复制给另一个对象，如A=B。这时，如果B中有一个成员变量指针已经申请了内存，那A中的那个成员变量也指向同一块内存。这就出现了问题：当B把内存释放了（如：析构），这时A内的指针就是野指针了，出现运行错误。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">野指针</h4>
<p>类中缺少显式的拷贝构造函数或赋值操作符，可能在拷贝或赋值的过程中产生野指针。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>提供显式的拷贝构造函数或赋值操作符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">bad</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">bad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">_strdup</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{}</span>
  <span class="o">~</span><span class="n">bad</span><span class="p">()</span> <span class="p">{</span> <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// no copy constructor at all</span>
  <span class="c1">// no assignment operator at all</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">operator</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">str</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，类bad中包含指针成员变量p，但是缺少显式的拷贝构造函数或赋值操作符。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">good</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="c1">// copy constructor</span>
  <span class="n">good</span><span class="p">(</span><span class="k">const</span> <span class="n">good</span> <span class="o">&amp;</span><span class="n">init</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">){</span>
      <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">init</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">init</span><span class="p">.</span><span class="n">p</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// assignment operator</span>
  <span class="n">good</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">good</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">){</span>
        <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">strcpy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="o">~</span><span class="n">good</span><span class="p">()</span> <span class="p">{</span> <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">operator</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">str</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，类good中包含指针成员变量p，并且提供了显式的拷贝构造函数和赋值操作符。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0050">错误的指针运算</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">越界访问内存</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在C和C++的类型系统中并没有区分"指向单一对象的指针"和"指向数组的指针"。因此，很容易对一个"指向单一对象的指针"执行指针运算。这会导致读取未初始化的内存值或者垃圾数据。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">越界访问内存</h4>
<p>对一个"指向单一对象的指针"执行指针运算。这会导致读取未初始化的内存值或者垃圾数据。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>只对"指向数组的指针"执行指针运算。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，<code>p</code>是一个指向单一对象a的指针，在第4行对<code>p</code>执行指针运算时，<code>p</code>最终指向一个未知内存。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，<code>p</code>是一个指向数组a的指针，可以对<code>p</code>执行指针运算。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1005">将非结构体类型转换为结构体类型</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>将非结构类型转换为结构类型并访问内部字段会导致内存访问错误或数据损坏。</p>
<h1 id="_2">漏洞与风险</h1>
<p>由于内存访问错误，执行可能会结束。</p>
<h1 id="_3">缓解与预防</h1>
<p>禁止不兼容的类型转换。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">foo</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">foo</span> <span class="o">*</span><span class="p">)</span><span class="n">main</span><span class="p">;</span>
  <span class="n">foo</span><span class="o">-&gt;</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">foo</span><span class="o">-&gt;</span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>http://cwe.mitre.org/data/definitions/588.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                <a href="../../tag/cwe-588.html">CWE-588</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0008">函数地址与0作比较</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">逻辑错误</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在条件判断中将函数的地址与0作比较时，因为函数的地址不可能为0，所以这样的比较结果通常为恒定值false。这种情况大多数时由于程序员笔误导致的。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">逻辑错误</h4>
<p>将函数地址与0作比较，结果恒为false，这可能与程序员的预期行为不一致，导致逻辑上的错误。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>将函数的返回值与0作比较。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">malloc</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bad */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中将strlen函数地址与0作比较，结果恒为false。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* good */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中将strlen函数的返回值与0作比较。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0018">传参CComBSTR或CComPtr对象的地址导致内存泄漏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">内存泄漏</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>局部非静态CComBSTR和CComPtr变量内部包含一个指向非空字符串的指针。当变量的地址作为参数传给一个函数时，内部指针所指向的值可能会被修改，导致内存泄漏。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">内存泄漏</h4>
<p>局部非静态CComBSTR和CComPtr变量内部包含一个指向非空字符串的指针。当变量的地址作为参数传给一个函数时，内部指针所指向的值可能会被修改，导致内存泄漏。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_5">缓解与预防</h1>
<p>在函数调用时，传递CComBSTR和CComPtr变量而非他们的地址。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">Base</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="c1">// \pName is a pointer</span>
  <span class="kt">void</span> <span class="n">getName</span><span class="p">(</span><span class="n">BSTR</span> <span class="o">*</span><span class="n">pName</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
    <span class="o">*</span><span class="n">pName</span> <span class="o">=</span> <span class="o">::</span><span class="n">SysAllocString</span><span class="p">(</span><span class="n">name_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">LPCOLESTR</span> <span class="n">name_</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Release</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="n">CComBSTR</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="k">const</span> <span class="n">Base</span> <span class="o">&amp;</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CComBSTR</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="sa">L</span><span class="s">"Lucky"</span><span class="p">;</span>
  <span class="n">base</span><span class="p">.</span><span class="n">getName</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，重载的取地址操作符(&amp;)返回name对象内部的指针，在被调用的方法Base::getName()中，指针所指向的内存在没有被释放的情况下被重新赋值，导致内存泄漏。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">Base</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="c1">// \pName is a value</span>
  <span class="kt">void</span> <span class="n">getName</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">pName</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
      <span class="n">pName</span> <span class="o">=</span> <span class="o">::</span><span class="n">SysAllocString</span><span class="p">(</span><span class="n">name_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">LPCOLESTR</span> <span class="n">name_</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Release</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="n">CComBSTR</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="k">const</span> <span class="n">Base</span> <span class="o">&amp;</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CComBSTR</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="sa">L</span><span class="s">"Lucky"</span><span class="p">;</span>
  <span class="n">base</span><span class="p">.</span><span class="n">getName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用方法customer.getName()时传递一个name对象。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0064">不正确地声明可变长度数组</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>声明可变长度数组时，数组长度必须满足以下要求：</p>
<ol>
<li>数组长度不能为负数或0。</li>
<li>数组长度必须是一个初始化的值。</li>
<li>数组长度不能为一个污点数据。</li>
</ol>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>声明可变长度数组时，如果不满足以上要求，可能申请的数组与预期不符，产生意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>声明可变长度数组时，数组长度必须满足以下要求：</p>
<ol>
<li>数组长度不能为负数或0。</li>
<li>数组长度必须是一个初始化的值。</li>
<li>数组长度不能为一个污点数据。</li>
</ol>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="c1">// expected-warning{{Declared variable-length array (VLA) has zero size}} </span>
  <span class="kt">int</span> <span class="n">vla</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，声明可变长度数组vla时，数组长度x为0。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">vla</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，声明可变长度数组vla时，数组长度x不为0。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0107">在用于控制程序流程的条件表达式中使用位运算符'&'或'|'</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在用于控制程序流程的条件表达式中使用位运算符'&amp;'或'|'。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当用于控制程序流程的条件表达式使用位运算符'&amp;'或'|'时，程序的本意可能为使用运算符"&amp;&amp;"或"||"，可能会改变原本的判断逻辑，导致程序执行不同的分支路径。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>使用运算符'&amp;&amp;'或'||'。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="c1">//在用于控制程序流程的条件表达式中使用位运算符“&amp;”</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span><span class="mi">0</span>  <span class="o">&amp;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> 
  <span class="p">{</span>  
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span><span class="mi">0</span>  <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> 
  <span class="p">{</span>  
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.26 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0074">不正确地使用va_list</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>VA_LIST的用法：  </p>
<ol>
<li>首先在函数里定义一具VA_LIST型的变量，这个变量是指向参数的指针；</li>
<li>然后用VA_START宏初始化变量刚定义的VA_LIST变量；</li>
<li>然后用VA_ARG返回可变的参数，VA_ARG的第二个参数是你要返回的参数的类型（如果函数有多个可变参数的，依次调用VA_ARG获取各个参数）；</li>
<li>最后用VA_END宏结束可变参数的获取。</li>
</ol>
<p>错误的使用VA_LIST，可能会导致产生错误的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>错误的使用VA_LIST，可能会导致产生错误的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用VA_LIST。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad1</span><span class="p">(</span><span class="kt">int</span> <span class="n">fst</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
  <span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
  <span class="c1">// expected-warning{{va_arg() is called on an uninitialized va_list}} </span>
  <span class="c1">// expected-note{{va_arg() is called on an uninitialized va_list}}</span>
  <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">va_arg</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>  
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用了一个未初始化的va_list变量va。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad2</span><span class="p">(</span><span class="kt">int</span> <span class="n">fst</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
  <span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
  <span class="c1">// expected-warning{{va_list 'va' is copied onto itself}} </span>
  <span class="c1">// expected-note{{va_list 'va' is copied onto itself}} </span>
  <span class="n">va_copy</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">va</span><span class="p">);</span> 
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，对变量va进行自我拷贝，没有实际意义。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">fst</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
  <span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
  <span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">fst</span><span class="p">);</span> <span class="c1">// Initialized va_list</span>
  <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">va_arg</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，对va_list变量va进行了初始化，然后再使用该变量。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0067">变量赋值后未使用</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">无效代码</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>变量在下一次赋值操作或函数结束之前没有被使用过，那么这样的赋值或初始化实际上是无效的。这样的编码方式可能会引入逻辑错误。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">无效代码</h4>
<p>变量在下一次赋值操作或函数结束之前没有被使用过，那么这样的赋值或初始化实际上是无效的。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>移除无效的代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// Value stored to x is never read.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第3行的赋值语句是无效代码。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移除无效代码。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/concurrency and temporal errors.html">并发和时序错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0060">加解锁错误</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/concurrency-and-temporal-errors.html">并发和时序错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">死锁</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#1-double-locking">漏洞代码示例1: Double locking</a></li>
<li><a href="#1">漏洞代码修复示例1</a></li>
<li><a href="#2-locking-order-reversal">漏洞代码示例2: Locking order reversal</a></li>
<li><a href="#2">漏洞代码修复示例2</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>所有的针对互斥量的加锁解锁操作，都必须针对同一模块，并且在同一抽象层面进行。否则，将会可能导致某些加锁/解锁操作不会依照多线程设计而被执行，甚至依照锁的类型，最终导致死锁、资源竞争等其他漏洞的爆发。在对加锁对象进行解锁过程中，错误的解锁顺序，容易造成死锁。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">死锁</h4>
<p>不正确地加锁解锁操作，导致死锁、资源竞争等问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地执行加锁解锁操作。对于死锁问题，可以采取例如可以调整资源请求顺序，或者加上sleep操作等方式。</p>
<h1 id="_6">演示实例</h1>
<h3 id="1-double-locking">漏洞代码示例1: Double locking</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">pthread_mutex_t</span> <span class="n">mtx1</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// no-warning</span>
  <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx1</span><span class="p">);</span>    
  <span class="c1">// expected-warning{{This lock has already been acquired}}</span>
  <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx1</span><span class="p">);</span>    
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，对同一个对象mtx1进行重复加锁。</p>
<h3 id="1">漏洞代码修复示例1</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">pthread_mutex_t</span> <span class="n">mtx1</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx1</span><span class="p">);</span>    <span class="c1">// no-warning</span>
  <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx1</span><span class="p">);</span>  <span class="c1">// no-warning</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，对mtx1先加锁，后解锁。</p>
<h3 id="2-locking-order-reversal">漏洞代码示例2: Locking order reversal</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Mutex</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">;</span>

<span class="cm">/* Thread 1 */</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">NonCriticalSection</span><span class="p">()</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">CriticalSection</span><span class="p">();</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Thread 2 */</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">NonCriticalSection</span><span class="p">()</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
   <span class="n">CriticalSection</span><span class="p">();</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，线程1和线程2分别抢占到M1,M2资源并等待对方释放资源，将导致死锁问题。</p>
<h3 id="2">漏洞代码修复示例2</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Mutex</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">;</span>

<span class="cm">/* Thread 1 */</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">NonCriticalSection</span><span class="p">()</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">CriticalSection</span><span class="p">();</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Thread 2 */</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">NonCriticalSection</span><span class="p">()</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
   <span class="n">Mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">CriticalSection</span><span class="p">();</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M2</span><span class="p">);</span>
   <span class="n">Mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">M1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，修改了进程1、进程2请求资源M1、M2的顺序从而预防了死锁的发生。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0004">不正确地使用sizeof</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在代码中使用memset函数来重置内存的值会与期望获取的大小不符。这种情况通常发生在sizeof关键字的使用上面。意图使用sizeof计算实际类型的大小，结果却计算了指针的大小。这种情况会导致重置内存少于期望重置的大小，最后导致未定义行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义行为</h4>
<p>使用sizeof计算实际类型的大小，结果却计算了指针的大小，可能会导致未定义的行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用sizeof操作符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">BB</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">BB</span> <span class="n">buf</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">));</span> <span class="c1">// bad</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码调用memset时，使用sizeof(&amp;buf)而非sizeof(buf)来获取结构体buf的bytes，100个bytes中只有4个或8个bytes被置为0。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">BB</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">BB</span> <span class="n">buf</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span> <span class="c1">// good</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码调用memset时，正确地使用sizeof(buf)来获取结构体buf的bytes，100个bytes都会被置为0。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/java.html">JAVA</a>
                <a href="../../tag/csharp.html">CSHARP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0068">使用浮点变量作为循环计数器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">死循环</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>由于浮点数可以表示实数，因此程序员常常错误地认为它们可以准确地表示任何简单的小数。浮点数也和整数一样受到精度的限制，二进制浮点数无法准确地表示所有的十进制小数，即使后者只用几个十进制数字就可以表示。</p>
<p>不同的实现具有不同的精度限制，为了使代码保持可移植性，不应该使用浮点数作为循环计数器。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">死循环</h4>
<p>使用浮点数作为循环计数器，可能会导致循环无法终止，造成死循环。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">缓解与预防</h1>
<p>使用整数作为循环计数器。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(;</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span><span class="n">a</span><span class="o">++</span><span class="p">){</span>
    <span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用浮点数变量a作为循环计数器，可能会造成死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(;</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span><span class="n">a</span><span class="o">++</span><span class="p">){</span>
    <span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用int型变量a作为循环计数器。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0041">无效的代码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">代码质量问题</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>无效的代码很可能是由于代码编写错误所致，会导致未定义的行为。这样的代码在编译期间通常被优化掉。但是，为了提高可读性并保证逻辑错误能够解决，应该标识、理解并消除无效代码。</p>
<p>没有效果的语句或表达式应该从代码中标识并删除。大多数现有的编译器可以对许多情况下的无效代码发出警告。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">代码质量问题</h4>
<p>无效的代码或从来不被执行的代码很可能是由于代码编写错误所致，会导致未定义的行为。这样的代码在编译期间通常被优化掉，并且会降低代码的可读性。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>理解代码的逻辑，消除无效代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// detect</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第3行中的比较操作是一个无效的代码，这很可能是由于程序员错误地使用了相等操作符==代替了赋值操作符=所致。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第三行中正确地执行将b的值赋值给a。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0128">参数被局部变量隐藏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>参数被局部变量隐藏是指参数和局部变量同名的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>局部变量与函数参数同名时，会使这些函数参数失效，这可能并不是程序员的本意，可能导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>在编写程序时，不应出现局部变量与参数同名。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c1">// 局部变量与函数参数同名</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.28 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0070">内存分配时对指针进行sizeof操作</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">缓冲区溢出</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>使用malloc、calloc或者realloc函数来分配内存的大小会与期望获取的大小不符。这种情况通常发生在sizeof关键字的使用上面。意图使用sizeof计算实际类型的大小，结果却计算了指针的大小。<br/>
这种情况会导致分配内存少于期望分配的大小，最后导致未定义行为，比如缓冲区溢出。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">缓冲区溢出</h4>
<p>内存分配时对指针进行sizeof操作，这种情况会导致分配内存少于期望分配的大小，最后导致未定义行为，比如缓冲区溢出。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>申请内存时正确地计算内存的大小。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">A</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
  <span class="k">struct</span> <span class="n">A</span> <span class="o">*</span><span class="n">ap1</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">A</span><span class="p">));</span>
  <span class="c1">// expected-warning {{Result of 'calloc' is converted to a pointer of type </span>
  <span class="c1">// 'struct A', which is incompatible with sizeof operand type</span>
  <span class="c1">// 'struct A *'}} </span>
  <span class="k">struct</span> <span class="n">A</span> <span class="o">*</span><span class="n">ap2</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ap1</span><span class="p">));</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，内存分配时对指针进行sizeof操作，导致分配内存少于期望分配的大小。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">A</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
  <span class="k">struct</span> <span class="n">A</span> <span class="o">*</span><span class="n">ap1</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">A</span><span class="p">));</span>
  <span class="k">struct</span> <span class="n">A</span> <span class="o">*</span><span class="n">ap2</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">ap1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，申请内存时正确地计算内存的大小。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/numeric errors.html">数值计算错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0112">浮点数的相等或不等比较</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/numeric-errors.html">数值计算错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>两个浮点型或双精度浮点型的值使用"=="或"!="运算符进行比较。</p>
<h1 id="_2">漏洞与风险</h1>
<p>浮点数在计算机中的存储和计算是不精确的，因此对浮点数采用"=="或"!="运算符进行比较可能得到与期望结果相反的结果。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>通过计算两个浮点数之间的差的绝对值是否小于一个允许的误差值判断浮点数之间是否相等或不等。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>  <span class="c1">//浮点数的相等比较</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.000001</span><span class="p">)</span>  <span class="c1">//浮点数的相等比较</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.25 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0117">初始化成员的顺序不正确</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在初始化类中的成员时，跟列表中成员顺序不一致。</p>
<h1 id="_2">漏洞与风险</h1>
<p>初始化列表成员顺序不正确可能导致部分成员未正确初始化。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应按列表成员的次序来初始化各成员。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span>
<span class="p">{</span>
    <span class="n">MyClass1</span> <span class="n">mc1</span><span class="p">;</span>
    <span class="n">MyClass2</span> <span class="n">mc2</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="c1">//初始化成员的顺序与列表中成员顺序不一致</span>
    <span class="n">MyClass</span><span class="p">()</span> <span class="o">:</span> <span class="n">MyClass2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">MyClass1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>  
<span class="p">};</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.6.5 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0007">错误的内存分配方式</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">内存的误用</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>有些时候，程序员使用 <code>malloc(a)+b</code> 或 <code>malloc(a)-b</code> 的方式来申请内存，其实他们的真实想法是调用 <code>malloc(a+b)</code> 或 <code>malloc(a-b)</code>来申请内存。这样的笔误会导致分配过少或过多内存，当执行拷贝数据到这样分配的内存块时，会造成内存写入错误。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">内存的误用</h4>
<p>使用 <code>malloc(a)+b</code> 或 <code>malloc(a)-b</code> 的方式来申请内存，会导致分配过少或过多内存，当执行拷贝数据到这样分配的内存块时，会造成内存写入错误。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用内存分配函数，减少错误的发生。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>  
  <span class="kt">char</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，*p1 和 *p2 都使用了错误的内存分配方式。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span> 
  <span class="kt">char</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，*p1 和 *p2 都使用了正确的内存分配方式。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0126">内置数字类型的宏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>这是典型的编译器为其特定的数据模型和功能提供的“恩惠”数字限制（通常在limits.h中）。跨平台使用这些值是危险的，因为不同编译器提供的限制和宽度可能不同，这可能会导致堆栈溢出，数值上溢或下溢，操作运行时运算枯竭等问题。</p>
<h1 id="_2">漏洞与风险</h1>
<p>可能会导致堆栈溢出，数值上溢或下溢，操作运行时运算枯竭等问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>自定义所需限制，而不是依赖于特定平台的编译器提供的一个抽象数字。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">INT_MAX</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define MY_INT_MAX 65535</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">MY_INT_MAX</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.7 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0059">不正确地使用chroot函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">权限提升</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>程序通过调用chroot()函数创建了一个jail，却并未进一步更换工作路径。该行为并不能够确保程序访问的文件不会超过该限制。
对chroot()的使用不当，会使得攻击者可以跳出chroot所设定的限制。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">权限提升</h4>
<p>攻击者可以跳出chroot所设定的限制，对系统敏感数据进行操作，如删除文件、涂改主页等。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在调用chroot()之后，紧接着调用chdir("/")更换工作路径。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// root changed.</span>
  <span class="n">chroot</span><span class="p">(</span><span class="s">"/usr/local"</span><span class="p">);</span> 
  <span class="c1">// expected-warning {{No call of chdir("/") immediately after chroot}} </span>
  <span class="n">foo</span><span class="p">();</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用chroot()之后，却并未进一步调用chdir("/")更换工作路径。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">chroot</span><span class="p">(</span><span class="s">"/usr/local"</span><span class="p">);</span> <span class="c1">// root changed.</span>
    <span class="n">chdir</span><span class="p">(</span><span class="s">"/"</span><span class="p">);</span>
  <span class="n">foo</span><span class="p">();</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用chroot()之后，紧接着调用chdir("/")更换工作路径。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0072">解引用非法迭代器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对容器的迭代器进行解引用时，当迭代器指向容器的end()或者rend()，都将产生未定义行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>对容器的迭代器进行解引用时，当迭代器指向容器的end()或者rend()，都将产生未定义行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>保证解引用迭代器时，迭代器指向合法区间内。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="o">*</span><span class="n">i</span><span class="p">;</span> <span class="c1">// expected-warning{{Iterator accessed past its end}}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，解引用指向容器end()的迭代器i。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="o">*</span><span class="n">i</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，保证解引用迭代器时，迭代器指向合法区间内。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0020">依赖序列点之间的求值顺序</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">副作用</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>表达式的求值可能产生副作用。在执行期间成为序列点的特定位置，前一次求值的所有副作用都已经完成，而下一个求值的所有副作用还没有发生。不要因副作用而依赖求值的顺序，除非这里要插入一个序列点。</p>
<p>在下面的例子中，如果二元加法表达式 <code>a + (a=2)</code> 左操作数先求值，则b的值为3；如果右操作数先求值，则b的值为4：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">副作用</h4>
<p>表达式的求值可能产生副作用。在执行期间成为序列点的特定位置，前一次求值的所有副作用都已经完成，而下一个求值的所有副作用还没有发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>确保表达式不会因为求值顺序而产生副作用。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">++</span><span class="p">;</span> 
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，函数bad返回值可能为0或1，依赖于x=x++中赋值和自增操作的求值顺序。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">x</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，消除了表达式求值的副作用，函数good返回确定的值1。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0105">在调用函数时对传递的参数进行赋值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在调用函数时对传递的参数进行赋值。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在C标准中求值顺序没有定义，所以在不同的编译器上移植时使用语法捷径可能产生操作影响。这种赋值并不总是一定会发生在函数调用之前，在不同的平台上将产生不同的结果。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不应在调用函数时对传递的参数进行赋值。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">example_fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">example_fun1</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">//在调用函数时对传递的参数进行赋值</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">example_fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">example_fun1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.4  <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0017">子类型重载父类虚方法时const限定符不一致</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">逻辑错误</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>子类型重载父类虚方法时const限定符不一致，则并没有实际的重载操作。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">逻辑错误</h4>
<p>子类型重载父类虚方法时const限定符不一致，则并没有实际的重载操作。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>修改父类或子类的方法声明，统一方法的const限定符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="n">setName</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="cm">/*...*/</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">class</span> <span class="nl">B</span> <span class="p">:</span> <span class="n">public</span> <span class="n">A</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">setName</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span>  <span class="p">{</span> <span class="cm">/* ... */</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，B::setName的本意是重载A::setName，但是在定义B::setName时缺少const限定符，导致重载失败。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="n">setName</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span>  <span class="k">const</span> <span class="p">{</span> <span class="cm">/*...*/</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">class</span> <span class="nl">B</span> <span class="p">:</span> <span class="n">public</span> <span class="n">A</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">setName</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span>  <span class="k">const</span> <span class="p">{</span> <span class="cm">/* ... */</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，给B::setName方法提供const限定符，与A::setName保持一致。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1000">在字符串拷贝函数中存在内存重叠</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>一般而言，memcpy以简单（但快速）的方式实现。简单来说，它只是循环遍历数据（按顺序），从一个位置复制到另一个位置。这可能会导致源在读取时被覆盖。</p>
<h1 id="_2">漏洞与风险</h1>
<p>一般而言，memcpy以简单（但快速）的方式实现。简单来说，它只是循环遍历数据（按顺序），从一个位置复制到另一个位置。这可能会导致源在读取时被覆盖。</p>
<h1 id="_3">缓解与预防</h1>
<p>使用memmove()代替memcpy()执行字符串拷贝。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">a</span><span class="p">[]</span><span class="o">=</span><span class="s">"hare rama hare rama"</span><span class="p">;</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// "hare hare hare hare hare hare rama hare rama"</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">a</span><span class="p">[]</span><span class="o">=</span><span class="s">"hare rama hare rama"</span><span class="p">;</span>
  <span class="n">memmove</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// "hare hare rama hare rama"</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0029">局部变量占栈空间太大</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">软件或系统崩溃</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>一个局部变量在栈上所能申请的最大空间，默认为1024字节。特殊的应用领域例如内核或设备驱动模块，需要有严格的栈空间限制，在这些应用领域中，超出栈空间最大限制会造成严重问题，例如软件或者系统崩溃。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">软件或系统崩溃</h4>
<p>特殊的应用领域例如内核或设备驱动模块，需要有严格的栈空间限制，在这些应用领域中，超出栈空间最大限制会造成严重问题，例如软件或者系统崩溃。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>创建一个局部变量时，该变量在栈上所占用的空间必须小于1024字节。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">16384</span><span class="p">];</span> <span class="c1">// Exceeds max single base use of 1024 bytes</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，数组buf占16384个字节，远远超过了所能申请的最大空间1024字节。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，数组buf占128个字节，小于栈上所能申请的最大空间1024字节。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0073">自我赋值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>自我赋值通常是一个打字错误，可能会导致程序出错或程序功能实现不正确。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>自我赋值通常是一个打字错误，可能会导致程序出错或程序功能实现不正确。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>检查代码逻辑，删除无效的自赋值代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第4行是无效的自赋值代码。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移除无效的自赋值代码。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0109">对BSTR类型的变量进行地址运算</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对BSTR类型的变量进行地址运算。</p>
<h1 id="_2">漏洞与风险</h1>
<p>对BSTR类型的变量进行地址运算可能导致错误的内存访问。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不对BSTR类型的变量进行地址运算。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">a</span><span class="o">++</span><span class="p">;</span>  <span class="c1">//对BSTR类型的变量进行地址运算</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.3.6 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1006">函数调用时参数个数与函数声明参数个数不一致</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>函数调用时如果提供了错误的参数个数，那么正确声明的函数通常会生成编译器诊断消息。 但是，在某些情况下，向函数提供不正确的参数最多只会产生编译器警告。 尽管应该解决这些警告，但它们并不妨碍程序编译。</p>
<h1 id="_2">漏洞与风险</h1>
<p>调用具有不正确参数的函数可能会导致意外或意外的程序行为。</p>
<h1 id="_3">缓解与预防</h1>
<p>函数调用时参数个数与函数声明参数个数保持一致。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
  <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">){</span>
  <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-CERT">
<p>https://wiki.sei.cmu.edu/confluence/display/c/EXP37-C.+Call+functions+with+the+correct+number+and+type+of+arguments.html <a class="footnote-backref" href="#fnref-CERT" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/c.html">C++</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0095">释放空指针</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void free (void* ptr); // Deallocate memory block
</pre></div>
</td></tr></table>
<p>调用free函数用来释放之前通过调用malloc，calloc或realloc分配的内存块，使其可以再次用于进一步的分配。<br/>
如果ptr没有指向使用上述函数分配的内存块，则会导致未定义的行为。<br/>
如果ptr是一个空指针，该函数什么也不做。  </p>
<h1 id="_2">漏洞与风险</h1>
<p>释放空指针是一个无效的操作。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不应该释放一个空指针。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">test</span><span class="p">(){</span>
  <span class="n">free</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，通过free()函数释放了nullptr。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0129">用于控制程序流程的条件表达式结果恒为真或假</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>用于控制程序流程的条件表达式结果恒为真或假。</p>
<h1 id="_2">漏洞与风险</h1>
<p>用于控制程序流程的条件表达式为常量时，代码的部分分支路径永远不会被执行，条件表达式变得毫无意义。当用于控制循环的条件表达式的结果恒为真时，可能导致程序进入死循环。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>消除条件表达式结果恒为真或假的情况。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">()</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//用于控制程序流程的条件表达式"a &gt; 0"恒为真</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.13 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0010">Delete Void类型指针</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在大多数的编译器实现中，使用delete操作来释放一个指向void类型的指针相当于在一块已经释放但是没有调用析构函数的内存块中调用free()函数。依照C++标准，这会导致未定义的行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>删除一个指向void类型的指针相当于在一块已经释放但是没有调用析构函数的内存块中调用free()函数。依照C++标准，这会导致未定义的行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>不要使用delete操作来释放一个指向void类型的指针。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span> 
    <span class="n">delete</span> <span class="n">p</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中使用delete一个指向void类型的指针。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span> 
    <span class="n">delete</span> <span class="n">p</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中使用delete一个指向int类型的指针。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1010">释放使用alloca函数申请的内存</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>alloca()从程序堆栈分配大小字节。分配的空间在调用函数退出时自动释放。因此，不要将由alloca()返回的指针值作为参数传递给free。</p>
<h1 id="_2">漏洞与风险</h1>
<p>释放使用alloca函数申请的内存可能会造成程序崩溃。</p>
<h1 id="_3">缓解与预防</h1>
<p>禁止释放使用alloca函数申请的内存。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">alloca</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>  <span class="c1">//error</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">alloca</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/type and encapsulation.html">类型和封装</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0122">不确定的存储结果</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/type-and-encapsulation.html">类型和封装</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>结构体中成员的字节位置取决于编译器的<code>#pragma align</code>和<code>#pragma pack</code>预处理指令。</p>
<h1 id="_2">漏洞与风险</h1>
<p>结构体中成员的字节位置取决于编译器的<code>#pragma align</code>和<code>#pragma pack</code>预处理指令可能导致代码移植时发生问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>重新调整结构体中成员的顺序，使成员的起始位置和大小不受编译器的<code>#pragma align</code>和<code>#pragma pack</code>预处理指令影响。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ST</span> 
<span class="p">{</span>
    <span class="n">UINT16_t</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">UINT32_t</span> <span class="n">b</span><span class="p">;</span>  <span class="c1">//b成员可能从结构体的第3个字节开始，也可能从第5个字节开始</span>
    <span class="n">UINT16_t</span> <span class="n">c</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ST</span> 
<span class="p">{</span>
     <span class="n">UINT16_t</span> <span class="n">a</span><span class="p">;</span>
     <span class="n">UINT16_t</span> <span class="n">b</span><span class="p">;</span>
     <span class="n">UINT32_t</span> <span class="n">c</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.3.20 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/memory and resource misuse.html">内存和资源误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0056">越界访问数组</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/memory-and-resource-misuse.html">内存和资源误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">程序崩溃</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当程序访问一个数组中的元素时，如果索引值超出数组的长度，就会访问数组之外的内存，从而导致程序崩溃。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">程序崩溃</h4>
<p>数组越界会导致程序崩溃。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_5">缓解与预防</h1>
<p>访问数组元素之前检测索引值是否超出数组的长度。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第3行中索引值4超出了数组的长度，导致数组越界。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用数组长度范围内的索引值。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                <a href="../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0069">不正确地使用UNIX/Posix库函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在使用以下UNIX/Posix库函数时，需要遵循指定的规则：<br/>
<code>open, openat, pthread_once, calloc, malloc, realloc, reallocf, alloca, __builtin_alloca, __builtin_alloca_with_align, valloc</code>。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>不正确地使用UNIX/Posix库函数，可能会造成意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用UNIX/Posix库函数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">mode</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
  <span class="c1">// expected-warning{{Call to 'open' with more than 3 arguments}}</span>
  <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> 
  <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，不正确地使用open函数，因为调用open函数时，传递了4个参数，超出open函数参数个数限制。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
  <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span> <span class="c1">// no-warning</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地使用open函数。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0005">不正确地释放COM接口指针</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">使用释放过的内存</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>COM组件指明必须使用AddRef或Release方法管理接口指针。显式地释放一个接口指针并没有修改指针的引用计数，这样会导致其它拥有这个指针权限的接口继续使用该释放的指针，可能会造成使用释放内存的缺陷。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">使用释放过的内存</h4>
<p>显式地释放一个接口指针并没有修改指针的引用计数，这样会导致其它拥有这个指针权限的接口继续使用该释放的指针，可能会造成使用释放内存的缺陷。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用AddRef或Release方法管理接口指针。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">IUnknown</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CFoo</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// bad</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第3行代码中显式地释放接口指针p。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">IUnknown</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CFoo</span><span class="p">;</span>
  <span class="n">p</span><span class="o">-&gt;</span><span class="n">AddRef</span><span class="p">();</span> <span class="c1">// p-&gt;Release();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第3行代码调用方法AddRef()来管理接口指针p。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0015">使用不安全的库函数创建临时文件</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">外部攻击</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>很多程序在共享目录(例如/tmp)下面创建临时文件，但是很多C语言库函数mktemp，tmpnam，tempnam，tmpfile创建出来的临时文件并不是安全的。如果一个临时文件的名字很容易被猜测到，攻击者就可以通过这个临时文件获取程序的权限，做一些非法操作。</p>
<p>避免使用这些不安全的库函数，可以使用安全的mkstemp函数来创建临时文件。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">外部攻击</h4>
<p>如果一个临时文件的名字很容易被猜测到，攻击者就可以通过这个临时文件获取程序的权限，做一些非法操作。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用安全的mkstemp函数来创建临时文件。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">mktemp</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用不安全的库函数mktemp创建临时文件。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"a.txt"</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">mkstemp</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用安全的库函数mkstemp创建临时文件。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../standard/objective-c.html">objective-c</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../subcategory/objective-c/quality issues/api abuse.html">API误用</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0028">错误的使用sleep函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../category/api-abuse.html">API误用</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">不可预知的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在对锁进行释放动作前，调用了sleep()等阻塞函数。由于在程序运行中，可能会有其他的线程对该锁控制的资源进行等待，锁释放前的对sleep()等阻塞函数的调用，会造成全系统的阻塞。在对锁进行释放动作前调用阻塞函数可能会造成不可预知的行为，应避免在对锁进行释放动作前调用阻塞函数。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">不可预知的行为</h4>
<p>在对锁进行释放动作前，调用了sleep()等阻塞函数。由于在程序运行中，可能会有其他的线程对该锁控制的资源进行等待，锁释放前的对sleep()等阻塞函数的调用，会造成全系统的阻塞。在对锁进行释放动作前调用阻塞函数可能会造成不可预知的行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>避免在对锁进行释放动作前调用阻塞函数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">30000</span><span class="p">);</span>       <span class="c1">// detect</span>
    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第5行对锁进行释放动作前，调用了sleep()阻塞函数。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
    <span class="c1">//...</span>
    <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在对锁进行释放动作前，移除sleep函数。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../tag/c.html">C</a>
                <a href="../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Pinpoint 源代码静态缺陷分析系统, 源伞科技有限公司 - 保留所有权利
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : "../..",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>