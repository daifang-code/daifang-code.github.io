
<!DOCTYPE html>
<html lang="zh">

<head>
    <link href='../../../theme/fonts/googleapis.css' rel='stylesheet' type='text/css'>
    <link href="../../../theme/stylesheet/normalize.min.css">
    <script src="../../../theme/javascript/jquery.min.js"></script>
    <script type="text/javascript" src="../../../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../../../theme/tipuesearch/css/tipuesearch.css">
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="../../../theme/tipuesearch/tipuesearch.js"></script>

        <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.css">

    <link rel="stylesheet" type="text/css"
          href="../../../theme/pygments/xcode.min.css">
    <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/font-awesome.min.css">





    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <meta name="robots" content=""/>      <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">      <meta name="author" content="Pinpoint Team"/>
    <meta name="description" content="Manual and documents for Sourcebrella Pinpoint"/> <meta property="og:site_name" content="Pinpoint Document"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Pinpoint Document"/>
<meta property="og:description" content="Manual and documents for Sourcebrella Pinpoint"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../.."/>
 
    <title>Pinpoint Document &ndash; Category</title>

</head>

<body style="display: none;">

<aside>
    <div>
        <a href="../../..">
                <img src="../../../theme/img/profile.png" alt="Pinpoint Document" title="Pinpoint Document">
        </a>
        <h1><a href="../../..">Pinpoint Document</a></h1>

        <div style="padding-left: 0">
            <form action="../../../search.html" onsubmit="return validateForm(this.elements['q'].value);">
                <input id="tipue_search_input" type="text" name="q" placeholder="输入以搜索">
            </form>
        </div>


        <ul class="global_lang">
                    <li><a href="javascript:void(0);"
                                                                                  language-link="en">en</a>
                    </li>
                    <li class="active"><a href="javascript:void(0);"
                                                                                  language-link="zh">zh</a>
                    </li>
        </ul>

        <!--  -->

        <nav>
            <ul class="list">
                    <li>
                        <a href="../../../standard/language-independent.html">Language Independent 缺陷文档</a>
                        (3)
                    </li>
                    <li>
                        <a href="../../../standard/c.html">c/c++ 缺陷文档</a>
                        (316)
                    </li>
                    <li>
                        <a href="../../../standard/csharp.html">csharp 缺陷文档</a>
                        (39)
                    </li>
                    <li>
                        <a href="../../../standard/golang.html">golang 缺陷文档</a>
                        (34)
                    </li>
                    <li>
                        <a href="../../../standard/java.html">java 缺陷文档</a>
                        (555)
                    </li>
                    <li>
                        <a href="../../../standard/javascript.html">javascript 缺陷文档</a>
                        (295)
                    </li>
                    <li>
                        <a href="../../../standard/objective-c.html">objective-c 缺陷文档</a>
                        (124)
                    </li>
                    <li>
                        <a href="../../../standard/php.html">php 缺陷文档</a>
                        (58)
                    </li>
                    <li>
                        <a href="../../../standard/python.html">python 缺陷文档</a>
                        (618)
                    </li>
                    <li>
                        <a href="../../../standard/swift.html">swift 缺陷文档</a>
                        (26)
                    </li>

            </ul>
        </nav>

        <ul class="social">
        </ul>
    </div>


</aside>
<main>
          <article>
            <h1>
            逻辑错误 (39)
            </h1>
        </article>
        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0115">不一致的case标签</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>指多个枚举类型用于同一个"switch"语句中或在"switch"标签语句中，case标签不一致的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>不一致的case标签通常是由于打字错误导致，可能导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>如switch条件中的变量类型为枚举类型，则case标签应为该枚举类型的枚举成员。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="n">A</span><span class="p">{</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">}</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">B</span><span class="p">{</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">}</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">case</span> <span class="nl">b1</span><span class="p">:</span> <span class="p">...;</span> <span class="k">break</span><span class="p">;</span>  <span class="c1">//不一致的case标签</span>
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="n">A</span><span class="p">{</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">}</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">B</span><span class="p">{</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">}</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">case</span> <span class="nl">a1</span><span class="p">:</span> <span class="p">...;</span> <span class="k">break</span><span class="p">;</span> 
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.13 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0024">Dangling else语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#else">悬挂"else"语句</a></li>
</ul>
</li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>花括号保证代码的一致性和可读性。更重要的是，当向执行体中插入一条语句时仅需要插入这条语句就可以了，同时如果忘记添加花括号的话，因为错误的代码缩进可能导致Dangling else语句，使得难以理解代码的逻辑结构。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="else">悬挂"else"语句</h4>
<p>在下面的例子重，很明显开发者的意图是condition1为false时执行do_something_else()。但是由于if语句的执行体缺少花括号，导致do_something_else()在condition1为true，condition2为false时执行，程序的逻辑并没有按照开发者的意图执行。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition1</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">condition2</span><span class="p">)</span>
    <span class="n">do_something</span><span class="p">();</span>
<span class="k">else</span> <span class="c1">// "dangling"</span>
  <span class="n">do_something_else</span><span class="p">();</span>
</pre></div>
</td></tr></table>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>对if语句始终使用花括号，即使语句执行体只有一条语句。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">cond1</span><span class="p">();</span>
<span class="kt">bool</span> <span class="nf">cond2</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something_else</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cond1</span><span class="p">())</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">cond2</span><span class="p">())</span>
      <span class="n">do_something</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="n">do_something_else</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，if和else语句的执行体缺少花括号。</p>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">cond1</span><span class="p">();</span>
<span class="kt">bool</span> <span class="nf">cond2</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something_else</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cond1</span><span class="p">()){</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">cond2</span><span class="p">()){</span>
      <span class="n">do_something</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">do_something_else</span><span class="p">();</span>
  <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，给每一个if和else语句的执行体都添加花括号。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0100">宏定义参数时括号缺失</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>用宏定义的参数没有使用括号。 </p>
<h1 id="_2">漏洞与风险</h1>
<p>当某表达式传递给该参数的时，可能产生错误的结果。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>用宏定义参数时应使用括号。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define TRIPLE(a) (a*3)</span>
<span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// TRIPLE(a + 5)转换为（a + 5*3），与原意不符</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">TRIPLE</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define TRIPLE(a) ((a)*3)</span>
<span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">TRIPLE</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.29 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0125">忽略采用typedef定义的抽象类型</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在对采用typedef定义的抽象类型的变量进行赋值、参数传递或运算时，忽略采用typedef定义的抽象类型而直接使用相应的基本类型进行操作。</p>
<h1 id="_2">漏洞与风险</h1>
<p>忽略采用typedef定义的抽象类型而直接使用相应的基本类型进行操作可能存在逻辑错误。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>当采用typedef定义的抽象类型的变量需要与其他类型的变量进行赋值、参数传递或运算时，对类型进行强制转换。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>  <span class="c1">//A类型的变量赋值给B类型的变量</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="n">A</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">B</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">A</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="n">a</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.27 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0075">构造函数或析构函数中调用虚函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>从构造器或析构器直接或间接的调用虚函数。由于对象的构造顺序从父类开始，然后是派生类，在构造过程中，尝试从父类调用派生类的方法是危险的。这就是为什么从构造器中调用虚函数不会导致在派生类中的函数被调用，在这个过程中，派生类对象尚未被初始化。类似地，对象会以构造的相反顺序被销毁，因此，在析构器中尝试调用派生类中的函数，会导致访问已经被销毁了的对象。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>从构造器或析构器直接或间接的调用虚函数。由于对象的构造顺序从父类开始，然后是派生类，在构造过程中，尝试从父类调用派生类的方法是危险的。这就是为什么从构造器中调用虚函数不会导致在派生类中的函数被调用，在这个过程中，派生类对象尚未被初始化。类似地，对象会以构造的相反顺序被销毁，因此，在析构器中尝试调用派生类中的函数，会导致访问已经被销毁了的对象。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>不在构造函数或析构函数中调用虚函数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">A</span><span class="p">(){</span> <span class="n">f</span><span class="p">();</span> <span class="p">};</span>
  <span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>

  <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{};</span>

  <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// from Sema: expected-note {{'foo' declared here}}</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Call to pure virtual function during construction has undefined behavior</span>
    <span class="n">foo</span><span class="p">();</span> 
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在类A的构造函数中调用虚函数foo()。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">A</span><span class="p">(){};</span>
  <span class="n">A</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>

  <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{};</span>

  <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">foo</span><span class="p">();</span> 
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移除类A的构造函数中对虚函数foo()的调用。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0127">实参与形参顺序不一致</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>调用函数时，传递的实参与形参顺序不一致。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当调用函数时，传递的实参与形参顺序不一致会导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>调用函数时，传递的实参与形参顺序保持一致。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">authenticate</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">username</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="c1">// 验证用户名和密码的正确性</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">exampleFun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>  <span class="c1">//传递的实参与形参顺序不一致。</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">authenticate</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">username</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="c1">// 验证用户名和密码的正确性</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">exampleFun</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.4.5 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0113">过时的implicit int</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在声明函数或变量时，使用了过时的"implicit int"规则。</p>
<h1 id="_2">漏洞与风险</h1>
<p>当一个变量未被指定所属类型时，默认的是"int"型，但现代C++已不再支持此规则，可能导致代码难以移植。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>在声明函数或变量时，应指定变量或函数返回值的类型。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// 未声明常量的类型</span>
<span class="n">example_fun</span><span class="p">()</span>    <span class="c1">// 未声明函数返回值的类型</span>
<span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
<span class="kt">int</span> <span class="nf">example_fun</span><span class="p">()</span>    
<span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.30 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0023">缺少break语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>一个switch语句包含好几个case标签和一个default标签。default标签是可选的，但是推荐使用default标签。按照惯例，在case标签后面跟着一系列语句之后会有一个break语句结束。如果省略了break语句，控制流会进入switch语句块中的下一个case标签中。由于break语句不是必需的，省略它不会产生一个编译诊断信息。如果这种省略不是程序员所希望的，这会产生一个出乎意料的控制流。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的行为</h4>
<p>如果在swith语句的标签中省略了break语句，控制流会进入switch语句块中的下一个case标签中，导致连续的执行分支逻辑，产生错误结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>应确保default分支和每个语句不为空的case分支结尾有break语句。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="c1">// Defect: Missing break statement in this case</span>
    <span class="n">foo</span><span class="p">();</span>
  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，case 2标签中缺少break语句，控制流会进入case 3。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">what</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在case 2标签中添加合适的break语句。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0114">迭代时使用不正确的容器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>迭代器分配给了一个容器后却在另一个容器中使用该迭代器的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在不适合的容器上使用迭代器会导致未定义的行为发生。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>应注意迭代器的使用范围和有效性。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">b</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">b</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.15 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0124">自身相除或比较</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在表达式中变量与自己相除或作比较。</p>
<h1 id="_2">漏洞与风险</h1>
<p>自身相除或比较通常不是程序的本意，程序中可能存在打字错误，自身相除可能导致程序出错或程序功能实现不正确，自身比较可能导致部分代码永远不会被执行。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>修复程序中存在的打字错误。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span>   <span class="c1">//a&lt;a恒为假</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.11 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0012">字符串数组初始化中缺少逗号</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在字符串数组初始化中，各个字符串之间缺少逗号分隔符。可能会生成一个串联的字符串，而不是分割的字符串元素，导致意料之外的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>生成一个串联的字符串，而不是分割的字符串元素，导致意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在字符串数组初始化中，使用逗号分隔符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">arr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello "</span> <span class="c1">// bad</span>
               <span class="s">"world"</span><span class="p">};</span>     
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行的字符串数组arr初始化时，缺少逗号分隔符，导致数组arr中只有一个<code>"a string literalanother string literal"</code>元素，而非预期的两个元素。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">arr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello "</span><span class="p">,</span>
               <span class="s">"world"</span><span class="p">};</span>     
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行初始化字符串数组时，使用逗号分隔符。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0046">未检测函数返回值为负数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">程序崩溃</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。错误的将函数返回值直接用作数组下标，循环变量等情况，而没有验证其是否为负数，可能会导致程序崩溃，死循环，整型溢出等问题。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">程序崩溃</h4>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。错误的将函数返回值直接用作数组下标，循环变量等情况，而没有验证其是否为负数，可能会导致程序崩溃，死循环，整型溢出等问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>对于可能返回负数的函数，在使用函数的返回值之前必须检测其是否为负数。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">some_function</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">();</span> <span class="c1">// some_function() might return -1</span>
  <span class="n">buff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Defect: buffer underrun at buff[-1]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，some_function()可能会返回一个负数，在第5行将返回值用作数组下标时，导致缓冲区溢出问题。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">some_function</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">();</span> <span class="c1">// some_function() might return -1</span>
  <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">buff</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在使用some_function()的返回值作为数组下标之前，确保返回值一定为非负数。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0039">死循环</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">拒绝服务攻击</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在循环体中，如果循环变量不改变，则永远无法退出循环，导致程序死循环。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">拒绝服务攻击</h4>
<p>死循环会导致程序挂起或者崩溃，过多的使用CPU或内存资源，可能会导致拒绝服务攻击。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>在循环体中修改循环变量的值，避免死循环。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">global_var</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">global_var</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，循环变量global_var的值在while循环中不会被改变，永远为10，导致死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">global_var</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">global_var</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
        <span class="n">global_var</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，在while循环中修改了global_var的值，从而可以使程序退出while循环。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0016">多余的分号</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">逻辑错误</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>当一个if语句被分号提前终止时，then语句将永远被执行，从而改变了if语句的逻辑。在while,for等循环语句被分号提前终止时，可能会导致死循环或者循环体部分只被执行一次。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">逻辑错误</h4>
<p>当一个if语句被分号提前终止时，then语句将永远被执行，从而改变了if语句的逻辑。在while,for等循环语句被分号提前终止时，可能会导致死循环或者循环体部分只被执行一次。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>仔细检查if，for，while语句后面的逗号，移除多余的分号。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">){};</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// detect</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第4行while语句后面存在一个多余的分号，导致死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">){};</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第4行移除while语句后面的分号，使得程序逻辑正常执行。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0009">I/O 库函数返回值错误</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">数据截断</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>库函数fgetc()，getc()，getchar()和istream::get()返回一个int类型的值，而不是char类型的值。将这些函数的返回值赋给一个char类型的值时，可能会造成数据截断。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">数据截断</h4>
<p>在大部分系统中，int类型都比char类型在内存中的字节数要大，将一个int类型转为char类型可能会造成数据截断。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用int类型的变量接收库函数fgetc()，getc()，getchar()和istream::get()的返回值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第3行中将getc()函数的返回值赋给一个char类型的变量可能会造成数据截断。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第3行中将getc()函数的返回值赋给一个int类型的变量。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0014">函数缺少返回值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">出乎意料的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>返回非void类型的函数在某条路径上缺少返回值，会导致出乎意料的程序行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">出乎意料的行为</h4>
<p>返回非void类型的函数在某条路径上缺少返回值，会导致出乎意料的程序行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>在返回非void类型的函数的每条路径上都提供返回值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// missing_return</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，当x的值既不等于5，也不等于3时，函数bad缺少返回值。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>
<p>在上面的代码中，在函数的最后提供了返回值0。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/csharp.html">CSHARP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0110">条件判别成立时相应分支无执行语句</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>条件判别成立时相应分支无任何执行语句。</p>
<h1 id="_2">漏洞与风险</h1>
<p>这通常不是程序的本意，可能是由于疏忽而遗漏掉了语句，可能会导致程序出错或程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>条件判别成立时相应分支不能为空。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">//条件判别成立时相应分支无执行语句</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">a</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.10 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0052">布尔类型变量赋值错误</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">移植性问题</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>布尔类型的数据拥有值1（true）或0（false），但是依赖于ANSI的赋值规则，从而非常灵活的，并且允许布尔类型为一个整型。但在不同程度灵活性的编译器之间移植时可能会产生问题，所以规定最多分配一个字节给布尔类型的变量。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">移植性问题</h4>
<p>给布尔类型的变量所赋的值大于一个字节，在不同程度灵活性的编译器之间移植时可能会产生问题。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>不应与其他整型数据交换布尔数据。C++标准定义布尔类型关键字"true"和"false"来分别表示整型值1和0。此外，许多编译器定义了TRUE和FALSE的宏或合适的占位符，或者自定义值。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">char</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将256赋值给布尔类型变量a。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">char</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">BOOL</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，将true赋值给布尔类型变量a。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0011">枚举值用作布尔值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义的行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在某些情况下，程序员将枚举值误用作布尔值作为条件判断，使得条件恒为真或恒为假，结果可能与程序员的意愿不符，导致未定义的行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义的行为</h4>
<p>将枚举值误用作布尔值作为条件判断，可能会导致未定义的行为发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>不要将枚举值用作布尔值进行条件判断。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">color</span> <span class="p">{</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">color</span> <span class="n">c</span> <span class="o">=</span> <span class="n">green</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1">// detect</span>
  <span class="p">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">red</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第6行中使用枚举值c作为if的条件判断，结果恒为真。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">color</span> <span class="p">{</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">color</span> <span class="n">c</span> <span class="o">=</span> <span class="n">green</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">green</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">red</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第6行中使用布尔表达式作为if的条件判断。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0116">无限递归函数</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>方法在没有做任何条件检查的情况下直接或间接调用自身。</p>
<h1 id="_2">漏洞与风险</h1>
<p>无限递归会导致程序栈溢出。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>消除无限递归。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">this</span><span class="p">.</span><span class="n">example_fun</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="c1">//无限递归</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.8.2 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0048">克隆代码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">意料之外的结果</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在拷贝粘贴代码块时，某些需要修改的实例，由于程序员的手误，导致这些实例没有被修改，导致程序产生意料之外的结果。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">意料之外的结果</h4>
<p>在拷贝粘贴代码块时，某些需要修改的实例，由于程序员的手误，导致这些实例没有被修改，导致程序产生意料之外的结果。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地执行拷贝粘贴代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CopyPasteBad</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">square</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">example</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// "square(a)" should read "square(b)"</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第11行本来应该使用变量b，在拷贝粘贴过程中并没有修改这个实例，导致程序执行结果有误。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CopyPasteGood</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">square</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">example</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">square</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，正确地执行拷贝粘贴代码。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0013">类中缺少显式的拷贝构造函数或赋值操作符</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">野指针</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在某些状况下，类内成员变量需要动态开辟堆内存，如果实行位拷贝（浅拷贝），也就是把对象里的值完全复制给另一个对象，如A=B。这时，如果B中有一个成员变量指针已经申请了内存，那A中的那个成员变量也指向同一块内存。这就出现了问题：当B把内存释放了（如：析构），这时A内的指针就是野指针了，出现运行错误。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">野指针</h4>
<p>类中缺少显式的拷贝构造函数或赋值操作符，可能在拷贝或赋值的过程中产生野指针。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>提供显式的拷贝构造函数或赋值操作符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">bad</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">bad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">_strdup</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{}</span>
  <span class="o">~</span><span class="n">bad</span><span class="p">()</span> <span class="p">{</span> <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// no copy constructor at all</span>
  <span class="c1">// no assignment operator at all</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">operator</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">str</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，类bad中包含指针成员变量p，但是缺少显式的拷贝构造函数或赋值操作符。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">good</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="c1">// copy constructor</span>
  <span class="n">good</span><span class="p">(</span><span class="k">const</span> <span class="n">good</span> <span class="o">&amp;</span><span class="n">init</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">){</span>
      <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">init</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">init</span><span class="p">.</span><span class="n">p</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// assignment operator</span>
  <span class="n">good</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">good</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">){</span>
        <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">strcpy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="o">~</span><span class="n">good</span><span class="p">()</span> <span class="p">{</span> <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">operator</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">str</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，类good中包含指针成员变量p，并且提供了显式的拷贝构造函数和赋值操作符。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1041">switch语句的重复操作</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
<li><a href="#_3">演示实例</a><ul>
<li><a href="#_4">漏洞代码示例</a></li>
<li><a href="#_5">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在switch语句中存在多余的位操作。</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_3">演示实例</h1>
<h3 id="_4">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="k">switch</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>        <span class="c1">// &lt;- this assignment is redundant</span>
         <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>        <span class="c1">// &lt;- case 2 falls through and sets y twice</span>
     <span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，case 2设置了y的值两次。</p>
<h3 id="_5">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
       <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span><span class="k">break</span><span class="p">;</span>        
      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
       <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span><span class="k">break</span><span class="p">;</span>        
  <span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，case 2将y的值设为2后跳出switch。</p>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-sourceforge">
<p>http://cppcheck.sourceforge.net/devinfo/doxyoutput/checkother_8cpp_source.html#l00732 <a class="footnote-backref" href="#fnref-sourceforge" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0008">函数地址与0作比较</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">逻辑错误</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在条件判断中将函数的地址与0作比较时，因为函数的地址不可能为0，所以这样的比较结果通常为恒定值false。这种情况大多数时由于程序员笔误导致的。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">逻辑错误</h4>
<p>将函数地址与0作比较，结果恒为false，这可能与程序员的预期行为不一致，导致逻辑上的错误。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>将函数的返回值与0作比较。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">malloc</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bad */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中将strlen函数地址与0作比较，结果恒为false。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* good */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第2行中将strlen函数的返回值与0作比较。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0018">传参CComBSTR或CComPtr对象的地址导致内存泄漏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">内存泄漏</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>局部非静态CComBSTR和CComPtr变量内部包含一个指向非空字符串的指针。当变量的地址作为参数传给一个函数时，内部指针所指向的值可能会被修改，导致内存泄漏。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">内存泄漏</h4>
<p>局部非静态CComBSTR和CComPtr变量内部包含一个指向非空字符串的指针。当变量的地址作为参数传给一个函数时，内部指针所指向的值可能会被修改，导致内存泄漏。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>高</p>
<h1 id="_5">缓解与预防</h1>
<p>在函数调用时，传递CComBSTR和CComPtr变量而非他们的地址。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">Base</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="c1">// \pName is a pointer</span>
  <span class="kt">void</span> <span class="n">getName</span><span class="p">(</span><span class="n">BSTR</span> <span class="o">*</span><span class="n">pName</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
    <span class="o">*</span><span class="n">pName</span> <span class="o">=</span> <span class="o">::</span><span class="n">SysAllocString</span><span class="p">(</span><span class="n">name_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">LPCOLESTR</span> <span class="n">name_</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Release</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="n">CComBSTR</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="k">const</span> <span class="n">Base</span> <span class="o">&amp;</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CComBSTR</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="sa">L</span><span class="s">"Lucky"</span><span class="p">;</span>
  <span class="n">base</span><span class="p">.</span><span class="n">getName</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，重载的取地址操作符(&amp;)返回name对象内部的指针，在被调用的方法Base::getName()中，指针所指向的内存在没有被释放的情况下被重新赋值，导致内存泄漏。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">class</span> <span class="n">Base</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="c1">// \pName is a value</span>
  <span class="kt">void</span> <span class="n">getName</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">pName</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
      <span class="n">pName</span> <span class="o">=</span> <span class="o">::</span><span class="n">SysAllocString</span><span class="p">(</span><span class="n">name_</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">LPCOLESTR</span> <span class="n">name_</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Release</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="n">CComBSTR</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="k">const</span> <span class="n">Base</span> <span class="o">&amp;</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CComBSTR</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="sa">L</span><span class="s">"Lucky"</span><span class="p">;</span>
  <span class="n">base</span><span class="p">.</span><span class="n">getName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在调用方法customer.getName()时传递一个name对象。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0067">变量赋值后未使用</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">无效代码</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>变量在下一次赋值操作或函数结束之前没有被使用过，那么这样的赋值或初始化实际上是无效的。这样的编码方式可能会引入逻辑错误。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">无效代码</h4>
<p>变量在下一次赋值操作或函数结束之前没有被使用过，那么这样的赋值或初始化实际上是无效的。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>移除无效的代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// Value stored to x is never read.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第3行的赋值语句是无效代码。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，移除无效代码。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0004">不正确地使用sizeof</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">未定义行为</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在代码中使用memset函数来重置内存的值会与期望获取的大小不符。这种情况通常发生在sizeof关键字的使用上面。意图使用sizeof计算实际类型的大小，结果却计算了指针的大小。这种情况会导致重置内存少于期望重置的大小，最后导致未定义行为。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">未定义行为</h4>
<p>使用sizeof计算实际类型的大小，结果却计算了指针的大小，可能会导致未定义的行为。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_5">缓解与预防</h1>
<p>正确地使用sizeof操作符。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">BB</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">BB</span> <span class="n">buf</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">));</span> <span class="c1">// bad</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码调用memset时，使用sizeof(&amp;buf)而非sizeof(buf)来获取结构体buf的bytes，100个bytes中只有4个或8个bytes被置为0。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">BB</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">BB</span> <span class="n">buf</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span> <span class="c1">// good</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码调用memset时，正确地使用sizeof(buf)来获取结构体buf的bytes，100个bytes都会被置为0。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/csharp.html">CSHARP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0068">使用浮点变量作为循环计数器</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">死循环</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>由于浮点数可以表示实数，因此程序员常常错误地认为它们可以准确地表示任何简单的小数。浮点数也和整数一样受到精度的限制，二进制浮点数无法准确地表示所有的十进制小数，即使后者只用几个十进制数字就可以表示。</p>
<p>不同的实现具有不同的精度限制，为了使代码保持可移植性，不应该使用浮点数作为循环计数器。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">死循环</h4>
<p>使用浮点数作为循环计数器，可能会导致循环无法终止，造成死循环。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>严重</p>
<h1 id="_5">缓解与预防</h1>
<p>使用整数作为循环计数器。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(;</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span><span class="n">a</span><span class="o">++</span><span class="p">){</span>
    <span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用浮点数变量a作为循环计数器，可能会造成死循环。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(;</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span><span class="n">a</span><span class="o">++</span><span class="p">){</span>
    <span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，使用int型变量a作为循环计数器。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1042">无用参数赋值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞利用威胁</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">演示实例</a><ul>
<li><a href="#_5">漏洞代码示例</a></li>
<li><a href="#_6">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>参数在函数中被修改但修改对外不可见，请检查是否这里的修改应该对外可见，也许应该传引用或者指针而不是传值。</p>
<h1 id="_2">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_3">缓解与预防</h1>
<p>参数在函数中被修改但修改对外不可见时应该传引用或者指针而不是传值。</p>
<h1 id="_4">演示实例</h1>
<h3 id="_5">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">){</span> 
    <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，参数在函数中被修改但修改对外不可见采用传值。</p>
<h3 id="_6">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">){</span> 
    <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> 
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，为保证修改对外可见采用传引用。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0041">无效的代码</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">代码质量问题</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>无效的代码很可能是由于代码编写错误所致，会导致未定义的行为。这样的代码在编译期间通常被优化掉。但是，为了提高可读性并保证逻辑错误能够解决，应该标识、理解并消除无效代码。</p>
<p>没有效果的语句或表达式应该从代码中标识并删除。大多数现有的编译器可以对许多情况下的无效代码发出警告。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">代码质量问题</h4>
<p>无效的代码或从来不被执行的代码很可能是由于代码编写错误所致，会导致未定义的行为。这样的代码在编译期间通常被优化掉，并且会降低代码的可读性。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>理解代码的逻辑，消除无效代码。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// detect</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，第3行中的比较操作是一个无效的代码，这很可能是由于程序员错误地使用了相等操作符==代替了赋值操作符=所致。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，在第三行中正确地执行将b的值赋值给a。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0128">参数被局部变量隐藏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>参数被局部变量隐藏是指参数和局部变量同名的现象。</p>
<h1 id="_2">漏洞与风险</h1>
<p>局部变量与函数参数同名时，会使这些函数参数失效，这可能并不是程序员的本意，可能导致程序功能实现不正确。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>在编写程序时，不应出现局部变量与参数同名。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>     <span class="c1">// 局部变量与函数参数同名</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.28 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0126">内置数字类型的宏</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>这是典型的编译器为其特定的数据模型和功能提供的“恩惠”数字限制（通常在limits.h中）。跨平台使用这些值是危险的，因为不同编译器提供的限制和宽度可能不同，这可能会导致堆栈溢出，数值上溢或下溢，操作运行时运算枯竭等问题。</p>
<h1 id="_2">漏洞与风险</h1>
<p>可能会导致堆栈溢出，数值上溢或下溢，操作运行时运算枯竭等问题。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>自定义所需限制，而不是依赖于特定平台的编译器提供的一个抽象数字。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">INT_MAX</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define MY_INT_MAX 65535</span>
<span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">MY_INT_MAX</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.7 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0020">依赖序列点之间的求值顺序</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">副作用</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>表达式的求值可能产生副作用。在执行期间成为序列点的特定位置，前一次求值的所有副作用都已经完成，而下一个求值的所有副作用还没有发生。不要因副作用而依赖求值的顺序，除非这里要插入一个序列点。</p>
<p>在下面的例子中，如果二元加法表达式 <code>a + (a=2)</code> 左操作数先求值，则b的值为3；如果右操作数先求值，则b的值为4：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</td></tr></table>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">副作用</h4>
<p>表达式的求值可能产生副作用。在执行期间成为序列点的特定位置，前一次求值的所有副作用都已经完成，而下一个求值的所有副作用还没有发生。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>确保表达式不会因为求值顺序而产生副作用。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">++</span><span class="p">;</span> 
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，函数bad返回值可能为0或1，依赖于x=x++中赋值和自增操作的求值顺序。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">x</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面的代码中，消除了表达式求值的副作用，函数good返回确定的值1。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0105">在调用函数时对传递的参数进行赋值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞修复代码示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>在调用函数时对传递的参数进行赋值。</p>
<h1 id="_2">漏洞与风险</h1>
<p>在C标准中求值顺序没有定义，所以在不同的编译器上移植时使用语法捷径可能产生操作影响。这种赋值并不总是一定会发生在函数调用之前，在不同的平台上将产生不同的结果。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不应在调用函数时对传递的参数进行赋值。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">example_fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">example_fun1</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">//在调用函数时对传递的参数进行赋值</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞修复代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">example_fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">example_fun1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> 
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.2.4  <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0109">对BSTR类型的变量进行地址运算</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
</ul>
</li>
<li><a href="#_7">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>对BSTR类型的变量进行地址运算。</p>
<h1 id="_2">漏洞与风险</h1>
<p>对BSTR类型的变量进行地址运算可能导致错误的内存访问。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>不对BSTR类型的变量进行地址运算。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span><span class="p">(</span><span class="n">BSTR</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">a</span><span class="o">++</span><span class="p">;</span>  <span class="c1">//对BSTR类型的变量进行地址运算</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_7">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.3.6 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0129">用于控制程序流程的条件表达式结果恒为真或假</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#_6">漏洞代码示例</a></li>
<li><a href="#_7">漏洞代码修复示例</a></li>
</ul>
</li>
<li><a href="#_8">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>用于控制程序流程的条件表达式结果恒为真或假。</p>
<h1 id="_2">漏洞与风险</h1>
<p>用于控制程序流程的条件表达式为常量时，代码的部分分支路径永远不会被执行，条件表达式变得毫无意义。当用于控制循环的条件表达式的结果恒为真时，可能导致程序进入死循环。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>低</p>
<h1 id="_4">缓解与预防</h1>
<p>消除条件表达式结果恒为真或假的情况。</p>
<h1 id="_5">演示实例</h1>
<h3 id="_6">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">()</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//用于控制程序流程的条件表达式"a &gt; 0"恒为真</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h3 id="_7">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">example_fun</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<h1 id="_8">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-hangbiao">
<p>SJ/T 11682-2017 6.5.13 <a class="footnote-backref" href="#fnref-hangbiao" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0002">忽略函数返回值</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#1">不可预测的行为 1</a></li>
</ul>
</li>
<li><a href="#_3">漏洞利用威胁</a></li>
<li><a href="#_4">缓解与预防</a></li>
<li><a href="#_5">演示实例</a><ul>
<li><a href="#1c">漏洞代码示例1(C)</a></li>
<li><a href="#1c_1">漏洞代码修复示例1(C)</a></li>
<li><a href="#2java">漏洞代码示例2(JAVA)</a></li>
<li><a href="#2java_1">漏洞代码修复示例2(JAVA)</a></li>
</ul>
</li>
<li><a href="#_6">引用</a></li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>忽略函数返回值的检测会导致不可预测的行为，在某些情况下会造成系统崩溃。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="1">不可预测的行为 <sup id="fnref-cwe"><a class="footnote-ref" href="#fn-cwe">1</a></sup></h4>
<p>如果攻击者控制函数返回一个异常的值，后面的程序逻辑会导致一个不可预测的行为。</p>
<h1 id="_3">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_4">缓解与预防</h1>
<p>检测函数的返回值。</p>
<h1 id="_5">演示实例</h1>
<h3 id="1c">漏洞代码示例1(C)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">test_check</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">test_check</span><span class="p">();</span>   <span class="c1">// Not check the return value</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码中没有检测函数test_check()的返回值。</p>
<h3 id="1c_1">漏洞代码修复示例1(C)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">test_check</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">test_check</span><span class="p">();</span> 
    <span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="p">...</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第6行代码中检测函数test_check()的返回值。</p>
<h3 id="2java">漏洞代码示例2(JAVA)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteFile</span><span class="o">(){</span>
  <span class="n">File</span> <span class="n">someFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"someFileName.txt"</span><span class="o">);</span>
   <span class="n">someFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>忽略了someFile.delete()的返回值。</p>
<h3 id="2java_1">漏洞代码修复示例2(JAVA)</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteFile</span><span class="o">(){</span>
  <span class="n">File</span> <span class="n">someFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"someFileName.txt"</span><span class="o">);</span>
   <span class="k">if</span> <span class="o">(!</span><span class="n">someFile</span><span class="o">.</span><span class="na">delete</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// handle failure to delete the file</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>对someFile.delete()的返回值进行判断。</p>
<h1 id="_6">引用</h1>
<div class="footnote">
<hr/>
<ol>
<li id="fn-cwe">
<p>https://cwe.mitre.org/data/definitions/252.html <a class="footnote-backref" href="#fnref-cwe" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                <a href="../../../tag/java.html">JAVA</a>
                <a href="../../../tag/find-bugs.html">FIND-BUGS</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE0005">不正确地释放COM接口指针</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a><ul>
<li><a href="#_3">使用释放过的内存</a></li>
</ul>
</li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">缓解与预防</a></li>
<li><a href="#_6">演示实例</a><ul>
<li><a href="#_7">漏洞代码示例</a></li>
<li><a href="#_8">漏洞代码修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>COM组件指明必须使用AddRef或Release方法管理接口指针。显式地释放一个接口指针并没有修改指针的引用计数，这样会导致其它拥有这个指针权限的接口继续使用该释放的指针，可能会造成使用释放内存的缺陷。</p>
<h1 id="_2">漏洞与风险</h1>
<h4 id="_3">使用释放过的内存</h4>
<p>显式地释放一个接口指针并没有修改指针的引用计数，这样会导致其它拥有这个指针权限的接口继续使用该释放的指针，可能会造成使用释放内存的缺陷。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">缓解与预防</h1>
<p>使用AddRef或Release方法管理接口指针。</p>
<h1 id="_6">演示实例</h1>
<h3 id="_7">漏洞代码示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">bad</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">IUnknown</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CFoo</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// bad</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第3行代码中显式地释放接口指针p。</p>
<h3 id="_8">漏洞代码修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">good</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">IUnknown</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CFoo</span><span class="p">;</span>
  <span class="n">p</span><span class="o">-&gt;</span><span class="n">AddRef</span><span class="p">();</span> <span class="c1">// p-&gt;Release();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在第3行代码调用方法AddRef()来管理接口指针p。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

        <article class="single">
            <header>
                <div class="breadcrumb">
                <ol>
                    <li>
                        <a href="../../../standard/c.html">c/c++</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues.html">质量问题</a>
                    </li>
                    <li>
                            <a href="../../../subcategory/c/quality issues/logic errors.html">逻辑错误</a>
                    </li>
                </ol>
                
                </div>

                <h1 id="PE1053">计算表达式不清晰</h1>
                <p>
                    在 2024-九月-28 发布于 <a href="../../../category/logic-errors.html">逻辑错误</a> 分类

                    &#8226; 1 min read
                </p>
            </header>

                <div class="toc">
<ul>
<li><a href="#_1">缺陷描述</a></li>
<li><a href="#_2">漏洞与风险</a></li>
<li><a href="#_3">缓解与预防</a></li>
<li><a href="#_4">漏洞利用威胁</a></li>
<li><a href="#_5">演示示例</a><ul>
<li><a href="#_6">漏洞缺陷示例</a></li>
<li><a href="#_7">漏洞缺陷修复示例</a></li>
</ul>
</li>
</ul>
</div>

            <div>
                
<h1 id="_1">缺陷描述</h1>
<p>计算表达式表述不清楚，使得同一个表达式有多种理解方式。例如'a+b?c:d'可能原意是想表达(a+b)?c:d或a+(b?c:d)。当一个if语句被分号提前终止时，then语句将永远被执行，从而改变了if语句的逻辑。在while,for等循环语句被分号提前终止时，可能会导致死循环或者循环体部分只被执行一次。</p>
<h1 id="_2">漏洞与风险</h1>
<p>若表达式没有被正确理解，或者程序执行逻辑与原意不同，则整个程序将脱离预定轨迹运行，甚至形成死循环并导致程序崩溃。</p>
<h1 id="_3">缓解与预防</h1>
<p>对于表达式，尽量多用括号标明运算步骤。对于判断和循环语句，注意分号所在位置。</p>
<h1 id="_4">漏洞利用威胁</h1>
<p>中</p>
<h1 id="_5">演示示例</h1>
<h3 id="_6">漏洞缺陷示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define FAIL 0</span>
<span class="cp">#define SUCCESS 1</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">validateUser</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">isUser</span> <span class="o">=</span> <span class="n">FAIL</span><span class="p">;</span>
  <span class="c1">// call method to authenticate username and password</span>
  <span class="c1">// if authentication fails then return failure otherwise return success</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">isUser</span> <span class="o">=</span> <span class="n">AuthenticateUser</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//detect</span>
    <span class="k">return</span> <span class="n">isUser</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">isUser</span> <span class="o">=</span> <span class="n">SUCCESS</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">isUser</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在这种情况下，“==”的优先级高于“=”，因此对于判断语句，将先进行AuthenticateUser(username, password) == FAIL的比较，然后对isUser进行赋值，从而导致整个程序逻辑错误。</p>
<h3 id="_7">漏洞缺陷修复示例</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define FAIL 0</span>
<span class="cp">#define SUCCESS 1</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">validateUser</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">isUser</span> <span class="o">=</span> <span class="n">FAIL</span><span class="p">;</span>
  <span class="c1">// call method to authenticate username and password</span>
  <span class="c1">// if authentication fails then return failure otherwise return success</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">isUser</span> <span class="o">=</span> <span class="n">AuthenticateUser</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">isUser</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">isUser</span> <span class="o">=</span> <span class="n">SUCCESS</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">isUser</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
<p>在上面代码中，我们只需要加上小括号先进行复制运算再进行比较运算就可以了。</p>
            </div>
            <div class="tag-cloud">
                <p>
                <a href="../../../tag/c.html">C</a>
                <a href="../../../tag/cpp.html">CPP</a>
                </p>
            </div>
        </article>

    <footer>
 <p>
  &copy; Pinpoint 2016-Present, Pinpoint 源代码静态缺陷分析系统, 源伞科技有限公司 - 保留所有权利
</p>

<p>
</p>     </footer>
</main>

  <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Pinpoint Document ",
  "url" : "../../..",
  "image": "",
  "description": "Manual and documents for Sourcebrella Pinpoint"
}
</script> 
<div id="initDiv"
     style="position: fixed; z-index: 1000; background-color: white; top: 0; right: 0; bottom: 0; left: 0; "></div>
<script type="text/javascript">
    window.onload = function () {
        document.getElementsByTagName('body')[0].style.display = "block";
        document.getElementById('initDiv').style.display = 'none';

        document.querySelectorAll('.global_lang li a').forEach(elm => {
            elm.addEventListener('click', (e) => {
                var lang = e.target.getAttribute('language-link');
                var abs_url = '/' + lang + '/';
                var reg = /\/(en|zh)\//;
                var newRef;
                var location = window.location;
                if (reg.test(location.href)) {
                    newRef = location.href.replace(reg, abs_url);
                } else {
                    var match = /\/(output|docs)\//.exec(window.location.href);
                    if (match) {
                        newRef = window.location.href.replace(match[0], '/' + match[1] + abs_url)
                    } else {
                        return;
                    }
                }
                window.open(newRef, '_self')
            })
        })
    };

</script>
</body>

</html>