<article class="bugdoc">
    <h2 class="bugdoc-title" id="Bug-Doc:PE0094">PE0094: Use of Pseudo-Random Number Generator(PRNG)</h2>
    <h3>The product uses a Pseudo-Random Number Generator (PRNG) in a security context, but the PRNG's algorithm is not cryptographically strong. </h3>
    <section id="tip">
     <h4 style="border-top: 0pt; padding: 0pt 4pt 4pt 4pt;">Bug info</h4>
                <dl>
                    <dt>BugTypeID</dt>
                    <dd>PE0094</dd>
                    <dt>Tags</dt>
                    <dd>C, C++, CWE-338</dd>
                    <dt>Category</dt>
                    <dd>Checkers/CPP</dd>
                    <dt>Authors</dt>
                    <dd>pinpoint</dd>
                </dl>
    <h4>Description</h4>
<p>When a non-cryptographic PRNG is used in a cryptographic context, it can expose the cryptography to certain types of attacks.</p>
<p>Often a pseudo-random number generator (PRNG) is not designed for cryptography. Sometimes a mediocre source of randomness is sufficient or preferable for algorithms that use random numbers. Weak generators generally take less processing power and/or do not use the precious, finite, entropy sources on a system. While such PRNGs might have very useful features, these same features could be used to break the cryptography.</p>
<h4>Vulnerability and risk</h4>
<p>If a PRNG is used for authentication and authorization, such as a session ID or a seed for generating a cryptographic key, then an attacker may be able to easily guess the ID or cryptographic key and gain access to restricted functionality.</p>
<h4>Potential Mitigations</h4>
<p>Use functions or hardware which use a hardware-based random number generation for all crypto. This is the recommended solution. Use CyptGenRandom on Windows, or hw_rand() on Linux.</p>
<h4>Likelihood of Exploit</h4>
<p>Low</p>
<h4>Demonstrative Examples</h4>
<h5>Vulnerable code Example 1</h5>
<p>This example uses a statistical PRNG to generate a random number:</p>
<div class="highlight"><pre><span></span><span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">());</span>
<span class="kt">int</span> <span class="n">randNum</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
</pre></div>
<p>The random number functions used in these examples, rand() and Random.nextInt(), are not considered cryptographically strong. An attacker may be able to predict the random numbers generated by these functions. Note that these example also exhibit CWE-337 (Predictable Seed in PRNG).</p>
<h5>Vulnerable code Example 2</h5>
<p>This example generates a sequence of 10 pseudorandom numbers using the random() function. When random() is not seeded, it behaves like rand(), producing the same sequence of random numbers each time any program that uses it is run.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* Always generates the same sequence */</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%ld, &quot;</span><span class="p">,</span> <span class="n">random</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h4>References</h4>
<section class="footnotes">
<ol>
<li id="fn-1"><p>http://cwe.mitre.org/data/definitions/338.html<a href="#fnref-1" class="footnote">&#8617;</a></p></li>
</ol>
</section>

    </section>
</article>
